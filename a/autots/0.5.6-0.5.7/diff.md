# Comparing `tmp/autots-0.5.6.tar.gz` & `tmp/autots-0.5.7.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "autots-0.5.6.tar", last modified: Mon Apr 10 03:32:24 2023, max compression
+gzip compressed data, was "autots-0.5.7.tar", last modified: Tue May 23 03:24:56 2023, max compression
```

## Comparing `autots-0.5.6.tar` & `autots-0.5.7.tar`

### file list

```diff
@@ -1,89 +1,89 @@
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.619454 autots-0.5.6/
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.480050 autots-0.5.6/AutoTS.egg-info/
--rw-rw-rw-   0        0        0     8893 2023-04-10 03:32:24.000000 autots-0.5.6/AutoTS.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0     2148 2023-04-10 03:32:24.000000 autots-0.5.6/AutoTS.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2023-04-10 03:32:24.000000 autots-0.5.6/AutoTS.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0      224 2023-04-10 03:32:24.000000 autots-0.5.6/AutoTS.egg-info/requires.txt
--rw-rw-rw-   0        0        0       33 2023-04-10 03:32:24.000000 autots-0.5.6/AutoTS.egg-info/top_level.txt
--rw-rw-rw-   0        0        0     1090 2022-11-23 22:39:41.000000 autots-0.5.6/LICENSE
--rw-rw-rw-   0        0        0       61 2023-04-03 03:08:26.000000 autots-0.5.6/MANIFEST.in
--rw-rw-rw-   0        0        0     8893 2023-04-10 03:32:24.619454 autots-0.5.6/PKG-INFO
--rw-rw-rw-   0        0        0     8248 2023-04-02 18:42:06.000000 autots-0.5.6/README.md
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.480050 autots-0.5.6/autots/
--rw-rw-rw-   0        0        0     1384 2023-04-03 14:59:13.000000 autots-0.5.6/autots/__init__.py
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.480050 autots-0.5.6/autots/datasets/
--rw-rw-rw-   0        0        0      535 2022-11-23 22:39:41.000000 autots-0.5.6/autots/datasets/__init__.py
--rw-rw-rw-   0        0        0    32463 2023-04-08 14:56:53.000000 autots-0.5.6/autots/datasets/_base.py
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.521292 autots-0.5.6/autots/datasets/data/
--rw-rw-rw-   0        0        0     4527 2022-11-23 22:39:41.000000 autots-0.5.6/autots/datasets/data/covid_daily.zip
--rw-rw-rw-   0        0        0    81380 2022-11-23 22:39:41.000000 autots-0.5.6/autots/datasets/data/eia_weekly.zip
--rw-rw-rw-   0        0        0    27440 2022-11-23 22:39:41.000000 autots-0.5.6/autots/datasets/data/fred_monthly.zip
--rw-rw-rw-   0        0        0     5553 2022-11-23 22:39:41.000000 autots-0.5.6/autots/datasets/data/fred_yearly.zip
--rw-rw-rw-   0        0        0   107751 2022-11-23 22:39:41.000000 autots-0.5.6/autots/datasets/data/holidays.zip
--rw-rw-rw-   0        0        0   158529 2022-11-23 22:39:41.000000 autots-0.5.6/autots/datasets/data/traffic_hourly.zip
--rw-rw-rw-   0        0        0     3377 2023-04-10 03:29:38.000000 autots-0.5.6/autots/datasets/fred.py
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.537294 autots-0.5.6/autots/evaluator/
--rw-rw-rw-   0        0        0       28 2022-11-23 22:39:41.000000 autots-0.5.6/autots/evaluator/__init__.py
--rw-rw-rw-   0        0        0    16533 2023-04-10 03:29:38.000000 autots-0.5.6/autots/evaluator/anomaly_detector.py
--rw-rw-rw-   0        0        0   108611 2023-04-10 03:29:40.000000 autots-0.5.6/autots/evaluator/auto_model.py
--rw-rw-rw-   0        0        0   139190 2023-04-10 03:29:40.000000 autots-0.5.6/autots/evaluator/auto_ts.py
--rw-rw-rw-   0        0        0    24446 2022-11-23 22:39:41.000000 autots-0.5.6/autots/evaluator/benchmark.py
--rw-rw-rw-   0        0        0    32646 2023-02-01 17:49:09.000000 autots-0.5.6/autots/evaluator/event_forecasting.py
--rw-rw-rw-   0        0        0    21898 2023-04-10 03:29:38.000000 autots-0.5.6/autots/evaluator/metrics.py
--rw-rw-rw-   0        0        0     6490 2023-02-01 17:49:09.000000 autots-0.5.6/autots/evaluator/validation.py
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.549472 autots-0.5.6/autots/models/
--rw-rw-rw-   0        0        0       24 2022-11-23 22:39:41.000000 autots-0.5.6/autots/models/__init__.py
--rw-rw-rw-   0        0        0    14112 2023-01-16 02:41:20.000000 autots-0.5.6/autots/models/arch.py
--rw-rw-rw-   0        0        0    22960 2023-04-07 20:55:54.000000 autots-0.5.6/autots/models/base.py
--rw-rw-rw-   0        0        0   112063 2023-04-10 03:29:40.000000 autots-0.5.6/autots/models/basics.py
--rw-rw-rw-   0        0        0   114816 2023-04-03 02:46:29.000000 autots-0.5.6/autots/models/cassandra.py
--rw-rw-rw-   0        0        0    16461 2022-11-23 22:39:41.000000 autots-0.5.6/autots/models/dnn.py
--rw-rw-rw-   0        0        0    62892 2023-04-10 03:29:39.000000 autots-0.5.6/autots/models/ensemble.py
--rw-rw-rw-   0        0        0    28446 2023-04-10 03:29:38.000000 autots-0.5.6/autots/models/gluonts.py
--rw-rw-rw-   0        0        0    10745 2023-04-10 03:29:38.000000 autots-0.5.6/autots/models/greykite.py
--rw-rw-rw-   0        0        0    33909 2022-11-23 22:39:41.000000 autots-0.5.6/autots/models/matrix_var.py
--rw-rw-rw-   0        0        0    19900 2023-04-10 03:29:38.000000 autots-0.5.6/autots/models/mlensemble.py
--rw-rw-rw-   0        0        0     8136 2023-03-31 21:04:36.000000 autots-0.5.6/autots/models/model_list.py
--rw-rw-rw-   0        0        0    33743 2022-11-23 22:39:41.000000 autots-0.5.6/autots/models/prophet.py
--rw-rw-rw-   0        0        0    19975 2022-11-23 22:39:41.000000 autots-0.5.6/autots/models/pytorch.py
--rw-rw-rw-   0        0        0   119304 2023-04-09 12:36:00.000000 autots-0.5.6/autots/models/sklearn.py
--rw-rw-rw-   0        0        0    93302 2023-02-01 17:49:10.000000 autots-0.5.6/autots/models/statsmodels.py
--rw-rw-rw-   0        0        0    21794 2022-11-23 22:39:41.000000 autots-0.5.6/autots/models/tfp.py
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.551032 autots-0.5.6/autots/templates/
--rw-rw-rw-   0        0        0       27 2022-11-23 22:39:41.000000 autots-0.5.6/autots/templates/__init__.py
--rw-rw-rw-   0        0        0    42365 2023-01-21 02:30:16.000000 autots-0.5.6/autots/templates/general.py
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.563306 autots-0.5.6/autots/tools/
--rw-rw-rw-   0        0        0       96 2022-11-23 22:39:41.000000 autots-0.5.6/autots/tools/__init__.py
--rw-rw-rw-   0        0        0    42765 2023-04-10 03:29:39.000000 autots-0.5.6/autots/tools/anomaly_utils.py
--rw-rw-rw-   0        0        0     9168 2023-04-08 14:59:14.000000 autots-0.5.6/autots/tools/calendar.py
--rw-rw-rw-   0        0        0     7163 2022-11-23 22:39:41.000000 autots-0.5.6/autots/tools/cointegration.py
--rw-rw-rw-   0        0        0     1709 2022-11-23 22:39:41.000000 autots-0.5.6/autots/tools/cpu_count.py
--rw-rw-rw-   0        0        0    40373 2023-03-11 22:20:32.000000 autots-0.5.6/autots/tools/fast_kalman.py
--rw-rw-rw-   0        0        0     5872 2022-11-23 22:39:41.000000 autots-0.5.6/autots/tools/hierarchial.py
--rw-rw-rw-   0        0        0     4491 2023-04-08 15:58:34.000000 autots-0.5.6/autots/tools/holiday.py
--rw-rw-rw-   0        0        0     9153 2022-11-23 22:39:41.000000 autots-0.5.6/autots/tools/impute.py
--rw-rw-rw-   0        0        0     5188 2022-11-23 22:39:41.000000 autots-0.5.6/autots/tools/lunar.py
--rw-rw-rw-   0        0        0     4362 2022-11-23 22:39:41.000000 autots-0.5.6/autots/tools/percentile.py
--rw-rw-rw-   0        0        0     7786 2022-11-23 22:39:41.000000 autots-0.5.6/autots/tools/probabilistic.py
--rw-rw-rw-   0        0        0     1001 2022-11-23 22:39:41.000000 autots-0.5.6/autots/tools/profile.py
--rw-rw-rw-   0        0        0    15361 2023-04-09 14:46:49.000000 autots-0.5.6/autots/tools/regressor.py
--rw-rw-rw-   0        0        0    16300 2023-04-10 03:29:39.000000 autots-0.5.6/autots/tools/seasonal.py
--rw-rw-rw-   0        0        0    18046 2023-04-08 14:58:25.000000 autots-0.5.6/autots/tools/shaping.py
--rw-rw-rw-   0        0        0    19147 2023-04-08 14:59:28.000000 autots-0.5.6/autots/tools/thresholding.py
--rw-rw-rw-   0        0        0   149956 2023-04-10 03:29:41.000000 autots-0.5.6/autots/tools/transform.py
--rw-rw-rw-   0        0        0    18154 2023-04-10 03:29:39.000000 autots-0.5.6/autots/tools/window_functions.py
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.564208 autots-0.5.6/docs/
--rw-rw-rw-   0        0        0     2750 2023-04-08 14:52:49.000000 autots-0.5.6/docs/conf.py
--rw-rw-rw-   0        0        0     1176 2023-04-08 14:52:59.000000 autots-0.5.6/pyproject.toml
--rw-rw-rw-   0        0        0       42 2023-04-10 03:32:24.619454 autots-0.5.6/setup.cfg
--rw-rw-rw-   0        0        0     1273 2023-04-08 14:52:53.000000 autots-0.5.6/setup.py
-drwxrwxrwx   0        0        0        0 2023-04-10 03:32:24.619454 autots-0.5.6/tests/
--rw-rw-rw-   0        0        0     4677 2022-11-23 22:39:41.000000 autots-0.5.6/tests/test_anomalies.py
--rw-rw-rw-   0        0        0    29300 2023-04-03 04:16:21.000000 autots-0.5.6/tests/test_autots.py
--rw-rw-rw-   0        0        0     4259 2022-11-23 22:39:41.000000 autots-0.5.6/tests/test_calendar_holiday.py
--rw-rw-rw-   0        0        0    10554 2023-04-02 03:12:25.000000 autots-0.5.6/tests/test_cassandra.py
--rw-rw-rw-   0        0        0     3654 2022-11-23 22:39:41.000000 autots-0.5.6/tests/test_event_forecasting.py
--rw-rw-rw-   0        0        0     1512 2022-11-23 22:39:41.000000 autots-0.5.6/tests/test_impute.py
--rw-rw-rw-   0        0        0     5112 2023-03-31 21:50:22.000000 autots-0.5.6/tests/test_metrics.py
--rw-rw-rw-   0        0        0     1514 2022-11-23 22:39:41.000000 autots-0.5.6/tests/test_percentile.py
--rw-rw-rw-   0        0        0     1836 2022-11-23 22:39:41.000000 autots-0.5.6/tests/test_regressor.py
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.441638 autots-0.5.7/
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.123592 autots-0.5.7/AutoTS.egg-info/
+-rw-rw-rw-   0        0        0     8896 2023-05-23 03:24:55.000000 autots-0.5.7/AutoTS.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0     2148 2023-05-23 03:24:56.000000 autots-0.5.7/AutoTS.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-05-23 03:24:55.000000 autots-0.5.7/AutoTS.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0      224 2023-05-23 03:24:55.000000 autots-0.5.7/AutoTS.egg-info/requires.txt
+-rw-rw-rw-   0        0        0       33 2023-05-23 03:24:55.000000 autots-0.5.7/AutoTS.egg-info/top_level.txt
+-rw-rw-rw-   0        0        0     1090 2022-11-23 22:39:41.000000 autots-0.5.7/LICENSE
+-rw-rw-rw-   0        0        0       61 2023-04-03 03:08:26.000000 autots-0.5.7/MANIFEST.in
+-rw-rw-rw-   0        0        0     8896 2023-05-23 03:24:56.441638 autots-0.5.7/PKG-INFO
+-rw-rw-rw-   0        0        0     8251 2023-04-10 03:35:49.000000 autots-0.5.7/README.md
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.123592 autots-0.5.7/autots/
+-rw-rw-rw-   0        0        0     1384 2023-04-03 14:59:13.000000 autots-0.5.7/autots/__init__.py
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.140069 autots-0.5.7/autots/datasets/
+-rw-rw-rw-   0        0        0      535 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/__init__.py
+-rw-rw-rw-   0        0        0    32463 2023-04-08 14:56:53.000000 autots-0.5.7/autots/datasets/_base.py
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.220747 autots-0.5.7/autots/datasets/data/
+-rw-rw-rw-   0        0        0     4527 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/covid_daily.zip
+-rw-rw-rw-   0        0        0    81380 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/eia_weekly.zip
+-rw-rw-rw-   0        0        0    27440 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/fred_monthly.zip
+-rw-rw-rw-   0        0        0     5553 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/fred_yearly.zip
+-rw-rw-rw-   0        0        0   107751 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/holidays.zip
+-rw-rw-rw-   0        0        0   158529 2022-11-23 22:39:41.000000 autots-0.5.7/autots/datasets/data/traffic_hourly.zip
+-rw-rw-rw-   0        0        0     3377 2023-04-10 03:29:38.000000 autots-0.5.7/autots/datasets/fred.py
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.252378 autots-0.5.7/autots/evaluator/
+-rw-rw-rw-   0        0        0       28 2022-11-23 22:39:41.000000 autots-0.5.7/autots/evaluator/__init__.py
+-rw-rw-rw-   0        0        0    16533 2023-04-10 03:29:38.000000 autots-0.5.7/autots/evaluator/anomaly_detector.py
+-rw-rw-rw-   0        0        0   108732 2023-05-23 03:16:40.000000 autots-0.5.7/autots/evaluator/auto_model.py
+-rw-rw-rw-   0        0        0   140077 2023-05-23 03:16:41.000000 autots-0.5.7/autots/evaluator/auto_ts.py
+-rw-rw-rw-   0        0        0    24446 2022-11-23 22:39:41.000000 autots-0.5.7/autots/evaluator/benchmark.py
+-rw-rw-rw-   0        0        0    32646 2023-02-01 17:49:09.000000 autots-0.5.7/autots/evaluator/event_forecasting.py
+-rw-rw-rw-   0        0        0    21871 2023-05-13 12:57:26.000000 autots-0.5.7/autots/evaluator/metrics.py
+-rw-rw-rw-   0        0        0     6490 2023-02-01 17:49:09.000000 autots-0.5.7/autots/evaluator/validation.py
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.274942 autots-0.5.7/autots/models/
+-rw-rw-rw-   0        0        0       24 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/__init__.py
+-rw-rw-rw-   0        0        0    14112 2023-01-16 02:41:20.000000 autots-0.5.7/autots/models/arch.py
+-rw-rw-rw-   0        0        0    23395 2023-05-23 03:16:38.000000 autots-0.5.7/autots/models/base.py
+-rw-rw-rw-   0        0        0   112063 2023-04-10 03:29:40.000000 autots-0.5.7/autots/models/basics.py
+-rw-rw-rw-   0        0        0   115339 2023-05-23 03:16:41.000000 autots-0.5.7/autots/models/cassandra.py
+-rw-rw-rw-   0        0        0    16461 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/dnn.py
+-rw-rw-rw-   0        0        0    63476 2023-05-23 03:16:40.000000 autots-0.5.7/autots/models/ensemble.py
+-rw-rw-rw-   0        0        0    28446 2023-04-10 03:29:38.000000 autots-0.5.7/autots/models/gluonts.py
+-rw-rw-rw-   0        0        0    10745 2023-04-10 03:29:38.000000 autots-0.5.7/autots/models/greykite.py
+-rw-rw-rw-   0        0        0    33909 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/matrix_var.py
+-rw-rw-rw-   0        0        0    19900 2023-04-10 03:29:38.000000 autots-0.5.7/autots/models/mlensemble.py
+-rw-rw-rw-   0        0        0     8280 2023-05-23 03:16:38.000000 autots-0.5.7/autots/models/model_list.py
+-rw-rw-rw-   0        0        0    33743 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/prophet.py
+-rw-rw-rw-   0        0        0    19975 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/pytorch.py
+-rw-rw-rw-   0        0        0   119274 2023-05-09 17:46:20.000000 autots-0.5.7/autots/models/sklearn.py
+-rw-rw-rw-   0        0        0    93302 2023-02-01 17:49:10.000000 autots-0.5.7/autots/models/statsmodels.py
+-rw-rw-rw-   0        0        0    21794 2022-11-23 22:39:41.000000 autots-0.5.7/autots/models/tfp.py
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.274942 autots-0.5.7/autots/templates/
+-rw-rw-rw-   0        0        0       27 2022-11-23 22:39:41.000000 autots-0.5.7/autots/templates/__init__.py
+-rw-rw-rw-   0        0        0    42365 2023-01-21 02:30:16.000000 autots-0.5.7/autots/templates/general.py
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.301397 autots-0.5.7/autots/tools/
+-rw-rw-rw-   0        0        0       96 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/__init__.py
+-rw-rw-rw-   0        0        0    42765 2023-04-10 03:29:39.000000 autots-0.5.7/autots/tools/anomaly_utils.py
+-rw-rw-rw-   0        0        0     9168 2023-04-08 14:59:14.000000 autots-0.5.7/autots/tools/calendar.py
+-rw-rw-rw-   0        0        0     7163 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/cointegration.py
+-rw-rw-rw-   0        0        0     1709 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/cpu_count.py
+-rw-rw-rw-   0        0        0    40373 2023-03-11 22:20:32.000000 autots-0.5.7/autots/tools/fast_kalman.py
+-rw-rw-rw-   0        0        0     5872 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/hierarchial.py
+-rw-rw-rw-   0        0        0     5983 2023-05-23 03:16:38.000000 autots-0.5.7/autots/tools/holiday.py
+-rw-rw-rw-   0        0        0     9153 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/impute.py
+-rw-rw-rw-   0        0        0     5188 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/lunar.py
+-rw-rw-rw-   0        0        0     4362 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/percentile.py
+-rw-rw-rw-   0        0        0     7786 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/probabilistic.py
+-rw-rw-rw-   0        0        0     1001 2022-11-23 22:39:41.000000 autots-0.5.7/autots/tools/profile.py
+-rw-rw-rw-   0        0        0    15361 2023-04-09 14:46:49.000000 autots-0.5.7/autots/tools/regressor.py
+-rw-rw-rw-   0        0        0    20206 2023-05-23 03:16:39.000000 autots-0.5.7/autots/tools/seasonal.py
+-rw-rw-rw-   0        0        0    18046 2023-04-08 14:58:25.000000 autots-0.5.7/autots/tools/shaping.py
+-rw-rw-rw-   0        0        0    19147 2023-04-08 14:59:28.000000 autots-0.5.7/autots/tools/thresholding.py
+-rw-rw-rw-   0        0        0   158744 2023-05-23 03:16:42.000000 autots-0.5.7/autots/tools/transform.py
+-rw-rw-rw-   0        0        0    18154 2023-04-10 03:29:39.000000 autots-0.5.7/autots/tools/window_functions.py
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.301397 autots-0.5.7/docs/
+-rw-rw-rw-   0        0        0     2748 2023-05-18 20:02:15.000000 autots-0.5.7/docs/conf.py
+-rw-rw-rw-   0        0        0     1176 2023-05-18 20:02:32.000000 autots-0.5.7/pyproject.toml
+-rw-rw-rw-   0        0        0       42 2023-05-23 03:24:56.441638 autots-0.5.7/setup.cfg
+-rw-rw-rw-   0        0        0     1273 2023-05-18 20:02:24.000000 autots-0.5.7/setup.py
+drwxrwxrwx   0        0        0        0 2023-05-23 03:24:56.441638 autots-0.5.7/tests/
+-rw-rw-rw-   0        0        0     4677 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_anomalies.py
+-rw-rw-rw-   0        0        0    29348 2023-05-05 03:21:32.000000 autots-0.5.7/tests/test_autots.py
+-rw-rw-rw-   0        0        0     6882 2023-05-17 21:08:23.000000 autots-0.5.7/tests/test_calendar_holiday.py
+-rw-rw-rw-   0        0        0    10554 2023-04-02 03:12:25.000000 autots-0.5.7/tests/test_cassandra.py
+-rw-rw-rw-   0        0        0     3654 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_event_forecasting.py
+-rw-rw-rw-   0        0        0     1512 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_impute.py
+-rw-rw-rw-   0        0        0     5118 2023-05-17 20:57:36.000000 autots-0.5.7/tests/test_metrics.py
+-rw-rw-rw-   0        0        0     1514 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_percentile.py
+-rw-rw-rw-   0        0        0     1836 2022-11-23 22:39:41.000000 autots-0.5.7/tests/test_regressor.py
```

### Comparing `autots-0.5.6/AutoTS.egg-info/PKG-INFO` & `autots-0.5.7/AutoTS.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: autots
-Version: 0.5.6
+Version: 0.5.7
 Summary: Automated Time Series Forecasting
 Home-page: https://github.com/winedarksea/AutoTS
 Author: Colin Catlin
 Author-email: Colin Catlin <colin.catlin@gmail.com>
 License: MIT License
 Project-URL: Homepage, https://github.com/winedarksea/AutoTS
 Project-URL: Bug Tracker, https://github.com/winedarksea/AutoTS/issues
@@ -18,15 +18,15 @@
 
 # AutoTS
 
 <img src="/img/autots_1280.png" width="400" height="184" title="AutoTS Logo">
 
 AutoTS is a time series package for Python designed for rapidly deploying high-accuracy forecasts at scale. 
 
-In 2023, AutoTS has won the M6 forecasting competition, delivering the highest performance investment decisions across 12 months of stock market forecasting.
+In 2023, AutoTS has won in the M6 forecasting competition, delivering the highest performance investment decisions across 12 months of stock market forecasting.
 
 There are dozens of forecasting models usable in the `sklearn` style of `.fit()` and `.predict()`. 
 These includes naive, statistical, machine learning, and deep learning models. 
 Additionally, there are over 30 time series specific transforms usable in the `sklearn` style of `.fit()`, `.transform()` and `.inverse_transform()`. 
 All of these function directly on Pandas Dataframes, without the need for conversion to proprietary objects. 
 
 All models support forecasting multivariate (multiple time series) outputs and also support probabilistic (upper/lower bound) forecasts.
```

### Comparing `autots-0.5.6/AutoTS.egg-info/SOURCES.txt` & `autots-0.5.7/AutoTS.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/LICENSE` & `autots-0.5.7/LICENSE`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/PKG-INFO` & `autots-0.5.7/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: autots
-Version: 0.5.6
+Version: 0.5.7
 Summary: Automated Time Series Forecasting
 Home-page: https://github.com/winedarksea/AutoTS
 Author: Colin Catlin
 Author-email: Colin Catlin <colin.catlin@gmail.com>
 License: MIT License
 Project-URL: Homepage, https://github.com/winedarksea/AutoTS
 Project-URL: Bug Tracker, https://github.com/winedarksea/AutoTS/issues
@@ -18,15 +18,15 @@
 
 # AutoTS
 
 <img src="/img/autots_1280.png" width="400" height="184" title="AutoTS Logo">
 
 AutoTS is a time series package for Python designed for rapidly deploying high-accuracy forecasts at scale. 
 
-In 2023, AutoTS has won the M6 forecasting competition, delivering the highest performance investment decisions across 12 months of stock market forecasting.
+In 2023, AutoTS has won in the M6 forecasting competition, delivering the highest performance investment decisions across 12 months of stock market forecasting.
 
 There are dozens of forecasting models usable in the `sklearn` style of `.fit()` and `.predict()`. 
 These includes naive, statistical, machine learning, and deep learning models. 
 Additionally, there are over 30 time series specific transforms usable in the `sklearn` style of `.fit()`, `.transform()` and `.inverse_transform()`. 
 All of these function directly on Pandas Dataframes, without the need for conversion to proprietary objects. 
 
 All models support forecasting multivariate (multiple time series) outputs and also support probabilistic (upper/lower bound) forecasts.
```

### Comparing `autots-0.5.6/README.md` & `autots-0.5.7/README.md`

 * *Files 2% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 # AutoTS
 
 <img src="/img/autots_1280.png" width="400" height="184" title="AutoTS Logo">
 
 AutoTS is a time series package for Python designed for rapidly deploying high-accuracy forecasts at scale. 
 
-In 2023, AutoTS has won the M6 forecasting competition, delivering the highest performance investment decisions across 12 months of stock market forecasting.
+In 2023, AutoTS has won in the M6 forecasting competition, delivering the highest performance investment decisions across 12 months of stock market forecasting.
 
 There are dozens of forecasting models usable in the `sklearn` style of `.fit()` and `.predict()`. 
 These includes naive, statistical, machine learning, and deep learning models. 
 Additionally, there are over 30 time series specific transforms usable in the `sklearn` style of `.fit()`, `.transform()` and `.inverse_transform()`. 
 All of these function directly on Pandas Dataframes, without the need for conversion to proprietary objects. 
 
 All models support forecasting multivariate (multiple time series) outputs and also support probabilistic (upper/lower bound) forecasts.
```

### Comparing `autots-0.5.6/autots/__init__.py` & `autots-0.5.7/autots/__init__.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/datasets/__init__.py` & `autots-0.5.7/autots/datasets/__init__.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/datasets/_base.py` & `autots-0.5.7/autots/datasets/_base.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/datasets/data/covid_daily.zip` & `autots-0.5.7/autots/datasets/data/covid_daily.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/datasets/data/eia_weekly.zip` & `autots-0.5.7/autots/datasets/data/eia_weekly.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/datasets/data/fred_monthly.zip` & `autots-0.5.7/autots/datasets/data/fred_monthly.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/datasets/data/fred_yearly.zip` & `autots-0.5.7/autots/datasets/data/fred_yearly.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/datasets/data/holidays.zip` & `autots-0.5.7/autots/datasets/data/holidays.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/datasets/data/traffic_hourly.zip` & `autots-0.5.7/autots/datasets/data/traffic_hourly.zip`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/datasets/fred.py` & `autots-0.5.7/autots/datasets/fred.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/evaluator/anomaly_detector.py` & `autots-0.5.7/autots/evaluator/anomaly_detector.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/evaluator/auto_model.py` & `autots-0.5.7/autots/evaluator/auto_model.py`

 * *Files 0% similar despite different names*

```diff
@@ -695,15 +695,17 @@
             try:
                 with open(f'{current_model_file}_failure.json', 'w') as f:
                     f.write(error_msg)
             except Exception:
                 pass
             print(error_msg)
 
-    transformer_object = GeneralTransformer(**transformation_dict, n_jobs=n_jobs)
+    transformer_object = GeneralTransformer(
+        **transformation_dict, n_jobs=n_jobs, holiday_country=holiday_country
+    )
     df_train_transformed = transformer_object._fit(df_train)
 
     # make sure regressor has same length. This could be a problem if wrong size regressor is passed.
     if future_regressor_train is not None:
         future_regressor_train = future_regressor_train.reindex(df_train.index)
 
     transformation_runtime = datetime.datetime.now() - transformationStartTime
@@ -732,14 +734,15 @@
                 "Model {} returned NaN for one or more series. fail_on_forecast_nan=True".format(
                     model_str
                 )
             )
 
     transformationStartTime = datetime.datetime.now()
     # Inverse the transformations, NULL FILLED IN UPPER/LOWER ONLY
+    # forecast inverse MUST come before upper and lower bounds inverse
     df_forecast.forecast = pd.DataFrame(
         transformer_object.inverse_transform(df_forecast.forecast)
     )
     df_forecast.lower_forecast = pd.DataFrame(
         transformer_object.inverse_transform(
             df_forecast.lower_forecast, fillzero=True, bounds=True
         )
```

### Comparing `autots-0.5.6/autots/evaluator/auto_ts.py` & `autots-0.5.7/autots/evaluator/auto_ts.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 import numpy as np
 import pandas as pd
 import random
 import copy
 import json
 import sys
 import time
+import traceback as tb
 
 from autots.tools.shaping import (
     long_to_wide,
     df_cleanup,
     subset_series,
     simple_train_test_split,
     NumericTransformer,
@@ -46,14 +47,15 @@
 
 
 class AutoTS(object):
     """Automate time series modeling using a genetic algorithm.
 
     Args:
         forecast_length (int): number of periods over which to evaluate forecast. Can be overriden later in .predict().
+            when you don't have much historical data, using a small forecast length for .fit and the full desired forecast lenght for .predict is usually the best possible approach given limitations.
         frequency (str): 'infer' or a specific pandas datetime offset. Can be used to force rollup of data (ie daily input, but frequency 'M' will rollup to monthly).
         prediction_interval (float): 0-1, uncertainty range for upper and lower forecasts. Adjust range, but rarely matches actual containment.
         max_generations (int): number of genetic algorithms generations to run.
             More runs = longer runtime, generally better accuracy.
             It's called `max` because someday there will be an auto early stopping option, but for now this is just the exact number of generations to run.
         no_negatives (bool): if True, all negative predictions are rounded up to 0.
         constraint (float): when not None, use this float value * data st dev above max or below min for constraining forecast values.
@@ -83,16 +85,17 @@
             occurs after any aggregration is applied, so will be whatever is specified by frequency, will drop n frequencies
         drop_data_older_than_periods (int): take only the n most recent timestamps
         model_list (list): str alias or list of names of model objects to use
             now can be a dictionary of {"model": prob} but only affects starting random templates. Genetic algorithim takes from there.
         transformer_list (list): list of transformers to use, or dict of transformer:probability. Note this does not apply to initial templates.
             can accept string aliases: "all", "fast", "superfast"
         transformer_max_depth (int): maximum number of sequential transformers to generate for new Random Transformers. Fewer will be faster.
-        models_mode (str): option to adjust parameter options for newly generated models. Currently includes:
-            'default', 'deep' (searches more params, likely slower), and 'regressor' (forces 'User' regressor mode in regressor capable models)
+        models_mode (str): option to adjust parameter options for newly generated models. Only sporadically utilized. Currently includes:
+            'default'/'random', 'deep' (searches more params, likely slower), and 'regressor' (forces 'User' regressor mode in regressor capable models),
+            'gradient_boosting', 'neuralnets' (~Regression class models only)
         num_validations (int): number of cross validations to perform. 0 for just train/test on best split.
             Possible confusion: num_validations is the number of validations to perform *after* the first eval segment, so totally eval/validations will be this + 1.
             Also "auto" and "max" aliases available. Max maxes out at 50.
         models_to_validate (int): top n models to pass through to cross validation. Or float in 0 to 1 as % of tried.
             0.99 is forced to 100% validation. 1 evaluates just 1 model.
             If horizontal or mosaic ensemble, then additional min per_series models above the number here are added to validation.
         max_per_model_class (int): of the models_to_validate what is the maximum to pass from any one model class/family.
@@ -423,15 +426,15 @@
         self.template_cols_id = (
             self.template_cols
             if "ID" in self.template_cols
             else ['ID'] + self.template_cols
         )
         self.initial_results = TemplateEvalObject()
         self.best_model_name = ""
-        self.best_model_params = ""
+        self.best_model_params = {}
         self.best_model_transformation_params = ""
         self.traceback = True if verbose > 1 else False
         self.future_regressor_train = None
         self.validation_train_indexes = []
         self.validation_test_indexes = []
         self.preclean_transformer = None
         self.score_per_series = None
@@ -924,15 +927,19 @@
             df_wide_numeric = remove_leading_zeros(df_wide_numeric)
 
         # check if NaN in last row
         self._nan_tail = df_wide_numeric.tail(2).isna().sum(axis=1).sum() > 0
 
         # preclean data
         if self.preclean is not None:
-            self.preclean_transformer = GeneralTransformer(**self.preclean)
+            self.preclean_transformer = GeneralTransformer(
+                **self.preclean,
+                n_jobs=self.n_jobs,
+                holiday_country=self.holiday_country,
+            )
             df_wide_numeric = self.preclean_transformer.fit_transform(df_wide_numeric)
 
         self.df_wide_numeric = df_wide_numeric
         self.startTimeStamps = df_wide_numeric.notna().idxmax()
 
         # check how many validations are possible given the length of the data.
         self.num_validations = validate_num_validations(
@@ -1149,15 +1156,17 @@
                     current_weights=current_weights,
                     validation_round=0,
                     max_generations="Ensembles",
                     current_generation=(current_generation + 1),
                     result_file=result_file,
                 )
             except Exception as e:
-                print(f"Ensembling Error: {repr(e)}")
+                print(
+                    f"Ensembling Error: {repr(e)}: {''.join(tb.format_exception(None, e, e.__traceback__))}"
+                )
 
         # drop any duplicates in results
         self.initial_results.model_results = (
             self.initial_results.model_results.drop_duplicates(
                 subset=(['ID'] + self.template_cols)
             )
         )
@@ -1279,15 +1288,17 @@
                         df_wide_numeric=df_wide_numeric,
                         num_validations=self.num_validations,
                         validation_template=ensemble_templates,
                         future_regressor=future_regressor,
                         first_validation=False,
                     )
                 except Exception as e:
-                    print(f"Ensembling Error: {repr(e)}")
+                    print(
+                        f"Post-Validation Ensembling Error: {repr(e)}: {''.join(tb.format_exception(None, e, e.__traceback__))}"
+                    )
                     time.sleep(5)
 
         error_msg_template = """No models available from validation.
 Try increasing models_to_validate, max_per_model_class
 or otherwise increase models available."""
 
         # run validation_results aggregation
@@ -1550,15 +1561,17 @@
                     result_file=result_file,
                 )
                 hens_model_results = self.initial_results.model_results[
                     self.initial_results.model_results['Ensemble'] == 2
                 ].copy()
             except Exception as e:
                 if self.verbose >= 0:
-                    print(f"Ensembling Error: {repr(e)}")
+                    print(
+                        f"Horizontal/Mosaic Ensembling Error: {repr(e)}: {''.join(tb.format_exception(None, e, e.__traceback__))}"
+                    )
                 hens_model_results = TemplateEvalObject().model_results.copy()
 
             # rerun validation_results aggregation with new models added
             self.validation_results = copy.copy(self.initial_results)
             self.validation_results = validation_aggregation(
                 self.validation_results, df_train=self.df_wide_numeric
             )
@@ -1620,15 +1633,17 @@
         self.best_model_transformation_params = json.loads(
             self.best_model['TransformationParameters'].iloc[0]
         )
         self.best_model_ensemble = self.best_model['Ensemble'].iloc[0]
         self.ensemble_check = int(self.best_model_ensemble > 0)
 
         # set flags to check if regressors or ensemble used in final model.
-        self.used_regressor_check = self._regr_param_check(self.best_model_params)
+        self.used_regressor_check = self._regr_param_check(
+            self.best_model_params.copy()
+        )
         self.regressor_used = self.used_regressor_check
         # clean up any remaining print statements
         sys.stdout.flush()
         return self
 
     def _regr_param_check(self, param_dict):
         """Help to search for if a regressor was used in model."""
@@ -1862,15 +1877,15 @@
 
         # allow multiple prediction intervals
         if isinstance(prediction_interval, list):
             forecast_objects = {}
             for interval in prediction_interval:
                 df_forecast = model_forecast(
                     model_name=self.best_model_name,
-                    model_param_dict=self.best_model_params,
+                    model_param_dict=self.best_model_params.copy(),
                     model_transform_dict=self.best_model_transformation_params,
                     df_train=self.df_wide_numeric,
                     forecast_length=forecast_length,
                     frequency=self.frequency,
                     prediction_interval=interval,
                     no_negatives=self.no_negatives,
                     constraint=self.constraint,
@@ -1912,15 +1927,15 @@
                         )
                     )
                 forecast_objects[str(interval)] = df_forecast
             return forecast_objects
         else:
             df_forecast = model_forecast(
                 model_name=self.best_model_name,
-                model_param_dict=self.best_model_params,
+                model_param_dict=self.best_model_params.copy(),
                 model_transform_dict=self.best_model_transformation_params,
                 df_train=self.df_wide_numeric,
                 forecast_length=forecast_length,
                 frequency=self.frequency,
                 prediction_interval=prediction_interval,
                 no_negatives=self.no_negatives,
                 constraint=self.constraint,
@@ -2329,15 +2344,15 @@
             if tail == "auto":
                 eval_periods = self.forecast_length * (self.num_validations + 1)
             else:
                 eval_periods = tail
         result = back_forecast(
             df=input_df,
             model_name=self.best_model_name,
-            model_param_dict=self.best_model_params,
+            model_param_dict=self.best_model_params.copy(),
             model_transform_dict=self.best_model_transformation_params,
             future_regressor_train=self.future_regressor_train,
             n_splits=n_splits,
             forecast_length=self.forecast_length,
             frequency=self.frequency,
             prediction_interval=self.prediction_interval,
             no_negatives=self.no_negatives,
@@ -2352,15 +2367,15 @@
 
     def horizontal_to_df(self):
         """helper function for plotting."""
         if self.best_model.empty:
             raise ValueError("No best_model. AutoTS .fit() needs to be run.")
         if self.best_model['Ensemble'].iloc[0] != 2:
             raise ValueError("Only works on horizontal ensemble type models.")
-        ModelParameters = self.best_model_params
+        ModelParameters = self.best_model_params.copy()
         series = ModelParameters['series']
         series = pd.DataFrame.from_dict(series, orient="index").reset_index(drop=False)
         if series.shape[1] > 2:
             # for mosaic style ensembles, choose the mode model id
             series.set_index(series.columns[0], inplace=True)
             series = series.mode(axis=1)[0].to_frame().reset_index(drop=False)
         series.columns = ['Series', 'ID']
@@ -2394,15 +2409,15 @@
 
     def mosaic_to_df(self):
         """Helper function to create a readable df of models in mosaic."""
         if self.best_model.empty:
             raise ValueError("No best_model. AutoTS .fit() needs to be run.")
         if self.best_model_ensemble != 2:
             raise ValueError("Only works on horizontal ensemble type models.")
-        ModelParameters = self.best_model_params
+        ModelParameters = self.best_model_params.copy()
         if str(ModelParameters['model_name']).lower() != 'mosaic':
             raise ValueError("Only works on mosaic ensembles.")
         series = pd.DataFrame.from_dict(ModelParameters['series'])
         lookup = {k: v['Model'] for k, v in ModelParameters['models'].items()}
         return series.replace(lookup)
 
     def plot_horizontal(
@@ -2705,15 +2720,15 @@
     ):
         """Plots most common models. Does not factor in nested in non-horizontal Ensembles."""
         if self.best_model.empty:
             raise ValueError("AutoTS not yet fit.")
         elif self.best_model_ensemble != 2:
             raise ValueError("this plot only works on horizontal-style ensembles.")
 
-        if str(self.best_model_params['model_name']).lower() == "mosaic":
+        if str(self.best_model_params.get('model_name', None)).lower() == "mosaic":
             series = self.mosaic_to_df()
             transformers = series.stack().value_counts()
         else:
             series = self.horizontal_to_df()
             transformers = series['Model'].value_counts().iloc[0:top_n]
 
         if color_list is None:
```

### Comparing `autots-0.5.6/autots/evaluator/benchmark.py` & `autots-0.5.7/autots/evaluator/benchmark.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/evaluator/event_forecasting.py` & `autots-0.5.7/autots/evaluator/event_forecasting.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/evaluator/metrics.py` & `autots-0.5.7/autots/evaluator/metrics.py`

 * *Files 2% similar despite different names*

```diff
@@ -500,30 +500,30 @@
     u_weights = np.ones_like(weights)
     frac_shape = F.shape[0] * 0.1
     first_weight = 5 if frac_shape < 5 else frac_shape
     u_weights[0, :] = first_weight
     u_weights[-1, :] = first_weight * 0.5
 
     # over/under estimate mask
-    ovm = filled_full_mae_errors > 0
+    ovm = full_errors > 0
 
     # note a number of these are created from my own imagination (winedarksea)
     # those are also subject to change as they are tested and refined
     result_df = pd.DataFrame(
         {
             'smape': smape(A, F, full_mae_errors, nan_flag=nan_flag),
             'mae': np.nanmean(full_mae_errors, axis=0),
             'rmse': rmse(squared_errors),
             # directional error
             'made': mean_absolute_differential_error(lA, lF, 1, scaler=scaler),
             # aggregate error
             'mage': mage,  # Gandalf approved
-            'underestimate': np.sum(filled_full_mae_errors[~ovm], axis=0),
+            'underestimate': np.nansum(full_errors[~ovm], axis=0),
             'mle': msle(full_errors, full_mae_errors, log_errors, nan_flag=nan_flag),
-            'overestimate': np.sum(filled_full_mae_errors[ovm], axis=0),
+            'overestimate': np.nansum(full_errors[ovm], axis=0),
             'imle': msle(
                 -full_errors,
                 full_mae_errors,
                 log_errors,
                 nan_flag=nan_flag,
             ),
             'spl': spl(
```

### Comparing `autots-0.5.6/autots/evaluator/validation.py` & `autots-0.5.7/autots/evaluator/validation.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/arch.py` & `autots-0.5.7/autots/models/arch.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/base.py` & `autots-0.5.7/autots/models/base.py`

 * *Files 3% similar despite different names*

```diff
@@ -433,15 +433,24 @@
             df_wide=df_wide,
             series=series,
             remove_zeroes=remove_zeroes,
             interpolate=interpolate,
             start_date=start_date,
         )
         if title is None:
-            title = f"{series} with model {str(self.model_name)[0:80]}"
+            title_prelim = str(self.model_name)[0:80]
+            if title_prelim == "Ensemble":
+                ensemble_type = self.model_parameters.get('model_name', "unknown")
+                if ensemble_type == "Horizontal":
+                    title_prelim = self.model_parameters['series'].get(
+                        series, "Horizontal"
+                    )
+                else:
+                    title_prelim = ensemble_type
+            title = f"{series} with model {title_prelim}"
         if vline is None:
             return plot_df.plot(title=title, **kwargs)
         else:
             ax = plot_df.plot(title=title, **kwargs)
             ax.vlines(
                 x=vline,
                 ls='--',
```

### Comparing `autots-0.5.6/autots/models/basics.py` & `autots-0.5.7/autots/models/basics.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/cassandra.py` & `autots-0.5.7/autots/models/cassandra.py`

 * *Files 1% similar despite different names*

```diff
@@ -19,7158 +19,7191 @@
 00000120: 616e 7366 6f72 6d65 7220 7665 7273 696f  ansformer versio
 00000130: 6e20 6f66 2041 6e6f 6d61 6c79 2f48 6f6c  n of Anomaly/Hol
 00000140: 6964 6179 2074 6f20 7573 6520 6120 6c6f  iday to use a lo
 00000150: 7765 7220 6c65 7665 6c20 696d 706f 7274  wer level import
 00000160: 2074 6861 6e20 6576 616c 7561 746f 720d   than evaluator.
 00000170: 0a66 726f 6d20 6175 746f 7473 2e74 6f6f  .from autots.too
 00000180: 6c73 2e73 6561 736f 6e61 6c20 696d 706f  ls.seasonal impo
-00000190: 7274 2063 7265 6174 655f 7365 6173 6f6e  rt create_season
-000001a0: 616c 6974 795f 6665 6174 7572 652c 2073  ality_feature, s
-000001b0: 6561 736f 6e61 6c5f 696e 740d 0a66 726f  easonal_int..fro
-000001c0: 6d20 6175 746f 7473 2e74 6f6f 6c73 2e74  m autots.tools.t
-000001d0: 7261 6e73 666f 726d 2069 6d70 6f72 7420  ransform import 
-000001e0: 280d 0a20 2020 2047 656e 6572 616c 5472  (..    GeneralTr
-000001f0: 616e 7366 6f72 6d65 722c 0d0a 2020 2020  ansformer,..    
-00000200: 5261 6e64 6f6d 5472 616e 7366 6f72 6d2c  RandomTransform,
-00000210: 0d0a 2020 2020 7363 616c 6572 732c 0d0a  ..    scalers,..
-00000220: 2020 2020 6669 6c74 6572 732c 0d0a 2020      filters,..  
-00000230: 2020 6465 636f 6d70 6f73 6974 696f 6e73    decompositions
-00000240: 2c0d 0a20 2020 2048 6f6c 6964 6179 5472  ,..    HolidayTr
-00000250: 616e 7366 6f72 6d65 722c 0d0a 2020 2020  ansformer,..    
-00000260: 416e 6f6d 616c 7952 656d 6f76 616c 2c0d  AnomalyRemoval,.
-00000270: 0a20 2020 2045 6d70 7479 5472 616e 7366  .    EmptyTransf
-00000280: 6f72 6d65 722c 0d0a 290d 0a66 726f 6d20  ormer,..)..from 
-00000290: 6175 746f 7473 2e74 6f6f 6c73 2069 6d70  autots.tools imp
-000002a0: 6f72 7420 6370 755f 636f 756e 740d 0a66  ort cpu_count..f
-000002b0: 726f 6d20 6175 746f 7473 2e6d 6f64 656c  rom autots.model
-000002c0: 732e 6261 7365 2069 6d70 6f72 7420 4d6f  s.base import Mo
-000002d0: 6465 6c4f 626a 6563 742c 2050 7265 6469  delObject, Predi
-000002e0: 6374 696f 6e4f 626a 6563 740d 0a66 726f  ctionObject..fro
-000002f0: 6d20 6175 746f 7473 2e74 656d 706c 6174  m autots.templat
-00000300: 6573 2e67 656e 6572 616c 2069 6d70 6f72  es.general impor
-00000310: 7420 6765 6e65 7261 6c5f 7465 6d70 6c61  t general_templa
-00000320: 7465 0d0a 6672 6f6d 2061 7574 6f74 732e  te..from autots.
-00000330: 746f 6f6c 732e 686f 6c69 6461 7920 696d  tools.holiday im
-00000340: 706f 7274 2068 6f6c 6964 6179 5f66 6c61  port holiday_fla
-00000350: 670d 0a66 726f 6d20 6175 746f 7473 2e74  g..from autots.t
-00000360: 6f6f 6c73 2e77 696e 646f 775f 6675 6e63  ools.window_func
-00000370: 7469 6f6e 7320 696d 706f 7274 2077 696e  tions import win
-00000380: 646f 775f 6c69 6e5f 7265 675f 6d65 616e  dow_lin_reg_mean
-00000390: 2020 2320 736c 6964 696e 675f 7769 6e64    # sliding_wind
-000003a0: 6f77 5f76 6965 770d 0a66 726f 6d20 6175  ow_view..from au
-000003b0: 746f 7473 2e65 7661 6c75 6174 6f72 2e61  tots.evaluator.a
-000003c0: 7574 6f5f 6d6f 6465 6c20 696d 706f 7274  uto_model import
-000003d0: 204d 6f64 656c 4d6f 6e73 7465 722c 206d   ModelMonster, m
-000003e0: 6f64 656c 5f66 6f72 6563 6173 740d 0a0d  odel_forecast...
-000003f0: 0a23 2073 6369 7079 2069 7320 7465 6368  .# scipy is tech
-00000400: 6e69 6361 6c6c 7920 6f70 7469 6f6e 616c  nically optional
-00000410: 2062 7574 206d 6f73 7420 6c69 6b65 6c79   but most likely
-00000420: 2069 7320 7072 6573 656e 740d 0a74 7279   is present..try
-00000430: 3a0d 0a20 2020 2066 726f 6d20 7363 6970  :..    from scip
-00000440: 792e 6f70 7469 6d69 7a65 2069 6d70 6f72  y.optimize impor
-00000450: 7420 6d69 6e69 6d69 7a65 0d0a 2020 2020  t minimize..    
-00000460: 6672 6f6d 2073 6369 7079 2e73 7461 7473  from scipy.stats
-00000470: 2069 6d70 6f72 7420 6e6f 726d 0d0a 6578   import norm..ex
-00000480: 6365 7074 2045 7863 6570 7469 6f6e 3a0d  cept Exception:.
-00000490: 0a0d 0a20 2020 2063 6c61 7373 206e 6f72  ...    class nor
-000004a0: 6d28 6f62 6a65 6374 293a 0d0a 2020 2020  m(object):..    
-000004b0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-000004c0: 640d 0a20 2020 2020 2020 2064 6566 2070  d..        def p
-000004d0: 7066 2878 293a 0d0a 2020 2020 2020 2020  pf(x):..        
-000004e0: 2020 2020 7265 7475 726e 2031 2e36 3434      return 1.644
-000004f0: 3835 3336 3236 3935 3134 3732 320d 0a0d  8536269514722...
-00000500: 0a0d 0a63 6c61 7373 2043 6173 7361 6e64  ...class Cassand
-00000510: 7261 284d 6f64 656c 4f62 6a65 6374 293a  ra(ModelObject):
-00000520: 0d0a 2020 2020 2222 2245 7870 6c61 696e  ..    """Explain
-00000530: 6162 6c65 2064 6563 6f6d 706f 7369 7469  able decompositi
-00000540: 6f6e 2d62 6173 6564 2066 6f72 6563 6173  on-based forecas
-00000550: 7469 6e67 2077 6974 6820 6164 7661 6e63  ting with advanc
-00000560: 6564 2074 7265 6e64 206d 6f64 656c 696e  ed trend modelin
-00000570: 6720 616e 6420 7072 6570 726f 6365 7373  g and preprocess
-00000580: 696e 672e 0d0a 0d0a 2020 2020 5475 6e63  ing.....    Tunc
-00000590: 2065 7469 616d 2066 6174 6973 2061 7065   etiam fatis ape
-000005a0: 7269 7420 4361 7373 616e 6472 6120 6675  rit Cassandra fu
-000005b0: 7475 7269 730d 0a20 2020 206f 7261 2c20  turis..    ora, 
-000005c0: 6465 6920 6975 7373 7520 6e6f 6e20 756d  dei iussu non um
-000005d0: 7175 616d 2063 7265 6469 7461 2054 6575  quam credita Teu
-000005e0: 6372 6973 2e0d 0a20 2020 204e 6f73 2064  cris...    Nos d
-000005f0: 656c 7562 7261 2064 6575 6d20 6d69 7365  elubra deum mise
-00000600: 7269 2c20 7175 6962 7573 2075 6c74 696d  ri, quibus ultim
-00000610: 7573 2065 7373 6574 0d0a 2020 2020 696c  us esset..    il
-00000620: 6c65 2064 6965 732c 2066 6573 7461 2076  le dies, festa v
-00000630: 656c 616d 7573 2066 726f 6e64 6520 7065  elamus fronde pe
-00000640: 7220 7572 6265 6d2e 0d0a 2020 2020 2d41  r urbem...    -A
-00000650: 656e 6569 6420 322e 3234 362d 322e 3234  eneid 2.246-2.24
-00000660: 390d 0a0d 0a20 2020 2049 6e20 6765 6e65  9....    In gene
-00000670: 7261 6c2c 2061 6c6c 2074 696d 6520 7365  ral, all time se
-00000680: 7269 6573 2064 6174 6120 696e 7075 7473  ries data inputs
-00000690: 2028 6466 2c20 7265 6772 6573 736f 7273   (df, regressors
-000006a0: 2c20 696d 7061 6374 7329 2073 686f 756c  , impacts) shoul
-000006b0: 6420 6265 2077 6964 6520 7374 796c 6520  d be wide style 
-000006c0: 6461 7461 2069 6e20 6120 7064 2e44 6174  data in a pd.Dat
-000006d0: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
-000006e0: 616e 2069 6e64 6578 2074 6861 7420 6973  an index that is
-000006f0: 2061 2070 642e 4461 7465 7469 6d65 496e   a pd.DatetimeIn
-00000700: 6465 780d 0a20 2020 2020 2020 206f 6e65  dex..        one
-00000710: 2063 6f6c 756d 6e20 7065 7220 7469 6d65   column per time
-00000720: 2073 6572 6965 732c 2077 6974 6820 6120   series, with a 
-00000730: 756e 6971 7565 6c79 2069 6465 6e74 6966  uniquely identif
-00000740: 6961 626c 6520 636f 6c75 6d6e 206e 616d  iable column nam
-00000750: 650d 0a0d 0a20 2020 2049 6d70 6163 7473  e....    Impacts
-00000760: 2067 6574 2063 6f6e 6675 7369 6e67 2e0d   get confusing..
-00000770: 0a20 2020 2041 2070 6173 7420 696d 7061  .    A past impa
-00000780: 6374 206f 6620 302e 3035 2077 6f75 6c64  ct of 0.05 would
-00000790: 206d 6561 6e20 616e 206f 7574 7369 6465   mean an outside
-000007a0: 2c20 756e 666f 7265 6361 7374 6162 6c65  , unforecastable
-000007b0: 2066 6f72 6365 2063 6175 7365 642f 6164   force caused/ad
-000007c0: 6465 6420 3525 206f 6620 7468 6520 7661  ded 5% of the va
-000007d0: 6c75 6520 6174 2074 6869 7320 7469 6d65  lue at this time
-000007e0: 2e0d 0a20 2020 2041 6363 6f72 6469 6e67  ...    According
-000007f0: 6c79 2c20 7468 6174 2035 2520 7769 6c6c  ly, that 5% will
-00000800: 2062 6520 7265 6d6f 7665 6420 6265 666f   be removed befo
-00000810: 7265 2066 6f72 6563 6173 7469 6e67 2c20  re forecasting, 
-00000820: 7468 656e 2061 6464 6564 2062 6163 6b20  then added back 
-00000830: 6f6e 2061 6674 6572 2e0d 0a20 2020 2049  on after...    I
-00000840: 6d70 6163 7473 2063 616e 2061 6c73 6f20  mpacts can also 
-00000850: 6265 206e 6567 6174 6976 6520 7661 6c75  be negative valu
-00000860: 6573 2e0d 0a20 2020 2041 2066 7574 7572  es...    A futur
-00000870: 6520 696d 7061 6374 206f 6620 3525 2077  e impact of 5% w
-00000880: 6f75 6c64 206d 6561 6e20 616e 206f 7574  ould mean an out
-00000890: 7369 6465 2066 6f72 6365 2061 6464 7320  side force adds 
-000008a0: 3525 2061 626f 7665 2074 6865 206f 7269  5% above the ori
-000008b0: 6769 6e61 6c20 666f 7265 6361 7374 2e0d  ginal forecast..
-000008c0: 0a20 2020 2046 7574 7572 6520 696d 7061  .    Future impa
-000008d0: 6374 7320 6361 6e20 6265 2075 7365 6420  cts can be used 
-000008e0: 746f 206d 6f64 656c 2070 726f 6475 6374  to model product
-000008f0: 2067 6f61 6c73 206f 7220 7465 6d70 6f72   goals or tempor
-00000900: 6172 7920 616e 6f6d 616c 6965 7320 7768  ary anomalies wh
-00000910: 6963 6820 6361 6e27 7420 6f72 2073 686f  ich can't or sho
-00000920: 756c 6427 7420 6265 206d 6f64 656c 6564  uld't be modeled
-00000930: 2062 7920 666f 7265 6361 7374 696e 6720   by forecasting 
-00000940: 616e 6420 7768 6f73 6520 7265 6c61 7469  and whose relati
-00000950: 7665 2065 6666 6563 7420 6973 206b 6e6f  ve effect is kno
-00000960: 776e 0d0a 2020 2020 436f 6d70 6172 6520  wn..    Compare 
-00000970: 7468 6973 2077 6974 6820 7265 6772 6573  this with regres
-00000980: 736f 7273 2c20 7768 6963 6820 6172 6520  sors, which are 
-00000990: 6573 7365 6e74 6961 6c6c 7920 7468 6520  essentially the 
-000009a0: 6d6f 6465 6c20 6573 7469 6d61 7469 6e67  model estimating
-000009b0: 2074 6865 2072 656c 6174 6976 6520 696d   the relative im
-000009c0: 7061 6374 2067 6976 656e 2074 6865 2072  pact given the r
-000009d0: 6177 2073 697a 6520 6f72 2070 7265 7365  aw size or prese
-000009e0: 6e63 6520 6f66 2061 6e20 6f75 7473 6964  nce of an outsid
-000009f0: 6520 6566 6665 6374 0d0a 0d0a 2020 2020  e effect....    
-00000a00: 5761 726e 2061 626f 7574 2072 656d 6f76  Warn about remov
-00000a10: 655f 6578 6365 7373 5f61 6e6f 6d61 6c69  e_excess_anomali
-00000a20: 6573 2066 726f 6d20 686f 6c69 6461 7920  es from holiday 
-00000a30: 6465 7465 6374 6f72 2069 6620 7265 6c79  detector if rely
-00000a40: 696e 6720 6f6e 2061 6e6f 6d61 6c79 2070  ing on anomaly p
-00000a50: 7265 6469 6374 696f 6e0d 0a20 2020 204c  rediction..    L
-00000a60: 696e 6561 7220 636f 6d70 6f6e 656e 7473  inear components
-00000a70: 2061 7265 2061 6c77 6179 7320 6d6f 6465   are always mode
-00000a80: 6c20 656c 656d 656e 7473 2c20 6275 7420  l elements, but 
-00000a90: 7472 656e 6420 6973 2061 6374 7561 6c73  trend is actuals
-00000aa0: 2028 6869 7374 6f72 7929 2061 6e64 206d   (history) and m
-00000ab0: 6f64 656c 2028 6675 7475 7265 290d 0a20  odel (future).. 
-00000ac0: 2020 2052 756e 6e69 6e67 2070 7265 6469     Running predi
-00000ad0: 6374 2075 7064 6174 6573 2073 6f6d 6520  ct updates some 
-00000ae0: 696e 7465 726e 616c 2061 7474 7269 6275  internal attribu
-00000af0: 7465 7320 7573 6564 2069 6e20 706c 6f74  tes used in plot
-00000b00: 7469 6e67 2061 6e64 206f 7468 6572 2066  ting and other f
-00000b10: 6967 7572 6573 2c20 6765 6e65 7261 6c6c  igures, generall
-00000b20: 7920 6578 7065 6374 2074 6f20 7573 6520  y expect to use 
-00000b30: 6675 6e63 7469 6f6e 7320 746f 206c 6174  functions to lat
-00000b40: 6573 7420 7072 6564 6963 740d 0a20 2020  est predict..   
-00000b50: 2053 6561 736f 6e61 6c69 7469 6573 2061   Seasonalities a
-00000b60: 7265 2068 6172 642d 636f 6465 6420 746f  re hard-coded to
-00000b70: 2062 6520 6173 2064 6179 7320 736f 2037   be as days so 7
-00000b80: 2077 696c 6c20 616c 7761 7973 203d 2077   will always = w
-00000b90: 6565 6b6c 7920 6576 656e 2069 6620 6461  eekly even if da
-00000ba0: 7461 2069 736e 2774 2064 6169 6c79 0d0a  ta isn't daily..
-00000bb0: 2020 2020 466f 7220 736c 6f70 6520 616e      For slope an
-00000bc0: 616c 7973 6973 2061 6e64 207a 6572 6f20  alysis and zero 
-00000bd0: 6372 6f73 7369 6e67 732c 2061 2073 6c6f  crossings, a slo
-00000be0: 7065 206f 6620 3020 6576 616c 7561 7465  pe of 0 evaluate
-00000bf0: 7320 6173 2061 2070 6f73 6974 6976 6520  s as a positive 
-00000c00: 7369 676e 2028 3d3e 3029 2e20 4578 6163  sign (=>0). Exac
-00000c10: 746c 7920 3020 736c 6f70 6520 6973 2072  tly 0 slope is r
-00000c20: 6172 6520 7265 616c 2077 6f72 6c64 2064  are real world d
-00000c30: 6174 610d 0a20 2020 2044 6f65 7320 6e6f  ata..    Does no
-00000c40: 7420 6375 7272 656e 746c 7920 666f 6c6c  t currently foll
-00000c50: 6f77 2074 6865 2072 6567 7265 7373 696f  ow the regressio
-00000c60: 6e5f 7479 7065 3d27 5573 6572 2720 616e  n_type='User' an
-00000c70: 6420 6661 696c 7320 6966 206e 6f20 7265  d fails if no re
-00000c80: 6772 6573 736f 7220 7061 7474 6572 6e20  gressor pattern 
-00000c90: 6f66 206f 7468 6572 206d 6f64 656c 730d  of other models.
-00000ca0: 0a20 2020 2046 6f72 2063 6f6d 706f 6e65  .    For compone
-00000cb0: 6e74 2064 6563 6f6d 706f 7369 7469 6f6e  nt decomposition
-00000cc0: 2c20 7363 616c 6520 7769 6c6c 2062 6520  , scale will be 
-00000cd0: 696e 6163 6375 7261 7465 2075 6e6c 6573  inaccurate unles
-00000ce0: 7320 2742 6173 6553 6361 6c65 7227 2069  s 'BaseScaler' i
-00000cf0: 7320 7573 6564 2c20 6275 7420 7265 6761  s used, but rega
-00000d00: 7264 6c65 7373 2074 6869 7320 776f 6e27  rdless this won'
-00000d10: 7420 6166 6665 6374 2066 696e 616c 2066  t affect final f
-00000d20: 6f72 6563 6173 740d 0a0d 0a20 2020 2041  orecast....    A
-00000d30: 7267 733a 0d0a 2020 2020 2020 2020 7061  rgs:..        pa
-00000d40: 7373 0d0a 0d0a 2020 2020 4d65 7468 6f64  ss....    Method
-00000d50: 733a 0d0a 2020 2020 2020 2020 2066 6974  s:..         fit
-00000d60: 0d0a 2020 2020 2020 2020 2070 7265 6469  ..         predi
-00000d70: 6374 0d0a 2020 2020 2020 2020 2068 6f6c  ct..         hol
-00000d80: 6964 6179 5f64 6574 6563 746f 722e 6461  iday_detector.da
-00000d90: 7465 735f 746f 5f68 6f6c 6964 6179 730d  tes_to_holidays.
-00000da0: 0a20 2020 2020 2020 2020 6372 6561 7465  .         create
-00000db0: 5f66 6f72 6563 6173 745f 696e 6465 783a  _forecast_index:
-00000dc0: 2061 6674 6572 202e 6669 742c 2063 616e   after .fit, can
-00000dd0: 2062 6520 7573 6564 2074 6f20 6372 6561   be used to crea
-00000de0: 7465 2069 6e64 6578 206f 6620 7072 6564  te index of pred
-00000df0: 6963 7469 6f6e 0d0a 2020 2020 2020 2020  iction..        
-00000e00: 2070 6c6f 745f 666f 7265 6361 7374 0d0a   plot_forecast..
-00000e10: 2020 2020 2020 2020 2070 6c6f 745f 636f           plot_co
-00000e20: 6d70 6f6e 656e 7473 0d0a 2020 2020 2020  mponents..      
-00000e30: 2020 2070 6c6f 745f 7472 656e 640d 0a20     plot_trend.. 
-00000e40: 2020 2020 2020 2020 6765 745f 6e65 775f          get_new_
-00000e50: 7061 7261 6d73 0d0a 2020 2020 2020 2020  params..        
-00000e60: 2072 6574 7572 6e5f 636f 6d70 6f6e 656e   return_componen
-00000e70: 7473 0d0a 0d0a 2020 2020 4174 7472 6962  ts....    Attrib
-00000e80: 7574 6573 3a0d 0a20 2020 2020 2020 202e  utes:..        .
-00000e90: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00000ea0: 2e61 6e6f 6d61 6c69 6573 0d0a 2020 2020  .anomalies..    
-00000eb0: 2020 2020 2e61 6e6f 6d61 6c79 5f64 6574      .anomaly_det
-00000ec0: 6563 746f 722e 7363 6f72 6573 0d0a 2020  ector.scores..  
-00000ed0: 2020 2020 2020 2e68 6f6c 6964 6179 5f63        .holiday_c
-00000ee0: 6f75 6e74 0d0a 2020 2020 2020 2020 2e68  ount..        .h
-00000ef0: 6f6c 6964 6179 7320 2873 6572 6965 7320  olidays (series 
-00000f00: 666c 6167 732c 2068 6f6c 6964 6179 2064  flags, holiday d
-00000f10: 6574 6563 746f 7220 6f6e 6c79 290d 0a20  etector only).. 
-00000f20: 2020 2020 2020 202e 7061 7261 6d73 0d0a         .params..
-00000f30: 2020 2020 2020 2020 2e6b 6565 705f 636f          .keep_co
-00000f40: 6c73 2c20 2e6b 6565 705f 636f 6c73 5f69  ls, .keep_cols_i
-00000f50: 6478 0d0a 2020 2020 2020 2020 2e78 5f61  dx..        .x_a
-00000f60: 7272 6179 0d0a 2020 2020 2020 2020 2e70  rray..        .p
-00000f70: 7265 6469 6374 5f78 5f61 7272 6179 0d0a  redict_x_array..
-00000f80: 2020 2020 2020 2020 2e74 7265 6e64 5f74          .trend_t
-00000f90: 7261 696e 0d0a 2020 2020 2020 2020 2e70  rain..        .p
-00000fa0: 7265 6469 6374 6564 5f74 7265 6e64 0d0a  redicted_trend..
-00000fb0: 2020 2020 2222 220d 0a0d 0a20 2020 2064      """....    d
-00000fc0: 6566 205f 5f69 6e69 745f 5f28 0d0a 2020  ef __init__(..  
-00000fd0: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
-00000fe0: 2020 2020 2070 7265 7072 6f63 6573 7369       preprocessi
-00000ff0: 6e67 5f74 7261 6e73 666f 726d 6174 696f  ng_transformatio
-00001000: 6e3a 2064 6963 7420 3d20 4e6f 6e65 2c20  n: dict = None, 
-00001010: 2023 2066 696c 7465 7273 2062 7920 6465   # filters by de
-00001020: 6661 756c 7420 6f6e 6c79 0d0a 2020 2020  fault only..    
-00001030: 2020 2020 7363 616c 696e 673a 2073 7472      scaling: str
-00001040: 203d 2022 4261 7365 5363 616c 6572 222c   = "BaseScaler",
-00001050: 2020 2320 7075 6c6c 6564 206f 7574 2066    # pulled out f
-00001060: 726f 6d20 7472 616e 7366 6f72 6d61 7469  rom transformati
-00001070: 6f6e 2061 7320 6120 7363 616c 6572 2069  on as a scaler i
-00001080: 7320 6e6f 7420 6f70 7469 6f6e 616c 2c20  s not optional, 
-00001090: 6d61 7962 6520 616c 6c6f 7720 6120 6c69  maybe allow a li
-000010a0: 7374 0d0a 2020 2020 2020 2020 7061 7374  st..        past
-000010b0: 5f69 6d70 6163 7473 5f69 6e74 6572 7665  _impacts_interve
-000010c0: 6e74 696f 6e3a 2073 7472 203d 204e 6f6e  ntion: str = Non
-000010d0: 652c 2020 2320 2772 656d 6f76 6527 2c20  e,  # 'remove', 
-000010e0: 2770 6c6f 745f 6f6e 6c79 272c 2027 7265  'plot_only', 're
-000010f0: 6772 6573 736f 7227 0d0a 2020 2020 2020  gressor'..      
-00001100: 2020 7365 6173 6f6e 616c 6974 6965 733a    seasonalities:
-00001110: 2064 6963 7420 3d20 5b0d 0a20 2020 2020   dict = [..     
-00001120: 2020 2020 2020 2027 636f 6d6d 6f6e 5f66         'common_f
-00001130: 6f75 7269 6572 270d 0a20 2020 2020 2020  ourier'..       
-00001140: 205d 2c20 2023 2069 6e74 6572 6163 7469   ],  # interacti
-00001150: 6f6e 7320 6164 6465 6420 6966 2066 6f75  ons added if fou
-00001160: 7269 6572 2061 6e64 206f 7264 6572 206d  rier and order m
-00001170: 6174 6368 6573 0d0a 2020 2020 2020 2020  atches..        
-00001180: 6172 5f6c 6167 733a 206c 6973 7420 3d20  ar_lags: list = 
-00001190: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2061  None,..        a
-000011a0: 725f 696e 7465 7261 6374 696f 6e5f 7365  r_interaction_se
-000011b0: 6173 6f6e 616c 6974 793a 2064 6963 7420  asonality: dict 
-000011c0: 3d20 4e6f 6e65 2c20 2023 2065 7175 616c  = None,  # equal
-000011d0: 206f 7220 6c65 7373 2074 6861 6e20 6e75   or less than nu
-000011e0: 6d62 6572 206f 6620 6172 206c 6167 730d  mber of ar lags.
-000011f0: 0a20 2020 2020 2020 2061 6e6f 6d61 6c79  .        anomaly
-00001200: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
-00001210: 3a20 6469 6374 203d 204e 6f6e 652c 2020  : dict = None,  
-00001220: 2320 6170 706c 7920 6265 666f 7265 2061  # apply before a
-00001230: 6e79 2070 7265 7072 6f63 6573 7369 6e67  ny preprocessing
-00001240: 2028 6173 2068 6173 206f 776e 290d 0a20   (as has own).. 
-00001250: 2020 2020 2020 2061 6e6f 6d61 6c79 5f69         anomaly_i
-00001260: 6e74 6572 7665 6e74 696f 6e3a 2073 7472  ntervention: str
-00001270: 203d 204e 6f6e 652c 2020 2320 7265 6d6f   = None,  # remo
-00001280: 7665 2c20 6372 6561 7465 2066 6561 7475  ve, create featu
-00001290: 7265 2c20 6d6f 6465 6c0d 0a20 2020 2020  re, model..     
-000012a0: 2020 2068 6f6c 6964 6179 5f64 6574 6563     holiday_detec
-000012b0: 746f 725f 7061 7261 6d73 3a20 6469 6374  tor_params: dict
-000012c0: 203d 204e 6f6e 652c 0d0a 2020 2020 2020   = None,..      
-000012d0: 2020 686f 6c69 6461 795f 636f 756e 7472    holiday_countr
-000012e0: 6965 733a 2064 6963 7420 3d20 4e6f 6e65  ies: dict = None
-000012f0: 2c20 2023 206c 6973 7420 6f72 2064 6963  ,  # list or dic
-00001300: 740d 0a20 2020 2020 2020 2068 6f6c 6964  t..        holid
-00001310: 6179 5f63 6f75 6e74 7269 6573 5f75 7365  ay_countries_use
-00001320: 643a 2062 6f6f 6c20 3d20 5472 7565 2c0d  d: bool = True,.
-00001330: 0a20 2020 2020 2020 206d 756c 7469 7661  .        multiva
-00001340: 7269 6174 655f 6665 6174 7572 653a 2073  riate_feature: s
-00001350: 7472 203d 204e 6f6e 652c 2020 2320 6279  tr = None,  # by
-00001360: 2067 726f 7570 2c20 6966 2067 6976 656e   group, if given
-00001370: 0d0a 2020 2020 2020 2020 6d75 6c74 6976  ..        multiv
-00001380: 6172 6961 7465 5f74 7261 6e73 666f 726d  ariate_transform
-00001390: 6174 696f 6e3a 2073 7472 203d 204e 6f6e  ation: str = Non
-000013a0: 652c 2020 2320 6170 706c 6965 6420 6265  e,  # applied be
-000013b0: 666f 7265 2063 7265 6174 696e 6720 6665  fore creating fe
-000013c0: 6174 7572 650d 0a20 2020 2020 2020 2072  ature..        r
-000013d0: 6567 7265 7373 6f72 5f74 7261 6e73 666f  egressor_transfo
-000013e0: 726d 6174 696f 6e3a 2064 6963 7420 3d20  rmation: dict = 
-000013f0: 4e6f 6e65 2c20 2023 2061 7070 6c69 6564  None,  # applied
-00001400: 2074 6f20 6675 7475 7265 5f72 6567 7265   to future_regre
-00001410: 7373 6f72 2061 6e64 2072 6567 7265 7373  ssor and regress
-00001420: 6f72 5f70 6572 5f73 6572 6965 730d 0a20  or_per_series.. 
-00001430: 2020 2020 2020 2072 6567 7265 7373 6f72         regressor
-00001440: 735f 7573 6564 3a20 626f 6f6c 203d 2054  s_used: bool = T
-00001450: 7275 652c 2020 2320 6f6e 2f6f 6666 206f  rue,  # on/off o
-00001460: 6620 6164 6469 7469 6f6e 616c 2075 7365  f additional use
-00001470: 7220 696e 7075 7473 0d0a 2020 2020 2020  r inputs..      
-00001480: 2020 6c69 6e65 6172 5f6d 6f64 656c 3a20    linear_model: 
-00001490: 6469 6374 203d 204e 6f6e 652c 2020 2320  dict = None,  # 
-000014a0: 6c73 7473 7120 5745 4947 4854 4544 2052  lstsq WEIGHTED R
-000014b0: 6964 6765 2c20 6261 7965 7369 616e 2c20  idge, bayesian, 
-000014c0: 6261 7965 7369 616e 2068 6965 7261 7263  bayesian hierarc
-000014d0: 6869 616c 2c20 6c31 206e 6f72 6d65 6420  hial, l1 normed 
-000014e0: 6f72 206f 7468 6572 206c 6f73 7320 286e  or other loss (n
-000014f0: 756d 6261 292c 0d0a 2020 2020 2020 2020  umba),..        
-00001500: 7261 6e64 6f6d 7761 6c6b 5f6e 3a20 696e  randomwalk_n: in
-00001510: 7420 3d20 4e6f 6e65 2c20 2023 2075 7365  t = None,  # use
-00001520: 2073 7461 7473 206f 6620 736f 7572 6365   stats of source
-00001530: 2064 660d 0a20 2020 2020 2020 2074 7265   df..        tre
-00001540: 6e64 5f77 696e 646f 773a 2069 6e74 203d  nd_window: int =
-00001550: 2033 302c 2020 2320 7365 7420 746f 204e   30,  # set to N
-00001560: 6f6e 6520 746f 2075 7365 2072 6177 2072  one to use raw r
-00001570: 6573 6964 7561 6c73 0d0a 2020 2020 2020  esiduals..      
-00001580: 2020 7472 656e 645f 7374 616e 6469 6e3a    trend_standin:
-00001590: 2073 7472 203d 204e 6f6e 652c 2020 2320   str = None,  # 
-000015a0: 726f 6c6c 696e 6720 6669 742c 2069 6e74  rolling fit, int
-000015b0: 6572 6365 7074 2d6f 6e6c 792c 2072 616e  ercept-only, ran
-000015c0: 646f 6d2e 6e6f 726d 616c 2066 6561 7475  dom.normal featu
-000015d0: 7265 730d 0a20 2020 2020 2020 2074 7265  res..        tre
-000015e0: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
-000015f0: 746f 725f 7061 7261 6d73 3a20 6469 6374  tor_params: dict
-00001600: 203d 204e 6f6e 652c 2020 2320 6469 6666   = None,  # diff
-00001610: 6572 656e 6365 2066 6972 7374 2c20 7275  erence first, ru
-00001620: 6e20 6f6e 2073 6c6f 7065 206f 6e6c 792c  n on slope only,
-00001630: 2075 7365 2057 696e 646f 7720 6e2f 3220   use Window n/2 
-00001640: 6469 6666 2074 6f20 7275 6c65 206f 7574  diff to rule out
-00001650: 2072 6574 7572 6e20 746f 0d0a 2020 2020   return to..    
-00001660: 2020 2020 2320 7472 656e 645f 616e 6f6d      # trend_anom
-00001670: 616c 795f 696e 7465 7276 656e 7469 6f6e  aly_intervention
-00001680: 3a20 7374 7220 3d20 4e6f 6e65 2c0d 0a20  : str = None,.. 
-00001690: 2020 2020 2020 2074 7265 6e64 5f74 7261         trend_tra
-000016a0: 6e73 666f 726d 6174 696f 6e3a 2064 6963  nsformation: dic
-000016b0: 7420 3d20 7b7d 2c0d 0a20 2020 2020 2020  t = {},..       
-000016c0: 2074 7265 6e64 5f6d 6f64 656c 3a20 6469   trend_model: di
-000016d0: 6374 203d 207b 0d0a 2020 2020 2020 2020  ct = {..        
-000016e0: 2020 2020 274d 6f64 656c 273a 2027 4c61      'Model': 'La
-000016f0: 7374 5661 6c75 654e 6169 7665 272c 0d0a  stValueNaive',..
-00001700: 2020 2020 2020 2020 2020 2020 274d 6f64              'Mod
-00001710: 656c 5061 7261 6d65 7465 7273 273a 207b  elParameters': {
-00001720: 7d2c 0d0a 2020 2020 2020 2020 7d2c 2020  },..        },  
-00001730: 2320 6861 7665 206f 6e65 206f 7220 7477  # have one or tw
-00001740: 6f20 696e 2062 7569 6c74 2c20 7468 656e  o in built, then
-00001750: 2072 6564 6972 6563 7420 746f 2061 6e79   redirect to any
-00001760: 2041 7574 6f54 5320 6d6f 6465 6c20 666f   AutoTS model fo
-00001770: 7220 6f74 6865 7220 6368 6f69 6365 730d  r other choices.
-00001780: 0a20 2020 2020 2020 2074 7265 6e64 5f70  .        trend_p
-00001790: 6869 3a20 666c 6f61 7420 3d20 4e6f 6e65  hi: float = None
-000017a0: 2c0d 0a20 2020 2020 2020 2063 6f6e 7374  ,..        const
-000017b0: 7261 696e 743a 2064 6963 7420 3d20 4e6f  raint: dict = No
-000017c0: 6e65 2c0d 0a20 2020 2020 2020 206d 6178  ne,..        max
-000017d0: 5f63 6f6c 696e 6561 7269 7479 3a20 666c  _colinearity: fl
-000017e0: 6f61 7420 3d20 302e 3939 382c 0d0a 2020  oat = 0.998,..  
-000017f0: 2020 2020 2020 6d61 785f 6d75 6c74 6963        max_multic
-00001800: 6f6c 696e 6561 7269 7479 3a20 666c 6f61  olinearity: floa
-00001810: 7420 3d20 302e 3030 312c 0d0a 2020 2020  t = 0.001,..    
-00001820: 2020 2020 2320 6e6f 7420 6d6f 6465 6c69      # not modeli
-00001830: 6e67 2072 656c 6174 6564 3a0d 0a20 2020  ng related:..   
-00001840: 2020 2020 2066 7265 7175 656e 6379 3a20       frequency: 
-00001850: 7374 7220 3d20 2769 6e66 6572 272c 0d0a  str = 'infer',..
-00001860: 2020 2020 2020 2020 7072 6564 6963 7469          predicti
-00001870: 6f6e 5f69 6e74 6572 7661 6c3a 2066 6c6f  on_interval: flo
-00001880: 6174 203d 2030 2e39 2c0d 0a20 2020 2020  at = 0.9,..     
-00001890: 2020 2072 616e 646f 6d5f 7365 6564 3a20     random_seed: 
-000018a0: 696e 7420 3d20 3230 3232 2c0d 0a20 2020  int = 2022,..   
-000018b0: 2020 2020 2076 6572 626f 7365 3a20 696e       verbose: in
-000018c0: 7420 3d20 302c 0d0a 2020 2020 2020 2020  t = 0,..        
-000018d0: 6e5f 6a6f 6273 3a20 696e 7420 3d20 2261  n_jobs: int = "a
-000018e0: 7574 6f22 2c0d 0a20 2020 2029 3a0d 0a20  uto",..    ):.. 
-000018f0: 2020 2020 2020 2069 6620 7072 6570 726f         if prepro
-00001900: 6365 7373 696e 675f 7472 616e 7366 6f72  cessing_transfor
-00001910: 6d61 7469 6f6e 2069 7320 4e6f 6e65 3a0d  mation is None:.
-00001920: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00001930: 7072 6f63 6573 7369 6e67 5f74 7261 6e73  processing_trans
-00001940: 666f 726d 6174 696f 6e20 3d20 7b7d 0d0a  formation = {}..
-00001950: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
-00001960: 7072 6f63 6573 7369 6e67 5f74 7261 6e73  processing_trans
-00001970: 666f 726d 6174 696f 6e20 3d20 7072 6570  formation = prep
-00001980: 726f 6365 7373 696e 675f 7472 616e 7366  rocessing_transf
-00001990: 6f72 6d61 7469 6f6e 0d0a 2020 2020 2020  ormation..      
-000019a0: 2020 7365 6c66 2e73 6361 6c69 6e67 203d    self.scaling =
-000019b0: 2073 6361 6c69 6e67 0d0a 2020 2020 2020   scaling..      
-000019c0: 2020 7365 6c66 2e70 6173 745f 696d 7061    self.past_impa
-000019d0: 6374 735f 696e 7465 7276 656e 7469 6f6e  cts_intervention
-000019e0: 203d 2070 6173 745f 696d 7061 6374 735f   = past_impacts_
-000019f0: 696e 7465 7276 656e 7469 6f6e 0d0a 2020  intervention..  
-00001a00: 2020 2020 2020 7365 6c66 2e73 6561 736f        self.seaso
-00001a10: 6e61 6c69 7469 6573 203d 2073 6561 736f  nalities = seaso
-00001a20: 6e61 6c69 7469 6573 0d0a 2020 2020 2020  nalities..      
-00001a30: 2020 7365 6c66 2e61 725f 6c61 6773 203d    self.ar_lags =
-00001a40: 2061 725f 6c61 6773 0d0a 2020 2020 2020   ar_lags..      
-00001a50: 2020 7365 6c66 2e61 725f 696e 7465 7261    self.ar_intera
-00001a60: 6374 696f 6e5f 7365 6173 6f6e 616c 6974  ction_seasonalit
-00001a70: 7920 3d20 6172 5f69 6e74 6572 6163 7469  y = ar_interacti
-00001a80: 6f6e 5f73 6561 736f 6e61 6c69 7479 0d0a  on_seasonality..
-00001a90: 2020 2020 2020 2020 7365 6c66 2e61 6e6f          self.ano
-00001aa0: 6d61 6c79 5f64 6574 6563 746f 725f 7061  maly_detector_pa
-00001ab0: 7261 6d73 203d 2061 6e6f 6d61 6c79 5f64  rams = anomaly_d
-00001ac0: 6574 6563 746f 725f 7061 7261 6d73 0d0a  etector_params..
-00001ad0: 2020 2020 2020 2020 7365 6c66 2e61 6e6f          self.ano
-00001ae0: 6d61 6c79 5f69 6e74 6572 7665 6e74 696f  maly_interventio
-00001af0: 6e20 3d20 616e 6f6d 616c 795f 696e 7465  n = anomaly_inte
-00001b00: 7276 656e 7469 6f6e 0d0a 2020 2020 2020  rvention..      
-00001b10: 2020 7365 6c66 2e68 6f6c 6964 6179 5f64    self.holiday_d
-00001b20: 6574 6563 746f 725f 7061 7261 6d73 203d  etector_params =
-00001b30: 2068 6f6c 6964 6179 5f64 6574 6563 746f   holiday_detecto
-00001b40: 725f 7061 7261 6d73 0d0a 2020 2020 2020  r_params..      
-00001b50: 2020 7365 6c66 2e68 6f6c 6964 6179 5f63    self.holiday_c
-00001b60: 6f75 6e74 7269 6573 203d 2068 6f6c 6964  ountries = holid
-00001b70: 6179 5f63 6f75 6e74 7269 6573 0d0a 2020  ay_countries..  
-00001b80: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00001b90: 6e63 6528 7365 6c66 2e68 6f6c 6964 6179  nce(self.holiday
-00001ba0: 5f63 6f75 6e74 7269 6573 2c20 7374 7229  _countries, str)
-00001bb0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00001bc0: 656c 662e 686f 6c69 6461 795f 636f 756e  elf.holiday_coun
-00001bd0: 7472 6965 7320 3d20 7365 6c66 2e68 6f6c  tries = self.hol
-00001be0: 6964 6179 5f63 6f75 6e74 7269 6573 2e73  iday_countries.s
-00001bf0: 706c 6974 2822 2c22 290d 0a20 2020 2020  plit(",")..     
-00001c00: 2020 2073 656c 662e 686f 6c69 6461 795f     self.holiday_
-00001c10: 636f 756e 7472 6965 735f 7573 6564 203d  countries_used =
-00001c20: 2068 6f6c 6964 6179 5f63 6f75 6e74 7269   holiday_countri
-00001c30: 6573 5f75 7365 640d 0a20 2020 2020 2020  es_used..       
-00001c40: 2073 656c 662e 6d75 6c74 6976 6172 6961   self.multivaria
-00001c50: 7465 5f66 6561 7475 7265 203d 206d 756c  te_feature = mul
-00001c60: 7469 7661 7269 6174 655f 6665 6174 7572  tivariate_featur
-00001c70: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-00001c80: 6d75 6c74 6976 6172 6961 7465 5f74 7261  multivariate_tra
-00001c90: 6e73 666f 726d 6174 696f 6e20 3d20 6d75  nsformation = mu
-00001ca0: 6c74 6976 6172 6961 7465 5f74 7261 6e73  ltivariate_trans
-00001cb0: 666f 726d 6174 696f 6e0d 0a20 2020 2020  formation..     
-00001cc0: 2020 2073 656c 662e 7265 6772 6573 736f     self.regresso
-00001cd0: 725f 7472 616e 7366 6f72 6d61 7469 6f6e  r_transformation
-00001ce0: 203d 2072 6567 7265 7373 6f72 5f74 7261   = regressor_tra
-00001cf0: 6e73 666f 726d 6174 696f 6e0d 0a20 2020  nsformation..   
-00001d00: 2020 2020 2073 656c 662e 7265 6772 6573       self.regres
-00001d10: 736f 7273 5f75 7365 6420 3d20 7265 6772  sors_used = regr
-00001d20: 6573 736f 7273 5f75 7365 640d 0a20 2020  essors_used..   
-00001d30: 2020 2020 2073 656c 662e 6c69 6e65 6172       self.linear
-00001d40: 5f6d 6f64 656c 203d 206c 696e 6561 725f  _model = linear_
-00001d50: 6d6f 6465 6c20 6966 206c 696e 6561 725f  model if linear_
-00001d60: 6d6f 6465 6c20 6973 206e 6f74 204e 6f6e  model is not Non
-00001d70: 6520 656c 7365 207b 7d0d 0a20 2020 2020  e else {}..     
-00001d80: 2020 2073 656c 662e 7261 6e64 6f6d 7761     self.randomwa
-00001d90: 6c6b 5f6e 203d 2072 616e 646f 6d77 616c  lk_n = randomwal
-00001da0: 6b5f 6e0d 0a20 2020 2020 2020 2073 656c  k_n..        sel
-00001db0: 662e 7472 656e 645f 7769 6e64 6f77 203d  f.trend_window =
-00001dc0: 2074 7265 6e64 5f77 696e 646f 770d 0a20   trend_window.. 
-00001dd0: 2020 2020 2020 2073 656c 662e 7472 656e         self.tren
-00001de0: 645f 7374 616e 6469 6e20 3d20 7472 656e  d_standin = tren
-00001df0: 645f 7374 616e 6469 6e0d 0a20 2020 2020  d_standin..     
-00001e00: 2020 2073 656c 662e 7472 656e 645f 616e     self.trend_an
-00001e10: 6f6d 616c 795f 6465 7465 6374 6f72 5f70  omaly_detector_p
-00001e20: 6172 616d 7320 3d20 7472 656e 645f 616e  arams = trend_an
-00001e30: 6f6d 616c 795f 6465 7465 6374 6f72 5f70  omaly_detector_p
-00001e40: 6172 616d 730d 0a20 2020 2020 2020 2023  arams..        #
-00001e50: 2073 656c 662e 7472 656e 645f 616e 6f6d   self.trend_anom
-00001e60: 616c 795f 696e 7465 7276 656e 7469 6f6e  aly_intervention
-00001e70: 203d 2074 7265 6e64 5f61 6e6f 6d61 6c79   = trend_anomaly
-00001e80: 5f69 6e74 6572 7665 6e74 696f 6e0d 0a20  _intervention.. 
-00001e90: 2020 2020 2020 2073 656c 662e 7472 656e         self.tren
-00001ea0: 645f 7472 616e 7366 6f72 6d61 7469 6f6e  d_transformation
-00001eb0: 203d 2074 7265 6e64 5f74 7261 6e73 666f   = trend_transfo
-00001ec0: 726d 6174 696f 6e0d 0a20 2020 2020 2020  rmation..       
-00001ed0: 2073 656c 662e 7472 656e 645f 6d6f 6465   self.trend_mode
-00001ee0: 6c20 3d20 7472 656e 645f 6d6f 6465 6c0d  l = trend_model.
-00001ef0: 0a20 2020 2020 2020 2073 656c 662e 7472  .        self.tr
-00001f00: 656e 645f 7068 6920 3d20 7472 656e 645f  end_phi = trend_
-00001f10: 7068 690d 0a20 2020 2020 2020 2073 656c  phi..        sel
-00001f20: 662e 636f 6e73 7472 6169 6e74 203d 2063  f.constraint = c
-00001f30: 6f6e 7374 7261 696e 740d 0a20 2020 2020  onstraint..     
-00001f40: 2020 2073 656c 662e 6d61 785f 636f 6c69     self.max_coli
-00001f50: 6e65 6172 6974 7920 3d20 6d61 785f 636f  nearity = max_co
-00001f60: 6c69 6e65 6172 6974 790d 0a20 2020 2020  linearity..     
-00001f70: 2020 2073 656c 662e 6d61 785f 6d75 6c74     self.max_mult
-00001f80: 6963 6f6c 696e 6561 7269 7479 203d 206d  icolinearity = m
-00001f90: 6178 5f6d 756c 7469 636f 6c69 6e65 6172  ax_multicolinear
-00001fa0: 6974 790d 0a20 2020 2020 2020 2023 206f  ity..        # o
-00001fb0: 7468 6572 2070 6172 616d 6574 6572 730d  ther parameters.
-00001fc0: 0a20 2020 2020 2020 2073 656c 662e 6672  .        self.fr
-00001fd0: 6571 7565 6e63 7920 3d20 6672 6571 7565  equency = freque
-00001fe0: 6e63 790d 0a20 2020 2020 2020 2073 656c  ncy..        sel
-00001ff0: 662e 7072 6564 6963 7469 6f6e 5f69 6e74  f.prediction_int
-00002000: 6572 7661 6c20 3d20 7072 6564 6963 7469  erval = predicti
-00002010: 6f6e 5f69 6e74 6572 7661 6c0d 0a20 2020  on_interval..   
-00002020: 2020 2020 2073 656c 662e 696e 745f 7374       self.int_st
-00002030: 645f 6465 7620 3d20 6e6f 726d 2e70 7066  d_dev = norm.ppf
-00002040: 280d 0a20 2020 2020 2020 2020 2020 2030  (..            0
-00002050: 2e35 202b 2030 2e35 202a 2073 656c 662e  .5 + 0.5 * self.
-00002060: 7072 6564 6963 7469 6f6e 5f69 6e74 6572  prediction_inter
-00002070: 7661 6c0d 0a20 2020 2020 2020 2029 2020  val..        )  
-00002080: 2320 3220 746f 2031 2073 6964 6564 2069  # 2 to 1 sided i
-00002090: 6e74 6572 7661 6c0d 0a20 2020 2020 2020  nterval..       
-000020a0: 2073 656c 662e 7261 6e64 6f6d 5f73 6565   self.random_see
-000020b0: 6420 3d20 7261 6e64 6f6d 5f73 6565 640d  d = random_seed.
-000020c0: 0a20 2020 2020 2020 2073 656c 662e 7665  .        self.ve
-000020d0: 7262 6f73 6520 3d20 7665 7262 6f73 650d  rbose = verbose.
-000020e0: 0a20 2020 2020 2020 2073 656c 662e 6e5f  .        self.n_
-000020f0: 6a6f 6273 203d 206e 5f6a 6f62 730d 0a20  jobs = n_jobs.. 
-00002100: 2020 2020 2020 2069 6620 7365 6c66 2e6e         if self.n
-00002110: 5f6a 6f62 7320 3d3d 2027 6175 746f 273a  _jobs == 'auto':
-00002120: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00002130: 6c66 2e6e 5f6a 6f62 7320 3d20 6370 755f  lf.n_jobs = cpu_
-00002140: 636f 756e 7428 6d6f 6469 6669 6572 3d30  count(modifier=0
-00002150: 2e37 3529 0d0a 2020 2020 2020 2020 2020  .75)..          
-00002160: 2020 6966 2076 6572 626f 7365 203e 2030    if verbose > 0
-00002170: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00002180: 2020 2070 7269 6e74 2866 2255 7369 6e67     print(f"Using
-00002190: 207b 7365 6c66 2e6e 5f6a 6f62 737d 2063   {self.n_jobs} c
-000021a0: 7075 7320 666f 7220 6e5f 6a6f 6273 2e22  pus for n_jobs."
-000021b0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000021c0: 7374 6172 7469 6e67 5f70 6172 616d 7320  starting_params 
-000021d0: 3d20 7365 6c66 2e67 6574 5f70 6172 616d  = self.get_param
-000021e0: 7328 290d 0a20 2020 2020 2020 2073 656c  s()..        sel
-000021f0: 662e 7363 616c 6572 203d 2045 6d70 7479  f.scaler = Empty
-00002200: 5472 616e 7366 6f72 6d65 7228 290d 0a20  Transformer().. 
-00002210: 2020 2020 2020 2073 656c 662e 7072 6570         self.prep
-00002220: 726f 6365 7373 6572 203d 2045 6d70 7479  rocesser = Empty
-00002230: 5472 616e 7366 6f72 6d65 7228 290d 0a20  Transformer().. 
-00002240: 2020 2020 2020 2073 656c 662e 6473 5f6d         self.ds_m
-00002250: 696e 203d 2070 642e 5469 6d65 7374 616d  in = pd.Timestam
-00002260: 7028 2232 3030 302d 3031 2d30 3122 290d  p("2000-01-01").
-00002270: 0a20 2020 2020 2020 2073 656c 662e 6473  .        self.ds
-00002280: 5f6d 6178 203d 2070 642e 5469 6d65 7374  _max = pd.Timest
-00002290: 616d 7028 2232 3032 352d 3031 2d30 3122  amp("2025-01-01"
-000022a0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000022b0: 6e61 6d65 203d 2022 4361 7373 616e 6472  name = "Cassandr
-000022c0: 6122 0d0a 2020 2020 2020 2020 7365 6c66  a"..        self
-000022d0: 2e66 7574 7572 655f 7265 6772 6573 736f  .future_regresso
-000022e0: 725f 7472 6169 6e20 3d20 4e6f 6e65 0d0a  r_train = None..
-000022f0: 2020 2020 2020 2020 7365 6c66 2e66 6c61          self.fla
-00002300: 675f 7265 6772 6573 736f 725f 7472 6169  g_regressor_trai
-00002310: 6e20 3d20 4e6f 6e65 0d0a 2020 2020 2020  n = None..      
-00002320: 2020 7365 6c66 2e72 6567 725f 7065 725f    self.regr_per_
-00002330: 7365 7269 6573 5f74 7220 3d20 4e6f 6e65  series_tr = None
-00002340: 0d0a 2020 2020 2020 2020 7365 6c66 2e74  ..        self.t
-00002350: 7265 6e64 5f74 7261 696e 203d 204e 6f6e  rend_train = Non
-00002360: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-00002370: 636f 6d70 6f6e 656e 7473 203d 204e 6f6e  components = Non
-00002380: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-00002390: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-000023a0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-000023b0: 2073 656c 662e 686f 6c69 6461 795f 6465   self.holiday_de
-000023c0: 7465 6374 6f72 203d 204e 6f6e 650d 0a20  tector = None.. 
-000023d0: 2020 2020 2020 2073 656c 662e 696d 7061         self.impa
-000023e0: 6374 7320 3d20 4e6f 6e65 0d0a 2020 2020  cts = None..    
-000023f0: 2020 2020 6966 2073 656c 662e 7472 656e      if self.tren
-00002400: 645f 616e 6f6d 616c 795f 6465 7465 6374  d_anomaly_detect
-00002410: 6f72 5f70 6172 616d 7320 6973 206e 6f74  or_params is not
-00002420: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00002430: 2020 2020 7365 6c66 2e74 7265 6e64 5f61      self.trend_a
-00002440: 6e6f 6d61 6c79 5f64 6574 6563 746f 7220  nomaly_detector 
-00002450: 3d20 416e 6f6d 616c 7952 656d 6f76 616c  = AnomalyRemoval
-00002460: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00002470: 2020 202a 2a73 656c 662e 7472 656e 645f     **self.trend_
-00002480: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00002490: 5f70 6172 616d 730d 0a20 2020 2020 2020  _params..       
-000024a0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-000024b0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-000024c0: 2020 2073 656c 662e 7472 656e 645f 616e     self.trend_an
-000024d0: 6f6d 616c 795f 6465 7465 6374 6f72 203d  omaly_detector =
-000024e0: 204e 6f6e 650d 0a0d 0a20 2020 2064 6566   None....    def
-000024f0: 2062 6173 655f 7363 616c 6572 2873 656c   base_scaler(sel
-00002500: 662c 2064 6629 3a0d 0a20 2020 2020 2020  f, df):..       
-00002510: 2073 656c 662e 7363 616c 6572 5f6d 6561   self.scaler_mea
-00002520: 6e20 3d20 6e70 2e6d 6561 6e28 6466 2c20  n = np.mean(df, 
-00002530: 6178 6973 3d30 290d 0a20 2020 2020 2020  axis=0)..       
-00002540: 2073 656c 662e 7363 616c 6572 5f73 7464   self.scaler_std
-00002550: 203d 206e 702e 7374 6428 6466 2c20 6178   = np.std(df, ax
-00002560: 6973 3d30 290d 0a20 2020 2020 2020 2072  is=0)..        r
-00002570: 6574 7572 6e20 2864 6620 2d20 7365 6c66  eturn (df - self
-00002580: 2e73 6361 6c65 725f 6d65 616e 2920 2f20  .scaler_mean) / 
-00002590: 7365 6c66 2e73 6361 6c65 725f 7374 640d  self.scaler_std.
-000025a0: 0a0d 0a20 2020 2064 6566 2073 6361 6c65  ...    def scale
-000025b0: 5f64 6174 6128 7365 6c66 2c20 6466 293a  _data(self, df):
-000025c0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-000025d0: 662e 7072 6570 726f 6365 7373 696e 675f  f.preprocessing_
-000025e0: 7472 616e 7366 6f72 6d61 7469 6f6e 2069  transformation i
-000025f0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00002600: 2020 2020 2020 2020 2064 6620 3d20 7365           df = se
-00002610: 6c66 2e70 7265 7072 6f63 6573 7365 722e  lf.preprocesser.
-00002620: 7472 616e 7366 6f72 6d28 6466 2e63 6f70  transform(df.cop
-00002630: 7928 2929 0d0a 2020 2020 2020 2020 6966  y())..        if
-00002640: 2073 656c 662e 7363 616c 696e 6720 6973   self.scaling is
-00002650: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00002660: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00002670: 7363 616c 696e 6720 3d3d 2022 4261 7365  scaling == "Base
-00002680: 5363 616c 6572 223a 0d0a 2020 2020 2020  Scaler":..      
-00002690: 2020 2020 2020 2020 2020 6466 203d 2073            df = s
-000026a0: 656c 662e 6261 7365 5f73 6361 6c65 7228  elf.base_scaler(
-000026b0: 6466 290d 0a20 2020 2020 2020 2020 2020  df)..           
-000026c0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000026d0: 2020 2020 2020 2020 6466 203d 2073 656c          df = sel
-000026e0: 662e 7363 616c 6572 2e74 7261 6e73 666f  f.scaler.transfo
-000026f0: 726d 2864 6629 0d0a 2020 2020 2020 2020  rm(df)..        
-00002700: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00002710: 6528 6466 2c20 7064 2e44 6174 6146 7261  e(df, pd.DataFra
-00002720: 6d65 293a 0d0a 2020 2020 2020 2020 2020  me):..          
-00002730: 2020 7265 7475 726e 2070 642e 4461 7461    return pd.Data
-00002740: 4672 616d 6528 6466 2c20 636f 6c75 6d6e  Frame(df, column
-00002750: 733d 6466 2e63 6f6c 756d 6e73 2c20 696e  s=df.columns, in
-00002760: 6465 783d 6466 2e69 6e64 6578 290d 0a20  dex=df.index).. 
-00002770: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00002780: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00002790: 2064 660d 0a0d 0a20 2020 2064 6566 2074   df....    def t
-000027a0: 6f5f 6f72 6967 696e 5f73 7061 6365 280d  o_origin_space(.
-000027b0: 0a20 2020 2020 2020 2073 656c 662c 2064  .        self, d
-000027c0: 662c 2074 7261 6e73 5f6d 6574 686f 643d  f, trans_method=
-000027d0: 2766 6f72 6563 6173 7427 2c20 636f 6d70  'forecast', comp
-000027e0: 6f6e 656e 7473 3d46 616c 7365 2c20 626f  onents=False, bo
-000027f0: 756e 6473 3d46 616c 7365 0d0a 2020 2020  unds=False..    
-00002800: 293a 0d0a 2020 2020 2020 2020 2222 2254  ):..        """T
-00002810: 616b 6520 7472 616e 7366 6f72 6d65 6420  ake transformed 
-00002820: 6f75 7470 7574 7320 6261 636b 2074 6f20  outputs back to 
-00002830: 6f72 6967 696e 616c 2066 6561 7475 7265  original feature
-00002840: 2073 7061 6365 2e22 2222 0d0a 2020 2020   space."""..    
-00002850: 2020 2020 6966 2073 656c 662e 7363 616c      if self.scal
-00002860: 696e 6720 3d3d 2022 4261 7365 5363 616c  ing == "BaseScal
-00002870: 6572 223a 0d0a 2020 2020 2020 2020 2020  er":..          
-00002880: 2020 2320 7265 7475 726e 2073 656c 662e    # return self.
-00002890: 7072 6570 726f 6365 7373 6572 2e69 6e76  preprocesser.inv
-000028a0: 6572 7365 5f74 7261 6e73 666f 726d 2864  erse_transform(d
-000028b0: 662c 2074 7261 6e73 5f6d 6574 686f 643d  f, trans_method=
-000028c0: 7472 616e 735f 6d65 7468 6f64 2920 2a20  trans_method) * 
-000028d0: 7365 6c66 2e73 6361 6c65 725f 7374 6420  self.scaler_std 
-000028e0: 2b20 7365 6c66 2e73 6361 6c65 725f 6d65  + self.scaler_me
-000028f0: 616e 0d0a 2020 2020 2020 2020 2020 2020  an..            
-00002900: 6966 2063 6f6d 706f 6e65 6e74 733a 0d0a  if components:..
-00002910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002920: 7265 7475 726e 2073 656c 662e 7072 6570  return self.prep
-00002930: 726f 6365 7373 6572 2e69 6e76 6572 7365  rocesser.inverse
-00002940: 5f74 7261 6e73 666f 726d 280d 0a20 2020  _transform(..   
-00002950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002960: 2064 6620 2a20 7365 6c66 2e73 6361 6c65   df * self.scale
-00002970: 725f 7374 642c 2074 7261 6e73 5f6d 6574  r_std, trans_met
-00002980: 686f 643d 7472 616e 735f 6d65 7468 6f64  hod=trans_method
-00002990: 2c20 626f 756e 6473 3d62 6f75 6e64 730d  , bounds=bounds.
-000029a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000029b0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-000029c0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-000029d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000029e0: 6c66 2e70 7265 7072 6f63 6573 7365 722e  lf.preprocesser.
-000029f0: 696e 7665 7273 655f 7472 616e 7366 6f72  inverse_transfor
-00002a00: 6d28 0d0a 2020 2020 2020 2020 2020 2020  m(..            
-00002a10: 2020 2020 2020 2020 6466 202a 2073 656c          df * sel
-00002a20: 662e 7363 616c 6572 5f73 7464 202b 2073  f.scaler_std + s
-00002a30: 656c 662e 7363 616c 6572 5f6d 6561 6e2c  elf.scaler_mean,
-00002a40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002a50: 2020 2020 2020 7472 616e 735f 6d65 7468        trans_meth
-00002a60: 6f64 3d74 7261 6e73 5f6d 6574 686f 642c  od=trans_method,
-00002a70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00002a80: 2020 2020 2020 626f 756e 6473 3d62 6f75        bounds=bou
-00002a90: 6e64 732c 0d0a 2020 2020 2020 2020 2020  nds,..          
-00002aa0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00002ab0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00002ac0: 2020 2020 2320 7265 7475 726e 2073 656c      # return sel
-00002ad0: 662e 7363 616c 6572 2e69 6e76 6572 7365  f.scaler.inverse
-00002ae0: 5f74 7261 6e73 666f 726d 2873 656c 662e  _transform(self.
-00002af0: 7072 6570 726f 6365 7373 6572 2e69 6e76  preprocesser.inv
-00002b00: 6572 7365 5f74 7261 6e73 666f 726d 2864  erse_transform(d
-00002b10: 662c 2074 7261 6e73 5f6d 6574 686f 643d  f, trans_method=
-00002b20: 7472 616e 735f 6d65 7468 6f64 292c 2074  trans_method), t
-00002b30: 7261 6e73 5f6d 6574 686f 643d 7472 616e  rans_method=tran
-00002b40: 735f 6d65 7468 6f64 290d 0a20 2020 2020  s_method)..     
-00002b50: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00002b60: 6c66 2e70 7265 7072 6f63 6573 7365 722e  lf.preprocesser.
-00002b70: 696e 7665 7273 655f 7472 616e 7366 6f72  inverse_transfor
-00002b80: 6d28 0d0a 2020 2020 2020 2020 2020 2020  m(..            
-00002b90: 2020 2020 7365 6c66 2e73 6361 6c65 722e      self.scaler.
-00002ba0: 696e 7665 7273 655f 7472 616e 7366 6f72  inverse_transfor
-00002bb0: 6d28 0d0a 2020 2020 2020 2020 2020 2020  m(..            
-00002bc0: 2020 2020 2020 2020 6466 2c20 7472 616e          df, tran
-00002bd0: 735f 6d65 7468 6f64 3d74 7261 6e73 5f6d  s_method=trans_m
-00002be0: 6574 686f 642c 2062 6f75 6e64 733d 626f  ethod, bounds=bo
-00002bf0: 756e 6473 0d0a 2020 2020 2020 2020 2020  unds..          
-00002c00: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
-00002c10: 2020 2020 2020 2020 2020 7472 616e 735f            trans_
-00002c20: 6d65 7468 6f64 3d74 7261 6e73 5f6d 6574  method=trans_met
-00002c30: 686f 642c 0d0a 2020 2020 2020 2020 2020  hod,..          
-00002c40: 2020 2020 2020 626f 756e 6473 3d62 6f75        bounds=bou
-00002c50: 6e64 732c 0d0a 2020 2020 2020 2020 2020  nds,..          
-00002c60: 2020 290d 0a0d 0a20 2020 2064 6566 2063    )....    def c
-00002c70: 7265 6174 655f 7428 7365 6c66 2c20 4454  reate_t(self, DT
-00002c80: 696e 6465 7829 3a0d 0a20 2020 2020 2020  index):..       
-00002c90: 2072 6574 7572 6e20 2844 5469 6e64 6578   return (DTindex
-00002ca0: 202d 2073 656c 662e 6473 5f6d 696e 2920   - self.ds_min) 
-00002cb0: 2f20 2873 656c 662e 6473 5f6d 6178 202d  / (self.ds_max -
-00002cc0: 2073 656c 662e 6473 5f6d 696e 290d 0a0d   self.ds_min)...
-00002cd0: 0a20 2020 2064 6566 2066 6974 280d 0a20  .    def fit(.. 
-00002ce0: 2020 2020 2020 2073 656c 662c 0d0a 2020         self,..  
-00002cf0: 2020 2020 2020 6466 2c0d 0a20 2020 2020        df,..     
-00002d00: 2020 2066 7574 7572 655f 7265 6772 6573     future_regres
-00002d10: 736f 723d 4e6f 6e65 2c0d 0a20 2020 2020  sor=None,..     
-00002d20: 2020 2072 6567 7265 7373 6f72 5f70 6572     regressor_per
-00002d30: 5f73 6572 6965 733d 4e6f 6e65 2c0d 0a20  _series=None,.. 
-00002d40: 2020 2020 2020 2066 6c61 675f 7265 6772         flag_regr
-00002d50: 6573 736f 7273 3d4e 6f6e 652c 0d0a 2020  essors=None,..  
-00002d60: 2020 2020 2020 6361 7465 676f 7269 6361        categorica
-00002d70: 6c5f 6772 6f75 7073 3d4e 6f6e 652c 0d0a  l_groups=None,..
-00002d80: 2020 2020 2020 2020 7061 7374 5f69 6d70          past_imp
-00002d90: 6163 7473 3d4e 6f6e 652c 0d0a 2020 2020  acts=None,..    
-00002da0: 293a 0d0a 2020 2020 2020 2020 2320 666c  ):..        # fl
-00002db0: 6167 2072 6567 7265 7373 6f72 7320 6279  ag regressors by
-00002dc0: 7061 7373 2070 7265 7072 6f63 6573 7369  pass preprocessi
-00002dd0: 6e67 0d0a 2020 2020 2020 2020 2320 6964  ng..        # id
-00002de0: 6561 6c6c 7920 616c 6c6f 7720 626f 7468  eally allow both
-00002df0: 2070 642e 4461 7461 4672 616d 6520 616e   pd.DataFrame an
-00002e00: 6420 6e70 2e61 7272 6179 2069 6e70 7574  d np.array input
-00002e10: 7320 2869 6e64 6578 2066 6f72 2061 7272  s (index for arr
-00002e20: 6179 3f0d 0a20 2020 2020 2020 2069 6620  ay?..        if 
-00002e30: 7365 6c66 2e63 6f6e 7374 7261 696e 7420  self.constraint 
-00002e40: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00002e50: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00002e60: 665f 6f72 6967 696e 616c 203d 2064 660d  f_original = df.
-00002e70: 0a20 2020 2020 2020 2073 656c 662e 6466  .        self.df
-00002e80: 203d 2064 662e 636f 7079 2829 0d0a 2020   = df.copy()..  
-00002e90: 2020 2020 2020 7365 6c66 2e62 6173 6963        self.basic
-00002ea0: 5f70 726f 6669 6c65 2873 656c 662e 6466  _profile(self.df
-00002eb0: 290d 0a20 2020 2020 2020 2023 2073 7461  )..        # sta
-00002ec0: 6e64 6172 6469 7a65 2067 726f 7570 696e  ndardize groupin
-00002ed0: 6773 2028 6578 7472 612f 6d69 7373 696e  gs (extra/missin
-00002ee0: 6720 6465 616c 7420 7769 7468 290d 0a20  g dealt with).. 
-00002ef0: 2020 2020 2020 2069 6620 6361 7465 676f         if catego
-00002f00: 7269 6361 6c5f 6772 6f75 7073 2069 7320  rical_groups is 
-00002f10: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00002f20: 2020 2063 6174 6567 6f72 6963 616c 5f67     categorical_g
-00002f30: 726f 7570 7320 3d20 7b7d 0d0a 2020 2020  roups = {}..    
-00002f40: 2020 2020 7365 6c66 2e63 6174 6567 6f72      self.categor
-00002f50: 6963 616c 5f67 726f 7570 7320 3d20 7b0d  ical_groups = {.
-00002f60: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00002f70: 3a20 280d 0a20 2020 2020 2020 2020 2020  : (..           
-00002f80: 2020 2020 2063 6174 6567 6f72 6963 616c       categorical
-00002f90: 5f67 726f 7570 735b 636f 6c5d 2069 6620  _groups[col] if 
-00002fa0: 636f 6c20 696e 2063 6174 6567 6f72 6963  col in categoric
-00002fb0: 616c 5f67 726f 7570 732e 6b65 7973 2829  al_groups.keys()
-00002fc0: 2065 6c73 6520 226f 7468 6572 220d 0a20   else "other".. 
-00002fd0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00002fe0: 2020 2020 2020 2020 2020 666f 7220 636f            for co
-00002ff0: 6c20 696e 2064 662e 636f 6c75 6d6e 730d  l in df.columns.
-00003000: 0a20 2020 2020 2020 207d 0d0a 2020 2020  .        }..    
-00003010: 2020 2020 7365 6c66 2e70 6173 745f 696d      self.past_im
-00003020: 7061 6374 7320 3d20 7061 7374 5f69 6d70  pacts = past_imp
-00003030: 6163 7473 0d0a 2020 2020 2020 2020 2320  acts..        # 
-00003040: 6966 2070 6173 7420 696d 7061 6374 7320  if past impacts 
-00003050: 6769 7665 6e2c 2061 7373 756d 6520 7265  given, assume re
-00003060: 6d6f 7661 6c20 756e 6c65 7373 206f 7468  moval unless oth
-00003070: 6572 7769 7365 2073 7065 6369 6669 6564  erwise specified
-00003080: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00003090: 662e 7061 7374 5f69 6d70 6163 7473 5f69  f.past_impacts_i
-000030a0: 6e74 6572 7665 6e74 696f 6e20 6973 204e  ntervention is N
-000030b0: 6f6e 6520 616e 6420 7061 7374 5f69 6d70  one and past_imp
-000030c0: 6163 7473 2069 7320 6e6f 7420 4e6f 6e65  acts is not None
-000030d0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-000030e0: 656c 662e 7061 7374 5f69 6d70 6163 7473  elf.past_impacts
-000030f0: 5f69 6e74 6572 7665 6e74 696f 6e20 3d20  _intervention = 
-00003100: 2272 656d 6f76 6522 0d0a 2020 2020 2020  "remove"..      
-00003110: 2020 656c 6966 2070 6173 745f 696d 7061    elif past_impa
-00003120: 6374 7320 6973 204e 6f6e 653a 0d0a 2020  cts is None:..  
-00003130: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00003140: 6173 745f 696d 7061 6374 735f 696e 7465  ast_impacts_inte
-00003150: 7276 656e 7469 6f6e 203d 204e 6f6e 650d  rvention = None.
-00003160: 0a20 2020 2020 2020 2069 6620 7265 6772  .        if regr
-00003170: 6573 736f 725f 7065 725f 7365 7269 6573  essor_per_series
-00003180: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00003190: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000031a0: 7265 6772 5f70 6572 5f73 6572 6965 735f  regr_per_series_
-000031b0: 7472 203d 2072 6567 7265 7373 6f72 5f70  tr = regressor_p
-000031c0: 6572 5f73 6572 6965 730d 0a0d 0a20 2020  er_series....   
-000031d0: 2020 2020 2023 2077 6861 7420 6665 6174       # what feat
-000031e0: 7572 6573 2077 696c 6c20 7265 7175 6972  ures will requir
-000031f0: 6520 7365 7061 7261 7465 206d 6f64 656c  e separate model
-00003200: 7320 746f 2062 6520 6669 7420 6173 2058  s to be fit as X
-00003210: 2077 696c 6c20 6e6f 7420 6265 2063 6f6e   will not be con
-00003220: 7369 7374 656e 7420 666f 7220 616c 6c0d  sistent for all.
-00003230: 0a20 2020 2020 2020 2023 2057 6861 7420  .        # What 
-00003240: 7472 6967 6765 7273 206c 6f6f 703a 0d0a  triggers loop:..
-00003250: 2020 2020 2020 2020 2320 4152 204c 6167          # AR Lag
-00003260: 730d 0a20 2020 2020 2020 2023 2048 6f6c  s..        # Hol
-00003270: 6964 6179 2063 6f75 6e74 7269 6573 2061  iday countries a
-00003280: 7320 6469 6374 2028 6e6f 7420 6c69 7374  s dict (not list
-00003290: 290d 0a20 2020 2020 2020 2023 2072 6567  )..        # reg
-000032a0: 7265 7373 6f72 5f70 6572 5f73 6572 6965  ressor_per_serie
-000032b0: 7320 286f 6e6c 7920 6966 2072 6567 7265  s (only if regre
-000032c0: 7373 6f72 2075 7365 6429 0d0a 2020 2020  ssor used)..    
-000032d0: 2020 2020 2320 4d75 6c74 6976 6172 6961      # Multivaria
-000032e0: 7465 2048 6f6c 6964 6179 2044 6574 6563  te Holiday Detec
-000032f0: 746f 722c 206f 6e6c 7920 6966 2063 7265  tor, only if cre
-00003300: 6174 6520 6665 6174 7572 652c 206e 6f74  ate feature, not
-00003310: 2072 656d 6f76 616c 2028 706c 6f74 2069   removal (plot i
-00003320: 6e20 7468 6973 2063 6173 6529 0d0a 2020  n this case)..  
-00003330: 2020 2020 2020 2320 4d75 6c74 6976 6172        # Multivar
-00003340: 6961 7465 2041 6e6f 6d61 6c79 2044 6574  iate Anomaly Det
-00003350: 6563 746f 722c 206f 6e6c 7920 6966 2063  ector, only if c
-00003360: 7265 6174 6520 6665 6174 7572 652c 206e  reate feature, n
-00003370: 6f74 2072 656d 6f76 616c 0d0a 2020 2020  ot removal..    
-00003380: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00003390: 6528 7365 6c66 2e61 6e6f 6d61 6c79 5f64  e(self.anomaly_d
-000033a0: 6574 6563 746f 725f 7061 7261 6d73 2c20  etector_params, 
-000033b0: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
-000033c0: 2020 2020 7365 6c66 2e61 6e6f 6d61 6c79      self.anomaly
-000033d0: 5f6e 6f74 5f75 6e69 203d 2028 0d0a 2020  _not_uni = (..  
-000033e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000033f0: 6c66 2e61 6e6f 6d61 6c79 5f64 6574 6563  lf.anomaly_detec
-00003400: 746f 725f 7061 7261 6d73 2e67 6574 2827  tor_params.get('
-00003410: 6f75 7470 7574 272c 204e 6f6e 6529 2021  output', None) !
-00003420: 3d20 2775 6e69 7661 7269 6174 6527 0d0a  = 'univariate'..
-00003430: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00003440: 2020 2020 2020 2073 656c 662e 616e 6f6d         self.anom
-00003450: 616c 795f 6e6f 745f 756e 6920 3d20 4661  aly_not_uni = Fa
-00003460: 6c73 650d 0a20 2020 2020 2020 2073 656c  lse..        sel
-00003470: 662e 6c6f 6f70 5f72 6571 7569 7265 6420  f.loop_required 
-00003480: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
-00003490: 2028 7365 6c66 2e61 725f 6c61 6773 2069   (self.ar_lags i
-000034a0: 7320 6e6f 7420 4e6f 6e65 290d 0a20 2020  s not None)..   
-000034b0: 2020 2020 2020 2020 206f 7220 2829 0d0a           or ()..
-000034c0: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
-000034d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000034e0: 2020 6973 696e 7374 616e 6365 2873 656c    isinstance(sel
-000034f0: 662e 686f 6c69 6461 795f 636f 756e 7472  f.holiday_countr
-00003500: 6965 732c 2064 6963 7429 2061 6e64 2073  ies, dict) and s
-00003510: 656c 662e 686f 6c69 6461 795f 636f 756e  elf.holiday_coun
-00003520: 7472 6965 735f 7573 6564 0d0a 2020 2020  tries_used..    
-00003530: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00003540: 2020 2020 2020 206f 7220 2828 7265 6772         or ((regr
-00003550: 6573 736f 725f 7065 725f 7365 7269 6573  essor_per_series
-00003560: 2069 7320 6e6f 7420 4e6f 6e65 2920 616e   is not None) an
-00003570: 6420 7365 6c66 2e72 6567 7265 7373 6f72  d self.regressor
-00003580: 735f 7573 6564 290d 0a20 2020 2020 2020  s_used)..       
-00003590: 2020 2020 206f 7220 2869 7369 6e73 7461       or (isinsta
-000035a0: 6e63 6528 7365 6c66 2e61 6e6f 6d61 6c79  nce(self.anomaly
-000035b0: 5f69 6e74 6572 7665 6e74 696f 6e2c 2064  _intervention, d
-000035c0: 6963 7429 2061 6e64 2073 656c 662e 616e  ict) and self.an
-000035d0: 6f6d 616c 795f 6e6f 745f 756e 6929 0d0a  omaly_not_uni)..
-000035e0: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
-000035f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00003600: 2020 7365 6c66 2e70 6173 745f 696d 7061    self.past_impa
-00003610: 6374 735f 696e 7465 7276 656e 7469 6f6e  cts_intervention
-00003620: 203d 3d20 2272 6567 7265 7373 6f72 220d   == "regressor".
-00003630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003640: 2061 6e64 2070 6173 745f 696d 7061 6374   and past_impact
-00003650: 7320 6973 206e 6f74 204e 6f6e 650d 0a20  s is not None.. 
-00003660: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00003670: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00003680: 2023 2063 6865 636b 2069 6620 726f 6c6c   # check if roll
-00003690: 696e 6720 7072 6564 6963 7469 6f6e 2069  ing prediction i
-000036a0: 7320 7265 7175 6972 6564 0d0a 2020 2020  s required..    
-000036b0: 2020 2020 7365 6c66 2e70 7265 6469 6374      self.predict
-000036c0: 5f6c 6f6f 705f 7265 7120 3d20 2873 656c  _loop_req = (sel
-000036d0: 662e 6172 5f6c 6167 7320 6973 206e 6f74  f.ar_lags is not
-000036e0: 204e 6f6e 6529 206f 7220 280d 0a20 2020   None) or (..   
-000036f0: 2020 2020 2020 2020 2073 656c 662e 6d75           self.mu
-00003700: 6c74 6976 6172 6961 7465 5f66 6561 7475  ltivariate_featu
-00003710: 7265 2069 7320 6e6f 7420 4e6f 6e65 0d0a  re is not None..
-00003720: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00003730: 2020 2023 2063 6865 636b 2069 6620 636f     # check if co
-00003740: 6d70 6f6e 656e 7420 7072 6f63 6573 7369  mponent processi
-00003750: 6e67 206d 7573 7420 6c6f 6f70 0d0a 2020  ng must loop..  
-00003760: 2020 2020 2020 2320 7365 6c66 2e63 6f6d        # self.com
-00003770: 706f 6e65 6e74 5f6c 6f6f 705f 7265 7120  ponent_loop_req 
-00003780: 3d20 2869 7369 6e73 7461 6e63 6528 7265  = (isinstance(re
-00003790: 6772 6573 736f 725f 7065 725f 7365 7269  gressor_per_seri
-000037a0: 6573 2c20 6469 6374 2920 616e 6420 7365  es, dict) and se
-000037b0: 6c66 2e72 6567 7265 7373 6f72 735f 7573  lf.regressors_us
-000037c0: 6564 2920 6f72 2028 6973 696e 7374 616e  ed) or (isinstan
-000037d0: 6365 2873 656c 662e 686f 6c69 6461 795f  ce(self.holiday_
-000037e0: 636f 756e 7472 6965 732c 2064 6963 7429  countries, dict)
-000037f0: 2061 6e64 2073 656c 662e 686f 6c69 6461   and self.holida
-00003800: 795f 636f 756e 7472 6965 735f 7573 6564  y_countries_used
-00003810: 290d 0a0d 0a20 2020 2020 2020 2023 2052  )....        # R
-00003820: 454d 4f56 4520 4e61 4e20 6275 7420 6f6e  EMOVE NaN but on
-00003830: 6c79 2074 6869 7320 736f 2066 6172 2c20  ly this so far, 
-00003840: 666f 7220 686f 6c69 6461 7920 616e 6420  for holiday and 
-00003850: 616e 6f6d 616c 7920 6465 7465 6374 696f  anomaly detectio
-00003860: 6e0d 0a20 2020 2020 2020 2069 6620 7365  n..        if se
-00003870: 6c66 2e70 7265 7072 6f63 6573 7369 6e67  lf.preprocessing
-00003880: 5f74 7261 6e73 666f 726d 6174 696f 6e20  _transformation 
-00003890: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-000038a0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000038b0: 7265 7072 6f63 6573 7365 7220 3d20 4765  reprocesser = Ge
-000038c0: 6e65 7261 6c54 7261 6e73 666f 726d 6572  neralTransformer
-000038d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000038e0: 2020 202a 2a7b 2766 696c 6c6e 6127 3a20     **{'fillna': 
-000038f0: 7365 6c66 2e70 7265 7072 6f63 6573 7369  self.preprocessi
-00003900: 6e67 5f74 7261 6e73 666f 726d 6174 696f  ng_transformatio
-00003910: 6e2e 6765 7428 2766 696c 6c6e 6127 2c20  n.get('fillna', 
-00003920: 2266 6669 6c6c 2229 7d0d 0a20 2020 2020  "ffill")}..     
-00003930: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00003940: 2020 2020 2020 7365 6c66 2e64 6620 3d20        self.df = 
-00003950: 7365 6c66 2e70 7265 7072 6f63 6573 7365  self.preprocesse
-00003960: 722e 6669 745f 7472 616e 7366 6f72 6d28  r.fit_transform(
-00003970: 7365 6c66 2e64 6629 0d0a 0d0a 2020 2020  self.df)....    
-00003980: 2020 2020 2320 7265 6d6f 7665 2070 6173      # remove pas
-00003990: 7420 696d 7061 6374 7320 746f 2066 696e  t impacts to fin
-000039a0: 6420 226f 7267 616e 6963 220d 0a20 2020  d "organic"..   
-000039b0: 2020 2020 2069 6620 7365 6c66 2e70 6173       if self.pas
-000039c0: 745f 696d 7061 6374 735f 696e 7465 7276  t_impacts_interv
-000039d0: 656e 7469 6f6e 203d 3d20 2272 656d 6f76  ention == "remov
-000039e0: 6522 3a0d 0a20 2020 2020 2020 2020 2020  e":..           
-000039f0: 2073 656c 662e 6466 203d 2073 656c 662e   self.df = self.
-00003a00: 6466 202f 2028 3120 2b20 7061 7374 5f69  df / (1 + past_i
-00003a10: 6d70 6163 7473 2920 2023 2077 6f75 6c64  mpacts)  # would
-00003a20: 204d 494e 5553 2062 6520 6265 7474 6572   MINUS be better
-00003a30: 3f0d 0a20 2020 2020 2020 2023 2068 6f6c  ?..        # hol
-00003a40: 6964 6179 2064 6574 6563 7469 6f6e 2066  iday detection f
-00003a50: 6972 7374 2c20 646f 6e27 7420 7761 6e74  irst, don't want
-00003a60: 2061 6e79 2061 6e6f 6d61 6c69 6573 2072   any anomalies r
-00003a70: 656d 6f76 6564 2079 6574 2c20 616e 6420  emoved yet, and 
-00003a80: 6861 7320 6f77 6e20 7072 6570 726f 6365  has own preproce
-00003a90: 7373 696e 670d 0a20 2020 2020 2020 2069  ssing..        i
-00003aa0: 6620 7365 6c66 2e68 6f6c 6964 6179 5f64  f self.holiday_d
-00003ab0: 6574 6563 746f 725f 7061 7261 6d73 2069  etector_params i
-00003ac0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00003ad0: 2020 2020 2020 2020 2073 656c 662e 686f           self.ho
-00003ae0: 6c69 6461 795f 6465 7465 6374 6f72 203d  liday_detector =
-00003af0: 2048 6f6c 6964 6179 5472 616e 7366 6f72   HolidayTransfor
-00003b00: 6d65 7228 2a2a 7365 6c66 2e68 6f6c 6964  mer(**self.holid
-00003b10: 6179 5f64 6574 6563 746f 725f 7061 7261  ay_detector_para
-00003b20: 6d73 290d 0a20 2020 2020 2020 2020 2020  ms)..           
-00003b30: 2073 656c 662e 686f 6c69 6461 795f 6465   self.holiday_de
-00003b40: 7465 6374 6f72 2e66 6974 2873 656c 662e  tector.fit(self.
-00003b50: 6466 290d 0a20 2020 2020 2020 2020 2020  df)..           
-00003b60: 2073 656c 662e 686f 6c69 6461 7973 203d   self.holidays =
-00003b70: 2073 656c 662e 686f 6c69 6461 795f 6465   self.holiday_de
-00003b80: 7465 6374 6f72 2e64 6174 6573 5f74 6f5f  tector.dates_to_
-00003b90: 686f 6c69 6461 7973 280d 0a20 2020 2020  holidays(..     
-00003ba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00003bb0: 6466 2e69 6e64 6578 2c20 7374 796c 653d  df.index, style=
-00003bc0: 2773 6572 6965 735f 666c 6167 270d 0a20  'series_flag'.. 
-00003bd0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00003be0: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
-00003bf0: 6f6c 6964 6179 5f63 6f75 6e74 203d 206e  oliday_count = n
-00003c00: 702e 636f 756e 745f 6e6f 6e7a 6572 6f28  p.count_nonzero(
-00003c10: 7365 6c66 2e68 6f6c 6964 6179 7329 0d0a  self.holidays)..
-00003c20: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00003c30: 656c 662e 686f 6c69 6461 795f 6465 7465  elf.holiday_dete
-00003c40: 6374 6f72 5f70 6172 616d 735b 2272 656d  ctor_params["rem
-00003c50: 6f76 655f 6578 6365 7373 5f61 6e6f 6d61  ove_excess_anoma
-00003c60: 6c69 6573 225d 3a0d 0a20 2020 2020 2020  lies"]:..       
-00003c70: 2020 2020 2020 2020 2073 656c 662e 6466           self.df
-00003c80: 203d 2073 656c 662e 6466 5b0d 0a20 2020   = self.df[..   
-00003c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ca0: 207e 280d 0a20 2020 2020 2020 2020 2020   ~(..           
-00003cb0: 2020 2020 2020 2020 2020 2020 2028 7365               (se
-00003cc0: 6c66 2e68 6f6c 6964 6179 5f64 6574 6563  lf.holiday_detec
-00003cd0: 746f 722e 616e 6f6d 616c 795f 6d6f 6465  tor.anomaly_mode
-00003ce0: 6c2e 616e 6f6d 616c 6965 7320 3d3d 202d  l.anomalies == -
-00003cf0: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00003d00: 2020 2020 2020 2020 2020 2020 2620 2873              & (s
-00003d10: 656c 662e 686f 6c69 6461 7973 2021 3d20  elf.holidays != 
-00003d20: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
-00003d30: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00003d40: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
-00003d50: 2020 2020 2020 2320 6669 6e64 2061 6e6f        # find ano
-00003d60: 6d61 6c69 6573 2c20 616e 6420 6569 7468  malies, and eith
-00003d70: 6572 2072 656d 6f76 6520 6f72 2073 6574  er remove or set
-00003d80: 7570 2066 6f72 206d 6f64 656c 696e 6720  up for modeling 
-00003d90: 7468 6520 616e 6f6d 616c 7920 7363 6f72  the anomaly scor
-00003da0: 6573 0d0a 2020 2020 2020 2020 6966 2073  es..        if s
-00003db0: 656c 662e 616e 6f6d 616c 795f 6465 7465  elf.anomaly_dete
-00003dc0: 6374 6f72 5f70 6172 616d 7320 6973 206e  ctor_params is n
-00003dd0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00003de0: 2020 2020 2020 7365 6c66 2e61 6e6f 6d61        self.anoma
-00003df0: 6c79 5f64 6574 6563 746f 7220 3d20 416e  ly_detector = An
-00003e00: 6f6d 616c 7952 656d 6f76 616c 282a 2a73  omalyRemoval(**s
-00003e10: 656c 662e 616e 6f6d 616c 795f 6465 7465  elf.anomaly_dete
-00003e20: 6374 6f72 5f70 6172 616d 7329 2e66 6974  ctor_params).fit
-00003e30: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00003e40: 2020 2073 656c 662e 6466 0d0a 2020 2020     self.df..    
-00003e50: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00003e60: 2020 2020 2020 2023 2052 454d 4f56 4520         # REMOVE 
-00003e70: 484f 4c49 4441 5953 2066 726f 6d20 616e  HOLIDAYS from an
-00003e80: 6f6d 616c 6965 732c 2061 7320 7468 6579  omalies, as they
-00003e90: 206d 6179 206c 6f6f 6b20 6c69 6b65 2061   may look like a
-00003ea0: 6e6f 6d61 6c69 6573 2062 7574 2061 7265  nomalies but are
-00003eb0: 2064 6561 6c74 2077 6974 6820 6279 2068   dealt with by h
-00003ec0: 6f6c 6964 6179 730d 0a20 2020 2020 2020  olidays..       
-00003ed0: 2020 2020 2023 2074 6869 732c 2068 6f77       # this, how
-00003ee0: 6576 6572 2c20 646f 6573 206e 6f74 6869  ever, does nothi
-00003ef0: 6e67 2074 6f20 7072 6573 6572 7665 2063  ng to preserve c
-00003f00: 6f75 6e74 7279 2068 6f6c 6964 6179 730d  ountry holidays.
-00003f10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00003f20: 7365 6c66 2e68 6f6c 6964 6179 5f64 6574  self.holiday_det
-00003f30: 6563 746f 725f 7061 7261 6d73 2069 7320  ector_params is 
-00003f40: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00003f50: 2020 2020 2020 2020 2020 2068 6f6c 5f66             hol_f
-00003f60: 696c 7420 3d20 2873 656c 662e 686f 6c69  ilt = (self.holi
-00003f70: 6461 7973 203d 3d20 3129 2026 2028 0d0a  days == 1) & (..
-00003f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f90: 2020 2020 7365 6c66 2e61 6e6f 6d61 6c79      self.anomaly
-00003fa0: 5f64 6574 6563 746f 722e 616e 6f6d 616c  _detector.anomal
-00003fb0: 6965 7320 3d3d 202d 310d 0a20 2020 2020  ies == -1..     
-00003fc0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00003fd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003fe0: 6c66 2e61 6e6f 6d61 6c79 5f64 6574 6563  lf.anomaly_detec
-00003ff0: 746f 722e 616e 6f6d 616c 6965 735b 686f  tor.anomalies[ho
-00004000: 6c5f 6669 6c74 5d20 3d20 310d 0a20 2020  l_filt] = 1..   
-00004010: 2020 2020 2020 2020 2020 2020 2023 2061               # a
-00004020: 7373 756d 6520 6d6f 7374 2061 7265 206e  ssume most are n
-00004030: 6f74 2061 6e6f 6d61 6c69 6573 2073 6f20  ot anomalies so 
-00004040: 6d65 6469 616e 2069 7320 6e6f 7420 616e  median is not an
-00004050: 6f6d 0d0a 2020 2020 2020 2020 2020 2020  om..            
-00004060: 2020 2020 7365 6c66 2e61 6e6f 6d61 6c79      self.anomaly
-00004070: 5f64 6574 6563 746f 722e 7363 6f72 6573  _detector.scores
-00004080: 5b68 6f6c 5f66 696c 745d 203d 206e 702e  [hol_filt] = np.
-00004090: 6d65 6469 616e 280d 0a20 2020 2020 2020  median(..       
-000040a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000040b0: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
-000040c0: 6f72 2e73 636f 7265 730d 0a20 2020 2020  or.scores..     
-000040d0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-000040e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-000040f0: 662e 616e 6f6d 616c 795f 696e 7465 7276  f.anomaly_interv
-00004100: 656e 7469 6f6e 203d 3d20 2272 656d 6f76  ention == "remov
-00004110: 6522 3a0d 0a20 2020 2020 2020 2020 2020  e":..           
-00004120: 2020 2020 2073 656c 662e 6466 203d 2073       self.df = s
-00004130: 656c 662e 616e 6f6d 616c 795f 6465 7465  elf.anomaly_dete
-00004140: 6374 6f72 2e74 7261 6e73 666f 726d 2873  ctor.transform(s
-00004150: 656c 662e 6466 290d 0a20 2020 2020 2020  elf.df)..       
-00004160: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00004170: 616e 6365 2873 656c 662e 616e 6f6d 616c  ance(self.anomal
-00004180: 795f 696e 7465 7276 656e 7469 6f6e 2c20  y_intervention, 
-00004190: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
-000041a0: 2020 2020 2020 2020 7365 6c66 2e61 6e6f          self.ano
-000041b0: 6d61 6c79 5f64 6574 6563 746f 722e 6669  maly_detector.fi
-000041c0: 745f 616e 6f6d 616c 795f 636c 6173 7369  t_anomaly_classi
-000041d0: 6669 6572 2829 0d0a 2020 2020 2020 2020  fier()..        
-000041e0: 2020 2020 2320 6465 7465 6374 5f6f 6e6c      # detect_onl
-000041f0: 7920 3d20 7061 7373 0d0a 2020 2020 2020  y = pass..      
-00004200: 2020 2320 6e6f 7720 646f 2073 7461 6e64    # now do stand
-00004210: 6172 6420 7072 6570 726f 6365 7373 696e  ard preprocessin
-00004220: 670d 0a20 2020 2020 2020 2069 6620 7365  g..        if se
-00004230: 6c66 2e70 7265 7072 6f63 6573 7369 6e67  lf.preprocessing
-00004240: 5f74 7261 6e73 666f 726d 6174 696f 6e20  _transformation 
-00004250: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00004260: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00004270: 7265 7072 6f63 6573 7365 7220 3d20 4765  reprocesser = Ge
-00004280: 6e65 7261 6c54 7261 6e73 666f 726d 6572  neralTransformer
-00004290: 282a 2a73 656c 662e 7072 6570 726f 6365  (**self.preproce
-000042a0: 7373 696e 675f 7472 616e 7366 6f72 6d61  ssing_transforma
-000042b0: 7469 6f6e 290d 0a20 2020 2020 2020 2020  tion)..         
-000042c0: 2020 2073 656c 662e 6466 203d 2073 656c     self.df = sel
-000042d0: 662e 7072 6570 726f 6365 7373 6572 2e66  f.preprocesser.f
-000042e0: 6974 5f74 7261 6e73 666f 726d 2873 656c  it_transform(sel
-000042f0: 662e 6466 290d 0a20 2020 2020 2020 2069  f.df)..        i
-00004300: 6620 7365 6c66 2e73 6361 6c69 6e67 2069  f self.scaling i
-00004310: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00004320: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00004330: 2e73 6361 6c69 6e67 203d 3d20 2242 6173  .scaling == "Bas
-00004340: 6553 6361 6c65 7222 3a0d 0a20 2020 2020  eScaler":..     
-00004350: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004360: 6466 203d 2073 656c 662e 6261 7365 5f73  df = self.base_s
-00004370: 6361 6c65 7228 7365 6c66 2e64 6629 0d0a  caler(self.df)..
-00004380: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00004390: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000043a0: 2020 2069 6620 7365 6c66 2e73 6361 6c69     if self.scali
-000043b0: 6e67 2069 7320 4e6f 6e65 3a0d 0a20 2020  ng is None:..   
-000043c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043d0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000043e0: 7228 2273 6361 6c69 6e67 206d 7573 7420  r("scaling must 
-000043f0: 6e6f 7420 6265 204e 6f6e 652e 2054 7279  not be None. Try
-00004400: 2027 4261 7365 5363 616c 6572 2722 290d   'BaseScaler'").
-00004410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004420: 2073 656c 662e 7363 616c 6572 203d 2047   self.scaler = G
-00004430: 656e 6572 616c 5472 616e 7366 6f72 6d65  eneralTransforme
-00004440: 7228 2a2a 7365 6c66 2e73 6361 6c69 6e67  r(**self.scaling
-00004450: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00004460: 2020 2073 656c 662e 6466 203d 2073 656c     self.df = sel
-00004470: 662e 7363 616c 6572 2e66 6974 5f74 7261  f.scaler.fit_tra
-00004480: 6e73 666f 726d 2873 656c 662e 6466 290d  nsform(self.df).
-00004490: 0a20 2020 2020 2020 2023 2061 6464 6974  .        # addit
-000044a0: 696f 6e61 6c20 7472 616e 7366 6f72 6d73  ional transforms
-000044b0: 2062 6566 6f72 6520 6d75 6c74 6976 6172   before multivar
-000044c0: 6961 7465 2066 6561 7475 7265 2063 7265  iate feature cre
-000044d0: 6174 696f 6e0d 0a20 2020 2020 2020 2069  ation..        i
-000044e0: 6620 7365 6c66 2e6d 756c 7469 7661 7269  f self.multivari
-000044f0: 6174 655f 7472 616e 7366 6f72 6d61 7469  ate_transformati
-00004500: 6f6e 2069 7320 6e6f 7420 4e6f 6e65 3a0d  on is not None:.
-00004510: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00004520: 662e 6d75 6c74 6976 6172 6961 7465 5f74  f.multivariate_t
-00004530: 7261 6e73 666f 726d 6572 203d 2047 656e  ransformer = Gen
-00004540: 6572 616c 5472 616e 7366 6f72 6d65 7228  eralTransformer(
-00004550: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004560: 2020 2a2a 7365 6c66 2e6d 756c 7469 7661    **self.multiva
-00004570: 7269 6174 655f 7472 616e 7366 6f72 6d61  riate_transforma
-00004580: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
-00004590: 2020 290d 0a20 2020 2020 2020 2023 206e    )..        # n
-000045a0: 6565 6473 2074 6f20 636f 6d65 2061 6674  eeds to come aft
-000045b0: 6572 2070 7265 7072 6f63 6573 7369 6e67  er preprocessing
-000045c0: 2062 6563 6175 7365 206f 6620 2773 6c69   because of 'sli
-000045d0: 6365 2720 7472 616e 7366 6f72 6d65 720d  ce' transformer.
-000045e0: 0a20 2020 2020 2020 2073 656c 662e 6473  .        self.ds
-000045f0: 5f6d 696e 203d 2073 656c 662e 6466 2e69  _min = self.df.i
-00004600: 6e64 6578 2e6d 696e 2829 0d0a 2020 2020  ndex.min()..    
-00004610: 2020 2020 7365 6c66 2e64 735f 6d61 7820      self.ds_max 
-00004620: 3d20 7365 6c66 2e64 662e 696e 6465 782e  = self.df.index.
-00004630: 6d61 7828 290d 0a20 2020 2020 2020 2073  max()..        s
-00004640: 656c 662e 745f 7472 6169 6e20 3d20 7365  elf.t_train = se
-00004650: 6c66 2e63 7265 6174 655f 7428 7365 6c66  lf.create_t(self
-00004660: 2e64 662e 696e 6465 7829 0d0a 2020 2020  .df.index)..    
-00004670: 2020 2020 7365 6c66 2e68 6973 746f 7279      self.history
-00004680: 5f64 6179 7320 3d20 2873 656c 662e 6473  _days = (self.ds
-00004690: 5f6d 6178 202d 2073 656c 662e 6473 5f6d  _max - self.ds_m
-000046a0: 696e 292e 6461 7973 0d0a 0d0a 2020 2020  in).days....    
-000046b0: 2020 2020 2320 4245 4749 4e20 434f 4e53      # BEGIN CONS
-000046c0: 5452 5543 5449 4f4e 204f 4620 5820 4152  TRUCTION OF X AR
-000046d0: 5241 590d 0a20 2020 2020 2020 2078 5f6c  RAY..        x_l
-000046e0: 6973 7420 3d20 5b5d 0d0a 2020 2020 2020  ist = []..      
-000046f0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00004700: 7365 6c66 2e61 6e6f 6d61 6c79 5f69 6e74  self.anomaly_int
-00004710: 6572 7665 6e74 696f 6e2c 2064 6963 7429  ervention, dict)
-00004720: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00004730: 206e 6565 6420 746f 206d 6f64 656c 2074   need to model t
-00004740: 6865 7365 2066 6f72 2070 7265 6469 6374  hese for predict
-00004750: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
-00004760: 2078 5f6c 6973 742e 6170 7065 6e64 280d   x_list.append(.
-00004770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004780: 2073 656c 662e 616e 6f6d 616c 795f 6465   self.anomaly_de
-00004790: 7465 6374 6f72 2e73 636f 7265 732e 7265  tector.scores.re
-000047a0: 6e61 6d65 280d 0a20 2020 2020 2020 2020  name(..         
-000047b0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-000047c0: 6e73 3d6c 616d 6264 6120 783a 2022 616e  ns=lambda x: "an
-000047d0: 6f6d 616c 7973 636f 7265 735f 2220 2b20  omalyscores_" + 
-000047e0: 7374 7228 7829 0d0a 2020 2020 2020 2020  str(x)..        
-000047f0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00004800: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00004810: 2020 2320 616c 6c20 6f66 2074 6865 2066    # all of the f
-00004820: 6f6c 6c6f 7769 6e67 2061 7265 2031 2064  ollowing are 1 d
-00004830: 6179 2070 6173 7420 6c61 6767 6564 0d0a  ay past lagged..
-00004840: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00004850: 6d75 6c74 6976 6172 6961 7465 5f66 6561  multivariate_fea
-00004860: 7475 7265 2069 7320 6e6f 7420 4e6f 6e65  ture is not None
-00004870: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00004880: 2069 6e63 6c75 6465 7320 6261 636b 6669   includes backfi
-00004890: 6c6c 0d0a 2020 2020 2020 2020 2020 2020  ll..            
-000048a0: 6c61 675f 315f 696e 6478 203d 206e 702e  lag_1_indx = np.
-000048b0: 636f 6e63 6174 656e 6174 6528 5b5b 305d  concatenate([[0]
-000048c0: 2c20 6e70 2e61 7261 6e67 6528 6c65 6e28  , np.arange(len(
-000048d0: 7365 6c66 2e64 6629 295d 295b 0d0a 2020  self.df))])[..  
-000048e0: 2020 2020 2020 2020 2020 2020 2020 3020                0 
-000048f0: 3a20 6c65 6e28 7365 6c66 2e64 6629 0d0a  : len(self.df)..
-00004900: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
-00004910: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00004920: 6c66 2e6d 756c 7469 7661 7269 6174 655f  lf.multivariate_
-00004930: 7472 616e 7366 6f72 6d61 7469 6f6e 2069  transformation i
-00004940: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00004950: 2020 2020 2020 2020 2020 2020 2074 7273               trs
-00004960: 5f64 6620 3d20 7365 6c66 2e6d 756c 7469  _df = self.multi
-00004970: 7661 7269 6174 655f 7472 616e 7366 6f72  variate_transfor
-00004980: 6d65 722e 6669 745f 7472 616e 7366 6f72  mer.fit_transfor
-00004990: 6d28 7365 6c66 2e64 6629 0d0a 2020 2020  m(self.df)..    
-000049a0: 2020 2020 2020 2020 2020 2020 6966 2074              if t
-000049b0: 7273 5f64 662e 7368 6170 6520 213d 2073  rs_df.shape != s
-000049c0: 656c 662e 6466 2e73 6861 7065 3a0d 0a20  elf.df.shape:.. 
-000049d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049e0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000049f0: 726f 7228 0d0a 2020 2020 2020 2020 2020  ror(..          
-00004a00: 2020 2020 2020 2020 2020 2020 2020 224d                "M
-00004a10: 756c 7469 7661 7269 6174 6520 5472 616e  ultivariate Tran
-00004a20: 7366 6f72 6d65 7220 6e6f 7420 7573 6162  sformer not usab
-00004a30: 6c65 2066 6f72 2074 6869 7320 726f 6c65  le for this role
-00004a40: 2e22 0d0a 2020 2020 2020 2020 2020 2020  ."..            
-00004a50: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00004a60: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00004a70: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00004a80: 735f 6466 203d 2073 656c 662e 6466 2e63  s_df = self.df.c
-00004a90: 6f70 7928 290d 0a20 2020 2020 2020 2020  opy()..         
-00004aa0: 2020 2069 6620 7365 6c66 2e6d 756c 7469     if self.multi
-00004ab0: 7661 7269 6174 655f 6665 6174 7572 6520  variate_feature 
-00004ac0: 3d3d 2022 6665 6174 7572 655f 6167 676c  == "feature_aggl
-00004ad0: 6f6d 6572 6174 696f 6e22 3a0d 0a20 2020  omeration":..   
-00004ae0: 2020 2020 2020 2020 2020 2020 2066 726f               fro
-00004af0: 6d20 736b 6c65 6172 6e2e 636c 7573 7465  m sklearn.cluste
-00004b00: 7220 696d 706f 7274 2046 6561 7475 7265  r import Feature
-00004b10: 4167 676c 6f6d 6572 6174 696f 6e0d 0a0d  Agglomeration...
-00004b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004b30: 2073 656c 662e 6167 676c 6f6d 5f6e 5f63   self.agglom_n_c
-00004b40: 6c75 7374 6572 7320 3d20 350d 0a20 2020  lusters = 5..   
-00004b50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00004b60: 662e 6167 676c 6f6d 6572 6174 6f72 203d  f.agglomerator =
-00004b70: 2046 6561 7475 7265 4167 676c 6f6d 6572   FeatureAgglomer
-00004b80: 6174 696f 6e28 0d0a 2020 2020 2020 2020  ation(..        
-00004b90: 2020 2020 2020 2020 2020 2020 6e5f 636c              n_cl
-00004ba0: 7573 7465 7273 3d73 656c 662e 6167 676c  usters=self.aggl
-00004bb0: 6f6d 5f6e 5f63 6c75 7374 6572 730d 0a20  om_n_clusters.. 
-00004bc0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00004bd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004be0: 2020 785f 6c69 7374 2e61 7070 656e 6428    x_list.append(
-00004bf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004c00: 2020 2020 2020 7064 2e44 6174 6146 7261        pd.DataFra
-00004c10: 6d65 280d 0a20 2020 2020 2020 2020 2020  me(..           
-00004c20: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00004c30: 662e 6167 676c 6f6d 6572 6174 6f72 2e66  f.agglomerator.f
-00004c40: 6974 5f74 7261 6e73 666f 726d 2874 7273  it_transform(trs
-00004c50: 5f64 6629 5b6c 6167 5f31 5f69 6e64 785d  _df)[lag_1_indx]
-00004c60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00004c70: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-00004c80: 3d73 656c 662e 6466 2e69 6e64 6578 2c0d  =self.df.index,.
-00004c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004ca0: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-00004cb0: 3d5b 0d0a 2020 2020 2020 2020 2020 2020  =[..            
+00000190: 7274 2028 0d0a 2020 2020 6372 6561 7465  rt (..    create
+000001a0: 5f73 6561 736f 6e61 6c69 7479 5f66 6561  _seasonality_fea
+000001b0: 7475 7265 2c0d 0a20 2020 2073 6561 736f  ture,..    seaso
+000001c0: 6e61 6c5f 696e 742c 0d0a 2020 2020 6461  nal_int,..    da
+000001d0: 7465 7061 7274 5f63 6f6d 706f 6e65 6e74  tepart_component
+000001e0: 732c 0d0a 2020 2020 6461 7465 5f70 6172  s,..    date_par
+000001f0: 745f 6d65 7468 6f64 732c 0d0a 290d 0a66  t_methods,..)..f
+00000200: 726f 6d20 6175 746f 7473 2e74 6f6f 6c73  rom autots.tools
+00000210: 2e74 7261 6e73 666f 726d 2069 6d70 6f72  .transform impor
+00000220: 7420 280d 0a20 2020 2047 656e 6572 616c  t (..    General
+00000230: 5472 616e 7366 6f72 6d65 722c 0d0a 2020  Transformer,..  
+00000240: 2020 5261 6e64 6f6d 5472 616e 7366 6f72    RandomTransfor
+00000250: 6d2c 0d0a 2020 2020 7363 616c 6572 732c  m,..    scalers,
+00000260: 0d0a 2020 2020 6669 6c74 6572 732c 0d0a  ..    filters,..
+00000270: 2020 2020 6465 636f 6d70 6f73 6974 696f      decompositio
+00000280: 6e73 2c0d 0a20 2020 2048 6f6c 6964 6179  ns,..    Holiday
+00000290: 5472 616e 7366 6f72 6d65 722c 0d0a 2020  Transformer,..  
+000002a0: 2020 416e 6f6d 616c 7952 656d 6f76 616c    AnomalyRemoval
+000002b0: 2c0d 0a20 2020 2045 6d70 7479 5472 616e  ,..    EmptyTran
+000002c0: 7366 6f72 6d65 722c 0d0a 290d 0a66 726f  sformer,..)..fro
+000002d0: 6d20 6175 746f 7473 2e74 6f6f 6c73 2069  m autots.tools i
+000002e0: 6d70 6f72 7420 6370 755f 636f 756e 740d  mport cpu_count.
+000002f0: 0a66 726f 6d20 6175 746f 7473 2e6d 6f64  .from autots.mod
+00000300: 656c 732e 6261 7365 2069 6d70 6f72 7420  els.base import 
+00000310: 4d6f 6465 6c4f 626a 6563 742c 2050 7265  ModelObject, Pre
+00000320: 6469 6374 696f 6e4f 626a 6563 740d 0a66  dictionObject..f
+00000330: 726f 6d20 6175 746f 7473 2e74 656d 706c  rom autots.templ
+00000340: 6174 6573 2e67 656e 6572 616c 2069 6d70  ates.general imp
+00000350: 6f72 7420 6765 6e65 7261 6c5f 7465 6d70  ort general_temp
+00000360: 6c61 7465 0d0a 6672 6f6d 2061 7574 6f74  late..from autot
+00000370: 732e 746f 6f6c 732e 686f 6c69 6461 7920  s.tools.holiday 
+00000380: 696d 706f 7274 2068 6f6c 6964 6179 5f66  import holiday_f
+00000390: 6c61 670d 0a66 726f 6d20 6175 746f 7473  lag..from autots
+000003a0: 2e74 6f6f 6c73 2e77 696e 646f 775f 6675  .tools.window_fu
+000003b0: 6e63 7469 6f6e 7320 696d 706f 7274 2077  nctions import w
+000003c0: 696e 646f 775f 6c69 6e5f 7265 675f 6d65  indow_lin_reg_me
+000003d0: 616e 2020 2320 736c 6964 696e 675f 7769  an  # sliding_wi
+000003e0: 6e64 6f77 5f76 6965 770d 0a66 726f 6d20  ndow_view..from 
+000003f0: 6175 746f 7473 2e65 7661 6c75 6174 6f72  autots.evaluator
+00000400: 2e61 7574 6f5f 6d6f 6465 6c20 696d 706f  .auto_model impo
+00000410: 7274 204d 6f64 656c 4d6f 6e73 7465 722c  rt ModelMonster,
+00000420: 206d 6f64 656c 5f66 6f72 6563 6173 740d   model_forecast.
+00000430: 0a0d 0a23 2073 6369 7079 2069 7320 7465  ...# scipy is te
+00000440: 6368 6e69 6361 6c6c 7920 6f70 7469 6f6e  chnically option
+00000450: 616c 2062 7574 206d 6f73 7420 6c69 6b65  al but most like
+00000460: 6c79 2069 7320 7072 6573 656e 740d 0a74  ly is present..t
+00000470: 7279 3a0d 0a20 2020 2066 726f 6d20 7363  ry:..    from sc
+00000480: 6970 792e 6f70 7469 6d69 7a65 2069 6d70  ipy.optimize imp
+00000490: 6f72 7420 6d69 6e69 6d69 7a65 0d0a 2020  ort minimize..  
+000004a0: 2020 6672 6f6d 2073 6369 7079 2e73 7461    from scipy.sta
+000004b0: 7473 2069 6d70 6f72 7420 6e6f 726d 0d0a  ts import norm..
+000004c0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+000004d0: 3a0d 0a0d 0a20 2020 2063 6c61 7373 206e  :....    class n
+000004e0: 6f72 6d28 6f62 6a65 6374 293a 0d0a 2020  orm(object):..  
+000004f0: 2020 2020 2020 4073 7461 7469 636d 6574        @staticmet
+00000500: 686f 640d 0a20 2020 2020 2020 2064 6566  hod..        def
+00000510: 2070 7066 2878 293a 0d0a 2020 2020 2020   ppf(x):..      
+00000520: 2020 2020 2020 7265 7475 726e 2031 2e36        return 1.6
+00000530: 3434 3835 3336 3236 3935 3134 3732 320d  448536269514722.
+00000540: 0a0d 0a0d 0a63 6c61 7373 2043 6173 7361  .....class Cassa
+00000550: 6e64 7261 284d 6f64 656c 4f62 6a65 6374  ndra(ModelObject
+00000560: 293a 0d0a 2020 2020 2222 2245 7870 6c61  ):..    """Expla
+00000570: 696e 6162 6c65 2064 6563 6f6d 706f 7369  inable decomposi
+00000580: 7469 6f6e 2d62 6173 6564 2066 6f72 6563  tion-based forec
+00000590: 6173 7469 6e67 2077 6974 6820 6164 7661  asting with adva
+000005a0: 6e63 6564 2074 7265 6e64 206d 6f64 656c  nced trend model
+000005b0: 696e 6720 616e 6420 7072 6570 726f 6365  ing and preproce
+000005c0: 7373 696e 672e 0d0a 0d0a 2020 2020 5475  ssing.....    Tu
+000005d0: 6e63 2065 7469 616d 2066 6174 6973 2061  nc etiam fatis a
+000005e0: 7065 7269 7420 4361 7373 616e 6472 6120  perit Cassandra 
+000005f0: 6675 7475 7269 730d 0a20 2020 206f 7261  futuris..    ora
+00000600: 2c20 6465 6920 6975 7373 7520 6e6f 6e20  , dei iussu non 
+00000610: 756d 7175 616d 2063 7265 6469 7461 2054  umquam credita T
+00000620: 6575 6372 6973 2e0d 0a20 2020 204e 6f73  eucris...    Nos
+00000630: 2064 656c 7562 7261 2064 6575 6d20 6d69   delubra deum mi
+00000640: 7365 7269 2c20 7175 6962 7573 2075 6c74  seri, quibus ult
+00000650: 696d 7573 2065 7373 6574 0d0a 2020 2020  imus esset..    
+00000660: 696c 6c65 2064 6965 732c 2066 6573 7461  ille dies, festa
+00000670: 2076 656c 616d 7573 2066 726f 6e64 6520   velamus fronde 
+00000680: 7065 7220 7572 6265 6d2e 0d0a 2020 2020  per urbem...    
+00000690: 2d41 656e 6569 6420 322e 3234 362d 322e  -Aeneid 2.246-2.
+000006a0: 3234 390d 0a0d 0a20 2020 2049 6e20 6765  249....    In ge
+000006b0: 6e65 7261 6c2c 2061 6c6c 2074 696d 6520  neral, all time 
+000006c0: 7365 7269 6573 2064 6174 6120 696e 7075  series data inpu
+000006d0: 7473 2028 6466 2c20 7265 6772 6573 736f  ts (df, regresso
+000006e0: 7273 2c20 696d 7061 6374 7329 2073 686f  rs, impacts) sho
+000006f0: 756c 6420 6265 2077 6964 6520 7374 796c  uld be wide styl
+00000700: 6520 6461 7461 2069 6e20 6120 7064 2e44  e data in a pd.D
+00000710: 6174 6146 7261 6d65 0d0a 2020 2020 2020  ataFrame..      
+00000720: 2020 616e 2069 6e64 6578 2074 6861 7420    an index that 
+00000730: 6973 2061 2070 642e 4461 7465 7469 6d65  is a pd.Datetime
+00000740: 496e 6465 780d 0a20 2020 2020 2020 206f  Index..        o
+00000750: 6e65 2063 6f6c 756d 6e20 7065 7220 7469  ne column per ti
+00000760: 6d65 2073 6572 6965 732c 2077 6974 6820  me series, with 
+00000770: 6120 756e 6971 7565 6c79 2069 6465 6e74  a uniquely ident
+00000780: 6966 6961 626c 6520 636f 6c75 6d6e 206e  ifiable column n
+00000790: 616d 650d 0a0d 0a20 2020 2049 6d70 6163  ame....    Impac
+000007a0: 7473 2067 6574 2063 6f6e 6675 7369 6e67  ts get confusing
+000007b0: 2e0d 0a20 2020 2041 2070 6173 7420 696d  ...    A past im
+000007c0: 7061 6374 206f 6620 302e 3035 2077 6f75  pact of 0.05 wou
+000007d0: 6c64 206d 6561 6e20 616e 206f 7574 7369  ld mean an outsi
+000007e0: 6465 2c20 756e 666f 7265 6361 7374 6162  de, unforecastab
+000007f0: 6c65 2066 6f72 6365 2063 6175 7365 642f  le force caused/
+00000800: 6164 6465 6420 3525 206f 6620 7468 6520  added 5% of the 
+00000810: 7661 6c75 6520 6174 2074 6869 7320 7469  value at this ti
+00000820: 6d65 2e0d 0a20 2020 2041 6363 6f72 6469  me...    Accordi
+00000830: 6e67 6c79 2c20 7468 6174 2035 2520 7769  ngly, that 5% wi
+00000840: 6c6c 2062 6520 7265 6d6f 7665 6420 6265  ll be removed be
+00000850: 666f 7265 2066 6f72 6563 6173 7469 6e67  fore forecasting
+00000860: 2c20 7468 656e 2061 6464 6564 2062 6163  , then added bac
+00000870: 6b20 6f6e 2061 6674 6572 2e0d 0a20 2020  k on after...   
+00000880: 2049 6d70 6163 7473 2063 616e 2061 6c73   Impacts can als
+00000890: 6f20 6265 206e 6567 6174 6976 6520 7661  o be negative va
+000008a0: 6c75 6573 2e0d 0a20 2020 2041 2066 7574  lues...    A fut
+000008b0: 7572 6520 696d 7061 6374 206f 6620 3525  ure impact of 5%
+000008c0: 2077 6f75 6c64 206d 6561 6e20 616e 206f   would mean an o
+000008d0: 7574 7369 6465 2066 6f72 6365 2061 6464  utside force add
+000008e0: 7320 3525 2061 626f 7665 2074 6865 206f  s 5% above the o
+000008f0: 7269 6769 6e61 6c20 666f 7265 6361 7374  riginal forecast
+00000900: 2e0d 0a20 2020 2046 7574 7572 6520 696d  ...    Future im
+00000910: 7061 6374 7320 6361 6e20 6265 2075 7365  pacts can be use
+00000920: 6420 746f 206d 6f64 656c 2070 726f 6475  d to model produ
+00000930: 6374 2067 6f61 6c73 206f 7220 7465 6d70  ct goals or temp
+00000940: 6f72 6172 7920 616e 6f6d 616c 6965 7320  orary anomalies 
+00000950: 7768 6963 6820 6361 6e27 7420 6f72 2073  which can't or s
+00000960: 686f 756c 6427 7420 6265 206d 6f64 656c  hould't be model
+00000970: 6564 2062 7920 666f 7265 6361 7374 696e  ed by forecastin
+00000980: 6720 616e 6420 7768 6f73 6520 7265 6c61  g and whose rela
+00000990: 7469 7665 2065 6666 6563 7420 6973 206b  tive effect is k
+000009a0: 6e6f 776e 0d0a 2020 2020 436f 6d70 6172  nown..    Compar
+000009b0: 6520 7468 6973 2077 6974 6820 7265 6772  e this with regr
+000009c0: 6573 736f 7273 2c20 7768 6963 6820 6172  essors, which ar
+000009d0: 6520 6573 7365 6e74 6961 6c6c 7920 7468  e essentially th
+000009e0: 6520 6d6f 6465 6c20 6573 7469 6d61 7469  e model estimati
+000009f0: 6e67 2074 6865 2072 656c 6174 6976 6520  ng the relative 
+00000a00: 696d 7061 6374 2067 6976 656e 2074 6865  impact given the
+00000a10: 2072 6177 2073 697a 6520 6f72 2070 7265   raw size or pre
+00000a20: 7365 6e63 6520 6f66 2061 6e20 6f75 7473  sence of an outs
+00000a30: 6964 6520 6566 6665 6374 0d0a 0d0a 2020  ide effect....  
+00000a40: 2020 5761 726e 2061 626f 7574 2072 656d    Warn about rem
+00000a50: 6f76 655f 6578 6365 7373 5f61 6e6f 6d61  ove_excess_anoma
+00000a60: 6c69 6573 2066 726f 6d20 686f 6c69 6461  lies from holida
+00000a70: 7920 6465 7465 6374 6f72 2069 6620 7265  y detector if re
+00000a80: 6c79 696e 6720 6f6e 2061 6e6f 6d61 6c79  lying on anomaly
+00000a90: 2070 7265 6469 6374 696f 6e0d 0a20 2020   prediction..   
+00000aa0: 204c 696e 6561 7220 636f 6d70 6f6e 656e   Linear componen
+00000ab0: 7473 2061 7265 2061 6c77 6179 7320 6d6f  ts are always mo
+00000ac0: 6465 6c20 656c 656d 656e 7473 2c20 6275  del elements, bu
+00000ad0: 7420 7472 656e 6420 6973 2061 6374 7561  t trend is actua
+00000ae0: 6c73 2028 6869 7374 6f72 7929 2061 6e64  ls (history) and
+00000af0: 206d 6f64 656c 2028 6675 7475 7265 290d   model (future).
+00000b00: 0a20 2020 2052 756e 6e69 6e67 2070 7265  .    Running pre
+00000b10: 6469 6374 2075 7064 6174 6573 2073 6f6d  dict updates som
+00000b20: 6520 696e 7465 726e 616c 2061 7474 7269  e internal attri
+00000b30: 6275 7465 7320 7573 6564 2069 6e20 706c  butes used in pl
+00000b40: 6f74 7469 6e67 2061 6e64 206f 7468 6572  otting and other
+00000b50: 2066 6967 7572 6573 2c20 6765 6e65 7261   figures, genera
+00000b60: 6c6c 7920 6578 7065 6374 2074 6f20 7573  lly expect to us
+00000b70: 6520 6675 6e63 7469 6f6e 7320 746f 206c  e functions to l
+00000b80: 6174 6573 7420 7072 6564 6963 740d 0a20  atest predict.. 
+00000b90: 2020 2053 6561 736f 6e61 6c69 7469 6573     Seasonalities
+00000ba0: 2061 7265 2068 6172 642d 636f 6465 6420   are hard-coded 
+00000bb0: 746f 2062 6520 6173 2064 6179 7320 736f  to be as days so
+00000bc0: 2037 2077 696c 6c20 616c 7761 7973 203d   7 will always =
+00000bd0: 2077 6565 6b6c 7920 6576 656e 2069 6620   weekly even if 
+00000be0: 6461 7461 2069 736e 2774 2064 6169 6c79  data isn't daily
+00000bf0: 0d0a 2020 2020 466f 7220 736c 6f70 6520  ..    For slope 
+00000c00: 616e 616c 7973 6973 2061 6e64 207a 6572  analysis and zer
+00000c10: 6f20 6372 6f73 7369 6e67 732c 2061 2073  o crossings, a s
+00000c20: 6c6f 7065 206f 6620 3020 6576 616c 7561  lope of 0 evalua
+00000c30: 7465 7320 6173 2061 2070 6f73 6974 6976  tes as a positiv
+00000c40: 6520 7369 676e 2028 3d3e 3029 2e20 4578  e sign (=>0). Ex
+00000c50: 6163 746c 7920 3020 736c 6f70 6520 6973  actly 0 slope is
+00000c60: 2072 6172 6520 7265 616c 2077 6f72 6c64   rare real world
+00000c70: 2064 6174 610d 0a20 2020 2044 6f65 7320   data..    Does 
+00000c80: 6e6f 7420 6375 7272 656e 746c 7920 666f  not currently fo
+00000c90: 6c6c 6f77 2074 6865 2072 6567 7265 7373  llow the regress
+00000ca0: 696f 6e5f 7479 7065 3d27 5573 6572 2720  ion_type='User' 
+00000cb0: 616e 6420 6661 696c 7320 6966 206e 6f20  and fails if no 
+00000cc0: 7265 6772 6573 736f 7220 7061 7474 6572  regressor patter
+00000cd0: 6e20 6f66 206f 7468 6572 206d 6f64 656c  n of other model
+00000ce0: 730d 0a20 2020 2046 6f72 2063 6f6d 706f  s..    For compo
+00000cf0: 6e65 6e74 2064 6563 6f6d 706f 7369 7469  nent decompositi
+00000d00: 6f6e 2c20 7363 616c 6520 7769 6c6c 2062  on, scale will b
+00000d10: 6520 696e 6163 6375 7261 7465 2075 6e6c  e inaccurate unl
+00000d20: 6573 7320 2742 6173 6553 6361 6c65 7227  ess 'BaseScaler'
+00000d30: 2069 7320 7573 6564 2c20 6275 7420 7265   is used, but re
+00000d40: 6761 7264 6c65 7373 2074 6869 7320 776f  gardless this wo
+00000d50: 6e27 7420 6166 6665 6374 2066 696e 616c  n't affect final
+00000d60: 2066 6f72 6563 6173 740d 0a0d 0a20 2020   forecast....   
+00000d70: 2041 7267 733a 0d0a 2020 2020 2020 2020   Args:..        
+00000d80: 7061 7373 0d0a 0d0a 2020 2020 4d65 7468  pass....    Meth
+00000d90: 6f64 733a 0d0a 2020 2020 2020 2020 2066  ods:..         f
+00000da0: 6974 0d0a 2020 2020 2020 2020 2070 7265  it..         pre
+00000db0: 6469 6374 0d0a 2020 2020 2020 2020 2068  dict..         h
+00000dc0: 6f6c 6964 6179 5f64 6574 6563 746f 722e  oliday_detector.
+00000dd0: 6461 7465 735f 746f 5f68 6f6c 6964 6179  dates_to_holiday
+00000de0: 730d 0a20 2020 2020 2020 2020 6372 6561  s..         crea
+00000df0: 7465 5f66 6f72 6563 6173 745f 696e 6465  te_forecast_inde
+00000e00: 783a 2061 6674 6572 202e 6669 742c 2063  x: after .fit, c
+00000e10: 616e 2062 6520 7573 6564 2074 6f20 6372  an be used to cr
+00000e20: 6561 7465 2069 6e64 6578 206f 6620 7072  eate index of pr
+00000e30: 6564 6963 7469 6f6e 0d0a 2020 2020 2020  ediction..      
+00000e40: 2020 2070 6c6f 745f 666f 7265 6361 7374     plot_forecast
+00000e50: 0d0a 2020 2020 2020 2020 2070 6c6f 745f  ..         plot_
+00000e60: 636f 6d70 6f6e 656e 7473 0d0a 2020 2020  components..    
+00000e70: 2020 2020 2070 6c6f 745f 7472 656e 640d       plot_trend.
+00000e80: 0a20 2020 2020 2020 2020 6765 745f 6e65  .         get_ne
+00000e90: 775f 7061 7261 6d73 0d0a 2020 2020 2020  w_params..      
+00000ea0: 2020 2072 6574 7572 6e5f 636f 6d70 6f6e     return_compon
+00000eb0: 656e 7473 0d0a 0d0a 2020 2020 4174 7472  ents....    Attr
+00000ec0: 6962 7574 6573 3a0d 0a20 2020 2020 2020  ibutes:..       
+00000ed0: 202e 616e 6f6d 616c 795f 6465 7465 6374   .anomaly_detect
+00000ee0: 6f72 2e61 6e6f 6d61 6c69 6573 0d0a 2020  or.anomalies..  
+00000ef0: 2020 2020 2020 2e61 6e6f 6d61 6c79 5f64        .anomaly_d
+00000f00: 6574 6563 746f 722e 7363 6f72 6573 0d0a  etector.scores..
+00000f10: 2020 2020 2020 2020 2e68 6f6c 6964 6179          .holiday
+00000f20: 5f63 6f75 6e74 0d0a 2020 2020 2020 2020  _count..        
+00000f30: 2e68 6f6c 6964 6179 7320 2873 6572 6965  .holidays (serie
+00000f40: 7320 666c 6167 732c 2068 6f6c 6964 6179  s flags, holiday
+00000f50: 2064 6574 6563 746f 7220 6f6e 6c79 290d   detector only).
+00000f60: 0a20 2020 2020 2020 202e 7061 7261 6d73  .        .params
+00000f70: 0d0a 2020 2020 2020 2020 2e6b 6565 705f  ..        .keep_
+00000f80: 636f 6c73 2c20 2e6b 6565 705f 636f 6c73  cols, .keep_cols
+00000f90: 5f69 6478 0d0a 2020 2020 2020 2020 2e78  _idx..        .x
+00000fa0: 5f61 7272 6179 0d0a 2020 2020 2020 2020  _array..        
+00000fb0: 2e70 7265 6469 6374 5f78 5f61 7272 6179  .predict_x_array
+00000fc0: 0d0a 2020 2020 2020 2020 2e74 7265 6e64  ..        .trend
+00000fd0: 5f74 7261 696e 0d0a 2020 2020 2020 2020  _train..        
+00000fe0: 2e70 7265 6469 6374 6564 5f74 7265 6e64  .predicted_trend
+00000ff0: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
+00001000: 2064 6566 205f 5f69 6e69 745f 5f28 0d0a   def __init__(..
+00001010: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
+00001020: 2020 2020 2020 2070 7265 7072 6f63 6573         preproces
+00001030: 7369 6e67 5f74 7261 6e73 666f 726d 6174  sing_transformat
+00001040: 696f 6e3a 2064 6963 7420 3d20 4e6f 6e65  ion: dict = None
+00001050: 2c20 2023 2066 696c 7465 7273 2062 7920  ,  # filters by 
+00001060: 6465 6661 756c 7420 6f6e 6c79 0d0a 2020  default only..  
+00001070: 2020 2020 2020 7363 616c 696e 673a 2073        scaling: s
+00001080: 7472 203d 2022 4261 7365 5363 616c 6572  tr = "BaseScaler
+00001090: 222c 2020 2320 7075 6c6c 6564 206f 7574  ",  # pulled out
+000010a0: 2066 726f 6d20 7472 616e 7366 6f72 6d61   from transforma
+000010b0: 7469 6f6e 2061 7320 6120 7363 616c 6572  tion as a scaler
+000010c0: 2069 7320 6e6f 7420 6f70 7469 6f6e 616c   is not optional
+000010d0: 2c20 6d61 7962 6520 616c 6c6f 7720 6120  , maybe allow a 
+000010e0: 6c69 7374 0d0a 2020 2020 2020 2020 7061  list..        pa
+000010f0: 7374 5f69 6d70 6163 7473 5f69 6e74 6572  st_impacts_inter
+00001100: 7665 6e74 696f 6e3a 2073 7472 203d 204e  vention: str = N
+00001110: 6f6e 652c 2020 2320 2772 656d 6f76 6527  one,  # 'remove'
+00001120: 2c20 2770 6c6f 745f 6f6e 6c79 272c 2027  , 'plot_only', '
+00001130: 7265 6772 6573 736f 7227 0d0a 2020 2020  regressor'..    
+00001140: 2020 2020 7365 6173 6f6e 616c 6974 6965      seasonalitie
+00001150: 733a 2064 6963 7420 3d20 5b0d 0a20 2020  s: dict = [..   
+00001160: 2020 2020 2020 2020 2027 636f 6d6d 6f6e           'common
+00001170: 5f66 6f75 7269 6572 270d 0a20 2020 2020  _fourier'..     
+00001180: 2020 205d 2c20 2023 2069 6e74 6572 6163     ],  # interac
+00001190: 7469 6f6e 7320 6164 6465 6420 6966 2066  tions added if f
+000011a0: 6f75 7269 6572 2061 6e64 206f 7264 6572  ourier and order
+000011b0: 206d 6174 6368 6573 0d0a 2020 2020 2020   matches..      
+000011c0: 2020 6172 5f6c 6167 733a 206c 6973 7420    ar_lags: list 
+000011d0: 3d20 4e6f 6e65 2c0d 0a20 2020 2020 2020  = None,..       
+000011e0: 2061 725f 696e 7465 7261 6374 696f 6e5f   ar_interaction_
+000011f0: 7365 6173 6f6e 616c 6974 793a 2064 6963  seasonality: dic
+00001200: 7420 3d20 4e6f 6e65 2c20 2023 2065 7175  t = None,  # equ
+00001210: 616c 206f 7220 6c65 7373 2074 6861 6e20  al or less than 
+00001220: 6e75 6d62 6572 206f 6620 6172 206c 6167  number of ar lag
+00001230: 730d 0a20 2020 2020 2020 2061 6e6f 6d61  s..        anoma
+00001240: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
+00001250: 6d73 3a20 6469 6374 203d 204e 6f6e 652c  ms: dict = None,
+00001260: 2020 2320 6170 706c 7920 6265 666f 7265    # apply before
+00001270: 2061 6e79 2070 7265 7072 6f63 6573 7369   any preprocessi
+00001280: 6e67 2028 6173 2068 6173 206f 776e 290d  ng (as has own).
+00001290: 0a20 2020 2020 2020 2061 6e6f 6d61 6c79  .        anomaly
+000012a0: 5f69 6e74 6572 7665 6e74 696f 6e3a 2073  _intervention: s
+000012b0: 7472 203d 204e 6f6e 652c 2020 2320 7265  tr = None,  # re
+000012c0: 6d6f 7665 2c20 6372 6561 7465 2066 6561  move, create fea
+000012d0: 7475 7265 2c20 6d6f 6465 6c0d 0a20 2020  ture, model..   
+000012e0: 2020 2020 2068 6f6c 6964 6179 5f64 6574       holiday_det
+000012f0: 6563 746f 725f 7061 7261 6d73 3a20 6469  ector_params: di
+00001300: 6374 203d 204e 6f6e 652c 0d0a 2020 2020  ct = None,..    
+00001310: 2020 2020 686f 6c69 6461 795f 636f 756e      holiday_coun
+00001320: 7472 6965 733a 2064 6963 7420 3d20 4e6f  tries: dict = No
+00001330: 6e65 2c20 2023 206c 6973 7420 6f72 2064  ne,  # list or d
+00001340: 6963 740d 0a20 2020 2020 2020 2068 6f6c  ict..        hol
+00001350: 6964 6179 5f63 6f75 6e74 7269 6573 5f75  iday_countries_u
+00001360: 7365 643a 2062 6f6f 6c20 3d20 5472 7565  sed: bool = True
+00001370: 2c0d 0a20 2020 2020 2020 206d 756c 7469  ,..        multi
+00001380: 7661 7269 6174 655f 6665 6174 7572 653a  variate_feature:
+00001390: 2073 7472 203d 204e 6f6e 652c 2020 2320   str = None,  # 
+000013a0: 6279 2067 726f 7570 2c20 6966 2067 6976  by group, if giv
+000013b0: 656e 0d0a 2020 2020 2020 2020 6d75 6c74  en..        mult
+000013c0: 6976 6172 6961 7465 5f74 7261 6e73 666f  ivariate_transfo
+000013d0: 726d 6174 696f 6e3a 2073 7472 203d 204e  rmation: str = N
+000013e0: 6f6e 652c 2020 2320 6170 706c 6965 6420  one,  # applied 
+000013f0: 6265 666f 7265 2063 7265 6174 696e 6720  before creating 
+00001400: 6665 6174 7572 650d 0a20 2020 2020 2020  feature..       
+00001410: 2072 6567 7265 7373 6f72 5f74 7261 6e73   regressor_trans
+00001420: 666f 726d 6174 696f 6e3a 2064 6963 7420  formation: dict 
+00001430: 3d20 4e6f 6e65 2c20 2023 2061 7070 6c69  = None,  # appli
+00001440: 6564 2074 6f20 6675 7475 7265 5f72 6567  ed to future_reg
+00001450: 7265 7373 6f72 2061 6e64 2072 6567 7265  ressor and regre
+00001460: 7373 6f72 5f70 6572 5f73 6572 6965 730d  ssor_per_series.
+00001470: 0a20 2020 2020 2020 2072 6567 7265 7373  .        regress
+00001480: 6f72 735f 7573 6564 3a20 626f 6f6c 203d  ors_used: bool =
+00001490: 2054 7275 652c 2020 2320 6f6e 2f6f 6666   True,  # on/off
+000014a0: 206f 6620 6164 6469 7469 6f6e 616c 2075   of additional u
+000014b0: 7365 7220 696e 7075 7473 0d0a 2020 2020  ser inputs..    
+000014c0: 2020 2020 6c69 6e65 6172 5f6d 6f64 656c      linear_model
+000014d0: 3a20 6469 6374 203d 204e 6f6e 652c 2020  : dict = None,  
+000014e0: 2320 6c73 7473 7120 5745 4947 4854 4544  # lstsq WEIGHTED
+000014f0: 2052 6964 6765 2c20 6261 7965 7369 616e   Ridge, bayesian
+00001500: 2c20 6261 7965 7369 616e 2068 6965 7261  , bayesian hiera
+00001510: 7263 6869 616c 2c20 6c31 206e 6f72 6d65  rchial, l1 norme
+00001520: 6420 6f72 206f 7468 6572 206c 6f73 7320  d or other loss 
+00001530: 286e 756d 6261 292c 0d0a 2020 2020 2020  (numba),..      
+00001540: 2020 7261 6e64 6f6d 7761 6c6b 5f6e 3a20    randomwalk_n: 
+00001550: 696e 7420 3d20 4e6f 6e65 2c20 2023 2075  int = None,  # u
+00001560: 7365 2073 7461 7473 206f 6620 736f 7572  se stats of sour
+00001570: 6365 2064 660d 0a20 2020 2020 2020 2074  ce df..        t
+00001580: 7265 6e64 5f77 696e 646f 773a 2069 6e74  rend_window: int
+00001590: 203d 2033 302c 2020 2320 7365 7420 746f   = 30,  # set to
+000015a0: 204e 6f6e 6520 746f 2075 7365 2072 6177   None to use raw
+000015b0: 2072 6573 6964 7561 6c73 0d0a 2020 2020   residuals..    
+000015c0: 2020 2020 7472 656e 645f 7374 616e 6469      trend_standi
+000015d0: 6e3a 2073 7472 203d 204e 6f6e 652c 2020  n: str = None,  
+000015e0: 2320 726f 6c6c 696e 6720 6669 742c 2069  # rolling fit, i
+000015f0: 6e74 6572 6365 7074 2d6f 6e6c 792c 2072  ntercept-only, r
+00001600: 616e 646f 6d2e 6e6f 726d 616c 2066 6561  andom.normal fea
+00001610: 7475 7265 730d 0a20 2020 2020 2020 2074  tures..        t
+00001620: 7265 6e64 5f61 6e6f 6d61 6c79 5f64 6574  rend_anomaly_det
+00001630: 6563 746f 725f 7061 7261 6d73 3a20 6469  ector_params: di
+00001640: 6374 203d 204e 6f6e 652c 2020 2320 6469  ct = None,  # di
+00001650: 6666 6572 656e 6365 2066 6972 7374 2c20  fference first, 
+00001660: 7275 6e20 6f6e 2073 6c6f 7065 206f 6e6c  run on slope onl
+00001670: 792c 2075 7365 2057 696e 646f 7720 6e2f  y, use Window n/
+00001680: 3220 6469 6666 2074 6f20 7275 6c65 206f  2 diff to rule o
+00001690: 7574 2072 6574 7572 6e20 746f 0d0a 2020  ut return to..  
+000016a0: 2020 2020 2020 2320 7472 656e 645f 616e        # trend_an
+000016b0: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
+000016c0: 6f6e 3a20 7374 7220 3d20 4e6f 6e65 2c0d  on: str = None,.
+000016d0: 0a20 2020 2020 2020 2074 7265 6e64 5f74  .        trend_t
+000016e0: 7261 6e73 666f 726d 6174 696f 6e3a 2064  ransformation: d
+000016f0: 6963 7420 3d20 7b7d 2c0d 0a20 2020 2020  ict = {},..     
+00001700: 2020 2074 7265 6e64 5f6d 6f64 656c 3a20     trend_model: 
+00001710: 6469 6374 203d 207b 0d0a 2020 2020 2020  dict = {..      
+00001720: 2020 2020 2020 274d 6f64 656c 273a 2027        'Model': '
+00001730: 4c61 7374 5661 6c75 654e 6169 7665 272c  LastValueNaive',
+00001740: 0d0a 2020 2020 2020 2020 2020 2020 274d  ..            'M
+00001750: 6f64 656c 5061 7261 6d65 7465 7273 273a  odelParameters':
+00001760: 207b 7d2c 0d0a 2020 2020 2020 2020 7d2c   {},..        },
+00001770: 2020 2320 6861 7665 206f 6e65 206f 7220    # have one or 
+00001780: 7477 6f20 696e 2062 7569 6c74 2c20 7468  two in built, th
+00001790: 656e 2072 6564 6972 6563 7420 746f 2061  en redirect to a
+000017a0: 6e79 2041 7574 6f54 5320 6d6f 6465 6c20  ny AutoTS model 
+000017b0: 666f 7220 6f74 6865 7220 6368 6f69 6365  for other choice
+000017c0: 730d 0a20 2020 2020 2020 2074 7265 6e64  s..        trend
+000017d0: 5f70 6869 3a20 666c 6f61 7420 3d20 4e6f  _phi: float = No
+000017e0: 6e65 2c0d 0a20 2020 2020 2020 2063 6f6e  ne,..        con
+000017f0: 7374 7261 696e 743a 2064 6963 7420 3d20  straint: dict = 
+00001800: 4e6f 6e65 2c0d 0a20 2020 2020 2020 206d  None,..        m
+00001810: 6178 5f63 6f6c 696e 6561 7269 7479 3a20  ax_colinearity: 
+00001820: 666c 6f61 7420 3d20 302e 3939 382c 0d0a  float = 0.998,..
+00001830: 2020 2020 2020 2020 6d61 785f 6d75 6c74          max_mult
+00001840: 6963 6f6c 696e 6561 7269 7479 3a20 666c  icolinearity: fl
+00001850: 6f61 7420 3d20 302e 3030 312c 0d0a 2020  oat = 0.001,..  
+00001860: 2020 2020 2020 2320 6e6f 7420 6d6f 6465        # not mode
+00001870: 6c69 6e67 2072 656c 6174 6564 3a0d 0a20  ling related:.. 
+00001880: 2020 2020 2020 2066 7265 7175 656e 6379         frequency
+00001890: 3a20 7374 7220 3d20 2769 6e66 6572 272c  : str = 'infer',
+000018a0: 0d0a 2020 2020 2020 2020 7072 6564 6963  ..        predic
+000018b0: 7469 6f6e 5f69 6e74 6572 7661 6c3a 2066  tion_interval: f
+000018c0: 6c6f 6174 203d 2030 2e39 2c0d 0a20 2020  loat = 0.9,..   
+000018d0: 2020 2020 2072 616e 646f 6d5f 7365 6564       random_seed
+000018e0: 3a20 696e 7420 3d20 3230 3232 2c0d 0a20  : int = 2022,.. 
+000018f0: 2020 2020 2020 2076 6572 626f 7365 3a20         verbose: 
+00001900: 696e 7420 3d20 302c 0d0a 2020 2020 2020  int = 0,..      
+00001910: 2020 6e5f 6a6f 6273 3a20 696e 7420 3d20    n_jobs: int = 
+00001920: 2261 7574 6f22 2c0d 0a20 2020 2020 2020  "auto",..       
+00001930: 202a 2a6b 7761 7267 732c 0d0a 2020 2020   **kwargs,..    
+00001940: 293a 0d0a 2020 2020 2020 2020 6966 2070  ):..        if p
+00001950: 7265 7072 6f63 6573 7369 6e67 5f74 7261  reprocessing_tra
+00001960: 6e73 666f 726d 6174 696f 6e20 6973 204e  nsformation is N
+00001970: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00001980: 2020 7072 6570 726f 6365 7373 696e 675f    preprocessing_
+00001990: 7472 616e 7366 6f72 6d61 7469 6f6e 203d  transformation =
+000019a0: 207b 7d0d 0a20 2020 2020 2020 2073 656c   {}..        sel
+000019b0: 662e 7072 6570 726f 6365 7373 696e 675f  f.preprocessing_
+000019c0: 7472 616e 7366 6f72 6d61 7469 6f6e 203d  transformation =
+000019d0: 2070 7265 7072 6f63 6573 7369 6e67 5f74   preprocessing_t
+000019e0: 7261 6e73 666f 726d 6174 696f 6e0d 0a20  ransformation.. 
+000019f0: 2020 2020 2020 2073 656c 662e 7363 616c         self.scal
+00001a00: 696e 6720 3d20 7363 616c 696e 670d 0a20  ing = scaling.. 
+00001a10: 2020 2020 2020 2073 656c 662e 7061 7374         self.past
+00001a20: 5f69 6d70 6163 7473 5f69 6e74 6572 7665  _impacts_interve
+00001a30: 6e74 696f 6e20 3d20 7061 7374 5f69 6d70  ntion = past_imp
+00001a40: 6163 7473 5f69 6e74 6572 7665 6e74 696f  acts_interventio
+00001a50: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+00001a60: 7365 6173 6f6e 616c 6974 6965 7320 3d20  seasonalities = 
+00001a70: 7365 6173 6f6e 616c 6974 6965 730d 0a20  seasonalities.. 
+00001a80: 2020 2020 2020 2073 656c 662e 6172 5f6c         self.ar_l
+00001a90: 6167 7320 3d20 6172 5f6c 6167 730d 0a20  ags = ar_lags.. 
+00001aa0: 2020 2020 2020 2073 656c 662e 6172 5f69         self.ar_i
+00001ab0: 6e74 6572 6163 7469 6f6e 5f73 6561 736f  nteraction_seaso
+00001ac0: 6e61 6c69 7479 203d 2061 725f 696e 7465  nality = ar_inte
+00001ad0: 7261 6374 696f 6e5f 7365 6173 6f6e 616c  raction_seasonal
+00001ae0: 6974 790d 0a20 2020 2020 2020 2073 656c  ity..        sel
+00001af0: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
+00001b00: 6f72 5f70 6172 616d 7320 3d20 616e 6f6d  or_params = anom
+00001b10: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
+00001b20: 616d 730d 0a20 2020 2020 2020 2073 656c  ams..        sel
+00001b30: 662e 616e 6f6d 616c 795f 696e 7465 7276  f.anomaly_interv
+00001b40: 656e 7469 6f6e 203d 2061 6e6f 6d61 6c79  ention = anomaly
+00001b50: 5f69 6e74 6572 7665 6e74 696f 6e0d 0a20  _intervention.. 
+00001b60: 2020 2020 2020 2073 656c 662e 686f 6c69         self.holi
+00001b70: 6461 795f 6465 7465 6374 6f72 5f70 6172  day_detector_par
+00001b80: 616d 7320 3d20 686f 6c69 6461 795f 6465  ams = holiday_de
+00001b90: 7465 6374 6f72 5f70 6172 616d 730d 0a20  tector_params.. 
+00001ba0: 2020 2020 2020 2073 656c 662e 686f 6c69         self.holi
+00001bb0: 6461 795f 636f 756e 7472 6965 7320 3d20  day_countries = 
+00001bc0: 686f 6c69 6461 795f 636f 756e 7472 6965  holiday_countrie
+00001bd0: 730d 0a20 2020 2020 2020 2069 6620 6973  s..        if is
+00001be0: 696e 7374 616e 6365 2873 656c 662e 686f  instance(self.ho
+00001bf0: 6c69 6461 795f 636f 756e 7472 6965 732c  liday_countries,
+00001c00: 2073 7472 293a 0d0a 2020 2020 2020 2020   str):..        
+00001c10: 2020 2020 7365 6c66 2e68 6f6c 6964 6179      self.holiday
+00001c20: 5f63 6f75 6e74 7269 6573 203d 2073 656c  _countries = sel
+00001c30: 662e 686f 6c69 6461 795f 636f 756e 7472  f.holiday_countr
+00001c40: 6965 732e 7370 6c69 7428 222c 2229 0d0a  ies.split(",")..
+00001c50: 2020 2020 2020 2020 7365 6c66 2e68 6f6c          self.hol
+00001c60: 6964 6179 5f63 6f75 6e74 7269 6573 5f75  iday_countries_u
+00001c70: 7365 6420 3d20 686f 6c69 6461 795f 636f  sed = holiday_co
+00001c80: 756e 7472 6965 735f 7573 6564 0d0a 2020  untries_used..  
+00001c90: 2020 2020 2020 7365 6c66 2e6d 756c 7469        self.multi
+00001ca0: 7661 7269 6174 655f 6665 6174 7572 6520  variate_feature 
+00001cb0: 3d20 6d75 6c74 6976 6172 6961 7465 5f66  = multivariate_f
+00001cc0: 6561 7475 7265 0d0a 2020 2020 2020 2020  eature..        
+00001cd0: 7365 6c66 2e6d 756c 7469 7661 7269 6174  self.multivariat
+00001ce0: 655f 7472 616e 7366 6f72 6d61 7469 6f6e  e_transformation
+00001cf0: 203d 206d 756c 7469 7661 7269 6174 655f   = multivariate_
+00001d00: 7472 616e 7366 6f72 6d61 7469 6f6e 0d0a  transformation..
+00001d10: 2020 2020 2020 2020 7365 6c66 2e72 6567          self.reg
+00001d20: 7265 7373 6f72 5f74 7261 6e73 666f 726d  ressor_transform
+00001d30: 6174 696f 6e20 3d20 7265 6772 6573 736f  ation = regresso
+00001d40: 725f 7472 616e 7366 6f72 6d61 7469 6f6e  r_transformation
+00001d50: 0d0a 2020 2020 2020 2020 7365 6c66 2e72  ..        self.r
+00001d60: 6567 7265 7373 6f72 735f 7573 6564 203d  egressors_used =
+00001d70: 2072 6567 7265 7373 6f72 735f 7573 6564   regressors_used
+00001d80: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00001d90: 696e 6561 725f 6d6f 6465 6c20 3d20 6c69  inear_model = li
+00001da0: 6e65 6172 5f6d 6f64 656c 2069 6620 6c69  near_model if li
+00001db0: 6e65 6172 5f6d 6f64 656c 2069 7320 6e6f  near_model is no
+00001dc0: 7420 4e6f 6e65 2065 6c73 6520 7b7d 0d0a  t None else {}..
+00001dd0: 2020 2020 2020 2020 7365 6c66 2e72 616e          self.ran
+00001de0: 646f 6d77 616c 6b5f 6e20 3d20 7261 6e64  domwalk_n = rand
+00001df0: 6f6d 7761 6c6b 5f6e 0d0a 2020 2020 2020  omwalk_n..      
+00001e00: 2020 7365 6c66 2e74 7265 6e64 5f77 696e    self.trend_win
+00001e10: 646f 7720 3d20 7472 656e 645f 7769 6e64  dow = trend_wind
+00001e20: 6f77 0d0a 2020 2020 2020 2020 7365 6c66  ow..        self
+00001e30: 2e74 7265 6e64 5f73 7461 6e64 696e 203d  .trend_standin =
+00001e40: 2074 7265 6e64 5f73 7461 6e64 696e 0d0a   trend_standin..
+00001e50: 2020 2020 2020 2020 7365 6c66 2e74 7265          self.tre
+00001e60: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
+00001e70: 746f 725f 7061 7261 6d73 203d 2074 7265  tor_params = tre
+00001e80: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
+00001e90: 746f 725f 7061 7261 6d73 0d0a 2020 2020  tor_params..    
+00001ea0: 2020 2020 2320 7365 6c66 2e74 7265 6e64      # self.trend
+00001eb0: 5f61 6e6f 6d61 6c79 5f69 6e74 6572 7665  _anomaly_interve
+00001ec0: 6e74 696f 6e20 3d20 7472 656e 645f 616e  ntion = trend_an
+00001ed0: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
+00001ee0: 6f6e 0d0a 2020 2020 2020 2020 7365 6c66  on..        self
+00001ef0: 2e74 7265 6e64 5f74 7261 6e73 666f 726d  .trend_transform
+00001f00: 6174 696f 6e20 3d20 7472 656e 645f 7472  ation = trend_tr
+00001f10: 616e 7366 6f72 6d61 7469 6f6e 0d0a 2020  ansformation..  
+00001f20: 2020 2020 2020 7365 6c66 2e74 7265 6e64        self.trend
+00001f30: 5f6d 6f64 656c 203d 2074 7265 6e64 5f6d  _model = trend_m
+00001f40: 6f64 656c 0d0a 2020 2020 2020 2020 7365  odel..        se
+00001f50: 6c66 2e74 7265 6e64 5f70 6869 203d 2074  lf.trend_phi = t
+00001f60: 7265 6e64 5f70 6869 0d0a 2020 2020 2020  rend_phi..      
+00001f70: 2020 7365 6c66 2e63 6f6e 7374 7261 696e    self.constrain
+00001f80: 7420 3d20 636f 6e73 7472 6169 6e74 0d0a  t = constraint..
+00001f90: 2020 2020 2020 2020 7365 6c66 2e6d 6178          self.max
+00001fa0: 5f63 6f6c 696e 6561 7269 7479 203d 206d  _colinearity = m
+00001fb0: 6178 5f63 6f6c 696e 6561 7269 7479 0d0a  ax_colinearity..
+00001fc0: 2020 2020 2020 2020 7365 6c66 2e6d 6178          self.max
+00001fd0: 5f6d 756c 7469 636f 6c69 6e65 6172 6974  _multicolinearit
+00001fe0: 7920 3d20 6d61 785f 6d75 6c74 6963 6f6c  y = max_multicol
+00001ff0: 696e 6561 7269 7479 0d0a 2020 2020 2020  inearity..      
+00002000: 2020 2320 6f74 6865 7220 7061 7261 6d65    # other parame
+00002010: 7465 7273 0d0a 2020 2020 2020 2020 7365  ters..        se
+00002020: 6c66 2e66 7265 7175 656e 6379 203d 2066  lf.frequency = f
+00002030: 7265 7175 656e 6379 0d0a 2020 2020 2020  requency..      
+00002040: 2020 7365 6c66 2e70 7265 6469 6374 696f    self.predictio
+00002050: 6e5f 696e 7465 7276 616c 203d 2070 7265  n_interval = pre
+00002060: 6469 6374 696f 6e5f 696e 7465 7276 616c  diction_interval
+00002070: 0d0a 2020 2020 2020 2020 7365 6c66 2e69  ..        self.i
+00002080: 6e74 5f73 7464 5f64 6576 203d 206e 6f72  nt_std_dev = nor
+00002090: 6d2e 7070 6628 0d0a 2020 2020 2020 2020  m.ppf(..        
+000020a0: 2020 2020 302e 3520 2b20 302e 3520 2a20      0.5 + 0.5 * 
+000020b0: 7365 6c66 2e70 7265 6469 6374 696f 6e5f  self.prediction_
+000020c0: 696e 7465 7276 616c 0d0a 2020 2020 2020  interval..      
+000020d0: 2020 2920 2023 2032 2074 6f20 3120 7369    )  # 2 to 1 si
+000020e0: 6465 6420 696e 7465 7276 616c 0d0a 2020  ded interval..  
+000020f0: 2020 2020 2020 7365 6c66 2e72 616e 646f        self.rando
+00002100: 6d5f 7365 6564 203d 2072 616e 646f 6d5f  m_seed = random_
+00002110: 7365 6564 0d0a 2020 2020 2020 2020 7365  seed..        se
+00002120: 6c66 2e76 6572 626f 7365 203d 2076 6572  lf.verbose = ver
+00002130: 626f 7365 0d0a 2020 2020 2020 2020 7365  bose..        se
+00002140: 6c66 2e6e 5f6a 6f62 7320 3d20 6e5f 6a6f  lf.n_jobs = n_jo
+00002150: 6273 0d0a 2020 2020 2020 2020 6966 2073  bs..        if s
+00002160: 656c 662e 6e5f 6a6f 6273 203d 3d20 2761  elf.n_jobs == 'a
+00002170: 7574 6f27 3a0d 0a20 2020 2020 2020 2020  uto':..         
+00002180: 2020 2073 656c 662e 6e5f 6a6f 6273 203d     self.n_jobs =
+00002190: 2063 7075 5f63 6f75 6e74 286d 6f64 6966   cpu_count(modif
+000021a0: 6965 723d 302e 3735 290d 0a20 2020 2020  ier=0.75)..     
+000021b0: 2020 2020 2020 2069 6620 7665 7262 6f73         if verbos
+000021c0: 6520 3e20 303a 0d0a 2020 2020 2020 2020  e > 0:..        
+000021d0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+000021e0: 5573 696e 6720 7b73 656c 662e 6e5f 6a6f  Using {self.n_jo
+000021f0: 6273 7d20 6370 7573 2066 6f72 206e 5f6a  bs} cpus for n_j
+00002200: 6f62 732e 2229 0d0a 2020 2020 2020 2020  obs.")..        
+00002210: 7365 6c66 2e73 7461 7274 696e 675f 7061  self.starting_pa
+00002220: 7261 6d73 203d 2073 656c 662e 6765 745f  rams = self.get_
+00002230: 7061 7261 6d73 2829 0d0a 2020 2020 2020  params()..      
+00002240: 2020 7365 6c66 2e73 6361 6c65 7220 3d20    self.scaler = 
+00002250: 456d 7074 7954 7261 6e73 666f 726d 6572  EmptyTransformer
+00002260: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+00002270: 2e70 7265 7072 6f63 6573 7365 7220 3d20  .preprocesser = 
+00002280: 456d 7074 7954 7261 6e73 666f 726d 6572  EmptyTransformer
+00002290: 2829 0d0a 2020 2020 2020 2020 7365 6c66  ()..        self
+000022a0: 2e64 735f 6d69 6e20 3d20 7064 2e54 696d  .ds_min = pd.Tim
+000022b0: 6573 7461 6d70 2822 3230 3030 2d30 312d  estamp("2000-01-
+000022c0: 3031 2229 0d0a 2020 2020 2020 2020 7365  01")..        se
+000022d0: 6c66 2e64 735f 6d61 7820 3d20 7064 2e54  lf.ds_max = pd.T
+000022e0: 696d 6573 7461 6d70 2822 3230 3235 2d30  imestamp("2025-0
+000022f0: 312d 3031 2229 0d0a 2020 2020 2020 2020  1-01")..        
+00002300: 7365 6c66 2e6e 616d 6520 3d20 2243 6173  self.name = "Cas
+00002310: 7361 6e64 7261 220d 0a20 2020 2020 2020  sandra"..       
+00002320: 2073 656c 662e 6675 7475 7265 5f72 6567   self.future_reg
+00002330: 7265 7373 6f72 5f74 7261 696e 203d 204e  ressor_train = N
+00002340: 6f6e 650d 0a20 2020 2020 2020 2073 656c  one..        sel
+00002350: 662e 666c 6167 5f72 6567 7265 7373 6f72  f.flag_regressor
+00002360: 5f74 7261 696e 203d 204e 6f6e 650d 0a20  _train = None.. 
+00002370: 2020 2020 2020 2073 656c 662e 7265 6772         self.regr
+00002380: 5f70 6572 5f73 6572 6965 735f 7472 203d  _per_series_tr =
+00002390: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
+000023a0: 656c 662e 7472 656e 645f 7472 6169 6e20  elf.trend_train 
+000023b0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+000023c0: 7365 6c66 2e63 6f6d 706f 6e65 6e74 7320  self.components 
+000023d0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+000023e0: 7365 6c66 2e61 6e6f 6d61 6c79 5f64 6574  self.anomaly_det
+000023f0: 6563 746f 7220 3d20 4e6f 6e65 0d0a 2020  ector = None..  
+00002400: 2020 2020 2020 7365 6c66 2e68 6f6c 6964        self.holid
+00002410: 6179 5f64 6574 6563 746f 7220 3d20 4e6f  ay_detector = No
+00002420: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
+00002430: 2e69 6d70 6163 7473 203d 204e 6f6e 650d  .impacts = None.
+00002440: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00002450: 2e74 7265 6e64 5f61 6e6f 6d61 6c79 5f64  .trend_anomaly_d
+00002460: 6574 6563 746f 725f 7061 7261 6d73 2069  etector_params i
+00002470: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00002480: 2020 2020 2020 2020 2073 656c 662e 7472           self.tr
+00002490: 656e 645f 616e 6f6d 616c 795f 6465 7465  end_anomaly_dete
+000024a0: 6374 6f72 203d 2041 6e6f 6d61 6c79 5265  ctor = AnomalyRe
+000024b0: 6d6f 7661 6c28 0d0a 2020 2020 2020 2020  moval(..        
+000024c0: 2020 2020 2020 2020 2a2a 7365 6c66 2e74          **self.t
+000024d0: 7265 6e64 5f61 6e6f 6d61 6c79 5f64 6574  rend_anomaly_det
+000024e0: 6563 746f 725f 7061 7261 6d73 0d0a 2020  ector_params..  
+000024f0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00002500: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00002510: 2020 2020 2020 2020 7365 6c66 2e74 7265          self.tre
+00002520: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
+00002530: 746f 7220 3d20 4e6f 6e65 0d0a 0d0a 2020  tor = None....  
+00002540: 2020 6465 6620 6261 7365 5f73 6361 6c65    def base_scale
+00002550: 7228 7365 6c66 2c20 6466 293a 0d0a 2020  r(self, df):..  
+00002560: 2020 2020 2020 7365 6c66 2e73 6361 6c65        self.scale
+00002570: 725f 6d65 616e 203d 206e 702e 6d65 616e  r_mean = np.mean
+00002580: 2864 662c 2061 7869 733d 3029 0d0a 2020  (df, axis=0)..  
+00002590: 2020 2020 2020 7365 6c66 2e73 6361 6c65        self.scale
+000025a0: 725f 7374 6420 3d20 6e70 2e73 7464 2864  r_std = np.std(d
+000025b0: 662c 2061 7869 733d 3029 0d0a 2020 2020  f, axis=0)..    
+000025c0: 2020 2020 7265 7475 726e 2028 6466 202d      return (df -
+000025d0: 2073 656c 662e 7363 616c 6572 5f6d 6561   self.scaler_mea
+000025e0: 6e29 202f 2073 656c 662e 7363 616c 6572  n) / self.scaler
+000025f0: 5f73 7464 0d0a 0d0a 2020 2020 6465 6620  _std....    def 
+00002600: 7363 616c 655f 6461 7461 2873 656c 662c  scale_data(self,
+00002610: 2064 6629 3a0d 0a20 2020 2020 2020 2069   df):..        i
+00002620: 6620 7365 6c66 2e70 7265 7072 6f63 6573  f self.preproces
+00002630: 7369 6e67 5f74 7261 6e73 666f 726d 6174  sing_transformat
+00002640: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
+00002650: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
+00002660: 203d 2073 656c 662e 7072 6570 726f 6365   = self.preproce
+00002670: 7373 6572 2e74 7261 6e73 666f 726d 2864  sser.transform(d
+00002680: 662e 636f 7079 2829 290d 0a20 2020 2020  f.copy())..     
+00002690: 2020 2069 6620 7365 6c66 2e73 6361 6c69     if self.scali
+000026a0: 6e67 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ng is not None:.
+000026b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000026c0: 7365 6c66 2e73 6361 6c69 6e67 203d 3d20  self.scaling == 
+000026d0: 2242 6173 6553 6361 6c65 7222 3a0d 0a20  "BaseScaler":.. 
+000026e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000026f0: 6620 3d20 7365 6c66 2e62 6173 655f 7363  f = self.base_sc
+00002700: 616c 6572 2864 6629 0d0a 2020 2020 2020  aler(df)..      
+00002710: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00002720: 2020 2020 2020 2020 2020 2020 2064 6620               df 
+00002730: 3d20 7365 6c66 2e73 6361 6c65 722e 7472  = self.scaler.tr
+00002740: 616e 7366 6f72 6d28 6466 290d 0a20 2020  ansform(df)..   
+00002750: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+00002760: 7374 616e 6365 2864 662c 2070 642e 4461  stance(df, pd.Da
+00002770: 7461 4672 616d 6529 3a0d 0a20 2020 2020  taFrame):..     
+00002780: 2020 2020 2020 2072 6574 7572 6e20 7064         return pd
+00002790: 2e44 6174 6146 7261 6d65 2864 662c 2063  .DataFrame(df, c
+000027a0: 6f6c 756d 6e73 3d64 662e 636f 6c75 6d6e  olumns=df.column
+000027b0: 732c 2069 6e64 6578 3d64 662e 696e 6465  s, index=df.inde
+000027c0: 7829 0d0a 2020 2020 2020 2020 656c 7365  x)..        else
+000027d0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+000027e0: 6574 7572 6e20 6466 0d0a 0d0a 2020 2020  eturn df....    
+000027f0: 6465 6620 746f 5f6f 7269 6769 6e5f 7370  def to_origin_sp
+00002800: 6163 6528 0d0a 2020 2020 2020 2020 7365  ace(..        se
+00002810: 6c66 2c20 6466 2c20 7472 616e 735f 6d65  lf, df, trans_me
+00002820: 7468 6f64 3d27 666f 7265 6361 7374 272c  thod='forecast',
+00002830: 2063 6f6d 706f 6e65 6e74 733d 4661 6c73   components=Fals
+00002840: 652c 2062 6f75 6e64 733d 4661 6c73 650d  e, bounds=False.
+00002850: 0a20 2020 2029 3a0d 0a20 2020 2020 2020  .    ):..       
+00002860: 2022 2222 5461 6b65 2074 7261 6e73 666f   """Take transfo
+00002870: 726d 6564 206f 7574 7075 7473 2062 6163  rmed outputs bac
+00002880: 6b20 746f 206f 7269 6769 6e61 6c20 6665  k to original fe
+00002890: 6174 7572 6520 7370 6163 652e 2222 220d  ature space.""".
+000028a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000028b0: 2e73 6361 6c69 6e67 203d 3d20 2242 6173  .scaling == "Bas
+000028c0: 6553 6361 6c65 7222 3a0d 0a20 2020 2020  eScaler":..     
+000028d0: 2020 2020 2020 2023 2072 6574 7572 6e20         # return 
+000028e0: 7365 6c66 2e70 7265 7072 6f63 6573 7365  self.preprocesse
+000028f0: 722e 696e 7665 7273 655f 7472 616e 7366  r.inverse_transf
+00002900: 6f72 6d28 6466 2c20 7472 616e 735f 6d65  orm(df, trans_me
+00002910: 7468 6f64 3d74 7261 6e73 5f6d 6574 686f  thod=trans_metho
+00002920: 6429 202a 2073 656c 662e 7363 616c 6572  d) * self.scaler
+00002930: 5f73 7464 202b 2073 656c 662e 7363 616c  _std + self.scal
+00002940: 6572 5f6d 6561 6e0d 0a20 2020 2020 2020  er_mean..       
+00002950: 2020 2020 2069 6620 636f 6d70 6f6e 656e       if componen
+00002960: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
+00002970: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00002980: 2e70 7265 7072 6f63 6573 7365 722e 696e  .preprocesser.in
+00002990: 7665 7273 655f 7472 616e 7366 6f72 6d28  verse_transform(
+000029a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000029b0: 2020 2020 2020 6466 202a 2073 656c 662e        df * self.
+000029c0: 7363 616c 6572 5f73 7464 2c20 7472 616e  scaler_std, tran
+000029d0: 735f 6d65 7468 6f64 3d74 7261 6e73 5f6d  s_method=trans_m
+000029e0: 6574 686f 642c 2062 6f75 6e64 733d 626f  ethod, bounds=bo
+000029f0: 756e 6473 0d0a 2020 2020 2020 2020 2020  unds..          
+00002a00: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00002a10: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00002a20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00002a30: 726e 2073 656c 662e 7072 6570 726f 6365  rn self.preproce
+00002a40: 7373 6572 2e69 6e76 6572 7365 5f74 7261  sser.inverse_tra
+00002a50: 6e73 666f 726d 280d 0a20 2020 2020 2020  nsform(..       
+00002a60: 2020 2020 2020 2020 2020 2020 2064 6620               df 
+00002a70: 2a20 7365 6c66 2e73 6361 6c65 725f 7374  * self.scaler_st
+00002a80: 6420 2b20 7365 6c66 2e73 6361 6c65 725f  d + self.scaler_
+00002a90: 6d65 616e 2c0d 0a20 2020 2020 2020 2020  mean,..         
+00002aa0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+00002ab0: 5f6d 6574 686f 643d 7472 616e 735f 6d65  _method=trans_me
+00002ac0: 7468 6f64 2c0d 0a20 2020 2020 2020 2020  thod,..         
+00002ad0: 2020 2020 2020 2020 2020 2062 6f75 6e64             bound
+00002ae0: 733d 626f 756e 6473 2c0d 0a20 2020 2020  s=bounds,..     
+00002af0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00002b00: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00002b10: 2020 2020 2020 2020 2023 2072 6574 7572           # retur
+00002b20: 6e20 7365 6c66 2e73 6361 6c65 722e 696e  n self.scaler.in
+00002b30: 7665 7273 655f 7472 616e 7366 6f72 6d28  verse_transform(
+00002b40: 7365 6c66 2e70 7265 7072 6f63 6573 7365  self.preprocesse
+00002b50: 722e 696e 7665 7273 655f 7472 616e 7366  r.inverse_transf
+00002b60: 6f72 6d28 6466 2c20 7472 616e 735f 6d65  orm(df, trans_me
+00002b70: 7468 6f64 3d74 7261 6e73 5f6d 6574 686f  thod=trans_metho
+00002b80: 6429 2c20 7472 616e 735f 6d65 7468 6f64  d), trans_method
+00002b90: 3d74 7261 6e73 5f6d 6574 686f 6429 0d0a  =trans_method)..
+00002ba0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00002bb0: 726e 2073 656c 662e 7072 6570 726f 6365  rn self.preproce
+00002bc0: 7373 6572 2e69 6e76 6572 7365 5f74 7261  sser.inverse_tra
+00002bd0: 6e73 666f 726d 280d 0a20 2020 2020 2020  nsform(..       
+00002be0: 2020 2020 2020 2020 2073 656c 662e 7363           self.sc
+00002bf0: 616c 6572 2e69 6e76 6572 7365 5f74 7261  aler.inverse_tra
+00002c00: 6e73 666f 726d 280d 0a20 2020 2020 2020  nsform(..       
+00002c10: 2020 2020 2020 2020 2020 2020 2064 662c               df,
+00002c20: 2074 7261 6e73 5f6d 6574 686f 643d 7472   trans_method=tr
+00002c30: 616e 735f 6d65 7468 6f64 2c20 626f 756e  ans_method, boun
+00002c40: 6473 3d62 6f75 6e64 730d 0a20 2020 2020  ds=bounds..     
+00002c50: 2020 2020 2020 2020 2020 2029 2c0d 0a20             ),.. 
+00002c60: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00002c70: 7261 6e73 5f6d 6574 686f 643d 7472 616e  rans_method=tran
+00002c80: 735f 6d65 7468 6f64 2c0d 0a20 2020 2020  s_method,..     
+00002c90: 2020 2020 2020 2020 2020 2062 6f75 6e64             bound
+00002ca0: 733d 626f 756e 6473 2c0d 0a20 2020 2020  s=bounds,..     
+00002cb0: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+00002cc0: 6465 6620 6372 6561 7465 5f74 2873 656c  def create_t(sel
+00002cd0: 662c 2044 5469 6e64 6578 293a 0d0a 2020  f, DTindex):..  
+00002ce0: 2020 2020 2020 7265 7475 726e 2028 4454        return (DT
+00002cf0: 696e 6465 7820 2d20 7365 6c66 2e64 735f  index - self.ds_
+00002d00: 6d69 6e29 202f 2028 7365 6c66 2e64 735f  min) / (self.ds_
+00002d10: 6d61 7820 2d20 7365 6c66 2e64 735f 6d69  max - self.ds_mi
+00002d20: 6e29 0d0a 0d0a 2020 2020 6465 6620 6669  n)....    def fi
+00002d30: 7428 0d0a 2020 2020 2020 2020 7365 6c66  t(..        self
+00002d40: 2c0d 0a20 2020 2020 2020 2064 662c 0d0a  ,..        df,..
+00002d50: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
+00002d60: 6567 7265 7373 6f72 3d4e 6f6e 652c 0d0a  egressor=None,..
+00002d70: 2020 2020 2020 2020 7265 6772 6573 736f          regresso
+00002d80: 725f 7065 725f 7365 7269 6573 3d4e 6f6e  r_per_series=Non
+00002d90: 652c 0d0a 2020 2020 2020 2020 666c 6167  e,..        flag
+00002da0: 5f72 6567 7265 7373 6f72 733d 4e6f 6e65  _regressors=None
+00002db0: 2c0d 0a20 2020 2020 2020 2063 6174 6567  ,..        categ
+00002dc0: 6f72 6963 616c 5f67 726f 7570 733d 4e6f  orical_groups=No
+00002dd0: 6e65 2c0d 0a20 2020 2020 2020 2070 6173  ne,..        pas
+00002de0: 745f 696d 7061 6374 733d 4e6f 6e65 2c0d  t_impacts=None,.
+00002df0: 0a20 2020 2029 3a0d 0a20 2020 2020 2020  .    ):..       
+00002e00: 2023 2066 6c61 6720 7265 6772 6573 736f   # flag regresso
+00002e10: 7273 2062 7970 6173 7320 7072 6570 726f  rs bypass prepro
+00002e20: 6365 7373 696e 670d 0a20 2020 2020 2020  cessing..       
+00002e30: 2023 2069 6465 616c 6c79 2061 6c6c 6f77   # ideally allow
+00002e40: 2062 6f74 6820 7064 2e44 6174 6146 7261   both pd.DataFra
+00002e50: 6d65 2061 6e64 206e 702e 6172 7261 7920  me and np.array 
+00002e60: 696e 7075 7473 2028 696e 6465 7820 666f  inputs (index fo
+00002e70: 7220 6172 7261 793f 0d0a 2020 2020 2020  r array?..      
+00002e80: 2020 6966 2073 656c 662e 636f 6e73 7472    if self.constr
+00002e90: 6169 6e74 2069 7320 6e6f 7420 4e6f 6e65  aint is not None
+00002ea0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00002eb0: 656c 662e 6466 5f6f 7269 6769 6e61 6c20  elf.df_original 
+00002ec0: 3d20 6466 0d0a 2020 2020 2020 2020 7365  = df..        se
+00002ed0: 6c66 2e64 6620 3d20 6466 2e63 6f70 7928  lf.df = df.copy(
+00002ee0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00002ef0: 6261 7369 635f 7072 6f66 696c 6528 7365  basic_profile(se
+00002f00: 6c66 2e64 6629 0d0a 2020 2020 2020 2020  lf.df)..        
+00002f10: 2320 7374 616e 6461 7264 697a 6520 6772  # standardize gr
+00002f20: 6f75 7069 6e67 7320 2865 7874 7261 2f6d  oupings (extra/m
+00002f30: 6973 7369 6e67 2064 6561 6c74 2077 6974  issing dealt wit
+00002f40: 6829 0d0a 2020 2020 2020 2020 6966 2063  h)..        if c
+00002f50: 6174 6567 6f72 6963 616c 5f67 726f 7570  ategorical_group
+00002f60: 7320 6973 204e 6f6e 653a 0d0a 2020 2020  s is None:..    
+00002f70: 2020 2020 2020 2020 6361 7465 676f 7269          categori
+00002f80: 6361 6c5f 6772 6f75 7073 203d 207b 7d0d  cal_groups = {}.
+00002f90: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
+00002fa0: 7465 676f 7269 6361 6c5f 6772 6f75 7073  tegorical_groups
+00002fb0: 203d 207b 0d0a 2020 2020 2020 2020 2020   = {..          
+00002fc0: 2020 636f 6c3a 2028 0d0a 2020 2020 2020    col: (..      
+00002fd0: 2020 2020 2020 2020 2020 6361 7465 676f            catego
+00002fe0: 7269 6361 6c5f 6772 6f75 7073 5b63 6f6c  rical_groups[col
+00002ff0: 5d20 6966 2063 6f6c 2069 6e20 6361 7465  ] if col in cate
+00003000: 676f 7269 6361 6c5f 6772 6f75 7073 2e6b  gorical_groups.k
+00003010: 6579 7328 2920 656c 7365 2022 6f74 6865  eys() else "othe
+00003020: 7222 0d0a 2020 2020 2020 2020 2020 2020  r"..            
+00003030: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
+00003040: 6f72 2063 6f6c 2069 6e20 6466 2e63 6f6c  or col in df.col
+00003050: 756d 6e73 0d0a 2020 2020 2020 2020 7d0d  umns..        }.
+00003060: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00003070: 7374 5f69 6d70 6163 7473 203d 2070 6173  st_impacts = pas
+00003080: 745f 696d 7061 6374 730d 0a20 2020 2020  t_impacts..     
+00003090: 2020 2023 2069 6620 7061 7374 2069 6d70     # if past imp
+000030a0: 6163 7473 2067 6976 656e 2c20 6173 7375  acts given, assu
+000030b0: 6d65 2072 656d 6f76 616c 2075 6e6c 6573  me removal unles
+000030c0: 7320 6f74 6865 7277 6973 6520 7370 6563  s otherwise spec
+000030d0: 6966 6965 640d 0a20 2020 2020 2020 2069  ified..        i
+000030e0: 6620 7365 6c66 2e70 6173 745f 696d 7061  f self.past_impa
+000030f0: 6374 735f 696e 7465 7276 656e 7469 6f6e  cts_intervention
+00003100: 2069 7320 4e6f 6e65 2061 6e64 2070 6173   is None and pas
+00003110: 745f 696d 7061 6374 7320 6973 206e 6f74  t_impacts is not
+00003120: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00003130: 2020 2020 7365 6c66 2e70 6173 745f 696d      self.past_im
+00003140: 7061 6374 735f 696e 7465 7276 656e 7469  pacts_interventi
+00003150: 6f6e 203d 2022 7265 6d6f 7665 220d 0a20  on = "remove".. 
+00003160: 2020 2020 2020 2065 6c69 6620 7061 7374         elif past
+00003170: 5f69 6d70 6163 7473 2069 7320 4e6f 6e65  _impacts is None
+00003180: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00003190: 656c 662e 7061 7374 5f69 6d70 6163 7473  elf.past_impacts
+000031a0: 5f69 6e74 6572 7665 6e74 696f 6e20 3d20  _intervention = 
+000031b0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6966  None..        if
+000031c0: 2072 6567 7265 7373 6f72 5f70 6572 5f73   regressor_per_s
+000031d0: 6572 6965 7320 6973 206e 6f74 204e 6f6e  eries is not Non
+000031e0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000031f0: 7365 6c66 2e72 6567 725f 7065 725f 7365  self.regr_per_se
+00003200: 7269 6573 5f74 7220 3d20 7265 6772 6573  ries_tr = regres
+00003210: 736f 725f 7065 725f 7365 7269 6573 0d0a  sor_per_series..
+00003220: 0d0a 2020 2020 2020 2020 2320 7768 6174  ..        # what
+00003230: 2066 6561 7475 7265 7320 7769 6c6c 2072   features will r
+00003240: 6571 7569 7265 2073 6570 6172 6174 6520  equire separate 
+00003250: 6d6f 6465 6c73 2074 6f20 6265 2066 6974  models to be fit
+00003260: 2061 7320 5820 7769 6c6c 206e 6f74 2062   as X will not b
+00003270: 6520 636f 6e73 6973 7465 6e74 2066 6f72  e consistent for
+00003280: 2061 6c6c 0d0a 2020 2020 2020 2020 2320   all..        # 
+00003290: 5768 6174 2074 7269 6767 6572 7320 6c6f  What triggers lo
+000032a0: 6f70 3a0d 0a20 2020 2020 2020 2023 2041  op:..        # A
+000032b0: 5220 4c61 6773 0d0a 2020 2020 2020 2020  R Lags..        
+000032c0: 2320 486f 6c69 6461 7920 636f 756e 7472  # Holiday countr
+000032d0: 6965 7320 6173 2064 6963 7420 286e 6f74  ies as dict (not
+000032e0: 206c 6973 7429 0d0a 2020 2020 2020 2020   list)..        
+000032f0: 2320 7265 6772 6573 736f 725f 7065 725f  # regressor_per_
+00003300: 7365 7269 6573 2028 6f6e 6c79 2069 6620  series (only if 
+00003310: 7265 6772 6573 736f 7220 7573 6564 290d  regressor used).
+00003320: 0a20 2020 2020 2020 2023 204d 756c 7469  .        # Multi
+00003330: 7661 7269 6174 6520 486f 6c69 6461 7920  variate Holiday 
+00003340: 4465 7465 6374 6f72 2c20 6f6e 6c79 2069  Detector, only i
+00003350: 6620 6372 6561 7465 2066 6561 7475 7265  f create feature
+00003360: 2c20 6e6f 7420 7265 6d6f 7661 6c20 2870  , not removal (p
+00003370: 6c6f 7420 696e 2074 6869 7320 6361 7365  lot in this case
+00003380: 290d 0a20 2020 2020 2020 2023 204d 756c  )..        # Mul
+00003390: 7469 7661 7269 6174 6520 416e 6f6d 616c  tivariate Anomal
+000033a0: 7920 4465 7465 6374 6f72 2c20 6f6e 6c79  y Detector, only
+000033b0: 2069 6620 6372 6561 7465 2066 6561 7475   if create featu
+000033c0: 7265 2c20 6e6f 7420 7265 6d6f 7661 6c0d  re, not removal.
+000033d0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+000033e0: 7374 616e 6365 2873 656c 662e 616e 6f6d  stance(self.anom
+000033f0: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
+00003400: 616d 732c 2064 6963 7429 3a0d 0a20 2020  ams, dict):..   
+00003410: 2020 2020 2020 2020 2073 656c 662e 616e           self.an
+00003420: 6f6d 616c 795f 6e6f 745f 756e 6920 3d20  omaly_not_uni = 
+00003430: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00003440: 2020 2073 656c 662e 616e 6f6d 616c 795f     self.anomaly_
+00003450: 6465 7465 6374 6f72 5f70 6172 616d 732e  detector_params.
+00003460: 6765 7428 276f 7574 7075 7427 2c20 4e6f  get('output', No
+00003470: 6e65 2920 213d 2027 756e 6976 6172 6961  ne) != 'univaria
+00003480: 7465 270d 0a20 2020 2020 2020 2020 2020  te'..           
+00003490: 2029 0d0a 2020 2020 2020 2020 7365 6c66   )..        self
+000034a0: 2e61 6e6f 6d61 6c79 5f6e 6f74 5f75 6e69  .anomaly_not_uni
+000034b0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+000034c0: 2020 7365 6c66 2e6c 6f6f 705f 7265 7175    self.loop_requ
+000034d0: 6972 6564 203d 2028 0d0a 2020 2020 2020  ired = (..      
+000034e0: 2020 2020 2020 2873 656c 662e 6172 5f6c        (self.ar_l
+000034f0: 6167 7320 6973 206e 6f74 204e 6f6e 6529  ags is not None)
+00003500: 0d0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
+00003510: 2028 290d 0a20 2020 2020 2020 2020 2020   ()..           
+00003520: 206f 7220 280d 0a20 2020 2020 2020 2020   or (..         
+00003530: 2020 2020 2020 2069 7369 6e73 7461 6e63         isinstanc
+00003540: 6528 7365 6c66 2e68 6f6c 6964 6179 5f63  e(self.holiday_c
+00003550: 6f75 6e74 7269 6573 2c20 6469 6374 2920  ountries, dict) 
+00003560: 616e 6420 7365 6c66 2e68 6f6c 6964 6179  and self.holiday
+00003570: 5f63 6f75 6e74 7269 6573 5f75 7365 640d  _countries_used.
+00003580: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00003590: 2020 2020 2020 2020 2020 2020 6f72 2028              or (
+000035a0: 2872 6567 7265 7373 6f72 5f70 6572 5f73  (regressor_per_s
+000035b0: 6572 6965 7320 6973 206e 6f74 204e 6f6e  eries is not Non
+000035c0: 6529 2061 6e64 2073 656c 662e 7265 6772  e) and self.regr
+000035d0: 6573 736f 7273 5f75 7365 6429 0d0a 2020  essors_used)..  
+000035e0: 2020 2020 2020 2020 2020 6f72 2028 6973            or (is
+000035f0: 696e 7374 616e 6365 2873 656c 662e 616e  instance(self.an
+00003600: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
+00003610: 6f6e 2c20 6469 6374 2920 616e 6420 7365  on, dict) and se
+00003620: 6c66 2e61 6e6f 6d61 6c79 5f6e 6f74 5f75  lf.anomaly_not_u
+00003630: 6e69 290d 0a20 2020 2020 2020 2020 2020  ni)..           
+00003640: 206f 7220 280d 0a20 2020 2020 2020 2020   or (..         
+00003650: 2020 2020 2020 2073 656c 662e 7061 7374         self.past
+00003660: 5f69 6d70 6163 7473 5f69 6e74 6572 7665  _impacts_interve
+00003670: 6e74 696f 6e20 3d3d 2022 7265 6772 6573  ntion == "regres
+00003680: 736f 7222 0d0a 2020 2020 2020 2020 2020  sor"..          
+00003690: 2020 2020 2020 616e 6420 7061 7374 5f69        and past_i
+000036a0: 6d70 6163 7473 2069 7320 6e6f 7420 4e6f  mpacts is not No
+000036b0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+000036c0: 290d 0a20 2020 2020 2020 2029 0d0a 2020  )..        )..  
+000036d0: 2020 2020 2020 2320 6368 6563 6b20 6966        # check if
+000036e0: 2072 6f6c 6c69 6e67 2070 7265 6469 6374   rolling predict
+000036f0: 696f 6e20 6973 2072 6571 7569 7265 640d  ion is required.
+00003700: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+00003710: 6564 6963 745f 6c6f 6f70 5f72 6571 203d  edict_loop_req =
+00003720: 2028 7365 6c66 2e61 725f 6c61 6773 2069   (self.ar_lags i
+00003730: 7320 6e6f 7420 4e6f 6e65 2920 6f72 2028  s not None) or (
+00003740: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00003750: 6c66 2e6d 756c 7469 7661 7269 6174 655f  lf.multivariate_
+00003760: 6665 6174 7572 6520 6973 206e 6f74 204e  feature is not N
+00003770: 6f6e 650d 0a20 2020 2020 2020 2029 0d0a  one..        )..
+00003780: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+00003790: 6966 2063 6f6d 706f 6e65 6e74 2070 726f  if component pro
+000037a0: 6365 7373 696e 6720 6d75 7374 206c 6f6f  cessing must loo
+000037b0: 700d 0a20 2020 2020 2020 2023 2073 656c  p..        # sel
+000037c0: 662e 636f 6d70 6f6e 656e 745f 6c6f 6f70  f.component_loop
+000037d0: 5f72 6571 203d 2028 6973 696e 7374 616e  _req = (isinstan
+000037e0: 6365 2872 6567 7265 7373 6f72 5f70 6572  ce(regressor_per
+000037f0: 5f73 6572 6965 732c 2064 6963 7429 2061  _series, dict) a
+00003800: 6e64 2073 656c 662e 7265 6772 6573 736f  nd self.regresso
+00003810: 7273 5f75 7365 6429 206f 7220 2869 7369  rs_used) or (isi
+00003820: 6e73 7461 6e63 6528 7365 6c66 2e68 6f6c  nstance(self.hol
+00003830: 6964 6179 5f63 6f75 6e74 7269 6573 2c20  iday_countries, 
+00003840: 6469 6374 2920 616e 6420 7365 6c66 2e68  dict) and self.h
+00003850: 6f6c 6964 6179 5f63 6f75 6e74 7269 6573  oliday_countries
+00003860: 5f75 7365 6429 0d0a 0d0a 2020 2020 2020  _used)....      
+00003870: 2020 2320 5245 4d4f 5645 204e 614e 2062    # REMOVE NaN b
+00003880: 7574 206f 6e6c 7920 7468 6973 2073 6f20  ut only this so 
+00003890: 6661 722c 2066 6f72 2068 6f6c 6964 6179  far, for holiday
+000038a0: 2061 6e64 2061 6e6f 6d61 6c79 2064 6574   and anomaly det
+000038b0: 6563 7469 6f6e 0d0a 2020 2020 2020 2020  ection..        
+000038c0: 6966 2073 656c 662e 7072 6570 726f 6365  if self.preproce
+000038d0: 7373 696e 675f 7472 616e 7366 6f72 6d61  ssing_transforma
+000038e0: 7469 6f6e 2069 7320 6e6f 7420 4e6f 6e65  tion is not None
+000038f0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00003900: 656c 662e 7072 6570 726f 6365 7373 6572  elf.preprocesser
+00003910: 203d 2047 656e 6572 616c 5472 616e 7366   = GeneralTransf
+00003920: 6f72 6d65 7228 0d0a 2020 2020 2020 2020  ormer(..        
+00003930: 2020 2020 2020 2020 2a2a 7b27 6669 6c6c          **{'fill
+00003940: 6e61 273a 2073 656c 662e 7072 6570 726f  na': self.prepro
+00003950: 6365 7373 696e 675f 7472 616e 7366 6f72  cessing_transfor
+00003960: 6d61 7469 6f6e 2e67 6574 2827 6669 6c6c  mation.get('fill
+00003970: 6e61 272c 2022 6666 696c 6c22 297d 0d0a  na', "ffill")}..
+00003980: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00003990: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000039a0: 6466 203d 2073 656c 662e 7072 6570 726f  df = self.prepro
+000039b0: 6365 7373 6572 2e66 6974 5f74 7261 6e73  cesser.fit_trans
+000039c0: 666f 726d 2873 656c 662e 6466 290d 0a0d  form(self.df)...
+000039d0: 0a20 2020 2020 2020 2023 2072 656d 6f76  .        # remov
+000039e0: 6520 7061 7374 2069 6d70 6163 7473 2074  e past impacts t
+000039f0: 6f20 6669 6e64 2022 6f72 6761 6e69 6322  o find "organic"
+00003a00: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00003a10: 662e 7061 7374 5f69 6d70 6163 7473 5f69  f.past_impacts_i
+00003a20: 6e74 6572 7665 6e74 696f 6e20 3d3d 2022  ntervention == "
+00003a30: 7265 6d6f 7665 223a 0d0a 2020 2020 2020  remove":..      
+00003a40: 2020 2020 2020 7365 6c66 2e64 6620 3d20        self.df = 
+00003a50: 7365 6c66 2e64 6620 2f20 2831 202b 2070  self.df / (1 + p
+00003a60: 6173 745f 696d 7061 6374 7329 2020 2320  ast_impacts)  # 
+00003a70: 776f 756c 6420 4d49 4e55 5320 6265 2062  would MINUS be b
+00003a80: 6574 7465 723f 0d0a 2020 2020 2020 2020  etter?..        
+00003a90: 2320 686f 6c69 6461 7920 6465 7465 6374  # holiday detect
+00003aa0: 696f 6e20 6669 7273 742c 2064 6f6e 2774  ion first, don't
+00003ab0: 2077 616e 7420 616e 7920 616e 6f6d 616c   want any anomal
+00003ac0: 6965 7320 7265 6d6f 7665 6420 7965 742c  ies removed yet,
+00003ad0: 2061 6e64 2068 6173 206f 776e 2070 7265   and has own pre
+00003ae0: 7072 6f63 6573 7369 6e67 0d0a 2020 2020  processing..    
+00003af0: 2020 2020 6966 2073 656c 662e 686f 6c69      if self.holi
+00003b00: 6461 795f 6465 7465 6374 6f72 5f70 6172  day_detector_par
+00003b10: 616d 7320 6973 206e 6f74 204e 6f6e 653a  ams is not None:
+00003b20: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00003b30: 6c66 2e68 6f6c 6964 6179 5f64 6574 6563  lf.holiday_detec
+00003b40: 746f 7220 3d20 486f 6c69 6461 7954 7261  tor = HolidayTra
+00003b50: 6e73 666f 726d 6572 282a 2a73 656c 662e  nsformer(**self.
+00003b60: 686f 6c69 6461 795f 6465 7465 6374 6f72  holiday_detector
+00003b70: 5f70 6172 616d 7329 0d0a 2020 2020 2020  _params)..      
+00003b80: 2020 2020 2020 7365 6c66 2e68 6f6c 6964        self.holid
+00003b90: 6179 5f64 6574 6563 746f 722e 6669 7428  ay_detector.fit(
+00003ba0: 7365 6c66 2e64 6629 0d0a 2020 2020 2020  self.df)..      
+00003bb0: 2020 2020 2020 7365 6c66 2e68 6f6c 6964        self.holid
+00003bc0: 6179 7320 3d20 7365 6c66 2e68 6f6c 6964  ays = self.holid
+00003bd0: 6179 5f64 6574 6563 746f 722e 6461 7465  ay_detector.date
+00003be0: 735f 746f 5f68 6f6c 6964 6179 7328 0d0a  s_to_holidays(..
+00003bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c00: 7365 6c66 2e64 662e 696e 6465 782c 2073  self.df.index, s
+00003c10: 7479 6c65 3d27 7365 7269 6573 5f66 6c61  tyle='series_fla
+00003c20: 6727 0d0a 2020 2020 2020 2020 2020 2020  g'..            
+00003c30: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00003c40: 656c 662e 686f 6c69 6461 795f 636f 756e  elf.holiday_coun
+00003c50: 7420 3d20 6e70 2e63 6f75 6e74 5f6e 6f6e  t = np.count_non
+00003c60: 7a65 726f 2873 656c 662e 686f 6c69 6461  zero(self.holida
+00003c70: 7973 290d 0a20 2020 2020 2020 2020 2020  ys)..           
+00003c80: 2069 6620 7365 6c66 2e68 6f6c 6964 6179   if self.holiday
+00003c90: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
+00003ca0: 5b22 7265 6d6f 7665 5f65 7863 6573 735f  ["remove_excess_
+00003cb0: 616e 6f6d 616c 6965 7322 5d3a 0d0a 2020  anomalies"]:..  
+00003cc0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003cd0: 6c66 2e64 6620 3d20 7365 6c66 2e64 665b  lf.df = self.df[
+00003ce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00003cf0: 2020 2020 2020 7e28 0d0a 2020 2020 2020        ~(..      
+00003d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d10: 2020 2873 656c 662e 686f 6c69 6461 795f    (self.holiday_
+00003d20: 6465 7465 6374 6f72 2e61 6e6f 6d61 6c79  detector.anomaly
+00003d30: 5f6d 6f64 656c 2e61 6e6f 6d61 6c69 6573  _model.anomalies
+00003d40: 203d 3d20 2d31 290d 0a20 2020 2020 2020   == -1)..       
+00003d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d60: 2026 2028 7365 6c66 2e68 6f6c 6964 6179   & (self.holiday
+00003d70: 7320 213d 2031 290d 0a20 2020 2020 2020  s != 1)..       
+00003d80: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00003d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003da0: 5d0d 0a20 2020 2020 2020 2023 2066 696e  ]..        # fin
+00003db0: 6420 616e 6f6d 616c 6965 732c 2061 6e64  d anomalies, and
+00003dc0: 2065 6974 6865 7220 7265 6d6f 7665 206f   either remove o
+00003dd0: 7220 7365 7475 7020 666f 7220 6d6f 6465  r setup for mode
+00003de0: 6c69 6e67 2074 6865 2061 6e6f 6d61 6c79  ling the anomaly
+00003df0: 2073 636f 7265 730d 0a20 2020 2020 2020   scores..       
+00003e00: 2069 6620 7365 6c66 2e61 6e6f 6d61 6c79   if self.anomaly
+00003e10: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
+00003e20: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00003e30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003e40: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+00003e50: 203d 2041 6e6f 6d61 6c79 5265 6d6f 7661   = AnomalyRemova
+00003e60: 6c28 2a2a 7365 6c66 2e61 6e6f 6d61 6c79  l(**self.anomaly
+00003e70: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
+00003e80: 292e 6669 7428 0d0a 2020 2020 2020 2020  ).fit(..        
+00003e90: 2020 2020 2020 2020 7365 6c66 2e64 660d          self.df.
+00003ea0: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+00003eb0: 2020 2020 2020 2020 2020 2020 2320 5245              # RE
+00003ec0: 4d4f 5645 2048 4f4c 4944 4159 5320 6672  MOVE HOLIDAYS fr
+00003ed0: 6f6d 2061 6e6f 6d61 6c69 6573 2c20 6173  om anomalies, as
+00003ee0: 2074 6865 7920 6d61 7920 6c6f 6f6b 206c   they may look l
+00003ef0: 696b 6520 616e 6f6d 616c 6965 7320 6275  ike anomalies bu
+00003f00: 7420 6172 6520 6465 616c 7420 7769 7468  t are dealt with
+00003f10: 2062 7920 686f 6c69 6461 7973 0d0a 2020   by holidays..  
+00003f20: 2020 2020 2020 2020 2020 2320 7468 6973            # this
+00003f30: 2c20 686f 7765 7665 722c 2064 6f65 7320  , however, does 
+00003f40: 6e6f 7468 696e 6720 746f 2070 7265 7365  nothing to prese
+00003f50: 7276 6520 636f 756e 7472 7920 686f 6c69  rve country holi
+00003f60: 6461 7973 0d0a 2020 2020 2020 2020 2020  days..          
+00003f70: 2020 6966 2073 656c 662e 686f 6c69 6461    if self.holida
+00003f80: 795f 6465 7465 6374 6f72 5f70 6172 616d  y_detector_param
+00003f90: 7320 6973 206e 6f74 204e 6f6e 653a 0d0a  s is not None:..
+00003fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003fb0: 686f 6c5f 6669 6c74 203d 2028 7365 6c66  hol_filt = (self
+00003fc0: 2e68 6f6c 6964 6179 7320 3d3d 2031 2920  .holidays == 1) 
+00003fd0: 2620 280d 0a20 2020 2020 2020 2020 2020  & (..           
+00003fe0: 2020 2020 2020 2020 2073 656c 662e 616e           self.an
+00003ff0: 6f6d 616c 795f 6465 7465 6374 6f72 2e61  omaly_detector.a
+00004000: 6e6f 6d61 6c69 6573 203d 3d20 2d31 0d0a  nomalies == -1..
+00004010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004020: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00004030: 2020 2073 656c 662e 616e 6f6d 616c 795f     self.anomaly_
+00004040: 6465 7465 6374 6f72 2e61 6e6f 6d61 6c69  detector.anomali
+00004050: 6573 5b68 6f6c 5f66 696c 745d 203d 2031  es[hol_filt] = 1
+00004060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004070: 2020 2320 6173 7375 6d65 206d 6f73 7420    # assume most 
+00004080: 6172 6520 6e6f 7420 616e 6f6d 616c 6965  are not anomalie
+00004090: 7320 736f 206d 6564 6961 6e20 6973 206e  s so median is n
+000040a0: 6f74 2061 6e6f 6d0d 0a20 2020 2020 2020  ot anom..       
+000040b0: 2020 2020 2020 2020 2073 656c 662e 616e           self.an
+000040c0: 6f6d 616c 795f 6465 7465 6374 6f72 2e73  omaly_detector.s
+000040d0: 636f 7265 735b 686f 6c5f 6669 6c74 5d20  cores[hol_filt] 
+000040e0: 3d20 6e70 2e6d 6564 6961 6e28 0d0a 2020  = np.median(..  
+000040f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004100: 2020 7365 6c66 2e61 6e6f 6d61 6c79 5f64    self.anomaly_d
+00004110: 6574 6563 746f 722e 7363 6f72 6573 0d0a  etector.scores..
+00004120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004130: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00004140: 6620 7365 6c66 2e61 6e6f 6d61 6c79 5f69  f self.anomaly_i
+00004150: 6e74 6572 7665 6e74 696f 6e20 3d3d 2022  ntervention == "
+00004160: 7265 6d6f 7665 223a 0d0a 2020 2020 2020  remove":..      
+00004170: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00004180: 6620 3d20 7365 6c66 2e61 6e6f 6d61 6c79  f = self.anomaly
+00004190: 5f64 6574 6563 746f 722e 7472 616e 7366  _detector.transf
+000041a0: 6f72 6d28 7365 6c66 2e64 6629 0d0a 2020  orm(self.df)..  
+000041b0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+000041c0: 7369 6e73 7461 6e63 6528 7365 6c66 2e61  sinstance(self.a
+000041d0: 6e6f 6d61 6c79 5f69 6e74 6572 7665 6e74  nomaly_intervent
+000041e0: 696f 6e2c 2064 6963 7429 3a0d 0a20 2020  ion, dict):..   
+000041f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00004200: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
+00004210: 6f72 2e66 6974 5f61 6e6f 6d61 6c79 5f63  or.fit_anomaly_c
+00004220: 6c61 7373 6966 6965 7228 290d 0a20 2020  lassifier()..   
+00004230: 2020 2020 2020 2020 2023 2064 6574 6563           # detec
+00004240: 745f 6f6e 6c79 203d 2070 6173 730d 0a20  t_only = pass.. 
+00004250: 2020 2020 2020 2023 206e 6f77 2064 6f20         # now do 
+00004260: 7374 616e 6461 7264 2070 7265 7072 6f63  standard preproc
+00004270: 6573 7369 6e67 0d0a 2020 2020 2020 2020  essing..        
+00004280: 6966 2073 656c 662e 7072 6570 726f 6365  if self.preproce
+00004290: 7373 696e 675f 7472 616e 7366 6f72 6d61  ssing_transforma
+000042a0: 7469 6f6e 2069 7320 6e6f 7420 4e6f 6e65  tion is not None
+000042b0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+000042c0: 656c 662e 7072 6570 726f 6365 7373 6572  elf.preprocesser
+000042d0: 203d 2047 656e 6572 616c 5472 616e 7366   = GeneralTransf
+000042e0: 6f72 6d65 7228 2a2a 7365 6c66 2e70 7265  ormer(**self.pre
+000042f0: 7072 6f63 6573 7369 6e67 5f74 7261 6e73  processing_trans
+00004300: 666f 726d 6174 696f 6e29 0d0a 2020 2020  formation)..    
+00004310: 2020 2020 2020 2020 7365 6c66 2e64 6620          self.df 
+00004320: 3d20 7365 6c66 2e70 7265 7072 6f63 6573  = self.preproces
+00004330: 7365 722e 6669 745f 7472 616e 7366 6f72  ser.fit_transfor
+00004340: 6d28 7365 6c66 2e64 6629 0d0a 2020 2020  m(self.df)..    
+00004350: 2020 2020 6966 2073 656c 662e 7363 616c      if self.scal
+00004360: 696e 6720 6973 206e 6f74 204e 6f6e 653a  ing is not None:
+00004370: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00004380: 2073 656c 662e 7363 616c 696e 6720 3d3d   self.scaling ==
+00004390: 2022 4261 7365 5363 616c 6572 223a 0d0a   "BaseScaler":..
+000043a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043b0: 7365 6c66 2e64 6620 3d20 7365 6c66 2e62  self.df = self.b
+000043c0: 6173 655f 7363 616c 6572 2873 656c 662e  ase_scaler(self.
+000043d0: 6466 290d 0a20 2020 2020 2020 2020 2020  df)..           
+000043e0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+000043f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00004400: 7363 616c 696e 6720 6973 204e 6f6e 653a  scaling is None:
+00004410: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004420: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00004430: 6545 7272 6f72 2822 7363 616c 696e 6720  eError("scaling 
+00004440: 6d75 7374 206e 6f74 2062 6520 4e6f 6e65  must not be None
+00004450: 2e20 5472 7920 2742 6173 6553 6361 6c65  . Try 'BaseScale
+00004460: 7227 2229 0d0a 2020 2020 2020 2020 2020  r'")..          
+00004470: 2020 2020 2020 7365 6c66 2e73 6361 6c65        self.scale
+00004480: 7220 3d20 4765 6e65 7261 6c54 7261 6e73  r = GeneralTrans
+00004490: 666f 726d 6572 282a 2a73 656c 662e 7363  former(**self.sc
+000044a0: 616c 696e 6729 0d0a 2020 2020 2020 2020  aling)..        
+000044b0: 2020 2020 2020 2020 7365 6c66 2e64 6620          self.df 
+000044c0: 3d20 7365 6c66 2e73 6361 6c65 722e 6669  = self.scaler.fi
+000044d0: 745f 7472 616e 7366 6f72 6d28 7365 6c66  t_transform(self
+000044e0: 2e64 6629 0d0a 2020 2020 2020 2020 2320  .df)..        # 
+000044f0: 6164 6469 7469 6f6e 616c 2074 7261 6e73  additional trans
+00004500: 666f 726d 7320 6265 666f 7265 206d 756c  forms before mul
+00004510: 7469 7661 7269 6174 6520 6665 6174 7572  tivariate featur
+00004520: 6520 6372 6561 7469 6f6e 0d0a 2020 2020  e creation..    
+00004530: 2020 2020 6966 2073 656c 662e 6d75 6c74      if self.mult
+00004540: 6976 6172 6961 7465 5f74 7261 6e73 666f  ivariate_transfo
+00004550: 726d 6174 696f 6e20 6973 206e 6f74 204e  rmation is not N
+00004560: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00004570: 2020 7365 6c66 2e6d 756c 7469 7661 7269    self.multivari
+00004580: 6174 655f 7472 616e 7366 6f72 6d65 7220  ate_transformer 
+00004590: 3d20 4765 6e65 7261 6c54 7261 6e73 666f  = GeneralTransfo
+000045a0: 726d 6572 280d 0a20 2020 2020 2020 2020  rmer(..         
+000045b0: 2020 2020 2020 202a 2a73 656c 662e 6d75         **self.mu
+000045c0: 6c74 6976 6172 6961 7465 5f74 7261 6e73  ltivariate_trans
+000045d0: 666f 726d 6174 696f 6e0d 0a20 2020 2020  formation..     
+000045e0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000045f0: 2020 2320 6e65 6564 7320 746f 2063 6f6d    # needs to com
+00004600: 6520 6166 7465 7220 7072 6570 726f 6365  e after preproce
+00004610: 7373 696e 6720 6265 6361 7573 6520 6f66  ssing because of
+00004620: 2027 736c 6963 6527 2074 7261 6e73 666f   'slice' transfo
+00004630: 726d 6572 0d0a 2020 2020 2020 2020 7365  rmer..        se
+00004640: 6c66 2e64 735f 6d69 6e20 3d20 7365 6c66  lf.ds_min = self
+00004650: 2e64 662e 696e 6465 782e 6d69 6e28 290d  .df.index.min().
+00004660: 0a20 2020 2020 2020 2073 656c 662e 6473  .        self.ds
+00004670: 5f6d 6178 203d 2073 656c 662e 6466 2e69  _max = self.df.i
+00004680: 6e64 6578 2e6d 6178 2829 0d0a 2020 2020  ndex.max()..    
+00004690: 2020 2020 7365 6c66 2e74 5f74 7261 696e      self.t_train
+000046a0: 203d 2073 656c 662e 6372 6561 7465 5f74   = self.create_t
+000046b0: 2873 656c 662e 6466 2e69 6e64 6578 290d  (self.df.index).
+000046c0: 0a20 2020 2020 2020 2073 656c 662e 6869  .        self.hi
+000046d0: 7374 6f72 795f 6461 7973 203d 2028 7365  story_days = (se
+000046e0: 6c66 2e64 735f 6d61 7820 2d20 7365 6c66  lf.ds_max - self
+000046f0: 2e64 735f 6d69 6e29 2e64 6179 730d 0a0d  .ds_min).days...
+00004700: 0a20 2020 2020 2020 2023 2042 4547 494e  .        # BEGIN
+00004710: 2043 4f4e 5354 5255 4354 494f 4e20 4f46   CONSTRUCTION OF
+00004720: 2058 2041 5252 4159 0d0a 2020 2020 2020   X ARRAY..      
+00004730: 2020 785f 6c69 7374 203d 205b 5d0d 0a20    x_list = [].. 
+00004740: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00004750: 616e 6365 2873 656c 662e 616e 6f6d 616c  ance(self.anomal
+00004760: 795f 696e 7465 7276 656e 7469 6f6e 2c20  y_intervention, 
+00004770: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
+00004780: 2020 2020 2320 6e65 6564 2074 6f20 6d6f      # need to mo
+00004790: 6465 6c20 7468 6573 6520 666f 7220 7072  del these for pr
+000047a0: 6564 6963 7469 6f6e 0d0a 2020 2020 2020  ediction..      
+000047b0: 2020 2020 2020 785f 6c69 7374 2e61 7070        x_list.app
+000047c0: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
+000047d0: 2020 2020 2020 7365 6c66 2e61 6e6f 6d61        self.anoma
+000047e0: 6c79 5f64 6574 6563 746f 722e 7363 6f72  ly_detector.scor
+000047f0: 6573 2e72 656e 616d 6528 0d0a 2020 2020  es.rename(..    
+00004800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004810: 636f 6c75 6d6e 733d 6c61 6d62 6461 2078  columns=lambda x
+00004820: 3a20 2261 6e6f 6d61 6c79 7363 6f72 6573  : "anomalyscores
+00004830: 5f22 202b 2073 7472 2878 290d 0a20 2020  _" + str(x)..   
+00004840: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00004850: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00004860: 2020 2020 2020 2023 2061 6c6c 206f 6620         # all of 
+00004870: 7468 6520 666f 6c6c 6f77 696e 6720 6172  the following ar
+00004880: 6520 3120 6461 7920 7061 7374 206c 6167  e 1 day past lag
+00004890: 6765 640d 0a20 2020 2020 2020 2069 6620  ged..        if 
+000048a0: 7365 6c66 2e6d 756c 7469 7661 7269 6174  self.multivariat
+000048b0: 655f 6665 6174 7572 6520 6973 206e 6f74  e_feature is not
+000048c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000048d0: 2020 2020 2320 696e 636c 7564 6573 2062      # includes b
+000048e0: 6163 6b66 696c 6c0d 0a20 2020 2020 2020  ackfill..       
+000048f0: 2020 2020 206c 6167 5f31 5f69 6e64 7820       lag_1_indx 
+00004900: 3d20 6e70 2e63 6f6e 6361 7465 6e61 7465  = np.concatenate
+00004910: 285b 5b30 5d2c 206e 702e 6172 616e 6765  ([[0], np.arange
+00004920: 286c 656e 2873 656c 662e 6466 2929 5d29  (len(self.df))])
+00004930: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
+00004940: 2020 2030 203a 206c 656e 2873 656c 662e     0 : len(self.
+00004950: 6466 290d 0a20 2020 2020 2020 2020 2020  df)..           
+00004960: 205d 0d0a 2020 2020 2020 2020 2020 2020   ]..            
+00004970: 6966 2073 656c 662e 6d75 6c74 6976 6172  if self.multivar
+00004980: 6961 7465 5f74 7261 6e73 666f 726d 6174  iate_transformat
+00004990: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
+000049a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000049b0: 2020 7472 735f 6466 203d 2073 656c 662e    trs_df = self.
+000049c0: 6d75 6c74 6976 6172 6961 7465 5f74 7261  multivariate_tra
+000049d0: 6e73 666f 726d 6572 2e66 6974 5f74 7261  nsformer.fit_tra
+000049e0: 6e73 666f 726d 2873 656c 662e 6466 290d  nsform(self.df).
+000049f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004a00: 2069 6620 7472 735f 6466 2e73 6861 7065   if trs_df.shape
+00004a10: 2021 3d20 7365 6c66 2e64 662e 7368 6170   != self.df.shap
+00004a20: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00004a30: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00004a40: 6c75 6545 7272 6f72 280d 0a20 2020 2020  lueError(..     
+00004a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a60: 2020 2022 4d75 6c74 6976 6172 6961 7465     "Multivariate
+00004a70: 2054 7261 6e73 666f 726d 6572 206e 6f74   Transformer not
+00004a80: 2075 7361 626c 6520 666f 7220 7468 6973   usable for this
+00004a90: 2072 6f6c 652e 220d 0a20 2020 2020 2020   role."..       
+00004aa0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00004ab0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00004ac0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00004ad0: 2020 2074 7273 5f64 6620 3d20 7365 6c66     trs_df = self
+00004ae0: 2e64 662e 636f 7079 2829 0d0a 2020 2020  .df.copy()..    
+00004af0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00004b00: 6d75 6c74 6976 6172 6961 7465 5f66 6561  multivariate_fea
+00004b10: 7475 7265 203d 3d20 2266 6561 7475 7265  ture == "feature
+00004b20: 5f61 6767 6c6f 6d65 7261 7469 6f6e 223a  _agglomeration":
+00004b30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004b40: 2020 6672 6f6d 2073 6b6c 6561 726e 2e63    from sklearn.c
+00004b50: 6c75 7374 6572 2069 6d70 6f72 7420 4665  luster import Fe
+00004b60: 6174 7572 6541 6767 6c6f 6d65 7261 7469  atureAgglomerati
+00004b70: 6f6e 0d0a 0d0a 2020 2020 2020 2020 2020  on....          
+00004b80: 2020 2020 2020 7365 6c66 2e61 6767 6c6f        self.agglo
+00004b90: 6d5f 6e5f 636c 7573 7465 7273 203d 2035  m_n_clusters = 5
+00004ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004bb0: 2020 7365 6c66 2e61 6767 6c6f 6d65 7261    self.agglomera
+00004bc0: 746f 7220 3d20 4665 6174 7572 6541 6767  tor = FeatureAgg
+00004bd0: 6c6f 6d65 7261 7469 6f6e 280d 0a20 2020  lomeration(..   
+00004be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004bf0: 206e 5f63 6c75 7374 6572 733d 7365 6c66   n_clusters=self
+00004c00: 2e61 6767 6c6f 6d5f 6e5f 636c 7573 7465  .agglom_n_cluste
+00004c10: 7273 0d0a 2020 2020 2020 2020 2020 2020  rs..            
+00004c20: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00004c30: 2020 2020 2020 2078 5f6c 6973 742e 6170         x_list.ap
+00004c40: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
+00004c50: 2020 2020 2020 2020 2020 2070 642e 4461             pd.Da
+00004c60: 7461 4672 616d 6528 0d0a 2020 2020 2020  taFrame(..      
+00004c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c80: 2020 7365 6c66 2e61 6767 6c6f 6d65 7261    self.agglomera
+00004c90: 746f 722e 6669 745f 7472 616e 7366 6f72  tor.fit_transfor
+00004ca0: 6d28 7472 735f 6466 295b 6c61 675f 315f  m(trs_df)[lag_1_
+00004cb0: 696e 6478 5d2c 0d0a 2020 2020 2020 2020  indx],..        
 00004cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cd0: 226d 756c 7469 7661 725f 2220 2b20 7374  "multivar_" + st
-00004ce0: 7228 7829 2066 6f72 2078 2069 6e20 7261  r(x) for x in ra
-00004cf0: 6e67 6528 7365 6c66 2e61 6767 6c6f 6d5f  nge(self.agglom_
-00004d00: 6e5f 636c 7573 7465 7273 290d 0a20 2020  n_clusters)..   
+00004cd0: 696e 6465 783d 7365 6c66 2e64 662e 696e  index=self.df.in
+00004ce0: 6465 782c 0d0a 2020 2020 2020 2020 2020  dex,..          
+00004cf0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00004d00: 6c75 6d6e 733d 5b0d 0a20 2020 2020 2020  lumns=[..       
 00004d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d20: 2020 2020 205d 2c0d 0a20 2020 2020 2020       ],..       
-00004d30: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00004d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d50: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00004d60: 6c69 6620 7365 6c66 2e6d 756c 7469 7661  lif self.multiva
-00004d70: 7269 6174 655f 6665 6174 7572 6520 3d3d  riate_feature ==
-00004d80: 2022 6772 6f75 705f 6176 6572 6167 6522   "group_average"
-00004d90: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00004da0: 2020 206d 756c 7469 7661 725f 6466 203d     multivar_df =
-00004db0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-00004dc0: 2020 2020 2020 2020 7472 735f 6466 2e67          trs_df.g
-00004dd0: 726f 7570 6279 2873 656c 662e 6361 7465  roupby(self.cate
-00004de0: 676f 7269 6361 6c5f 6772 6f75 7073 2c20  gorical_groups, 
-00004df0: 6178 6973 3d31 290d 0a20 2020 2020 2020  axis=1)..       
-00004e00: 2020 2020 2020 2020 2020 2020 202e 6d65               .me
-00004e10: 616e 2829 0d0a 2020 2020 2020 2020 2020  an()..          
-00004e20: 2020 2020 2020 2020 2020 2e69 6c6f 635b            .iloc[
-00004e30: 6c61 675f 315f 696e 6478 5d0d 0a20 2020  lag_1_indx]..   
-00004e40: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00004d20: 2020 2020 2022 6d75 6c74 6976 6172 5f22       "multivar_"
+00004d30: 202b 2073 7472 2878 2920 666f 7220 7820   + str(x) for x 
+00004d40: 696e 2072 616e 6765 2873 656c 662e 6167  in range(self.ag
+00004d50: 676c 6f6d 5f6e 5f63 6c75 7374 6572 7329  glom_n_clusters)
+00004d60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004d70: 2020 2020 2020 2020 2020 5d2c 0d0a 2020            ],..  
+00004d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d90: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00004da0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00004db0: 2020 2020 656c 6966 2073 656c 662e 6d75      elif self.mu
+00004dc0: 6c74 6976 6172 6961 7465 5f66 6561 7475  ltivariate_featu
+00004dd0: 7265 203d 3d20 2267 726f 7570 5f61 7665  re == "group_ave
+00004de0: 7261 6765 223a 0d0a 2020 2020 2020 2020  rage":..        
+00004df0: 2020 2020 2020 2020 6d75 6c74 6976 6172          multivar
+00004e00: 5f64 6620 3d20 280d 0a20 2020 2020 2020  _df = (..       
+00004e10: 2020 2020 2020 2020 2020 2020 2074 7273               trs
+00004e20: 5f64 662e 6772 6f75 7062 7928 7365 6c66  _df.groupby(self
+00004e30: 2e63 6174 6567 6f72 6963 616c 5f67 726f  .categorical_gro
+00004e40: 7570 732c 2061 7869 733d 3129 0d0a 2020  ups, axis=1)..  
 00004e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e60: 6d75 6c74 6976 6172 5f64 662e 696e 6465  multivar_df.inde
-00004e70: 7820 3d20 7365 6c66 2e64 662e 696e 6465  x = self.df.inde
-00004e80: 780d 0a20 2020 2020 2020 2020 2020 2020  x..             
-00004e90: 2020 2078 5f6c 6973 742e 6170 7065 6e64     x_list.append
-00004ea0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00004eb0: 2020 2020 2020 206d 756c 7469 7661 725f         multivar_
-00004ec0: 6466 2e72 656e 616d 6528 636f 6c75 6d6e  df.rename(column
-00004ed0: 733d 6c61 6d62 6461 2078 3a20 226d 756c  s=lambda x: "mul
-00004ee0: 7469 7661 725f 2220 2b20 7374 7228 7829  tivar_" + str(x)
-00004ef0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00004f00: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-00004f10: 2020 656c 6966 2073 656c 662e 6d75 6c74    elif self.mult
-00004f20: 6976 6172 6961 7465 5f66 6561 7475 7265  ivariate_feature
-00004f30: 203d 3d20 226f 7363 696c 6c61 746f 7222   == "oscillator"
-00004f40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00004f50: 2020 2072 6574 7572 6e20 4e6f 7449 6d70     return NotImp
-00004f60: 6c65 6d65 6e74 6564 0d0a 2020 2020 2020  lemented..      
-00004f70: 2020 2020 2020 2020 2020 6e70 2e63 6f75            np.cou
-00004f80: 6e74 5f6e 6f6e 7a65 726f 2828 6466 202d  nt_nonzero((df -
-00004f90: 2064 662e 7368 6966 7428 3129 292e 636c   df.shift(1)).cl
-00004fa0: 6970 2875 7070 6572 3d30 2929 5b3a 2d31  ip(upper=0))[:-1
-00004fb0: 5d0d 0a20 2020 2020 2020 2069 6620 7365  ]..        if se
-00004fc0: 6c66 2e73 6561 736f 6e61 6c69 7469 6573  lf.seasonalities
-00004fd0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00004fe0: 2020 2020 2020 2020 2020 2073 5f6c 6973             s_lis
-00004ff0: 7420 3d20 5b5d 0d0a 2020 2020 2020 2020  t = []..        
-00005000: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-00005010: 2020 2020 2020 2020 2020 666f 7220 7365            for se
-00005020: 6173 6f6e 616c 6974 7920 696e 2073 656c  asonality in sel
-00005030: 662e 7365 6173 6f6e 616c 6974 6965 733a  f.seasonalities:
-00005040: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005050: 2020 2020 2020 735f 6c69 7374 2e61 7070        s_list.app
-00005060: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
-00005070: 2020 2020 2020 2020 2020 2020 2020 6372                cr
-00005080: 6561 7465 5f73 6561 736f 6e61 6c69 7479  eate_seasonality
-00005090: 5f66 6561 7475 7265 280d 0a20 2020 2020  _feature(..     
-000050a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000050b0: 2020 2020 2020 2073 656c 662e 6466 2e69         self.df.i
-000050c0: 6e64 6578 2c0d 0a20 2020 2020 2020 2020  ndex,..         
-000050d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000050e0: 2020 2073 656c 662e 745f 7472 6169 6e2c     self.t_train,
-000050f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005100: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00005110: 6173 6f6e 616c 6974 792c 0d0a 2020 2020  asonality,..    
+00004e60: 2020 2e6d 6561 6e28 290d 0a20 2020 2020    .mean()..     
+00004e70: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+00004e80: 696c 6f63 5b6c 6167 5f31 5f69 6e64 785d  iloc[lag_1_indx]
+00004e90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004ea0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00004eb0: 2020 2020 206d 756c 7469 7661 725f 6466       multivar_df
+00004ec0: 2e69 6e64 6578 203d 2073 656c 662e 6466  .index = self.df
+00004ed0: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
+00004ee0: 2020 2020 2020 2020 785f 6c69 7374 2e61          x_list.a
+00004ef0: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
+00004f00: 2020 2020 2020 2020 2020 2020 6d75 6c74              mult
+00004f10: 6976 6172 5f64 662e 7265 6e61 6d65 2863  ivar_df.rename(c
+00004f20: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
+00004f30: 2022 6d75 6c74 6976 6172 5f22 202b 2073   "multivar_" + s
+00004f40: 7472 2878 2929 0d0a 2020 2020 2020 2020  tr(x))..        
+00004f50: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00004f60: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+00004f70: 2e6d 756c 7469 7661 7269 6174 655f 6665  .multivariate_fe
+00004f80: 6174 7572 6520 3d3d 2022 6f73 6369 6c6c  ature == "oscill
+00004f90: 6174 6f72 223a 0d0a 2020 2020 2020 2020  ator":..        
+00004fa0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00004fb0: 6f74 496d 706c 656d 656e 7465 640d 0a20  otImplemented.. 
+00004fc0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00004fd0: 702e 636f 756e 745f 6e6f 6e7a 6572 6f28  p.count_nonzero(
+00004fe0: 2864 6620 2d20 6466 2e73 6869 6674 2831  (df - df.shift(1
+00004ff0: 2929 2e63 6c69 7028 7570 7065 723d 3029  )).clip(upper=0)
+00005000: 295b 3a2d 315d 0d0a 2020 2020 2020 2020  )[:-1]..        
+00005010: 6966 2073 656c 662e 7365 6173 6f6e 616c  if self.seasonal
+00005020: 6974 6965 7320 6973 206e 6f74 204e 6f6e  ities is not Non
+00005030: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00005040: 735f 6c69 7374 203d 205b 5d0d 0a20 2020  s_list = []..   
+00005050: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+00005060: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00005070: 6f72 2073 6561 736f 6e61 6c69 7479 2069  or seasonality i
+00005080: 6e20 7365 6c66 2e73 6561 736f 6e61 6c69  n self.seasonali
+00005090: 7469 6573 3a0d 0a20 2020 2020 2020 2020  ties:..         
+000050a0: 2020 2020 2020 2020 2020 2073 5f6c 6973             s_lis
+000050b0: 742e 6170 7065 6e64 280d 0a20 2020 2020  t.append(..     
+000050c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000050d0: 2020 2063 7265 6174 655f 7365 6173 6f6e     create_season
+000050e0: 616c 6974 795f 6665 6174 7572 6528 0d0a  ality_feature(..
+000050f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005100: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005110: 2e64 662e 696e 6465 782c 0d0a 2020 2020  .df.index,..    
 00005120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005130: 2020 2020 2020 2020 6869 7374 6f72 795f          history_
-00005140: 6461 7973 3d73 656c 662e 6869 7374 6f72  days=self.histor
-00005150: 795f 6461 7973 2c0d 0a20 2020 2020 2020  y_days,..       
-00005160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005170: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-00005180: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00005190: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000051a0: 2049 4e54 4552 4143 5449 4f4e 5320 4e4f   INTERACTIONS NO
-000051b0: 5420 494d 504c 454d 454e 5445 440d 0a20  T IMPLEMENTED.. 
-000051c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000051d0: 2020 2023 204f 5244 4552 2053 5045 4349     # ORDER SPECI
-000051e0: 4649 4341 5449 4f4e 204e 4f54 2049 4d50  FICATION NOT IMP
-000051f0: 4c45 4d45 4e54 4544 0d0a 2020 2020 2020  LEMENTED..      
-00005200: 2020 2020 2020 2020 2020 735f 6466 203d            s_df =
-00005210: 2070 642e 636f 6e63 6174 2873 5f6c 6973   pd.concat(s_lis
-00005220: 742c 2061 7869 733d 3129 0d0a 2020 2020  t, axis=1)..    
-00005230: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00005240: 7863 6570 7469 6f6e 2061 7320 653a 0d0a  xception as e:..
-00005250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005260: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00005270: 2866 2273 6561 736f 6e61 6c69 7479 207b  (f"seasonality {
-00005280: 7365 6173 6f6e 616c 6974 797d 2063 7265  seasonality} cre
-00005290: 6174 696f 6e20 6572 726f 7222 2920 6672  ation error") fr
-000052a0: 6f6d 2065 0d0a 2020 2020 2020 2020 2020  om e..          
-000052b0: 2020 735f 6466 2e69 6e64 6578 203d 2073    s_df.index = s
-000052c0: 656c 662e 6466 2e69 6e64 6578 0d0a 2020  elf.df.index..  
-000052d0: 2020 2020 2020 2020 2020 785f 6c69 7374            x_list
-000052e0: 2e61 7070 656e 6428 735f 6466 290d 0a20  .append(s_df).. 
-000052f0: 2020 2020 2020 2023 2054 6865 7365 2066         # These f
-00005300: 6561 7475 7265 7320 6172 6520 746f 2070  eatures are to p
-00005310: 7265 7665 6e74 206f 7665 7266 6974 7469  revent overfitti
-00005320: 6e67 2061 6e64 2073 7461 6e64 696e 2066  ng and standin f
-00005330: 6f72 2075 6e6f 6273 6572 7665 6420 636f  or unobserved co
-00005340: 6d70 6f6e 656e 7473 2068 6572 650d 0a20  mponents here.. 
-00005350: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
-00005360: 616e 646f 6d77 616c 6b5f 6e20 6973 206e  andomwalk_n is n
-00005370: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00005380: 2020 2020 2020 785f 6c69 7374 2e61 7070        x_list.app
-00005390: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
-000053a0: 2020 2020 2020 7064 2e44 6174 6146 7261        pd.DataFra
-000053b0: 6d65 280d 0a20 2020 2020 2020 2020 2020  me(..           
-000053c0: 2020 2020 2020 2020 206e 702e 7261 6e64           np.rand
-000053d0: 6f6d 2e6e 6f72 6d61 6c28 7369 7a65 3d28  om.normal(size=(
-000053e0: 6c65 6e28 7365 6c66 2e64 6629 2c20 7365  len(self.df), se
-000053f0: 6c66 2e72 616e 646f 6d77 616c 6b5f 6e29  lf.randomwalk_n)
-00005400: 292e 6375 6d73 756d 280d 0a20 2020 2020  ).cumsum(..     
-00005410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005420: 2020 2061 7869 733d 300d 0a20 2020 2020     axis=0..     
-00005430: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00005440: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00005450: 2020 2020 2020 2063 6f6c 756d 6e73 3d5b         columns=[
-00005460: 2272 616e 646f 6d77 616c 6b5f 2220 2b20  "randomwalk_" + 
-00005470: 7374 7228 7829 2066 6f72 2078 2069 6e20  str(x) for x in 
-00005480: 7261 6e67 6528 7365 6c66 2e72 616e 646f  range(self.rando
-00005490: 6d77 616c 6b5f 6e29 5d2c 0d0a 2020 2020  mwalk_n)],..    
-000054a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054b0: 696e 6465 783d 7365 6c66 2e64 662e 696e  index=self.df.in
-000054c0: 6465 782c 0d0a 2020 2020 2020 2020 2020  dex,..          
-000054d0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000054e0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-000054f0: 6966 2073 656c 662e 7472 656e 645f 7374  if self.trend_st
-00005500: 616e 6469 6e20 6973 206e 6f74 204e 6f6e  andin is not Non
-00005510: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00005520: 6966 2073 656c 662e 7472 656e 645f 7374  if self.trend_st
-00005530: 616e 6469 6e20 3d3d 2022 7261 6e64 6f6d  andin == "random
-00005540: 5f6e 6f72 6d61 6c22 3a0d 0a20 2020 2020  _normal":..     
-00005550: 2020 2020 2020 2020 2020 206e 756d 5f73             num_s
-00005560: 7461 6e64 696e 203d 2034 0d0a 2020 2020  tandin = 4..    
-00005570: 2020 2020 2020 2020 2020 2020 785f 6c69              x_li
-00005580: 7374 2e61 7070 656e 6428 0d0a 2020 2020  st.append(..    
-00005590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055a0: 7064 2e44 6174 6146 7261 6d65 280d 0a20  pd.DataFrame(.. 
-000055b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055c0: 2020 2020 2020 206e 702e 7261 6e64 6f6d         np.random
-000055d0: 2e6e 6f72 6d61 6c28 7369 7a65 3d28 6c65  .normal(size=(le
-000055e0: 6e28 7365 6c66 2e64 6629 2c20 6e75 6d5f  n(self.df), num_
-000055f0: 7374 616e 6469 6e29 292c 0d0a 2020 2020  standin)),..    
-00005600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005610: 2020 2020 636f 6c75 6d6e 733d 5b22 7261      columns=["ra
-00005620: 6e64 6e6f 726d 5f22 202b 2073 7472 2878  ndnorm_" + str(x
-00005630: 2920 666f 7220 7820 696e 2072 616e 6765  ) for x in range
-00005640: 286e 756d 5f73 7461 6e64 696e 295d 2c0d  (num_standin)],.
+00005130: 2020 2020 2020 2020 7365 6c66 2e74 5f74          self.t_t
+00005140: 7261 696e 2c0d 0a20 2020 2020 2020 2020  rain,..         
+00005150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005160: 2020 2073 6561 736f 6e61 6c69 7479 2c0d     seasonality,.
+00005170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005180: 2020 2020 2020 2020 2020 2020 2068 6973               his
+00005190: 746f 7279 5f64 6179 733d 7365 6c66 2e68  tory_days=self.h
+000051a0: 6973 746f 7279 5f64 6179 732c 0d0a 2020  istory_days,..  
+000051b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000051c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000051d0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+000051e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000051f0: 2020 2020 2320 494e 5445 5241 4354 494f      # INTERACTIO
+00005200: 4e53 204e 4f54 2049 4d50 4c45 4d45 4e54  NS NOT IMPLEMENT
+00005210: 4544 0d0a 2020 2020 2020 2020 2020 2020  ED..            
+00005220: 2020 2020 2020 2020 2320 4f52 4445 5220          # ORDER 
+00005230: 5350 4543 4946 4943 4154 494f 4e20 4e4f  SPECIFICATION NO
+00005240: 5420 494d 504c 454d 454e 5445 440d 0a20  T IMPLEMENTED.. 
+00005250: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00005260: 5f64 6620 3d20 7064 2e63 6f6e 6361 7428  _df = pd.concat(
+00005270: 735f 6c69 7374 2c20 6178 6973 3d31 290d  s_list, axis=1).
+00005280: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00005290: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+000052a0: 2065 3a0d 0a20 2020 2020 2020 2020 2020   e:..           
+000052b0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000052c0: 4572 726f 7228 6622 7365 6173 6f6e 616c  Error(f"seasonal
+000052d0: 6974 7920 7b73 6561 736f 6e61 6c69 7479  ity {seasonality
+000052e0: 7d20 6372 6561 7469 6f6e 2065 7272 6f72  } creation error
+000052f0: 2229 2066 726f 6d20 650d 0a20 2020 2020  ") from e..     
+00005300: 2020 2020 2020 2073 5f64 662e 696e 6465         s_df.inde
+00005310: 7820 3d20 7365 6c66 2e64 662e 696e 6465  x = self.df.inde
+00005320: 780d 0a20 2020 2020 2020 2020 2020 2078  x..            x
+00005330: 5f6c 6973 742e 6170 7065 6e64 2873 5f64  _list.append(s_d
+00005340: 6629 0d0a 2020 2020 2020 2020 2320 5468  f)..        # Th
+00005350: 6573 6520 6665 6174 7572 6573 2061 7265  ese features are
+00005360: 2074 6f20 7072 6576 656e 7420 6f76 6572   to prevent over
+00005370: 6669 7474 696e 6720 616e 6420 7374 616e  fitting and stan
+00005380: 6469 6e20 666f 7220 756e 6f62 7365 7276  din for unobserv
+00005390: 6564 2063 6f6d 706f 6e65 6e74 7320 6865  ed components he
+000053a0: 7265 0d0a 2020 2020 2020 2020 6966 2073  re..        if s
+000053b0: 656c 662e 7261 6e64 6f6d 7761 6c6b 5f6e  elf.randomwalk_n
+000053c0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+000053d0: 2020 2020 2020 2020 2020 2078 5f6c 6973             x_lis
+000053e0: 742e 6170 7065 6e64 280d 0a20 2020 2020  t.append(..     
+000053f0: 2020 2020 2020 2020 2020 2070 642e 4461             pd.Da
+00005400: 7461 4672 616d 6528 0d0a 2020 2020 2020  taFrame(..      
+00005410: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+00005420: 2e72 616e 646f 6d2e 6e6f 726d 616c 2873  .random.normal(s
+00005430: 697a 653d 286c 656e 2873 656c 662e 6466  ize=(len(self.df
+00005440: 292c 2073 656c 662e 7261 6e64 6f6d 7761  ), self.randomwa
+00005450: 6c6b 5f6e 2929 2e63 756d 7375 6d28 0d0a  lk_n)).cumsum(..
+00005460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005470: 2020 2020 2020 2020 6178 6973 3d30 0d0a          axis=0..
+00005480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005490: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
+000054a0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+000054b0: 6d6e 733d 5b22 7261 6e64 6f6d 7761 6c6b  mns=["randomwalk
+000054c0: 5f22 202b 2073 7472 2878 2920 666f 7220  _" + str(x) for 
+000054d0: 7820 696e 2072 616e 6765 2873 656c 662e  x in range(self.
+000054e0: 7261 6e64 6f6d 7761 6c6b 5f6e 295d 2c0d  randomwalk_n)],.
+000054f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005500: 2020 2020 2069 6e64 6578 3d73 656c 662e       index=self.
+00005510: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
+00005520: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00005530: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00005540: 2020 2020 2069 6620 7365 6c66 2e74 7265       if self.tre
+00005550: 6e64 5f73 7461 6e64 696e 2069 7320 6e6f  nd_standin is no
+00005560: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00005570: 2020 2020 2069 6620 7365 6c66 2e74 7265       if self.tre
+00005580: 6e64 5f73 7461 6e64 696e 203d 3d20 2272  nd_standin == "r
+00005590: 616e 646f 6d5f 6e6f 726d 616c 223a 0d0a  andom_normal":..
+000055a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055b0: 6e75 6d5f 7374 616e 6469 6e20 3d20 340d  num_standin = 4.
+000055c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000055d0: 2078 5f6c 6973 742e 6170 7065 6e64 280d   x_list.append(.
+000055e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000055f0: 2020 2020 2070 642e 4461 7461 4672 616d       pd.DataFram
+00005600: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
+00005610: 2020 2020 2020 2020 2020 2020 6e70 2e72              np.r
+00005620: 616e 646f 6d2e 6e6f 726d 616c 2873 697a  andom.normal(siz
+00005630: 653d 286c 656e 2873 656c 662e 6466 292c  e=(len(self.df),
+00005640: 206e 756d 5f73 7461 6e64 696e 2929 2c0d   num_standin)),.
 00005650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005660: 2020 2020 2020 2020 2069 6e64 6578 3d73           index=s
-00005670: 656c 662e 6466 2e69 6e64 6578 2c0d 0a20  elf.df.index,.. 
-00005680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005690: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-000056a0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000056b0: 2020 2020 2065 6c69 6620 7365 6c66 2e74       elif self.t
-000056c0: 7265 6e64 5f73 7461 6e64 696e 203d 3d20  rend_standin == 
-000056d0: 2272 6f6c 6c69 6e67 5f74 7265 6e64 223a  "rolling_trend":
-000056e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000056f0: 2020 7265 7369 642c 2073 6c6f 7065 2c20    resid, slope, 
-00005700: 696e 7465 7263 6570 7420 3d20 7365 6c66  intercept = self
-00005710: 2e72 6f6c 6c69 6e67 5f74 7265 6e64 280d  .rolling_trend(.
-00005720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005730: 2020 2020 206e 702e 6173 6172 7261 7928       np.asarray(
-00005740: 6466 292c 206e 702e 6172 7261 7928 7365  df), np.array(se
-00005750: 6c66 2e63 7265 6174 655f 7428 6466 2e69  lf.create_t(df.i
-00005760: 6e64 6578 2929 0d0a 2020 2020 2020 2020  ndex))..        
-00005770: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00005780: 2020 2020 2020 2020 2020 2072 6573 6964             resid
-00005790: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
-000057a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000057b0: 2020 2020 2020 736c 6f70 6520 2a20 6e70        slope * np
-000057c0: 2e61 7361 7272 6179 2873 656c 662e 745f  .asarray(self.t_
-000057d0: 7472 6169 6e29 5b2e 2e2e 2c20 4e6f 6e65  train)[..., None
-000057e0: 5d20 2b20 696e 7465 7263 6570 742c 0d0a  ] + intercept,..
-000057f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005800: 2020 2020 696e 6465 783d 6466 2e69 6e64      index=df.ind
-00005810: 6578 2c0d 0a20 2020 2020 2020 2020 2020  ex,..           
-00005820: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-00005830: 3d64 662e 636f 6c75 6d6e 732c 0d0a 2020  =df.columns,..  
-00005840: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-00005850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005860: 2078 5f6c 6973 742e 6170 7065 6e64 2872   x_list.append(r
-00005870: 6573 6964 2e72 656e 616d 6528 636f 6c75  esid.rename(colu
-00005880: 6d6e 733d 6c61 6d62 6461 2078 3a20 2272  mns=lambda x: "r
-00005890: 6f6c 6c69 6e67 5f74 7265 6e64 5f22 202b  olling_trend_" +
-000058a0: 2073 7472 2878 2929 290d 0a20 2020 2020   str(x)))..     
-000058b0: 2020 2069 6620 6675 7475 7265 5f72 6567     if future_reg
-000058c0: 7265 7373 6f72 2069 7320 6e6f 7420 4e6f  ressor is not No
-000058d0: 6e65 2061 6e64 2073 656c 662e 7265 6772  ne and self.regr
-000058e0: 6573 736f 7273 5f75 7365 643a 0d0a 2020  essors_used:..  
-000058f0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00005900: 662e 7265 6772 6573 736f 725f 7472 616e  f.regressor_tran
-00005910: 7366 6f72 6d61 7469 6f6e 2069 7320 6e6f  sformation is no
-00005920: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00005930: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-00005940: 6772 6573 736f 725f 7472 616e 7366 6f72  gressor_transfor
-00005950: 6d65 7220 3d20 4765 6e65 7261 6c54 7261  mer = GeneralTra
-00005960: 6e73 666f 726d 6572 280d 0a20 2020 2020  nsformer(..     
-00005970: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00005980: 2a73 656c 662e 7265 6772 6573 736f 725f  *self.regressor_
-00005990: 7472 616e 7366 6f72 6d61 7469 6f6e 0d0a  transformation..
-000059a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000059b0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-000059c0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000059d0: 2020 2020 2020 7365 6c66 2e72 6567 7265        self.regre
-000059e0: 7373 6f72 5f74 7261 6e73 666f 726d 6572  ssor_transformer
-000059f0: 203d 2047 656e 6572 616c 5472 616e 7366   = GeneralTransf
-00005a00: 6f72 6d65 7228 2a2a 7b27 6669 6c6c 6e61  ormer(**{'fillna
-00005a10: 273a 2027 6666 696c 6c27 7d29 0d0a 2020  ': 'ffill'})..  
-00005a20: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
-00005a30: 7574 7572 655f 7265 6772 6573 736f 725f  uture_regressor_
-00005a40: 7472 6169 6e20 3d20 7365 6c66 2e72 6567  train = self.reg
-00005a50: 7265 7373 6f72 5f74 7261 6e73 666f 726d  ressor_transform
-00005a60: 6572 2e66 6974 5f74 7261 6e73 666f 726d  er.fit_transform
-00005a70: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00005a80: 2020 2063 6c65 616e 5f72 6567 7265 7373     clean_regress
-00005a90: 6f72 2866 7574 7572 655f 7265 6772 6573  or(future_regres
-00005aa0: 736f 7229 0d0a 2020 2020 2020 2020 2020  sor)..          
-00005ab0: 2020 292e 6669 6c6c 6e61 2830 290d 0a20    ).fillna(0).. 
-00005ac0: 2020 2020 2020 2020 2020 2078 5f6c 6973             x_lis
-00005ad0: 742e 6170 7065 6e64 280d 0a20 2020 2020  t.append(..     
-00005ae0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005af0: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
-00005b00: 5f74 7261 696e 2e72 6569 6e64 6578 2873  _train.reindex(s
-00005b10: 656c 662e 6466 2e69 6e64 6578 2c20 6669  elf.df.index, fi
-00005b20: 6c6c 5f76 616c 7565 3d30 290d 0a20 2020  ll_value=0)..   
-00005b30: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-00005b40: 2020 2020 6966 2066 6c61 675f 7265 6772      if flag_regr
-00005b50: 6573 736f 7273 2069 7320 6e6f 7420 4e6f  essors is not No
-00005b60: 6e65 2061 6e64 2073 656c 662e 7265 6772  ne and self.regr
-00005b70: 6573 736f 7273 5f75 7365 643a 0d0a 2020  essors_used:..  
-00005b80: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
-00005b90: 6c61 675f 7265 6772 6573 736f 725f 7472  lag_regressor_tr
-00005ba0: 6169 6e20 3d20 636c 6561 6e5f 7265 6772  ain = clean_regr
-00005bb0: 6573 736f 7228 0d0a 2020 2020 2020 2020  essor(..        
-00005bc0: 2020 2020 2020 2020 666c 6167 5f72 6567          flag_reg
-00005bd0: 7265 7373 6f72 732c 2070 7265 6669 783d  ressors, prefix=
-00005be0: 2272 6567 7266 6c61 6773 5f22 0d0a 2020  "regrflags_"..  
-00005bf0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00005c00: 2020 2020 2020 2020 2078 5f6c 6973 742e           x_list.
-00005c10: 6170 7065 6e64 2873 656c 662e 666c 6167  append(self.flag
-00005c20: 5f72 6567 7265 7373 6f72 5f74 7261 696e  _regressor_train
-00005c30: 2e72 6569 6e64 6578 2873 656c 662e 6466  .reindex(self.df
-00005c40: 2e69 6e64 6578 2929 0d0a 2020 2020 2020  .index))..      
-00005c50: 2020 6966 2028 0d0a 2020 2020 2020 2020    if (..        
-00005c60: 2020 2020 7365 6c66 2e68 6f6c 6964 6179      self.holiday
-00005c70: 5f63 6f75 6e74 7269 6573 2069 7320 6e6f  _countries is no
-00005c80: 7420 4e6f 6e65 0d0a 2020 2020 2020 2020  t None..        
-00005c90: 2020 2020 616e 6420 6e6f 7420 6973 696e      and not isin
-00005ca0: 7374 616e 6365 2873 656c 662e 686f 6c69  stance(self.holi
-00005cb0: 6461 795f 636f 756e 7472 6965 732c 2064  day_countries, d
-00005cc0: 6963 7429 0d0a 2020 2020 2020 2020 2020  ict)..          
-00005cd0: 2020 616e 6420 7365 6c66 2e68 6f6c 6964    and self.holid
-00005ce0: 6179 5f63 6f75 6e74 7269 6573 5f75 7365  ay_countries_use
-00005cf0: 640d 0a20 2020 2020 2020 2029 3a0d 0a20  d..        ):.. 
-00005d00: 2020 2020 2020 2020 2020 2066 6f72 2068             for h
-00005d10: 6f6c 6964 6179 5f63 6f75 6e74 7279 2069  oliday_country i
-00005d20: 6e20 7365 6c66 2e68 6f6c 6964 6179 5f63  n self.holiday_c
-00005d30: 6f75 6e74 7269 6573 3a0d 0a20 2020 2020  ountries:..     
-00005d40: 2020 2020 2020 2020 2020 2078 5f6c 6973             x_lis
-00005d50: 742e 6170 7065 6e64 280d 0a20 2020 2020  t.append(..     
-00005d60: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00005d70: 6f6c 6964 6179 5f66 6c61 6728 0d0a 2020  oliday_flag(..  
-00005d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005d90: 2020 2020 2020 7365 6c66 2e64 662e 696e        self.df.in
-00005da0: 6465 782c 0d0a 2020 2020 2020 2020 2020  dex,..          
-00005db0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00005dc0: 756e 7472 793d 686f 6c69 6461 795f 636f  untry=holiday_co
-00005dd0: 756e 7472 792c 0d0a 2020 2020 2020 2020  untry,..        
-00005de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005df0: 656e 636f 6465 5f68 6f6c 6964 6179 5f74  encode_holiday_t
-00005e00: 7970 653d 5472 7565 2c0d 0a20 2020 2020  ype=True,..     
-00005e10: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00005e20: 2e72 656e 616d 6528 636f 6c75 6d6e 733d  .rename(columns=
-00005e30: 6c61 6d62 6461 2078 3a20 2268 6f6c 6964  lambda x: "holid
-00005e40: 6179 5f22 202b 2073 7472 2878 2929 2c0d  ay_" + str(x)),.
-00005e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005e60: 2029 0d0a 2020 2020 2020 2020 2320 7075   )..        # pu
-00005e70: 7420 7468 6973 2074 6f20 7468 6520 656e  t this to the en
-00005e80: 6420 6173 2069 7420 7461 6b65 7320 7570  d as it takes up
-00005e90: 206c 6f74 7320 6f66 2066 6561 7475 7265   lots of feature
-00005ea0: 2073 7061 6365 2073 6f6d 6574 696d 6573   space sometimes
-00005eb0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00005ec0: 662e 686f 6c69 6461 795f 6465 7465 6374  f.holiday_detect
-00005ed0: 6f72 5f70 6172 616d 7320 6973 206e 6f74  or_params is not
-00005ee0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00005ef0: 2020 2020 785f 6c69 7374 2e61 7070 656e      x_list.appen
-00005f00: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
-00005f10: 2020 2020 7365 6c66 2e68 6f6c 6964 6179      self.holiday
-00005f20: 5f64 6574 6563 746f 722e 6461 7465 735f  _detector.dates_
-00005f30: 746f 5f68 6f6c 6964 6179 7328 7365 6c66  to_holidays(self
-00005f40: 2e64 662e 696e 6465 782c 2073 7479 6c65  .df.index, style
-00005f50: 3d22 666c 6167 2229 0d0a 2020 2020 2020  ="flag")..      
-00005f60: 2020 2020 2020 2020 2020 2e63 6c69 7028            .clip(
-00005f70: 7570 7065 723d 3129 0d0a 2020 2020 2020  upper=1)..      
-00005f80: 2020 2020 2020 2020 2020 2e72 656e 616d            .renam
-00005f90: 6528 636f 6c75 6d6e 733d 6c61 6d62 6461  e(columns=lambda
-00005fa0: 2078 3a20 2268 6f6c 6964 6179 5f22 202b   x: "holiday_" +
-00005fb0: 2073 7472 2878 2929 0d0a 2020 2020 2020   str(x))..      
-00005fc0: 2020 2020 2020 290d 0a0d 0a20 2020 2020        )....     
-00005fd0: 2020 2023 2046 494e 414c 2046 4541 5455     # FINAL FEATU
-00005fe0: 5245 2050 524f 4345 5353 494e 470d 0a20  RE PROCESSING.. 
-00005ff0: 2020 2020 2020 2078 5f61 7272 6179 203d         x_array =
-00006000: 2070 642e 636f 6e63 6174 2878 5f6c 6973   pd.concat(x_lis
-00006010: 742c 2061 7869 733d 3129 0d0a 2020 2020  t, axis=1)..    
-00006020: 2020 2020 7365 6c66 2e78 5f61 7272 6179      self.x_array
-00006030: 203d 2078 5f61 7272 6179 2020 2320 6361   = x_array  # ca
-00006040: 6e20 7265 6d6f 7665 2074 6869 7320 6c61  n remove this la
-00006050: 7465 722c 2069 7420 6973 2066 6f72 2064  ter, it is for d
-00006060: 6562 7567 6769 6e67 0d0a 2020 2020 2020  ebugging..      
-00006070: 2020 6966 206e 702e 616e 7928 6e70 2e69    if np.any(np.i
-00006080: 736e 616e 2878 5f61 7272 6179 2e61 7374  snan(x_array.ast
-00006090: 7970 6528 666c 6f61 7429 2929 3a20 2023  ype(float))):  #
-000060a0: 2072 656d 6f76 6520 6c61 7465 722c 2066   remove later, f
-000060b0: 6f72 2064 6562 7567 6769 6e67 0d0a 2020  or debugging..  
-000060c0: 2020 2020 2020 2020 2020 6e75 6c7a 203d            nulz =
-000060d0: 2078 5f61 7272 6179 2e69 736e 756c 6c28   x_array.isnull(
-000060e0: 292e 7375 6d28 290d 0a20 2020 2020 2020  ).sum()..       
-000060f0: 2020 2020 2070 7269 6e74 280d 0a20 2020       print(..   
-00006100: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
-00006110: 6865 2066 6f6c 6c6f 7769 6e67 2063 6f6c  he following col
-00006120: 756d 6e73 2063 6f6e 7461 696e 206e 616e  umns contain nan
-00006130: 2076 616c 7565 733a 207b 6e75 6c7a 5b6e   values: {nulz[n
-00006140: 756c 7a20 3e20 305d 2e69 6e64 6578 2e74  ulz > 0].index.t
-00006150: 6f6c 6973 7428 297d 220d 0a20 2020 2020  olist()}"..     
-00006160: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00006170: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00006180: 6545 7272 6f72 2822 6e61 6e20 7661 6c75  eError("nan valu
-00006190: 6573 2069 6e20 785f 6172 7261 7922 290d  es in x_array").
-000061a0: 0a20 2020 2020 2020 2069 6620 6e70 2e61  .        if np.a
-000061b0: 6c6c 2873 656c 662e 6466 203d 3d20 3029  ll(self.df == 0)
-000061c0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000061d0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000061e0: 2274 7261 6e73 666f 726d 6564 2064 6174  "transformed dat
-000061f0: 6120 6973 2061 6c6c 207a 6572 6f65 7322  a is all zeroes"
-00006200: 290d 0a20 2020 2020 2020 2069 6620 6e70  )..        if np
-00006210: 2e61 6e79 2828 7365 6c66 2e64 662e 6973  .any((self.df.is
-00006220: 6e75 6c6c 2829 2e61 6c6c 2829 2929 3a0d  null().all())):.
-00006230: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00006240: 7365 2056 616c 7565 4572 726f 7228 2274  se ValueError("t
-00006250: 7261 6e73 666f 726d 6564 2064 6620 6861  ransformed df ha
-00006260: 7320 4e61 4e20 6669 6c6c 6564 2073 6572  s NaN filled ser
-00006270: 6965 7322 290d 0a20 2020 2020 2020 2023  ies")..        #
-00006280: 2072 656d 6f76 6520 7a65 726f 2076 6172   remove zero var
-00006290: 6961 6e63 6520 2863 6f72 7220 6973 206e  iance (corr is n
-000062a0: 616e 290d 0a20 2020 2020 2020 2063 6f72  an)..        cor
-000062b0: 7220 3d20 6e70 2e63 6f72 7263 6f65 6628  r = np.corrcoef(
-000062c0: 785f 6172 7261 792c 2072 6f77 7661 723d  x_array, rowvar=
-000062d0: 3029 0d0a 2020 2020 2020 2020 6e65 6172  0)..        near
-000062e0: 7a20 3d20 785f 6172 7261 792e 636f 6c75  z = x_array.colu
-000062f0: 6d6e 735b 6e70 2e69 736e 616e 2863 6f72  mns[np.isnan(cor
-00006300: 7229 2e61 6c6c 2861 7869 733d 3129 5d0d  r).all(axis=1)].
-00006310: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
-00006320: 6e65 6172 7a29 203e 2030 3a0d 0a20 2020  nearz) > 0:..   
-00006330: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00006340: 2e76 6572 626f 7365 203e 2031 3a0d 0a20  .verbose > 1:.. 
-00006350: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00006360: 7269 6e74 2866 2244 726f 7070 696e 6720  rint(f"Dropping 
-00006370: 7a65 726f 2076 6172 6961 6e63 6520 6665  zero variance fe
-00006380: 6174 7572 6520 636f 6c75 6d6e 7320 7b6e  ature columns {n
-00006390: 6561 727a 7d22 290d 0a20 2020 2020 2020  earz}")..       
-000063a0: 2020 2020 2078 5f61 7272 6179 203d 2078       x_array = x
-000063b0: 5f61 7272 6179 2e64 726f 7028 636f 6c75  _array.drop(colu
-000063c0: 6d6e 733d 6e65 6172 7a29 0d0a 2020 2020  mns=nearz)..    
-000063d0: 2020 2020 2320 7265 6d6f 7665 2063 6f6c      # remove col
-000063e0: 696e 6561 7220 6665 6174 7572 6573 0d0a  inear features..
-000063f0: 2020 2020 2020 2020 2320 4e4f 5445 2054          # NOTE T
-00006400: 4845 5345 2052 454d 4f56 414c 5320 5245  HESE REMOVALS RE
-00006410: 4d4f 5645 2054 4845 2046 4952 5354 204f  MOVE THE FIRST O
-00006420: 4620 5041 4952 2043 4f4c 554d 4e20 4649  F PAIR COLUMN FI
-00006430: 5253 540d 0a20 2020 2020 2020 2063 6f72  RST..        cor
-00006440: 7220 3d20 6e70 2e63 6f72 7263 6f65 6628  r = np.corrcoef(
-00006450: 785f 6172 7261 792c 2072 6f77 7661 723d  x_array, rowvar=
-00006460: 3029 2020 2320 7365 636f 6e64 206f 6e65  0)  # second one
-00006470: 0d0a 2020 2020 2020 2020 772c 2076 6563  ..        w, vec
-00006480: 203d 206e 702e 6c69 6e61 6c67 2e65 6967   = np.linalg.eig
-00006490: 2863 6f72 7229 0d0a 2020 2020 2020 2020  (corr)..        
-000064a0: 6e70 2e66 696c 6c5f 6469 6167 6f6e 616c  np.fill_diagonal
-000064b0: 2863 6f72 722c 2030 290d 0a20 2020 2020  (corr, 0)..     
-000064c0: 2020 2069 6620 7365 6c66 2e6d 6178 5f63     if self.max_c
-000064d0: 6f6c 696e 6561 7269 7479 2069 7320 6e6f  olinearity is no
-000064e0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-000064f0: 2020 2020 2063 6f72 656c 203d 2078 5f61       corel = x_a
-00006500: 7272 6179 2e63 6f6c 756d 6e73 5b0d 0a20  rray.columns[.. 
-00006510: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00006520: 702e 6d69 6e28 636f 7272 202a 206e 702e  p.min(corr * np.
-00006530: 7472 6928 636f 7272 2e73 6861 7065 5b30  tri(corr.shape[0
-00006540: 5d29 2c20 6178 6973 3d30 2920 3e20 7365  ]), axis=0) > se
-00006550: 6c66 2e6d 6178 5f63 6f6c 696e 6561 7269  lf.max_colineari
-00006560: 7479 0d0a 2020 2020 2020 2020 2020 2020  ty..            
-00006570: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-00006580: 6620 6c65 6e28 636f 7265 6c29 203e 2030  f len(corel) > 0
-00006590: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000065a0: 2020 2069 6620 7365 6c66 2e76 6572 626f     if self.verbo
-000065b0: 7365 203e 2031 3a0d 0a20 2020 2020 2020  se > 1:..       
-000065c0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-000065d0: 6e74 2866 2244 726f 7070 696e 6720 636f  nt(f"Dropping co
-000065e0: 6c69 6e65 6172 2066 6561 7475 7265 2063  linear feature c
-000065f0: 6f6c 756d 6e73 207b 636f 7265 6c7d 2229  olumns {corel}")
-00006600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006610: 2020 785f 6172 7261 7920 3d20 785f 6172    x_array = x_ar
-00006620: 7261 792e 6472 6f70 2863 6f6c 756d 6e73  ray.drop(columns
-00006630: 3d63 6f72 656c 290d 0a20 2020 2020 2020  =corel)..       
-00006640: 2069 6620 7365 6c66 2e6d 6178 5f6d 756c   if self.max_mul
-00006650: 7469 636f 6c69 6e65 6172 6974 7920 6973  ticolinearity is
-00006660: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00006670: 2020 2020 2020 2020 636f 6c69 6e20 3d20          colin = 
-00006680: 785f 6172 7261 792e 636f 6c75 6d6e 735b  x_array.columns[
-00006690: 7720 3c20 7365 6c66 2e6d 6178 5f6d 756c  w < self.max_mul
-000066a0: 7469 636f 6c69 6e65 6172 6974 795d 0d0a  ticolinearity]..
-000066b0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000066c0: 656e 2863 6f6c 696e 2920 3e20 303a 0d0a  en(colin) > 0:..
-000066d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000066e0: 6966 2073 656c 662e 7665 7262 6f73 6520  if self.verbose 
-000066f0: 3e20 313a 0d0a 2020 2020 2020 2020 2020  > 1:..          
-00006700: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00006710: 6622 4472 6f70 7069 6e67 206d 756c 7469  f"Dropping multi
-00006720: 2d63 6f6c 696e 6561 7220 6665 6174 7572  -colinear featur
-00006730: 6520 636f 6c75 6d6e 7320 7b63 6f6c 696e  e columns {colin
-00006740: 7d22 290d 0a20 2020 2020 2020 2020 2020  }")..           
-00006750: 2020 2020 2078 5f61 7272 6179 203d 2078       x_array = x
-00006760: 5f61 7272 6179 2e64 726f 7028 636f 6c75  _array.drop(colu
-00006770: 6d6e 733d 636f 6c69 6e29 0d0a 0d0a 2020  mns=colin)....  
-00006780: 2020 2020 2020 2320 7468 696e 6773 2077        # things w
-00006790: 6520 7761 6e74 206d 6f64 656c 6564 2062  e want modeled b
-000067a0: 7574 2077 616e 7420 746f 2064 6973 6361  ut want to disca
-000067b0: 7264 2066 726f 6d20 6576 616c 7561 7469  rd from evaluati
-000067c0: 6f6e 2028 7374 616e 6469 6e73 290d 0a20  on (standins).. 
-000067d0: 2020 2020 2020 2072 656d 6f76 655f 7061         remove_pa
-000067e0: 7474 6572 6e73 203d 205b 0d0a 2020 2020  tterns = [..    
-000067f0: 2020 2020 2020 2020 2272 616e 646e 6f72          "randnor
-00006800: 6d5f 222c 0d0a 2020 2020 2020 2020 2020  m_",..          
-00006810: 2020 2272 6f6c 6c69 6e67 5f74 7265 6e64    "rolling_trend
-00006820: 5f22 2c0d 0a20 2020 2020 2020 2020 2020  _",..           
-00006830: 2022 7261 6e64 6f6d 7761 6c6b 5f22 2c0d   "randomwalk_",.
-00006840: 0a20 2020 2020 2020 205d 2020 2320 2269  .        ]  # "i
-00006850: 6e74 6572 6365 7074 2220 6164 6465 6420  ntercept" added 
-00006860: 6166 7465 722c 2073 6f20 6e6f 7420 696e  after, so not in
-00006870: 636c 7564 6564 0d0a 0d0a 2020 2020 2020  cluded....      
-00006880: 2020 2320 5255 4e20 4c49 4e45 4152 204d    # RUN LINEAR M
-00006890: 4f44 454c 0d0a 2020 2020 2020 2020 2320  ODEL..        # 
-000068a0: 6164 6420 7820 6665 6174 7572 6573 2074  add x features t
-000068b0: 6861 7420 646f 6e27 7420 6170 706c 7920  hat don't apply 
-000068c0: 746f 2061 6c6c 2c20 616e 6420 6e65 6564  to all, and need
-000068d0: 2074 6f20 6265 206c 6f6f 7065 640d 0a20   to be looped.. 
-000068e0: 2020 2020 2020 2069 6620 7365 6c66 2e6c         if self.l
-000068f0: 6f6f 705f 7265 7175 6972 6564 3a0d 0a20  oop_required:.. 
-00006900: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006910: 7061 7261 6d73 203d 207b 7d0d 0a20 2020  params = {}..   
-00006920: 2020 2020 2020 2020 2073 656c 662e 6b65           self.ke
-00006930: 6570 5f63 6f6c 7320 3d20 7b7d 0d0a 2020  ep_cols = {}..  
-00006940: 2020 2020 2020 2020 2020 7365 6c66 2e78            self.x
-00006950: 5f61 7272 6179 203d 207b 7d0d 0a20 2020  _array = {}..   
-00006960: 2020 2020 2020 2020 2073 656c 662e 6b65           self.ke
-00006970: 6570 5f63 6f6c 735f 6964 7820 3d20 7b7d  ep_cols_idx = {}
-00006980: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00006990: 6c66 2e63 6f6c 5f67 726f 7570 696e 6773  lf.col_groupings
-000069a0: 203d 207b 7d0d 0a20 2020 2020 2020 2020   = {}..         
-000069b0: 2020 2074 7265 6e64 5f72 6573 6964 7561     trend_residua
-000069c0: 6c73 203d 205b 5d0d 0a20 2020 2020 2020  ls = []..       
-000069d0: 2020 2020 2066 6f72 2063 6f6c 2069 6e20       for col in 
-000069e0: 7365 6c66 2e64 662e 636f 6c75 6d6e 733a  self.df.columns:
-000069f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006a00: 2020 635f 7820 3d20 785f 6172 7261 792e    c_x = x_array.
-00006a10: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
-00006a20: 2020 2020 2020 2020 2320 696d 706c 656d          # implem
-00006a30: 656e 7420 7065 725f 7365 7269 6573 2068  ent per_series h
-00006a40: 6f6c 6964 6179 2063 6f75 6e74 7269 6573  oliday countries
-00006a50: 2066 6c61 670d 0a20 2020 2020 2020 2020   flag..         
-00006a60: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
-00006a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006a80: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00006a90: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
-00006aa0: 6573 2c20 6469 6374 290d 0a20 2020 2020  es, dict)..     
-00006ab0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00006ac0: 6e64 2073 656c 662e 686f 6c69 6461 795f  nd self.holiday_
-00006ad0: 636f 756e 7472 6965 735f 7573 6564 0d0a  countries_used..
-00006ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006af0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00006b00: 2020 2020 2020 2020 6863 203d 2073 656c          hc = sel
-00006b10: 662e 686f 6c69 6461 795f 636f 756e 7472  f.holiday_countr
-00006b20: 6965 732e 6765 7428 636f 6c2c 204e 6f6e  ies.get(col, Non
-00006b30: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00006b40: 2020 2020 2020 2020 6966 2068 6320 6973          if hc is
-00006b50: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00006b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b70: 2020 2020 635f 6863 203d 2068 6f6c 6964      c_hc = holid
-00006b80: 6179 5f66 6c61 6728 0d0a 2020 2020 2020  ay_flag(..      
-00006b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ba0: 2020 2020 2020 7365 6c66 2e64 662e 696e        self.df.in
-00006bb0: 6465 782c 0d0a 2020 2020 2020 2020 2020  dex,..          
-00006bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006bd0: 2020 636f 756e 7472 793d 6863 2c0d 0a20    country=hc,.. 
+00005660: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
+00005670: 3d5b 2272 616e 646e 6f72 6d5f 2220 2b20  =["randnorm_" + 
+00005680: 7374 7228 7829 2066 6f72 2078 2069 6e20  str(x) for x in 
+00005690: 7261 6e67 6528 6e75 6d5f 7374 616e 6469  range(num_standi
+000056a0: 6e29 5d2c 0d0a 2020 2020 2020 2020 2020  n)],..          
+000056b0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000056c0: 6465 783d 7365 6c66 2e64 662e 696e 6465  dex=self.df.inde
+000056d0: 782c 0d0a 2020 2020 2020 2020 2020 2020  x,..            
+000056e0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+000056f0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00005700: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
+00005710: 656c 662e 7472 656e 645f 7374 616e 6469  elf.trend_standi
+00005720: 6e20 3d3d 2022 726f 6c6c 696e 675f 7472  n == "rolling_tr
+00005730: 656e 6422 3a0d 0a20 2020 2020 2020 2020  end":..         
+00005740: 2020 2020 2020 2072 6573 6964 2c20 736c         resid, sl
+00005750: 6f70 652c 2069 6e74 6572 6365 7074 203d  ope, intercept =
+00005760: 2073 656c 662e 726f 6c6c 696e 675f 7472   self.rolling_tr
+00005770: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
+00005780: 2020 2020 2020 2020 2020 6e70 2e61 7361            np.asa
+00005790: 7272 6179 2864 6629 2c20 6e70 2e61 7272  rray(df), np.arr
+000057a0: 6179 2873 656c 662e 6372 6561 7465 5f74  ay(self.create_t
+000057b0: 2864 662e 696e 6465 7829 290d 0a20 2020  (df.index))..   
+000057c0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+000057d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057e0: 7265 7369 6420 3d20 7064 2e44 6174 6146  resid = pd.DataF
+000057f0: 7261 6d65 280d 0a20 2020 2020 2020 2020  rame(..         
+00005800: 2020 2020 2020 2020 2020 2073 6c6f 7065             slope
+00005810: 202a 206e 702e 6173 6172 7261 7928 7365   * np.asarray(se
+00005820: 6c66 2e74 5f74 7261 696e 295b 2e2e 2e2c  lf.t_train)[...,
+00005830: 204e 6f6e 655d 202b 2069 6e74 6572 6365   None] + interce
+00005840: 7074 2c0d 0a20 2020 2020 2020 2020 2020  pt,..           
+00005850: 2020 2020 2020 2020 2069 6e64 6578 3d64           index=d
+00005860: 662e 696e 6465 782c 0d0a 2020 2020 2020  f.index,..      
+00005870: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00005880: 6c75 6d6e 733d 6466 2e63 6f6c 756d 6e73  lumns=df.columns
+00005890: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000058a0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+000058b0: 2020 2020 2020 785f 6c69 7374 2e61 7070        x_list.app
+000058c0: 656e 6428 7265 7369 642e 7265 6e61 6d65  end(resid.rename
+000058d0: 2863 6f6c 756d 6e73 3d6c 616d 6264 6120  (columns=lambda 
+000058e0: 783a 2022 726f 6c6c 696e 675f 7472 656e  x: "rolling_tren
+000058f0: 645f 2220 2b20 7374 7228 7829 2929 0d0a  d_" + str(x)))..
+00005900: 2020 2020 2020 2020 6966 2066 7574 7572          if futur
+00005910: 655f 7265 6772 6573 736f 7220 6973 206e  e_regressor is n
+00005920: 6f74 204e 6f6e 6520 616e 6420 7365 6c66  ot None and self
+00005930: 2e72 6567 7265 7373 6f72 735f 7573 6564  .regressors_used
+00005940: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00005950: 6620 7365 6c66 2e72 6567 7265 7373 6f72  f self.regressor
+00005960: 5f74 7261 6e73 666f 726d 6174 696f 6e20  _transformation 
+00005970: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00005980: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00005990: 6c66 2e72 6567 7265 7373 6f72 5f74 7261  lf.regressor_tra
+000059a0: 6e73 666f 726d 6572 203d 2047 656e 6572  nsformer = Gener
+000059b0: 616c 5472 616e 7366 6f72 6d65 7228 0d0a  alTransformer(..
+000059c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059d0: 2020 2020 2a2a 7365 6c66 2e72 6567 7265      **self.regre
+000059e0: 7373 6f72 5f74 7261 6e73 666f 726d 6174  ssor_transformat
+000059f0: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
+00005a00: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00005a10: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00005a20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005a30: 7265 6772 6573 736f 725f 7472 616e 7366  regressor_transf
+00005a40: 6f72 6d65 7220 3d20 4765 6e65 7261 6c54  ormer = GeneralT
+00005a50: 7261 6e73 666f 726d 6572 282a 2a7b 2766  ransformer(**{'f
+00005a60: 696c 6c6e 6127 3a20 2766 6669 6c6c 277d  illna': 'ffill'}
+00005a70: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
+00005a80: 656c 662e 6675 7475 7265 5f72 6567 7265  elf.future_regre
+00005a90: 7373 6f72 5f74 7261 696e 203d 2073 656c  ssor_train = sel
+00005aa0: 662e 7265 6772 6573 736f 725f 7472 616e  f.regressor_tran
+00005ab0: 7366 6f72 6d65 722e 6669 745f 7472 616e  sformer.fit_tran
+00005ac0: 7366 6f72 6d28 0d0a 2020 2020 2020 2020  sform(..        
+00005ad0: 2020 2020 2020 2020 636c 6561 6e5f 7265          clean_re
+00005ae0: 6772 6573 736f 7228 6675 7475 7265 5f72  gressor(future_r
+00005af0: 6567 7265 7373 6f72 290d 0a20 2020 2020  egressor)..     
+00005b00: 2020 2020 2020 2029 2e66 696c 6c6e 6128         ).fillna(
+00005b10: 3029 0d0a 2020 2020 2020 2020 2020 2020  0)..            
+00005b20: 785f 6c69 7374 2e61 7070 656e 6428 0d0a  x_list.append(..
+00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b40: 7365 6c66 2e66 7574 7572 655f 7265 6772  self.future_regr
+00005b50: 6573 736f 725f 7472 6169 6e2e 7265 696e  essor_train.rein
+00005b60: 6465 7828 7365 6c66 2e64 662e 696e 6465  dex(self.df.inde
+00005b70: 782c 2066 696c 6c5f 7661 6c75 653d 3029  x, fill_value=0)
+00005b80: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
+00005b90: 0a20 2020 2020 2020 2069 6620 666c 6167  .        if flag
+00005ba0: 5f72 6567 7265 7373 6f72 7320 6973 206e  _regressors is n
+00005bb0: 6f74 204e 6f6e 6520 616e 6420 7365 6c66  ot None and self
+00005bc0: 2e72 6567 7265 7373 6f72 735f 7573 6564  .regressors_used
+00005bd0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00005be0: 656c 662e 666c 6167 5f72 6567 7265 7373  elf.flag_regress
+00005bf0: 6f72 5f74 7261 696e 203d 2063 6c65 616e  or_train = clean
+00005c00: 5f72 6567 7265 7373 6f72 280d 0a20 2020  _regressor(..   
+00005c10: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+00005c20: 675f 7265 6772 6573 736f 7273 2c20 7072  g_regressors, pr
+00005c30: 6566 6978 3d22 7265 6772 666c 6167 735f  efix="regrflags_
+00005c40: 220d 0a20 2020 2020 2020 2020 2020 2029  "..            )
+00005c50: 0d0a 2020 2020 2020 2020 2020 2020 785f  ..            x_
+00005c60: 6c69 7374 2e61 7070 656e 6428 7365 6c66  list.append(self
+00005c70: 2e66 6c61 675f 7265 6772 6573 736f 725f  .flag_regressor_
+00005c80: 7472 6169 6e2e 7265 696e 6465 7828 7365  train.reindex(se
+00005c90: 6c66 2e64 662e 696e 6465 7829 290d 0a20  lf.df.index)).. 
+00005ca0: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
+00005cb0: 2020 2020 2020 2020 2073 656c 662e 686f           self.ho
+00005cc0: 6c69 6461 795f 636f 756e 7472 6965 7320  liday_countries 
+00005cd0: 6973 206e 6f74 204e 6f6e 650d 0a20 2020  is not None..   
+00005ce0: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
+00005cf0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00005d00: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
+00005d10: 6573 2c20 6469 6374 290d 0a20 2020 2020  es, dict)..     
+00005d20: 2020 2020 2020 2061 6e64 2073 656c 662e         and self.
+00005d30: 686f 6c69 6461 795f 636f 756e 7472 6965  holiday_countrie
+00005d40: 735f 7573 6564 0d0a 2020 2020 2020 2020  s_used..        
+00005d50: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00005d60: 666f 7220 686f 6c69 6461 795f 636f 756e  for holiday_coun
+00005d70: 7472 7920 696e 2073 656c 662e 686f 6c69  try in self.holi
+00005d80: 6461 795f 636f 756e 7472 6965 733a 0d0a  day_countries:..
+00005d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005da0: 785f 6c69 7374 2e61 7070 656e 6428 0d0a  x_list.append(..
+00005db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005dc0: 2020 2020 686f 6c69 6461 795f 666c 6167      holiday_flag
+00005dd0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00005de0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005df0: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
+00005e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e10: 2020 2063 6f75 6e74 7279 3d68 6f6c 6964     country=holid
+00005e20: 6179 5f63 6f75 6e74 7279 2c0d 0a20 2020  ay_country,..   
+00005e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e40: 2020 2020 2065 6e63 6f64 655f 686f 6c69       encode_holi
+00005e50: 6461 795f 7479 7065 3d54 7275 652c 0d0a  day_type=True,..
+00005e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e70: 2020 2020 292e 7265 6e61 6d65 2863 6f6c      ).rename(col
+00005e80: 756d 6e73 3d6c 616d 6264 6120 783a 2022  umns=lambda x: "
+00005e90: 686f 6c69 6461 795f 2220 2b20 7374 7228  holiday_" + str(
+00005ea0: 7829 292c 0d0a 2020 2020 2020 2020 2020  x)),..          
+00005eb0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00005ec0: 2023 2070 7574 2074 6869 7320 746f 2074   # put this to t
+00005ed0: 6865 2065 6e64 2061 7320 6974 2074 616b  he end as it tak
+00005ee0: 6573 2075 7020 6c6f 7473 206f 6620 6665  es up lots of fe
+00005ef0: 6174 7572 6520 7370 6163 6520 736f 6d65  ature space some
+00005f00: 7469 6d65 730d 0a20 2020 2020 2020 2069  times..        i
+00005f10: 6620 7365 6c66 2e68 6f6c 6964 6179 5f64  f self.holiday_d
+00005f20: 6574 6563 746f 725f 7061 7261 6d73 2069  etector_params i
+00005f30: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00005f40: 2020 2020 2020 2020 2078 5f6c 6973 742e           x_list.
+00005f50: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+00005f60: 2020 2020 2020 2020 2073 656c 662e 686f           self.ho
+00005f70: 6c69 6461 795f 6465 7465 6374 6f72 2e64  liday_detector.d
+00005f80: 6174 6573 5f74 6f5f 686f 6c69 6461 7973  ates_to_holidays
+00005f90: 2873 656c 662e 6466 2e69 6e64 6578 2c20  (self.df.index, 
+00005fa0: 7374 796c 653d 2266 6c61 6722 290d 0a20  style="flag").. 
+00005fb0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+00005fc0: 636c 6970 2875 7070 6572 3d31 290d 0a20  clip(upper=1).. 
+00005fd0: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+00005fe0: 7265 6e61 6d65 2863 6f6c 756d 6e73 3d6c  rename(columns=l
+00005ff0: 616d 6264 6120 783a 2022 686f 6c69 6461  ambda x: "holida
+00006000: 795f 2220 2b20 7374 7228 7829 290d 0a20  y_" + str(x)).. 
+00006010: 2020 2020 2020 2020 2020 2029 0d0a 0d0a             )....
+00006020: 2020 2020 2020 2020 2320 4649 4e41 4c20          # FINAL 
+00006030: 4645 4154 5552 4520 5052 4f43 4553 5349  FEATURE PROCESSI
+00006040: 4e47 0d0a 2020 2020 2020 2020 785f 6172  NG..        x_ar
+00006050: 7261 7920 3d20 7064 2e63 6f6e 6361 7428  ray = pd.concat(
+00006060: 785f 6c69 7374 2c20 6178 6973 3d31 290d  x_list, axis=1).
+00006070: 0a20 2020 2020 2020 2073 656c 662e 785f  .        self.x_
+00006080: 6172 7261 7920 3d20 785f 6172 7261 7920  array = x_array 
+00006090: 2023 2063 616e 2072 656d 6f76 6520 7468   # can remove th
+000060a0: 6973 206c 6174 6572 2c20 6974 2069 7320  is later, it is 
+000060b0: 666f 7220 6465 6275 6767 696e 670d 0a20  for debugging.. 
+000060c0: 2020 2020 2020 2069 6620 6e70 2e61 6e79         if np.any
+000060d0: 286e 702e 6973 6e61 6e28 785f 6172 7261  (np.isnan(x_arra
+000060e0: 792e 6173 7479 7065 2866 6c6f 6174 2929  y.astype(float))
+000060f0: 293a 2020 2320 7265 6d6f 7665 206c 6174  ):  # remove lat
+00006100: 6572 2c20 666f 7220 6465 6275 6767 696e  er, for debuggin
+00006110: 670d 0a20 2020 2020 2020 2020 2020 206e  g..            n
+00006120: 756c 7a20 3d20 785f 6172 7261 792e 6973  ulz = x_array.is
+00006130: 6e75 6c6c 2829 2e73 756d 2829 0d0a 2020  null().sum()..  
+00006140: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00006150: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006160: 2020 6622 7468 6520 666f 6c6c 6f77 696e    f"the followin
+00006170: 6720 636f 6c75 6d6e 7320 636f 6e74 6169  g columns contai
+00006180: 6e20 6e61 6e20 7661 6c75 6573 3a20 7b6e  n nan values: {n
+00006190: 756c 7a5b 6e75 6c7a 203e 2030 5d2e 696e  ulz[nulz > 0].in
+000061a0: 6465 782e 746f 6c69 7374 2829 7d22 0d0a  dex.tolist()}"..
+000061b0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+000061c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000061d0: 2056 616c 7565 4572 726f 7228 226e 616e   ValueError("nan
+000061e0: 2076 616c 7565 7320 696e 2078 5f61 7272   values in x_arr
+000061f0: 6179 2229 0d0a 2020 2020 2020 2020 6966  ay")..        if
+00006200: 206e 702e 616c 6c28 7365 6c66 2e64 6620   np.all(self.df 
+00006210: 3d3d 2030 293a 0d0a 2020 2020 2020 2020  == 0):..        
+00006220: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00006230: 7272 6f72 2822 7472 616e 7366 6f72 6d65  rror("transforme
+00006240: 6420 6461 7461 2069 7320 616c 6c20 7a65  d data is all ze
+00006250: 726f 6573 2229 0d0a 2020 2020 2020 2020  roes")..        
+00006260: 6966 206e 702e 616e 7928 2873 656c 662e  if np.any((self.
+00006270: 6466 2e69 736e 756c 6c28 292e 616c 6c28  df.isnull().all(
+00006280: 2929 293a 0d0a 2020 2020 2020 2020 2020  ))):..          
+00006290: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+000062a0: 6f72 2822 7472 616e 7366 6f72 6d65 6420  or("transformed 
+000062b0: 6466 2068 6173 204e 614e 2066 696c 6c65  df has NaN fille
+000062c0: 6420 7365 7269 6573 2229 0d0a 2020 2020  d series")..    
+000062d0: 2020 2020 2320 7265 6d6f 7665 207a 6572      # remove zer
+000062e0: 6f20 7661 7269 616e 6365 2028 636f 7272  o variance (corr
+000062f0: 2069 7320 6e61 6e29 0d0a 2020 2020 2020   is nan)..      
+00006300: 2020 636f 7272 203d 206e 702e 636f 7272    corr = np.corr
+00006310: 636f 6566 2878 5f61 7272 6179 2c20 726f  coef(x_array, ro
+00006320: 7776 6172 3d30 290d 0a20 2020 2020 2020  wvar=0)..       
+00006330: 206e 6561 727a 203d 2078 5f61 7272 6179   nearz = x_array
+00006340: 2e63 6f6c 756d 6e73 5b6e 702e 6973 6e61  .columns[np.isna
+00006350: 6e28 636f 7272 292e 616c 6c28 6178 6973  n(corr).all(axis
+00006360: 3d31 295d 0d0a 2020 2020 2020 2020 6966  =1)]..        if
+00006370: 206c 656e 286e 6561 727a 2920 3e20 303a   len(nearz) > 0:
+00006380: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00006390: 2073 656c 662e 7665 7262 6f73 6520 3e20   self.verbose > 
+000063a0: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+000063b0: 2020 2020 7072 696e 7428 6622 4472 6f70      print(f"Drop
+000063c0: 7069 6e67 207a 6572 6f20 7661 7269 616e  ping zero varian
+000063d0: 6365 2066 6561 7475 7265 2063 6f6c 756d  ce feature colum
+000063e0: 6e73 207b 6e65 6172 7a7d 2229 0d0a 2020  ns {nearz}")..  
+000063f0: 2020 2020 2020 2020 2020 785f 6172 7261            x_arra
+00006400: 7920 3d20 785f 6172 7261 792e 6472 6f70  y = x_array.drop
+00006410: 2863 6f6c 756d 6e73 3d6e 6561 727a 290d  (columns=nearz).
+00006420: 0a20 2020 2020 2020 2023 2072 656d 6f76  .        # remov
+00006430: 6520 636f 6c69 6e65 6172 2066 6561 7475  e colinear featu
+00006440: 7265 730d 0a20 2020 2020 2020 2023 204e  res..        # N
+00006450: 4f54 4520 5448 4553 4520 5245 4d4f 5641  OTE THESE REMOVA
+00006460: 4c53 2052 454d 4f56 4520 5448 4520 4649  LS REMOVE THE FI
+00006470: 5253 5420 4f46 2050 4149 5220 434f 4c55  RST OF PAIR COLU
+00006480: 4d4e 2046 4952 5354 0d0a 2020 2020 2020  MN FIRST..      
+00006490: 2020 636f 7272 203d 206e 702e 636f 7272    corr = np.corr
+000064a0: 636f 6566 2878 5f61 7272 6179 2c20 726f  coef(x_array, ro
+000064b0: 7776 6172 3d30 2920 2023 2073 6563 6f6e  wvar=0)  # secon
+000064c0: 6420 6f6e 650d 0a20 2020 2020 2020 2077  d one..        w
+000064d0: 2c20 7665 6320 3d20 6e70 2e6c 696e 616c  , vec = np.linal
+000064e0: 672e 6569 6728 636f 7272 290d 0a20 2020  g.eig(corr)..   
+000064f0: 2020 2020 206e 702e 6669 6c6c 5f64 6961       np.fill_dia
+00006500: 676f 6e61 6c28 636f 7272 2c20 3029 0d0a  gonal(corr, 0)..
+00006510: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00006520: 6d61 785f 636f 6c69 6e65 6172 6974 7920  max_colinearity 
+00006530: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00006540: 2020 2020 2020 2020 2020 636f 7265 6c20            corel 
+00006550: 3d20 785f 6172 7261 792e 636f 6c75 6d6e  = x_array.column
+00006560: 735b 0d0a 2020 2020 2020 2020 2020 2020  s[..            
+00006570: 2020 2020 6e70 2e6d 696e 2863 6f72 7220      np.min(corr 
+00006580: 2a20 6e70 2e74 7269 2863 6f72 722e 7368  * np.tri(corr.sh
+00006590: 6170 655b 305d 292c 2061 7869 733d 3029  ape[0]), axis=0)
+000065a0: 203e 2073 656c 662e 6d61 785f 636f 6c69   > self.max_coli
+000065b0: 6e65 6172 6974 790d 0a20 2020 2020 2020  nearity..       
+000065c0: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
+000065d0: 2020 2020 6966 206c 656e 2863 6f72 656c      if len(corel
+000065e0: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
+000065f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00006600: 7665 7262 6f73 6520 3e20 313a 0d0a 2020  verbose > 1:..  
+00006610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006620: 2020 7072 696e 7428 6622 4472 6f70 7069    print(f"Droppi
+00006630: 6e67 2063 6f6c 696e 6561 7220 6665 6174  ng colinear feat
+00006640: 7572 6520 636f 6c75 6d6e 7320 7b63 6f72  ure columns {cor
+00006650: 656c 7d22 290d 0a20 2020 2020 2020 2020  el}")..         
+00006660: 2020 2020 2020 2078 5f61 7272 6179 203d         x_array =
+00006670: 2078 5f61 7272 6179 2e64 726f 7028 636f   x_array.drop(co
+00006680: 6c75 6d6e 733d 636f 7265 6c29 0d0a 2020  lumns=corel)..  
+00006690: 2020 2020 2020 6966 2073 656c 662e 6d61        if self.ma
+000066a0: 785f 6d75 6c74 6963 6f6c 696e 6561 7269  x_multicolineari
+000066b0: 7479 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ty is not None:.
+000066c0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+000066d0: 696e 203d 2078 5f61 7272 6179 2e63 6f6c  in = x_array.col
+000066e0: 756d 6e73 5b77 203c 2073 656c 662e 6d61  umns[w < self.ma
+000066f0: 785f 6d75 6c74 6963 6f6c 696e 6561 7269  x_multicolineari
+00006700: 7479 5d0d 0a20 2020 2020 2020 2020 2020  ty]..           
+00006710: 2069 6620 6c65 6e28 636f 6c69 6e29 203e   if len(colin) >
+00006720: 2030 3a0d 0a20 2020 2020 2020 2020 2020   0:..           
+00006730: 2020 2020 2069 6620 7365 6c66 2e76 6572       if self.ver
+00006740: 626f 7365 203e 2031 3a0d 0a20 2020 2020  bose > 1:..     
+00006750: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00006760: 7269 6e74 2866 2244 726f 7070 696e 6720  rint(f"Dropping 
+00006770: 6d75 6c74 692d 636f 6c69 6e65 6172 2066  multi-colinear f
+00006780: 6561 7475 7265 2063 6f6c 756d 6e73 207b  eature columns {
+00006790: 636f 6c69 6e7d 2229 0d0a 2020 2020 2020  colin}")..      
+000067a0: 2020 2020 2020 2020 2020 785f 6172 7261            x_arra
+000067b0: 7920 3d20 785f 6172 7261 792e 6472 6f70  y = x_array.drop
+000067c0: 2863 6f6c 756d 6e73 3d63 6f6c 696e 290d  (columns=colin).
+000067d0: 0a0d 0a20 2020 2020 2020 2023 2074 6869  ...        # thi
+000067e0: 6e67 7320 7765 2077 616e 7420 6d6f 6465  ngs we want mode
+000067f0: 6c65 6420 6275 7420 7761 6e74 2074 6f20  led but want to 
+00006800: 6469 7363 6172 6420 6672 6f6d 2065 7661  discard from eva
+00006810: 6c75 6174 696f 6e20 2873 7461 6e64 696e  luation (standin
+00006820: 7329 0d0a 2020 2020 2020 2020 7265 6d6f  s)..        remo
+00006830: 7665 5f70 6174 7465 726e 7320 3d20 5b0d  ve_patterns = [.
+00006840: 0a20 2020 2020 2020 2020 2020 2022 7261  .            "ra
+00006850: 6e64 6e6f 726d 5f22 2c0d 0a20 2020 2020  ndnorm_",..     
+00006860: 2020 2020 2020 2022 726f 6c6c 696e 675f         "rolling_
+00006870: 7472 656e 645f 222c 0d0a 2020 2020 2020  trend_",..      
+00006880: 2020 2020 2020 2272 616e 646f 6d77 616c        "randomwal
+00006890: 6b5f 222c 0d0a 2020 2020 2020 2020 5d20  k_",..        ] 
+000068a0: 2023 2022 696e 7465 7263 6570 7422 2061   # "intercept" a
+000068b0: 6464 6564 2061 6674 6572 2c20 736f 206e  dded after, so n
+000068c0: 6f74 2069 6e63 6c75 6465 640d 0a0d 0a20  ot included.... 
+000068d0: 2020 2020 2020 2023 2052 554e 204c 494e         # RUN LIN
+000068e0: 4541 5220 4d4f 4445 4c0d 0a20 2020 2020  EAR MODEL..     
+000068f0: 2020 2023 2061 6464 2078 2066 6561 7475     # add x featu
+00006900: 7265 7320 7468 6174 2064 6f6e 2774 2061  res that don't a
+00006910: 7070 6c79 2074 6f20 616c 6c2c 2061 6e64  pply to all, and
+00006920: 206e 6565 6420 746f 2062 6520 6c6f 6f70   need to be loop
+00006930: 6564 0d0a 2020 2020 2020 2020 6966 2073  ed..        if s
+00006940: 656c 662e 6c6f 6f70 5f72 6571 7569 7265  elf.loop_require
+00006950: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00006960: 7365 6c66 2e70 6172 616d 7320 3d20 7b7d  self.params = {}
+00006970: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00006980: 6c66 2e6b 6565 705f 636f 6c73 203d 207b  lf.keep_cols = {
+00006990: 7d0d 0a20 2020 2020 2020 2020 2020 2073  }..            s
+000069a0: 656c 662e 785f 6172 7261 7920 3d20 7b7d  elf.x_array = {}
+000069b0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000069c0: 6c66 2e6b 6565 705f 636f 6c73 5f69 6478  lf.keep_cols_idx
+000069d0: 203d 207b 7d0d 0a20 2020 2020 2020 2020   = {}..         
+000069e0: 2020 2073 656c 662e 636f 6c5f 6772 6f75     self.col_grou
+000069f0: 7069 6e67 7320 3d20 7b7d 0d0a 2020 2020  pings = {}..    
+00006a00: 2020 2020 2020 2020 7472 656e 645f 7265          trend_re
+00006a10: 7369 6475 616c 7320 3d20 5b5d 0d0a 2020  siduals = []..  
+00006a20: 2020 2020 2020 2020 2020 666f 7220 636f            for co
+00006a30: 6c20 696e 2073 656c 662e 6466 2e63 6f6c  l in self.df.col
+00006a40: 756d 6e73 3a0d 0a20 2020 2020 2020 2020  umns:..         
+00006a50: 2020 2020 2020 2063 5f78 203d 2078 5f61         c_x = x_a
+00006a60: 7272 6179 2e63 6f70 7928 290d 0a20 2020  rray.copy()..   
+00006a70: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00006a80: 6d70 6c65 6d65 6e74 2070 6572 5f73 6572  mplement per_ser
+00006a90: 6965 7320 686f 6c69 6461 7920 636f 756e  ies holiday coun
+00006aa0: 7472 6965 7320 666c 6167 0d0a 2020 2020  tries flag..    
+00006ab0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00006ac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006ad0: 2020 2020 2020 6973 696e 7374 616e 6365        isinstance
+00006ae0: 2873 656c 662e 686f 6c69 6461 795f 636f  (self.holiday_co
+00006af0: 756e 7472 6965 732c 2064 6963 7429 0d0a  untries, dict)..
+00006b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b10: 2020 2020 616e 6420 7365 6c66 2e68 6f6c      and self.hol
+00006b20: 6964 6179 5f63 6f75 6e74 7269 6573 5f75  iday_countries_u
+00006b30: 7365 640d 0a20 2020 2020 2020 2020 2020  sed..           
+00006b40: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
+00006b50: 2020 2020 2020 2020 2020 2020 2068 6320               hc 
+00006b60: 3d20 7365 6c66 2e68 6f6c 6964 6179 5f63  = self.holiday_c
+00006b70: 6f75 6e74 7269 6573 2e67 6574 2863 6f6c  ountries.get(col
+00006b80: 2c20 4e6f 6e65 290d 0a20 2020 2020 2020  , None)..       
+00006b90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00006ba0: 6863 2069 7320 6e6f 7420 4e6f 6e65 3a0d  hc is not None:.
+00006bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006bc0: 2020 2020 2020 2020 2063 5f68 6320 3d20           c_hc = 
+00006bd0: 686f 6c69 6461 795f 666c 6167 280d 0a20  holiday_flag(.. 
 00006be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006bf0: 2020 2020 2020 2020 2020 2065 6e63 6f64             encod
-00006c00: 655f 686f 6c69 6461 795f 7479 7065 3d54  e_holiday_type=T
-00006c10: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
-00006c20: 2020 2020 2020 2020 2020 2020 2020 292e                ).
-00006c30: 7265 6e61 6d65 2863 6f6c 756d 6e73 3d6c  rename(columns=l
-00006c40: 616d 6264 6120 783a 2022 686f 6c69 6461  ambda x: "holida
-00006c50: 795f 2220 2b20 7374 7228 7829 290d 0a20  y_" + str(x)).. 
-00006c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c70: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00006c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c90: 2020 635f 6863 203d 2070 642e 4461 7461    c_hc = pd.Data
-00006ca0: 4672 616d 6528 0d0a 2020 2020 2020 2020  Frame(..        
-00006cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cc0: 2020 2020 302c 2069 6e64 6578 3d73 656c      0, index=sel
-00006cd0: 662e 6466 2e69 6e64 6578 2c20 636f 6c75  f.df.index, colu
-00006ce0: 6d6e 733d 5b22 686f 6c69 6461 795f 3022  mns=["holiday_0"
-00006cf0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00006d00: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00006d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d20: 2020 635f 7820 3d20 7064 2e63 6f6e 6361    c_x = pd.conca
-00006d30: 7428 5b63 5f78 2c20 635f 6863 5d2c 2061  t([c_x, c_hc], a
-00006d40: 7869 733d 3129 0d0a 2020 2020 2020 2020  xis=1)..        
-00006d50: 2020 2020 2020 2020 2320 696d 706c 656d          # implem
-00006d60: 656e 7420 7265 6772 6573 736f 7273 2070  ent regressors p
-00006d70: 6572 2073 6572 6965 730d 0a20 2020 2020  er series..     
-00006d80: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00006d90: 696e 7374 616e 6365 2872 6567 7265 7373  instance(regress
-00006da0: 6f72 5f70 6572 5f73 6572 6965 732c 2064  or_per_series, d
-00006db0: 6963 7429 2061 6e64 2073 656c 662e 7265  ict) and self.re
-00006dc0: 6772 6573 736f 7273 5f75 7365 643a 0d0a  gressors_used:..
+00006bf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006c00: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
+00006c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c20: 2020 2020 2020 2063 6f75 6e74 7279 3d68         country=h
+00006c30: 632c 0d0a 2020 2020 2020 2020 2020 2020  c,..            
+00006c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c50: 656e 636f 6465 5f68 6f6c 6964 6179 5f74  encode_holiday_t
+00006c60: 7970 653d 5472 7565 2c0d 0a20 2020 2020  ype=True,..     
+00006c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c80: 2020 2029 2e72 656e 616d 6528 636f 6c75     ).rename(colu
+00006c90: 6d6e 733d 6c61 6d62 6461 2078 3a20 2268  mns=lambda x: "h
+00006ca0: 6f6c 6964 6179 5f22 202b 2073 7472 2878  oliday_" + str(x
+00006cb0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00006cc0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00006cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ce0: 2020 2020 2020 2063 5f68 6320 3d20 7064         c_hc = pd
+00006cf0: 2e44 6174 6146 7261 6d65 280d 0a20 2020  .DataFrame(..   
+00006d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d10: 2020 2020 2020 2020 2030 2c20 696e 6465           0, inde
+00006d20: 783d 7365 6c66 2e64 662e 696e 6465 782c  x=self.df.index,
+00006d30: 2063 6f6c 756d 6e73 3d5b 2268 6f6c 6964   columns=["holid
+00006d40: 6179 5f30 225d 0d0a 2020 2020 2020 2020  ay_0"]..        
+00006d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00006d70: 2020 2020 2020 2063 5f78 203d 2070 642e         c_x = pd.
+00006d80: 636f 6e63 6174 285b 635f 782c 2063 5f68  concat([c_x, c_h
+00006d90: 635d 2c20 6178 6973 3d31 290d 0a20 2020  c], axis=1)..   
+00006da0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00006db0: 6d70 6c65 6d65 6e74 2072 6567 7265 7373  mplement regress
+00006dc0: 6f72 7320 7065 7220 7365 7269 6573 0d0a  ors per series..
 00006dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006de0: 2020 2020 6863 203d 2072 6567 7265 7373      hc = regress
-00006df0: 6f72 5f70 6572 5f73 6572 6965 732e 6765  or_per_series.ge
-00006e00: 7428 636f 6c2c 204e 6f6e 6529 0d0a 2020  t(col, None)..  
-00006e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e20: 2020 6966 2068 6320 6973 206e 6f74 204e    if hc is not N
-00006e30: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00006e40: 2020 2020 2020 2020 2020 2020 2020 635f                c_
-00006e50: 6863 203d 2028 0d0a 2020 2020 2020 2020  hc = (..        
-00006e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e70: 2020 2020 7064 2e44 6174 6146 7261 6d65      pd.DataFrame
-00006e80: 2868 6329 0d0a 2020 2020 2020 2020 2020  (hc)..          
+00006de0: 6966 2069 7369 6e73 7461 6e63 6528 7265  if isinstance(re
+00006df0: 6772 6573 736f 725f 7065 725f 7365 7269  gressor_per_seri
+00006e00: 6573 2c20 6469 6374 2920 616e 6420 7365  es, dict) and se
+00006e10: 6c66 2e72 6567 7265 7373 6f72 735f 7573  lf.regressors_us
+00006e20: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+00006e30: 2020 2020 2020 2020 2068 6320 3d20 7265           hc = re
+00006e40: 6772 6573 736f 725f 7065 725f 7365 7269  gressor_per_seri
+00006e50: 6573 2e67 6574 2863 6f6c 2c20 4e6f 6e65  es.get(col, None
+00006e60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00006e70: 2020 2020 2020 2069 6620 6863 2069 7320         if hc is 
+00006e80: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
 00006e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ea0: 2020 2e72 656e 616d 6528 636f 6c75 6d6e    .rename(column
-00006eb0: 733d 6c61 6d62 6461 2078 3a20 2272 6567  s=lambda x: "reg
-00006ec0: 7270 6572 7365 7269 6573 5f22 202b 2073  rperseries_" + s
-00006ed0: 7472 2878 2929 0d0a 2020 2020 2020 2020  tr(x))..        
+00006ea0: 2020 2063 5f68 6320 3d20 280d 0a20 2020     c_hc = (..   
+00006eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ec0: 2020 2020 2020 2020 2070 642e 4461 7461           pd.Data
+00006ed0: 4672 616d 6528 6863 290d 0a20 2020 2020  Frame(hc)..     
 00006ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ef0: 2020 2020 2e72 6569 6e64 6578 2873 656c      .reindex(sel
-00006f00: 662e 6466 2e69 6e64 6578 290d 0a20 2020  f.df.index)..   
-00006f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f20: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00006f30: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00006f40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00006f50: 2020 2020 2020 2020 2020 2063 5f68 6320             c_hc 
-00006f60: 3d20 7064 2e44 6174 6146 7261 6d65 280d  = pd.DataFrame(.
-00006f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006f80: 2020 2020 2020 2020 2020 2020 2030 2c20               0, 
-00006f90: 696e 6465 783d 7365 6c66 2e64 662e 696e  index=self.df.in
-00006fa0: 6465 782c 2063 6f6c 756d 6e73 3d5b 2272  dex, columns=["r
-00006fb0: 6567 7270 6572 7365 7269 6573 5f30 225d  egrperseries_0"]
-00006fc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006fd0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00006fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ff0: 2063 5f78 203d 2070 642e 636f 6e63 6174   c_x = pd.concat
-00007000: 285b 635f 782c 2063 5f68 635d 2c20 6178  ([c_x, c_hc], ax
-00007010: 6973 3d31 290d 0a20 2020 2020 2020 2020  is=1)..         
-00007020: 2020 2020 2020 2023 2069 6d70 6c65 6d65         # impleme
-00007030: 6e74 2070 6173 745f 696d 7061 6374 7320  nt past_impacts 
-00007040: 6173 2072 6567 7265 7373 6f72 0d0a 2020  as regressor..  
-00007050: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00007060: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-00007070: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
-00007080: 6365 2870 6173 745f 696d 7061 6374 732c  ce(past_impacts,
-00007090: 2070 642e 4461 7461 4672 616d 6529 0d0a   pd.DataFrame)..
-000070a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070b0: 2020 2020 616e 6420 7365 6c66 2e70 6173      and self.pas
-000070c0: 745f 696d 7061 6374 735f 696e 7465 7276  t_impacts_interv
-000070d0: 656e 7469 6f6e 203d 3d20 2272 6567 7265  ention == "regre
-000070e0: 7373 6f72 220d 0a20 2020 2020 2020 2020  ssor"..         
-000070f0: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
-00007100: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00007110: 5f78 203d 2070 642e 636f 6e63 6174 280d  _x = pd.concat(.
-00007120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007130: 2020 2020 2020 2020 205b 0d0a 2020 2020           [..    
-00007140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007150: 2020 2020 2020 2020 635f 782c 0d0a 2020          c_x,..  
-00007160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007170: 2020 2020 2020 2020 2020 7061 7374 5f69            past_i
-00007180: 6d70 6163 7473 5b63 6f6c 5d0d 0a20 2020  mpacts[col]..   
-00007190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000071a0: 2020 2020 2020 2020 202e 746f 5f66 7261           .to_fra
-000071b0: 6d65 2829 0d0a 2020 2020 2020 2020 2020  me()..          
-000071c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000071d0: 2020 2e72 656e 616d 6528 636f 6c75 6d6e    .rename(column
-000071e0: 733d 6c61 6d62 6461 2078 3a20 2269 6d70  s=lambda x: "imp
-000071f0: 6163 7473 5f22 202b 2073 7472 2878 2929  acts_" + str(x))
-00007200: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00007210: 2020 2020 2020 2020 2020 205d 2c0d 0a20             ],.. 
-00007220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007230: 2020 2020 2020 2061 7869 733d 312c 0d0a         axis=1,..
-00007240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007250: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-00007260: 2020 2020 2020 2023 2061 6464 2041 5220         # add AR 
-00007270: 6665 6174 7572 6573 0d0a 2020 2020 2020  features..      
-00007280: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00007290: 662e 6172 5f6c 6167 7320 6973 206e 6f74  f.ar_lags is not
-000072a0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000072b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000072c0: 6c61 6720 696e 2073 656c 662e 6172 5f6c  lag in self.ar_l
-000072d0: 6167 733a 0d0a 2020 2020 2020 2020 2020  ags:..          
-000072e0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-000072f0: 675f 6964 7820 3d20 6e70 2e63 6f6e 6361  g_idx = np.conca
-00007300: 7465 6e61 7465 280d 0a20 2020 2020 2020  tenate(..       
-00007310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007320: 2020 2020 205b 6e70 2e72 6570 6561 7428       [np.repeat(
-00007330: 5b30 5d2c 206c 6167 292c 206e 702e 6172  [0], lag), np.ar
-00007340: 616e 6765 286c 656e 2873 656c 662e 6466  ange(len(self.df
-00007350: 2929 5d0d 0a20 2020 2020 2020 2020 2020  ))]..           
-00007360: 2020 2020 2020 2020 2020 2020 2029 5b30               )[0
-00007370: 203a 206c 656e 2873 656c 662e 6466 295d   : len(self.df)]
-00007380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007390: 2020 2020 2020 2020 2020 6c61 675f 7320            lag_s 
-000073a0: 3d20 7365 6c66 2e64 665b 636f 6c5d 2e69  = self.df[col].i
-000073b0: 6c6f 635b 6c61 675f 6964 785d 2e72 656e  loc[lag_idx].ren
-000073c0: 616d 6528 6622 6c61 677b 6c61 677d 5f22  ame(f"lag{lag}_"
-000073d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000073e0: 2020 2020 2020 2020 2020 206c 6167 5f73             lag_s
-000073f0: 2e69 6e64 6578 203d 2073 656c 662e 6466  .index = self.df
-00007400: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
-00007410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007420: 6966 2073 656c 662e 6172 5f69 6e74 6572  if self.ar_inter
-00007430: 6163 7469 6f6e 5f73 6561 736f 6e61 6c69  action_seasonali
-00007440: 7479 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ty is not None:.
-00007450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007460: 2020 2020 2020 2020 2020 2020 2073 5f66               s_f
-00007470: 6561 7420 3d20 6372 6561 7465 5f73 6561  eat = create_sea
-00007480: 736f 6e61 6c69 7479 5f66 6561 7475 7265  sonality_feature
-00007490: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-000074a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074b0: 2020 2073 656c 662e 6466 2e69 6e64 6578     self.df.index
-000074c0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000074d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074e0: 2020 2073 656c 662e 745f 7472 6169 6e2c     self.t_train,
-000074f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007510: 2020 7365 6c66 2e61 725f 696e 7465 7261    self.ar_intera
-00007520: 6374 696f 6e5f 7365 6173 6f6e 616c 6974  ction_seasonalit
-00007530: 792c 0d0a 2020 2020 2020 2020 2020 2020  y,..            
-00007540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007550: 2020 2020 6869 7374 6f72 795f 6461 7973      history_days
-00007560: 3d73 656c 662e 6869 7374 6f72 795f 6461  =self.history_da
-00007570: 7973 2c0d 0a20 2020 2020 2020 2020 2020  ys,..           
-00007580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007590: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-000075a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075b0: 735f 6665 6174 2e69 6e64 6578 203d 206c  s_feat.index = l
-000075c0: 6167 5f73 2e69 6e64 6578 0d0a 2020 2020  ag_s.index..    
+00006ef0: 2020 2020 2020 202e 7265 6e61 6d65 2863         .rename(c
+00006f00: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
+00006f10: 2022 7265 6772 7065 7273 6572 6965 735f   "regrperseries_
+00006f20: 2220 2b20 7374 7228 7829 290d 0a20 2020  " + str(x))..   
+00006f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f40: 2020 2020 2020 2020 202e 7265 696e 6465           .reinde
+00006f50: 7828 7365 6c66 2e64 662e 696e 6465 7829  x(self.df.index)
+00006f60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006f70: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f90: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00006fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fb0: 635f 6863 203d 2070 642e 4461 7461 4672  c_hc = pd.DataFr
+00006fc0: 616d 6528 0d0a 2020 2020 2020 2020 2020  ame(..          
+00006fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fe0: 2020 302c 2069 6e64 6578 3d73 656c 662e    0, index=self.
+00006ff0: 6466 2e69 6e64 6578 2c20 636f 6c75 6d6e  df.index, column
+00007000: 733d 5b22 7265 6772 7065 7273 6572 6965  s=["regrperserie
+00007010: 735f 3022 5d0d 0a20 2020 2020 2020 2020  s_0"]..         
+00007020: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00007030: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007040: 2020 2020 2020 635f 7820 3d20 7064 2e63        c_x = pd.c
+00007050: 6f6e 6361 7428 5b63 5f78 2c20 635f 6863  oncat([c_x, c_hc
+00007060: 5d2c 2061 7869 733d 3129 0d0a 2020 2020  ], axis=1)..    
+00007070: 2020 2020 2020 2020 2020 2020 2320 696d              # im
+00007080: 706c 656d 656e 7420 7061 7374 5f69 6d70  plement past_imp
+00007090: 6163 7473 2061 7320 7265 6772 6573 736f  acts as regresso
+000070a0: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
+000070b0: 2020 2069 6620 280d 0a20 2020 2020 2020     if (..       
+000070c0: 2020 2020 2020 2020 2020 2020 2069 7369               isi
+000070d0: 6e73 7461 6e63 6528 7061 7374 5f69 6d70  nstance(past_imp
+000070e0: 6163 7473 2c20 7064 2e44 6174 6146 7261  acts, pd.DataFra
+000070f0: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
+00007100: 2020 2020 2020 2020 2061 6e64 2073 656c           and sel
+00007110: 662e 7061 7374 5f69 6d70 6163 7473 5f69  f.past_impacts_i
+00007120: 6e74 6572 7665 6e74 696f 6e20 3d3d 2022  ntervention == "
+00007130: 7265 6772 6573 736f 7222 0d0a 2020 2020  regressor"..    
+00007140: 2020 2020 2020 2020 2020 2020 293a 0d0a              ):..
+00007150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007160: 2020 2020 635f 7820 3d20 7064 2e63 6f6e      c_x = pd.con
+00007170: 6361 7428 0d0a 2020 2020 2020 2020 2020  cat(..          
+00007180: 2020 2020 2020 2020 2020 2020 2020 5b0d                [.
+00007190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000071a0: 2020 2020 2020 2020 2020 2020 2063 5f78               c_x
+000071b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000071c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000071d0: 6173 745f 696d 7061 6374 735b 636f 6c5d  ast_impacts[col]
+000071e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000071f0: 2020 2020 2020 2020 2020 2020 2020 2e74                .t
+00007200: 6f5f 6672 616d 6528 290d 0a20 2020 2020  o_frame()..     
+00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007220: 2020 2020 2020 202e 7265 6e61 6d65 2863         .rename(c
+00007230: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
+00007240: 2022 696d 7061 6374 735f 2220 2b20 7374   "impacts_" + st
+00007250: 7228 7829 292c 0d0a 2020 2020 2020 2020  r(x)),..        
+00007260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007270: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00007280: 2020 2020 2020 2020 2020 2020 6178 6973              axis
+00007290: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
+000072a0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+000072b0: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
+000072c0: 6420 4152 2066 6561 7475 7265 730d 0a20  d AR features.. 
+000072d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000072e0: 6620 7365 6c66 2e61 725f 6c61 6773 2069  f self.ar_lags i
+000072f0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00007300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007310: 2066 6f72 206c 6167 2069 6e20 7365 6c66   for lag in self
+00007320: 2e61 725f 6c61 6773 3a0d 0a20 2020 2020  .ar_lags:..     
+00007330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007340: 2020 206c 6167 5f69 6478 203d 206e 702e     lag_idx = np.
+00007350: 636f 6e63 6174 656e 6174 6528 0d0a 2020  concatenate(..  
+00007360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007370: 2020 2020 2020 2020 2020 5b6e 702e 7265            [np.re
+00007380: 7065 6174 285b 305d 2c20 6c61 6729 2c20  peat([0], lag), 
+00007390: 6e70 2e61 7261 6e67 6528 6c65 6e28 7365  np.arange(len(se
+000073a0: 6c66 2e64 6629 295d 0d0a 2020 2020 2020  lf.df))]..      
+000073b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000073c0: 2020 295b 3020 3a20 6c65 6e28 7365 6c66    )[0 : len(self
+000073d0: 2e64 6629 5d0d 0a20 2020 2020 2020 2020  .df)]..         
+000073e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000073f0: 6167 5f73 203d 2073 656c 662e 6466 5b63  ag_s = self.df[c
+00007400: 6f6c 5d2e 696c 6f63 5b6c 6167 5f69 6478  ol].iloc[lag_idx
+00007410: 5d2e 7265 6e61 6d65 2866 226c 6167 7b6c  ].rename(f"lag{l
+00007420: 6167 7d5f 2229 0d0a 2020 2020 2020 2020  ag}_")..        
+00007430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007440: 6c61 675f 732e 696e 6465 7820 3d20 7365  lag_s.index = se
+00007450: 6c66 2e64 662e 696e 6465 780d 0a20 2020  lf.df.index..   
+00007460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007470: 2020 2020 2069 6620 7365 6c66 2e61 725f       if self.ar_
+00007480: 696e 7465 7261 6374 696f 6e5f 7365 6173  interaction_seas
+00007490: 6f6e 616c 6974 7920 6973 206e 6f74 204e  onality is not N
+000074a0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000074b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000074c0: 2020 735f 6665 6174 203d 2063 7265 6174    s_feat = creat
+000074d0: 655f 7365 6173 6f6e 616c 6974 795f 6665  e_seasonality_fe
+000074e0: 6174 7572 6528 0d0a 2020 2020 2020 2020  ature(..        
+000074f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007500: 2020 2020 2020 2020 7365 6c66 2e64 662e          self.df.
+00007510: 696e 6465 782c 0d0a 2020 2020 2020 2020  index,..        
+00007520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007530: 2020 2020 2020 2020 7365 6c66 2e74 5f74          self.t_t
+00007540: 7261 696e 2c0d 0a20 2020 2020 2020 2020  rain,..         
+00007550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007560: 2020 2020 2020 2073 656c 662e 6172 5f69         self.ar_i
+00007570: 6e74 6572 6163 7469 6f6e 5f73 6561 736f  nteraction_seaso
+00007580: 6e61 6c69 7479 2c0d 0a20 2020 2020 2020  nality,..       
+00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075a0: 2020 2020 2020 2020 2068 6973 746f 7279           history
+000075b0: 5f64 6179 733d 7365 6c66 2e68 6973 746f  _days=self.histo
+000075c0: 7279 5f64 6179 732c 0d0a 2020 2020 2020  ry_days,..      
 000075d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075e0: 2020 2020 2020 2020 6c61 675f 7320 3d20          lag_s = 
-000075f0: 735f 6665 6174 2e6d 756c 286c 6167 5f73  s_feat.mul(lag_s
-00007600: 2c20 6178 6973 3d30 292e 7265 6e61 6d65  , axis=0).rename
-00007610: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00007620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007630: 2020 2063 6f6c 756d 6e73 3d6c 616d 6264     columns=lambd
-00007640: 6120 783a 2066 226c 6167 7b6c 6167 7d5f  a x: f"lag{lag}_
-00007650: 2220 2b20 7374 7228 7829 0d0a 2020 2020  " + str(x)..    
-00007660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007670: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00007680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007690: 2020 2063 5f78 203d 2070 642e 636f 6e63     c_x = pd.conc
-000076a0: 6174 285b 635f 782c 206c 6167 5f73 5d2c  at([c_x, lag_s],
-000076b0: 2061 7869 733d 3129 0d0a 2020 2020 2020   axis=1)..      
-000076c0: 2020 2020 2020 2020 2020 2320 4e4f 5445            # NOTE
-000076d0: 2054 4845 5245 2049 5320 4e4f 2052 454d   THERE IS NO REM
-000076e0: 4f56 494e 4720 4f46 2043 4f4c 494e 4541  OVING OF COLINEA
-000076f0: 5220 4645 4154 5552 4553 2041 4444 4544  R FEATURES ADDED
-00007700: 2048 4552 450d 0a20 2020 2020 2020 2020   HERE..         
-00007710: 2020 2020 2020 2073 656c 662e 6b65 6570         self.keep
-00007720: 5f63 6f6c 735b 636f 6c5d 203d 2063 5f78  _cols[col] = c_x
-00007730: 2e63 6f6c 756d 6e73 5b0d 0a20 2020 2020  .columns[..     
-00007740: 2020 2020 2020 2020 2020 2020 2020 207e                 ~
-00007750: 635f 782e 636f 6c75 6d6e 732e 7374 722e  c_x.columns.str.
-00007760: 636f 6e74 6169 6e73 2822 7c22 2e6a 6f69  contains("|".joi
-00007770: 6e28 7265 6d6f 7665 5f70 6174 7465 726e  n(remove_pattern
-00007780: 7329 290d 0a20 2020 2020 2020 2020 2020  s))..           
-00007790: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
-000077a0: 2020 2020 2020 2020 7365 6c66 2e6b 6565          self.kee
-000077b0: 705f 636f 6c73 5f69 6478 5b63 6f6c 5d20  p_cols_idx[col] 
-000077c0: 3d20 635f 782e 636f 6c75 6d6e 732e 6765  = c_x.columns.ge
-000077d0: 745f 696e 6465 7865 725f 666f 7228 0d0a  t_indexer_for(..
-000077e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077f0: 2020 2020 7365 6c66 2e6b 6565 705f 636f      self.keep_co
-00007800: 6c73 5b63 6f6c 5d0d 0a20 2020 2020 2020  ls[col]..       
-00007810: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-00007820: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007830: 2e63 6f6c 5f67 726f 7570 696e 6773 5b63  .col_groupings[c
-00007840: 6f6c 5d20 3d20 280d 0a20 2020 2020 2020  ol] = (..       
-00007850: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00007860: 662e 6b65 6570 5f63 6f6c 735b 636f 6c5d  f.keep_cols[col]
-00007870: 2e73 7472 2e70 6172 7469 7469 6f6e 2822  .str.partition("
-00007880: 5f22 292e 6765 745f 6c65 7665 6c5f 7661  _").get_level_va
-00007890: 6c75 6573 2830 290d 0a20 2020 2020 2020  lues(0)..       
-000078a0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-000078b0: 2020 2020 2020 2020 2020 2020 635f 785b              c_x[
-000078c0: 2769 6e74 6572 6365 7074 275d 203d 2031  'intercept'] = 1
-000078d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000078e0: 2020 7365 6c66 2e78 5f61 7272 6179 5b63    self.x_array[c
-000078f0: 6f6c 5d20 3d20 635f 780d 0a20 2020 2020  ol] = c_x..     
-00007900: 2020 2020 2020 2020 2020 2023 2041 4444             # ADD
-00007910: 494e 4720 5245 4345 4e43 5920 5745 4947  ING RECENCY WEIG
-00007920: 4854 494e 4720 414e 4420 5249 4447 4520  HTING AND RIDGE 
-00007930: 5041 5241 4d53 0d0a 2020 2020 2020 2020  PARAMS..        
-00007940: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-00007950: 616d 735b 636f 6c5d 203d 206c 696e 6561  ams[col] = linea
-00007960: 725f 6d6f 6465 6c28 0d0a 2020 2020 2020  r_model(..      
-00007970: 2020 2020 2020 2020 2020 2020 2020 635f                c_
-00007980: 782c 2073 656c 662e 6466 5b63 6f6c 5d2e  x, self.df[col].
-00007990: 746f 5f66 7261 6d65 2829 2c20 7061 7261  to_frame(), para
-000079a0: 6d73 3d73 656c 662e 6c69 6e65 6172 5f6d  ms=self.linear_m
-000079b0: 6f64 656c 0d0a 2020 2020 2020 2020 2020  odel..          
-000079c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000079d0: 2020 2020 2020 2020 2074 7265 6e64 5f72           trend_r
-000079e0: 6573 6964 7561 6c73 2e61 7070 656e 6428  esiduals.append(
-000079f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007a00: 2020 2020 2020 7365 6c66 2e64 665b 636f        self.df[co
-00007a10: 6c5d 0d0a 2020 2020 2020 2020 2020 2020  l]..            
-00007a20: 2020 2020 2020 2020 2d20 7064 2e53 6572          - pd.Ser
-00007a30: 6965 7328 0d0a 2020 2020 2020 2020 2020  ies(..          
-00007a40: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-00007a50: 2e64 6f74 280d 0a20 2020 2020 2020 2020  .dot(..         
-00007a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a70: 2020 2063 5f78 5b73 656c 662e 6b65 6570     c_x[self.keep
-00007a80: 5f63 6f6c 735b 636f 6c5d 5d2c 0d0a 2020  _cols[col]],..  
+000075e0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000075f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007600: 2020 2020 2073 5f66 6561 742e 696e 6465       s_feat.inde
+00007610: 7820 3d20 6c61 675f 732e 696e 6465 780d  x = lag_s.index.
+00007620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007630: 2020 2020 2020 2020 2020 2020 206c 6167               lag
+00007640: 5f73 203d 2073 5f66 6561 742e 6d75 6c28  _s = s_feat.mul(
+00007650: 6c61 675f 732c 2061 7869 733d 3029 2e72  lag_s, axis=0).r
+00007660: 656e 616d 6528 0d0a 2020 2020 2020 2020  ename(..        
+00007670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007680: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
+00007690: 6c61 6d62 6461 2078 3a20 6622 6c61 677b  lambda x: f"lag{
+000076a0: 6c61 677d 5f22 202b 2073 7472 2878 290d  lag}_" + str(x).
+000076b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000076c0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+000076d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076e0: 2020 2020 2020 2020 635f 7820 3d20 7064          c_x = pd
+000076f0: 2e63 6f6e 6361 7428 5b63 5f78 2c20 6c61  .concat([c_x, la
+00007700: 675f 735d 2c20 6178 6973 3d31 290d 0a20  g_s], axis=1).. 
+00007710: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00007720: 204e 4f54 4520 5448 4552 4520 4953 204e   NOTE THERE IS N
+00007730: 4f20 5245 4d4f 5649 4e47 204f 4620 434f  O REMOVING OF CO
+00007740: 4c49 4e45 4152 2046 4541 5455 5245 5320  LINEAR FEATURES 
+00007750: 4144 4445 4420 4845 5245 0d0a 2020 2020  ADDED HERE..    
+00007760: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007770: 2e6b 6565 705f 636f 6c73 5b63 6f6c 5d20  .keep_cols[col] 
+00007780: 3d20 635f 782e 636f 6c75 6d6e 735b 0d0a  = c_x.columns[..
+00007790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000077a0: 2020 2020 7e63 5f78 2e63 6f6c 756d 6e73      ~c_x.columns
+000077b0: 2e73 7472 2e63 6f6e 7461 696e 7328 227c  .str.contains("|
+000077c0: 222e 6a6f 696e 2872 656d 6f76 655f 7061  ".join(remove_pa
+000077d0: 7474 6572 6e73 2929 0d0a 2020 2020 2020  tterns))..      
+000077e0: 2020 2020 2020 2020 2020 5d0d 0a20 2020            ]..   
+000077f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00007800: 662e 6b65 6570 5f63 6f6c 735f 6964 785b  f.keep_cols_idx[
+00007810: 636f 6c5d 203d 2063 5f78 2e63 6f6c 756d  col] = c_x.colum
+00007820: 6e73 2e67 6574 5f69 6e64 6578 6572 5f66  ns.get_indexer_f
+00007830: 6f72 280d 0a20 2020 2020 2020 2020 2020  or(..           
+00007840: 2020 2020 2020 2020 2073 656c 662e 6b65           self.ke
+00007850: 6570 5f63 6f6c 735b 636f 6c5d 0d0a 2020  ep_cols[col]..  
+00007860: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00007870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007880: 2073 656c 662e 636f 6c5f 6772 6f75 7069   self.col_groupi
+00007890: 6e67 735b 636f 6c5d 203d 2028 0d0a 2020  ngs[col] = (..  
+000078a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078b0: 2020 7365 6c66 2e6b 6565 705f 636f 6c73    self.keep_cols
+000078c0: 5b63 6f6c 5d2e 7374 722e 7061 7274 6974  [col].str.partit
+000078d0: 696f 6e28 225f 2229 2e67 6574 5f6c 6576  ion("_").get_lev
+000078e0: 656c 5f76 616c 7565 7328 3029 0d0a 2020  el_values(0)..  
+000078f0: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00007900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007910: 2063 5f78 5b27 696e 7465 7263 6570 7427   c_x['intercept'
+00007920: 5d20 3d20 310d 0a20 2020 2020 2020 2020  ] = 1..         
+00007930: 2020 2020 2020 2073 656c 662e 785f 6172         self.x_ar
+00007940: 7261 795b 636f 6c5d 203d 2063 5f78 0d0a  ray[col] = c_x..
+00007950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007960: 2320 4144 4449 4e47 2052 4543 454e 4359  # ADDING RECENCY
+00007970: 2057 4549 4748 5449 4e47 2041 4e44 2052   WEIGHTING AND R
+00007980: 4944 4745 2050 4152 414d 530d 0a20 2020  IDGE PARAMS..   
+00007990: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000079a0: 662e 7061 7261 6d73 5b63 6f6c 5d20 3d20  f.params[col] = 
+000079b0: 6c69 6e65 6172 5f6d 6f64 656c 280d 0a20  linear_model(.. 
+000079c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079d0: 2020 2063 5f78 2c20 7365 6c66 2e64 665b     c_x, self.df[
+000079e0: 636f 6c5d 2e74 6f5f 6672 616d 6528 292c  col].to_frame(),
+000079f0: 2070 6172 616d 733d 7365 6c66 2e6c 696e   params=self.lin
+00007a00: 6561 725f 6d6f 6465 6c0d 0a20 2020 2020  ear_model..     
+00007a10: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00007a20: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00007a30: 656e 645f 7265 7369 6475 616c 732e 6170  end_residuals.ap
+00007a40: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
+00007a50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007a60: 6466 5b63 6f6c 5d0d 0a20 2020 2020 2020  df[col]..       
+00007a70: 2020 2020 2020 2020 2020 2020 202d 2070               - p
+00007a80: 642e 5365 7269 6573 280d 0a20 2020 2020  d.Series(..     
 00007a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007aa0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00007ab0: 6172 616d 735b 636f 6c5d 5b73 656c 662e  arams[col][self.
-00007ac0: 6b65 6570 5f63 6f6c 735f 6964 785b 636f  keep_cols_idx[co
-00007ad0: 6c5d 5d2c 0d0a 2020 2020 2020 2020 2020  l]],..          
-00007ae0: 2020 2020 2020 2020 2020 2020 2020 292e                ).
-00007af0: 666c 6174 7465 6e28 292c 0d0a 2020 2020  flatten(),..    
-00007b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b10: 2020 2020 6e61 6d65 3d63 6f6c 2c0d 0a20      name=col,.. 
-00007b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b30: 2020 2020 2020 2069 6e64 6578 3d73 656c         index=sel
-00007b40: 662e 6466 2e69 6e64 6578 2c0d 0a20 2020  f.df.index,..   
-00007b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b60: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-00007b70: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-00007b80: 2020 2074 7265 6e64 5f72 6573 6964 7561     trend_residua
-00007b90: 6c73 203d 2070 642e 636f 6e63 6174 2874  ls = pd.concat(t
-00007ba0: 7265 6e64 5f72 6573 6964 7561 6c73 2c20  rend_residuals, 
-00007bb0: 6178 6973 3d31 290d 0a20 2020 2020 2020  axis=1)..       
-00007bc0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00007bd0: 2020 2020 2320 5255 4e20 4c49 4e45 4152      # RUN LINEAR
-00007be0: 204d 4f44 454c 2c20 5748 454e 204e 4f20   MODEL, WHEN NO 
-00007bf0: 4c4f 4f50 4544 2046 4541 5455 5245 530d  LOOPED FEATURES.
-00007c00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00007c10: 662e 6b65 6570 5f63 6f6c 7320 3d20 785f  f.keep_cols = x_
-00007c20: 6172 7261 792e 636f 6c75 6d6e 735b 0d0a  array.columns[..
-00007c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c40: 7e78 5f61 7272 6179 2e63 6f6c 756d 6e73  ~x_array.columns
-00007c50: 2e73 7472 2e63 6f6e 7461 696e 7328 227c  .str.contains("|
-00007c60: 222e 6a6f 696e 2872 656d 6f76 655f 7061  ".join(remove_pa
-00007c70: 7474 6572 6e73 2929 0d0a 2020 2020 2020  tterns))..      
-00007c80: 2020 2020 2020 5d0d 0a20 2020 2020 2020        ]..       
-00007c90: 2020 2020 2073 656c 662e 6b65 6570 5f63       self.keep_c
-00007ca0: 6f6c 735f 6964 7820 3d20 785f 6172 7261  ols_idx = x_arra
-00007cb0: 792e 636f 6c75 6d6e 732e 6765 745f 696e  y.columns.get_in
-00007cc0: 6465 7865 725f 666f 7228 7365 6c66 2e6b  dexer_for(self.k
-00007cd0: 6565 705f 636f 6c73 290d 0a20 2020 2020  eep_cols)..     
-00007ce0: 2020 2020 2020 2073 656c 662e 636f 6c5f         self.col_
-00007cf0: 6772 6f75 7069 6e67 7320 3d20 7365 6c66  groupings = self
-00007d00: 2e6b 6565 705f 636f 6c73 2e73 7472 2e70  .keep_cols.str.p
-00007d10: 6172 7469 7469 6f6e 2822 5f22 292e 6765  artition("_").ge
-00007d20: 745f 6c65 7665 6c5f 7661 6c75 6573 2830  t_level_values(0
-00007d30: 290d 0a20 2020 2020 2020 2020 2020 2078  )..            x
-00007d40: 5f61 7272 6179 5b27 696e 7465 7263 6570  _array['intercep
-00007d50: 7427 5d20 3d20 310d 0a20 2020 2020 2020  t'] = 1..       
-00007d60: 2020 2020 2023 2072 756e 206d 6f64 656c       # run model
-00007d70: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00007d80: 6c66 2e70 6172 616d 7320 3d20 6c69 6e65  lf.params = line
-00007d90: 6172 5f6d 6f64 656c 2878 5f61 7272 6179  ar_model(x_array
-00007da0: 2c20 7365 6c66 2e64 662c 2070 6172 616d  , self.df, param
-00007db0: 733d 7365 6c66 2e6c 696e 6561 725f 6d6f  s=self.linear_mo
-00007dc0: 6465 6c29 0d0a 2020 2020 2020 2020 2020  del)..          
-00007dd0: 2020 7472 656e 645f 7265 7369 6475 616c    trend_residual
-00007de0: 7320 3d20 7365 6c66 2e64 6620 2d20 6e70  s = self.df - np
-00007df0: 2e64 6f74 280d 0a20 2020 2020 2020 2020  .dot(..         
-00007e00: 2020 2020 2020 2078 5f61 7272 6179 5b73         x_array[s
-00007e10: 656c 662e 6b65 6570 5f63 6f6c 735d 2c20  elf.keep_cols], 
-00007e20: 7365 6c66 2e70 6172 616d 735b 7365 6c66  self.params[self
-00007e30: 2e6b 6565 705f 636f 6c73 5f69 6478 5d0d  .keep_cols_idx].
-00007e40: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-00007e50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007e60: 2e78 5f61 7272 6179 203d 2078 5f61 7272  .x_array = x_arr
-00007e70: 6179 0d0a 0d0a 2020 2020 2020 2020 2320  ay....        # 
-00007e80: 6f70 7469 6f6e 2074 6f20 7275 6e20 7472  option to run tr
-00007e90: 656e 6420 6d6f 6465 6c20 6f6e 2066 756c  end model on ful
-00007ea0: 6c20 7265 7369 6475 616c 7320 6f72 206f  l residuals or o
-00007eb0: 6e20 726f 6c6c 696e 6720 7472 656e 640d  n rolling trend.
-00007ec0: 0a20 2020 2020 2020 2069 6620 280d 0a20  .        if (.. 
-00007ed0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007ee0: 7472 656e 645f 616e 6f6d 616c 795f 6465  trend_anomaly_de
-00007ef0: 7465 6374 6f72 5f70 6172 616d 7320 6973  tector_params is
-00007f00: 206e 6f74 204e 6f6e 650d 0a20 2020 2020   not None..     
-00007f10: 2020 2020 2020 206f 7220 7365 6c66 2e74         or self.t
-00007f20: 7265 6e64 5f77 696e 646f 7720 6973 206e  rend_window is n
-00007f30: 6f74 204e 6f6e 650d 0a20 2020 2020 2020  ot None..       
-00007f40: 2029 3a0d 0a20 2020 2020 2020 2020 2020   ):..           
-00007f50: 2023 2072 6f6c 6c69 6e67 2074 7265 6e64   # rolling trend
-00007f60: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00007f70: 656e 645f 706f 7374 6572 696f 722c 2073  end_posterior, s
-00007f80: 6c6f 7065 2c20 696e 7465 7263 6570 7420  lope, intercept 
-00007f90: 3d20 7365 6c66 2e72 6f6c 6c69 6e67 5f74  = self.rolling_t
-00007fa0: 7265 6e64 280d 0a20 2020 2020 2020 2020  rend(..         
-00007fb0: 2020 2020 2020 2074 7265 6e64 5f72 6573         trend_res
-00007fc0: 6964 7561 6c73 2c20 6e70 2e61 7272 6179  iduals, np.array
-00007fd0: 2873 656c 662e 745f 7472 6169 6e29 0d0a  (self.t_train)..
-00007fe0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00007ff0: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
-00008000: 5f70 6f73 7465 7269 6f72 203d 2070 642e  _posterior = pd.
-00008010: 4461 7461 4672 616d 6528 0d0a 2020 2020  DataFrame(..    
-00008020: 2020 2020 2020 2020 2020 2020 7472 656e              tren
-00008030: 645f 706f 7374 6572 696f 722c 2069 6e64  d_posterior, ind
-00008040: 6578 3d73 656c 662e 6466 2e69 6e64 6578  ex=self.df.index
-00008050: 2c20 636f 6c75 6d6e 733d 7365 6c66 2e64  , columns=self.d
-00008060: 662e 636f 6c75 6d6e 730d 0a20 2020 2020  f.columns..     
-00008070: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00008080: 2020 2020 2020 7265 735f 6469 6620 3d20        res_dif = 
-00008090: 7472 656e 645f 7265 7369 6475 616c 7320  trend_residuals 
-000080a0: 2d20 7472 656e 645f 706f 7374 6572 696f  - trend_posterio
-000080b0: 720d 0a20 2020 2020 2020 2020 2020 2072  r..            r
-000080c0: 6573 5f75 7070 6572 203d 2072 6573 5f64  es_upper = res_d
-000080d0: 6966 5b72 6573 5f64 6966 203e 3d20 305d  if[res_dif >= 0]
-000080e0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000080f0: 735f 6c6f 7765 7220 3d20 7265 735f 6469  s_lower = res_di
-00008100: 665b 7265 735f 6469 6620 3c3d 2030 5d0d  f[res_dif <= 0].
-00008110: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008120: 662e 7265 7369 6475 616c 5f75 6e63 6572  f.residual_uncer
-00008130: 7461 696e 7479 5f75 7070 6572 203d 2072  tainty_upper = r
-00008140: 6573 5f75 7070 6572 2e6d 6561 6e28 290d  es_upper.mean().
-00008150: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008160: 662e 7265 7369 6475 616c 5f75 6e63 6572  f.residual_uncer
-00008170: 7461 696e 7479 5f6c 6f77 6572 203d 2072  tainty_lower = r
-00008180: 6573 5f6c 6f77 6572 2e6d 6561 6e28 292e  es_lower.mean().
-00008190: 6162 7328 290d 0a20 2020 2020 2020 2020  abs()..         
-000081a0: 2020 2073 656c 662e 7265 7369 6475 616c     self.residual
-000081b0: 5f75 6e63 6572 7461 696e 7479 5f75 7070  _uncertainty_upp
-000081c0: 6572 5f73 7464 203d 2072 6573 5f75 7070  er_std = res_upp
-000081d0: 6572 2e73 7464 2829 0d0a 2020 2020 2020  er.std()..      
-000081e0: 2020 2020 2020 7365 6c66 2e72 6573 6964        self.resid
-000081f0: 7561 6c5f 756e 6365 7274 6169 6e74 795f  ual_uncertainty_
-00008200: 6c6f 7765 725f 7374 6420 3d20 7265 735f  lower_std = res_
-00008210: 6c6f 7765 722e 7374 6428 290d 0a20 2020  lower.std()..   
-00008220: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00008230: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
-00008240: 6964 7561 6c5f 756e 6365 7274 6169 6e74  idual_uncertaint
-00008250: 795f 7570 7065 7220 3d20 7064 2e53 6572  y_upper = pd.Ser
-00008260: 6965 7328 302c 2069 6e64 6578 3d73 656c  ies(0, index=sel
-00008270: 662e 6466 2e63 6f6c 756d 6e73 290d 0a20  f.df.columns).. 
-00008280: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008290: 7265 7369 6475 616c 5f75 6e63 6572 7461  residual_uncerta
-000082a0: 696e 7479 5f6c 6f77 6572 203d 2070 642e  inty_lower = pd.
-000082b0: 5365 7269 6573 2830 2c20 696e 6465 783d  Series(0, index=
-000082c0: 7365 6c66 2e64 662e 636f 6c75 6d6e 7329  self.df.columns)
-000082d0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000082e0: 6c66 2e72 6573 6964 7561 6c5f 756e 6365  lf.residual_unce
-000082f0: 7274 6169 6e74 795f 7570 7065 725f 7374  rtainty_upper_st
-00008300: 6420 3d20 7064 2e53 6572 6965 7328 302c  d = pd.Series(0,
-00008310: 2069 6e64 6578 3d73 656c 662e 6466 2e63   index=self.df.c
-00008320: 6f6c 756d 6e73 290d 0a20 2020 2020 2020  olumns)..       
-00008330: 2020 2020 2073 656c 662e 7265 7369 6475       self.residu
-00008340: 616c 5f75 6e63 6572 7461 696e 7479 5f6c  al_uncertainty_l
-00008350: 6f77 6572 5f73 7464 203d 2070 642e 5365  ower_std = pd.Se
-00008360: 7269 6573 2830 2c20 696e 6465 783d 7365  ries(0, index=se
-00008370: 6c66 2e64 662e 636f 6c75 6d6e 7329 0d0a  lf.df.columns)..
-00008380: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00008390: 7472 656e 645f 7769 6e64 6f77 2069 7320  trend_window is 
-000083a0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-000083b0: 2020 2020 2020 2073 656c 662e 7472 656e         self.tren
-000083c0: 645f 7472 6169 6e20 3d20 7472 656e 645f  d_train = trend_
-000083d0: 706f 7374 6572 696f 720d 0a20 2020 2020  posterior..     
-000083e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000083f0: 2020 2020 2020 7365 6c66 2e74 7265 6e64        self.trend
-00008400: 5f74 7261 696e 203d 2070 642e 4461 7461  _train = pd.Data
-00008410: 4672 616d 6528 0d0a 2020 2020 2020 2020  Frame(..        
-00008420: 2020 2020 2020 2020 7472 656e 645f 7265          trend_re
-00008430: 7369 6475 616c 732c 2069 6e64 6578 3d73  siduals, index=s
-00008440: 656c 662e 6466 2e69 6e64 6578 2c20 636f  elf.df.index, co
-00008450: 6c75 6d6e 733d 7365 6c66 2e64 662e 636f  lumns=self.df.co
-00008460: 6c75 6d6e 730d 0a20 2020 2020 2020 2020  lumns..         
-00008470: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
-00008480: 280d 0a20 2020 2020 2020 2020 2020 2073  (..            s
-00008490: 656c 662e 7a65 726f 5f63 726f 7373 696e  elf.zero_crossin
-000084a0: 6773 2c0d 0a20 2020 2020 2020 2020 2020  gs,..           
-000084b0: 2073 656c 662e 6368 616e 6765 706f 696e   self.changepoin
-000084c0: 7473 2c0d 0a20 2020 2020 2020 2020 2020  ts,..           
-000084d0: 2073 656c 662e 736c 6f70 655f 7369 676e   self.slope_sign
-000084e0: 2c0d 0a20 2020 2020 2020 2020 2020 2073  ,..            s
-000084f0: 656c 662e 6163 6365 6c2c 0d0a 2020 2020  elf.accel,..    
-00008500: 2020 2020 2920 3d20 7365 6c66 2e61 6e61      ) = self.ana
-00008510: 6c79 7a65 5f74 7265 6e64 2873 6c6f 7065  lyze_trend(slope
-00008520: 2c20 696e 6465 783d 7365 6c66 2e74 7265  , index=self.tre
-00008530: 6e64 5f74 7261 696e 2e69 6e64 6578 290d  nd_train.index).
-00008540: 0a20 2020 2020 2020 2069 6620 4661 6c73  .        if Fals
-00008550: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00008560: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
-00008570: 6c79 5f64 6574 6563 746f 7220 3d20 416e  ly_detector = An
-00008580: 6f6d 616c 7952 656d 6f76 616c 280d 0a20  omalyRemoval(.. 
-00008590: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-000085a0: 2a73 656c 662e 7472 656e 645f 616e 6f6d  *self.trend_anom
-000085b0: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
-000085c0: 616d 730d 0a20 2020 2020 2020 2020 2020  ams..           
-000085d0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-000085e0: 2320 4449 4646 2074 6865 206c 656e 6774  # DIFF the lengt
-000085f0: 6820 6f66 2057 2028 6f72 2077 2d31 3f29  h of W (or w-1?)
-00008600: 0d0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
-00008610: 6674 5f69 6478 203d 206e 702e 636f 6e63  ft_idx = np.conc
-00008620: 6174 656e 6174 6528 5b5b 305d 2c20 6e70  atenate([[0], np
-00008630: 2e61 7261 6e67 6528 6c65 6e28 736c 6f70  .arange(len(slop
-00008640: 6529 295d 295b 3020 3a20 6c65 6e28 736c  e))])[0 : len(sl
-00008650: 6f70 6529 5d0d 0a20 2020 2020 2020 2020  ope)]..         
-00008660: 2020 2073 6c6f 7065 5f64 6966 6620 3d20     slope_diff = 
-00008670: 736c 6f70 6520 2d20 736c 6f70 655b 7368  slope - slope[sh
-00008680: 6674 5f69 6478 5d0d 0a20 2020 2020 2020  ft_idx]..       
-00008690: 2020 2020 2073 6866 745f 6964 7820 3d20       shft_idx = 
-000086a0: 6e70 2e63 6f6e 6361 7465 6e61 7465 280d  np.concatenate(.
-000086b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000086c0: 205b 6e70 2e72 6570 6561 7428 5b30 5d2c   [np.repeat([0],
-000086d0: 2073 656c 662e 7472 656e 645f 7769 6e64   self.trend_wind
-000086e0: 6f77 292c 206e 702e 6172 616e 6765 286c  ow), np.arange(l
-000086f0: 656e 2873 6c6f 7065 2929 5d0d 0a20 2020  en(slope))]..   
-00008700: 2020 2020 2020 2020 2029 5b30 203a 206c           )[0 : l
-00008710: 656e 2873 6c6f 7065 295d 0d0a 2020 2020  en(slope)]..    
-00008720: 2020 2020 2020 2020 736c 6f70 655f 6469          slope_di
-00008730: 6666 203d 2073 6c6f 7065 5f64 6966 6620  ff = slope_diff 
-00008740: 2b20 736c 6f70 655f 6469 6666 5b73 6866  + slope_diff[shf
-00008750: 745f 6964 785d 0d0a 2020 2020 2020 2020  t_idx]..        
-00008760: 2020 2020 2320 6e70 2e63 756d 7375 6d28      # np.cumsum(
-00008770: 736c 6f70 652c 2061 7869 733d 3029 0d0a  slope, axis=0)..
-00008780: 2020 2020 2020 2020 2020 2020 2320 7064              # pd
-00008790: 2e44 6174 6146 7261 6d65 2873 6c6f 7065  .DataFrame(slope
-000087a0: 292e 726f 6c6c 696e 6728 3930 2c20 6365  ).rolling(90, ce
-000087b0: 6e74 6572 3d54 7275 652c 206d 696e 5f70  nter=True, min_p
-000087c0: 6572 696f 6473 3d32 292e 6d65 616e 2829  eriods=2).mean()
-000087d0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000087e0: 7064 2e44 6174 6146 7261 6d65 2873 6c6f  pd.DataFrame(slo
-000087f0: 7065 2c20 696e 6465 783d 6466 2e69 6e64  pe, index=df.ind
-00008800: 6578 292e 726f 6c6c 696e 6728 3336 352c  ex).rolling(365,
-00008810: 2063 656e 7465 723d 5472 7565 2c20 6d69   center=True, mi
-00008820: 6e5f 7065 7269 6f64 733d 3229 2e6d 6561  n_periods=2).mea
-00008830: 6e28 295b 305d 2e70 6c6f 7428 290d 0a20  n()[0].plot().. 
-00008840: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008850: 7472 656e 645f 616e 6f6d 616c 795f 6465  trend_anomaly_de
-00008860: 7465 6374 6f72 2e66 6974 280d 0a20 2020  tector.fit(..   
-00008870: 2020 2020 2020 2020 2020 2020 2070 642e               pd.
-00008880: 4461 7461 4672 616d 6528 2873 6c6f 7065  DataFrame((slope
-00008890: 202d 2073 6c6f 7065 5b73 6866 745f 6964   - slope[shft_id
-000088a0: 785d 292c 2069 6e64 6578 3d73 656c 662e  x]), index=self.
-000088b0: 6466 2e69 6e64 6578 290d 0a20 2020 2020  df.index)..     
-000088c0: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
-000088d0: 2020 2020 7365 6c66 2e66 6974 5f72 756e      self.fit_run
-000088e0: 7469 6d65 203d 2073 656c 662e 7469 6d65  time = self.time
-000088f0: 2829 202d 2073 656c 662e 7374 6172 7454  () - self.startT
-00008900: 696d 650d 0a20 2020 2020 2020 2072 6574  ime..        ret
-00008910: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
-00008920: 6465 6620 616e 616c 797a 655f 7472 656e  def analyze_tren
-00008930: 6428 7365 6c66 2c20 736c 6f70 652c 2069  d(self, slope, i
-00008940: 6e64 6578 293a 0d0a 2020 2020 2020 2020  ndex):..        
-00008950: 2320 6465 7369 7265 6420 6265 6861 7669  # desired behavi
-00008960: 6f72 2069 7320 7374 6179 696e 6720 3e3d  or is staying >=
-00008970: 3020 6f72 2073 7461 7969 6e67 203c 3d20  0 or staying <= 
-00008980: 302c 206f 6e6c 7920 6765 7474 696e 6720  0, only getting 
-00008990: 6265 796f 6e64 2030 2063 6f75 6e74 2061  beyond 0 count a
-000089a0: 7320 7475 726e 696e 6720 706f 696e 740d  s turning point.
-000089b0: 0a20 2020 2020 2020 2066 616c 7365 5f72  .        false_r
-000089c0: 6f77 203d 206e 702e 7a65 726f 7328 2831  ow = np.zeros((1
-000089d0: 2c20 736c 6f70 652e 7368 6170 655b 315d  , slope.shape[1]
-000089e0: 2929 2e61 7374 7970 6528 626f 6f6c 290d  )).astype(bool).
-000089f0: 0a20 2020 2020 2020 2023 2077 6865 7265  .        # where
-00008a00: 2074 6865 2073 6c6f 7065 2063 726f 7373   the slope cross
-00008a10: 6573 2030 2074 6f20 2d31 206f 7220 7265  es 0 to -1 or re
-00008a20: 7665 7273 650d 0a20 2020 2020 2020 2073  verse..        s
-00008a30: 6c6f 7065 5f73 6967 6e20 3d20 6e70 2e73  lope_sign = np.s
-00008a40: 6967 6e62 6974 2873 6c6f 7065 290d 0a20  ignbit(slope).. 
-00008a50: 2020 2020 2020 207a 6572 6f5f 6372 6f73         zero_cros
-00008a60: 7369 6e67 7320 3d20 6e70 2e76 7374 6163  sings = np.vstac
-00008a70: 6b28 0d0a 2020 2020 2020 2020 2020 2020  k(..            
-00008a80: 286e 702e 6469 6666 2873 6c6f 7065 5f73  (np.diff(slope_s
-00008a90: 6967 6e2c 2061 7869 733d 3029 2c20 6661  ign, axis=0), fa
-00008aa0: 6c73 655f 726f 7729 0d0a 2020 2020 2020  lse_row)..      
-00008ab0: 2020 2920 2023 2055 7365 206f 6e20 6561    )  # Use on ea
-00008ac0: 726c 6965 7374 2c20 6669 6c6c 2065 6e64  rliest, fill end
-00008ad0: 0d0a 2020 2020 2020 2020 2320 7768 6572  ..        # wher
-00008ae0: 6520 7468 6520 7261 7465 206f 6620 6368  e the rate of ch
-00008af0: 616e 6765 206f 6620 7468 6520 7261 7465  ange of the rate
-00008b00: 206f 6620 6368 616e 6765 2063 726f 7373   of change cross
-00008b10: 6573 2030 2074 6f20 2d31 206f 7220 7265  es 0 to -1 or re
-00008b20: 7665 7273 650d 0a20 2020 2020 2020 2061  verse..        a
-00008b30: 6363 656c 203d 206e 702e 6469 6666 2873  ccel = np.diff(s
-00008b40: 6c6f 7065 2c20 6178 6973 3d30 290d 0a20  lope, axis=0).. 
-00008b50: 2020 2020 2020 2063 6861 6e67 6570 6f69         changepoi
-00008b60: 6e74 7320 3d20 6e70 2e76 7374 6163 6b28  nts = np.vstack(
-00008b70: 0d0a 2020 2020 2020 2020 2020 2020 2866  ..            (f
-00008b80: 616c 7365 5f72 6f77 2c20 6e70 2e64 6966  alse_row, np.dif
-00008b90: 6628 6e70 2e73 6967 6e62 6974 2861 6363  f(np.signbit(acc
-00008ba0: 656c 292c 2061 7869 733d 3029 2c20 6661  el), axis=0), fa
-00008bb0: 6c73 655f 726f 7729 0d0a 2020 2020 2020  lse_row)..      
-00008bc0: 2020 290d 0a20 2020 2020 2020 2069 6620    )..        if 
-00008bd0: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
-00008be0: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
-00008bf0: 6d73 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ms is not None:.
-00008c00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008c10: 662e 7472 656e 645f 616e 6f6d 616c 795f  f.trend_anomaly_
-00008c20: 6465 7465 6374 6f72 2e66 6974 280d 0a20  detector.fit(.. 
-00008c30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00008c40: 642e 4461 7461 4672 616d 6528 0d0a 2020  d.DataFrame(..  
-00008c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c60: 2020 6e70 2e77 6865 7265 2863 6861 6e67    np.where(chang
-00008c70: 6570 6f69 6e74 732c 2073 6c6f 7065 2c20  epoints, slope, 
-00008c80: 3029 2c0d 0a20 2020 2020 2020 2020 2020  0),..           
-00008c90: 2020 2020 2020 2020 2069 6e64 6578 3d69           index=i
-00008ca0: 6e64 6578 2c0d 0a20 2020 2020 2020 2020  ndex,..         
-00008cb0: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-00008cc0: 6e73 3d73 656c 662e 636f 6c75 6d6e 5f6e  ns=self.column_n
-00008cd0: 616d 6573 2c20 2023 204e 6565 6420 6469  ames,  # Need di
-00008ce0: 6666 6572 656e 7420 736f 7572 6365 2066  fferent source f
-00008cf0: 6f72 2069 6e64 6578 0d0a 2020 2020 2020  or index..      
-00008d00: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00008d10: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-00008d20: 2020 2020 2320 4e6f 7465 7320 6f6e 206f      # Notes on o
-00008d30: 7468 6572 2061 7070 726f 6163 6865 730d  ther approaches.
-00008d40: 0a20 2020 2020 2020 2023 206e 702e 6e6f  .        # np.no
-00008d50: 6e7a 6572 6f28 6e70 2e64 6966 6628 6e70  nzero(np.diff(np
-00008d60: 2e73 6967 6e28 736c 6f70 6529 2c20 6178  .sign(slope), ax
-00008d70: 6973 3d30 2929 2028 7468 6973 2066 6176  is=0)) (this fav
-00008d80: 6f72 7320 7072 6576 696f 7573 2070 6f69  ors previous poi
-00008d90: 6e74 2c20 6164 6420 3120 746f 2062 6520  nt, add 1 to be 
-00008da0: 6166 7465 7229 0d0a 2020 2020 2020 2020  after)..        
-00008db0: 2320 7265 706c 6163 696e 6720 3020 7769  # replacing 0 wi
-00008dc0: 7468 202d 3120 6162 6f76 6520 6d69 6768  th -1 above migh
-00008dd0: 7420 776f 726b 0d0a 2020 2020 2020 2020  t work..        
-00008de0: 2320 6874 7470 733a 2f2f 7374 6163 6b6f  # https://stacko
-00008df0: 7665 7266 6c6f 772e 636f 6d2f 7175 6573  verflow.com/ques
-00008e00: 7469 6f6e 732f 3338 3433 3031 372f 6566  tions/3843017/ef
-00008e10: 6669 6369 656e 746c 792d 6465 7465 6374  ficiently-detect
-00008e20: 2d73 6967 6e2d 6368 616e 6765 732d 696e  -sign-changes-in
-00008e30: 2d70 7974 686f 6e0d 0a20 2020 2020 2020  -python..       
-00008e40: 2023 206e 702e 7768 6572 6528 6e70 2e64   # np.where(np.d
-00008e50: 6966 6628 6e70 2e73 6967 6e62 6974 2861  iff(np.signbit(a
-00008e60: 2929 295b 305d 2028 6669 6e64 7320 7a65  )))[0] (finds ze
-00008e70: 726f 2061 7420 6265 6769 6e6e 696e 6720  ro at beginning 
-00008e80: 616e 6420 6e6f 7420 6174 2065 6e64 290d  and not at end).
-00008e90: 0a20 2020 2020 2020 2023 206e 702e 7768  .        # np.wh
-00008ea0: 6572 6528 6e70 2e62 6974 7769 7365 5f78  ere(np.bitwise_x
-00008eb0: 6f72 2870 6f73 6974 6976 655b 313a 5d2c  or(positive[1:],
-00008ec0: 2070 6f73 6974 6976 655b 3a2d 315d 2929   positive[:-1]))
-00008ed0: 5b30 5d0d 0a20 2020 2020 2020 2072 6574  [0]..        ret
-00008ee0: 7572 6e20 7a65 726f 5f63 726f 7373 696e  urn zero_crossin
-00008ef0: 6773 2c20 6368 616e 6765 706f 696e 7473  gs, changepoints
-00008f00: 2c20 736c 6f70 655f 7369 676e 2c20 6163  , slope_sign, ac
-00008f10: 6365 6c0d 0a0d 0a20 2020 2064 6566 2072  cel....    def r
-00008f20: 6f6c 6c69 6e67 5f74 7265 6e64 2873 656c  olling_trend(sel
-00008f30: 662c 2074 7265 6e64 5f72 6573 6964 7561  f, trend_residua
-00008f40: 6c73 2c20 7429 3a0d 0a20 2020 2020 2020  ls, t):..       
-00008f50: 2064 6174 6573 5f32 6420 3d20 6e70 2e72   dates_2d = np.r
-00008f60: 6570 6561 7428 0d0a 2020 2020 2020 2020  epeat(..        
-00008f70: 2020 2020 745b 2e2e 2e2c 204e 6f6e 655d      t[..., None]
-00008f80: 2c0d 0a20 2020 2020 2020 2020 2020 2023  ,..            #
-00008f90: 2064 665f 686f 6c69 6461 795f 7363 616c   df_holiday_scal
-00008fa0: 6564 2e69 6e64 6578 2e74 6f5f 6a75 6c69  ed.index.to_juli
-00008fb0: 616e 5f64 6174 6528 292e 746f 5f6e 756d  an_date().to_num
-00008fc0: 7079 2829 5b2e 2e2e 2c20 4e6f 6e65 5d2c  py()[..., None],
-00008fd0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00008fe0: 656e 645f 7265 7369 6475 616c 732e 7368  end_residuals.sh
-00008ff0: 6170 655b 315d 2c0d 0a20 2020 2020 2020  ape[1],..       
-00009000: 2020 2020 2061 7869 733d 312c 0d0a 2020       axis=1,..  
-00009010: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00009020: 2077 696e 6420 3d20 3330 2069 6620 7365   wind = 30 if se
-00009030: 6c66 2e74 7265 6e64 5f77 696e 646f 7720  lf.trend_window 
-00009040: 6973 204e 6f6e 6520 656c 7365 2073 656c  is None else sel
-00009050: 662e 7472 656e 645f 7769 6e64 6f77 0d0a  f.trend_window..
-00009060: 2020 2020 2020 2020 775f 3120 3d20 7769          w_1 = wi
-00009070: 6e64 202d 2031 0d0a 2020 2020 2020 2020  nd - 1..        
-00009080: 7374 6570 735f 6168 6420 3d20 696e 7428  steps_ahd = int(
-00009090: 775f 3120 2f20 3229 0d0a 2020 2020 2020  w_1 / 2)..      
-000090a0: 2020 7930 203d 206e 702e 7265 7065 6174    y0 = np.repeat
-000090b0: 286e 702e 6172 7261 7928 7472 656e 645f  (np.array(trend_
-000090c0: 7265 7369 6475 616c 735b 303a 315d 292c  residuals[0:1]),
-000090d0: 2073 7465 7073 5f61 6864 2c20 6178 6973   steps_ahd, axis
-000090e0: 3d30 290d 0a20 2020 2020 2020 2064 3020  =0)..        d0 
-000090f0: 3d20 2d31 202a 2064 6174 6573 5f32 645b  = -1 * dates_2d[
-00009100: 3120 3a20 7930 2e73 6861 7065 5b30 5d20  1 : y0.shape[0] 
-00009110: 2b20 315d 5b3a 3a2d 315d 0d0a 2020 2020  + 1][::-1]..    
-00009120: 2020 2020 7368 6170 6532 203d 2028 775f      shape2 = (w_
-00009130: 3120 2d20 7374 6570 735f 6168 642c 2079  1 - steps_ahd, y
-00009140: 302e 7368 6170 655b 315d 290d 0a20 2020  0.shape[1])..   
-00009150: 2020 2020 2079 3220 3d20 6e70 2e63 6f6e       y2 = np.con
-00009160: 6361 7465 6e61 7465 280d 0a20 2020 2020  catenate(..     
-00009170: 2020 2020 2020 205b 0d0a 2020 2020 2020         [..      
-00009180: 2020 2020 2020 2020 2020 7930 2c0d 0a20            y0,.. 
-00009190: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000091a0: 7265 6e64 5f72 6573 6964 7561 6c73 2c0d  rend_residuals,.
-000091b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000091c0: 206e 702e 6675 6c6c 2873 6861 7065 322c   np.full(shape2,
-000091d0: 206e 702e 6e61 6e29 2c0d 0a20 2020 2020   np.nan),..     
-000091e0: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
-000091f0: 2020 290d 0a20 2020 2020 2020 2064 203d    )..        d =
-00009200: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
-00009210: 0d0a 2020 2020 2020 2020 2020 2020 5b0d  ..            [.
-00009220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009230: 2064 302c 0d0a 2020 2020 2020 2020 2020   d0,..          
-00009240: 2020 2020 2020 6461 7465 735f 3264 2c0d        dates_2d,.
-00009250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009260: 206e 702e 6675 6c6c 2873 6861 7065 322c   np.full(shape2,
-00009270: 206e 702e 6e61 6e29 2c0d 0a20 2020 2020   np.nan),..     
-00009280: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
-00009290: 2020 290d 0a20 2020 2020 2020 2073 6c6f    )..        slo
-000092a0: 7065 2c20 696e 7465 7263 6570 7420 3d20  pe, intercept = 
-000092b0: 7769 6e64 6f77 5f6c 696e 5f72 6567 5f6d  window_lin_reg_m
-000092c0: 6561 6e28 642c 2079 322c 2077 696e 6429  ean(d, y2, wind)
-000092d0: 0d0a 2020 2020 2020 2020 7472 656e 645f  ..        trend_
-000092e0: 706f 7374 6572 696f 7220 3d20 736c 6f70  posterior = slop
-000092f0: 6520 2a20 745b 2e2e 2e2c 204e 6f6e 655d  e * t[..., None]
-00009300: 202b 2069 6e74 6572 6365 7074 0d0a 2020   + intercept..  
-00009310: 2020 2020 2020 7265 7475 726e 2074 7265        return tre
-00009320: 6e64 5f70 6f73 7465 7269 6f72 2c20 736c  nd_posterior, sl
-00009330: 6f70 652c 2069 6e74 6572 6365 7074 0d0a  ope, intercept..
-00009340: 0d0a 2020 2020 6465 6620 5f70 7265 6469  ..    def _predi
-00009350: 6374 5f6c 696e 6561 7228 0d0a 2020 2020  ct_linear(..    
-00009360: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-00009370: 2020 2064 6174 6573 2c0d 0a20 2020 2020     dates,..     
-00009380: 2020 2068 6973 746f 7279 5f64 662c 0d0a     history_df,..
-00009390: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
-000093a0: 6567 7265 7373 6f72 2c0d 0a20 2020 2020  egressor,..     
-000093b0: 2020 2072 6567 7265 7373 6f72 5f70 6572     regressor_per
-000093c0: 5f73 6572 6965 732c 0d0a 2020 2020 2020  _series,..      
-000093d0: 2020 666c 6167 5f72 6567 7265 7373 6f72    flag_regressor
-000093e0: 732c 0d0a 2020 2020 2020 2020 696d 7061  s,..        impa
-000093f0: 6374 732c 0d0a 2020 2020 2020 2020 7265  cts,..        re
-00009400: 7475 726e 5f63 6f6d 706f 6e65 6e74 733d  turn_components=
-00009410: 4661 6c73 652c 0d0a 2020 2020 293a 0d0a  False,..    ):..
-00009420: 2020 2020 2020 2020 2320 6163 6365 7074          # accept
-00009430: 7320 616e 7920 6461 7465 2069 6e20 6869  s any date in hi
-00009440: 7374 6f72 7920 286f 7220 6c61 6720 6265  story (or lag be
-00009450: 796f 6e64 2920 6173 206c 6f6e 6720 6173  yond) as long as
-00009460: 2072 6567 7265 7373 6f72 7320 696e 636c   regressors incl
-00009470: 7564 6520 7468 6f73 6520 6461 7465 7320  ude those dates 
-00009480: 696e 2069 6e64 6578 2061 7320 7765 6c6c  in index as well
-00009490: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-000094a0: 2e74 5f70 7265 6469 6374 203d 2073 656c  .t_predict = sel
-000094b0: 662e 6372 6561 7465 5f74 2864 6174 6573  f.create_t(dates
-000094c0: 290d 0a20 2020 2020 2020 2078 5f6c 6973  )..        x_lis
-000094d0: 7420 3d20 5b5d 0d0a 2020 2020 2020 2020  t = []..        
-000094e0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
-000094f0: 6c66 2e61 6e6f 6d61 6c79 5f69 6e74 6572  lf.anomaly_inter
-00009500: 7665 6e74 696f 6e2c 2064 6963 7429 3a0d  vention, dict):.
-00009510: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
-00009520: 6f72 6563 6173 7420 616e 6f6d 616c 7920  orecast anomaly 
-00009530: 7363 6f72 6573 2061 7320 7469 6d65 2073  scores as time s
-00009540: 6572 6965 730d 0a20 2020 2020 2020 2020  eries..         
-00009550: 2020 206c 656e 5f69 6e74 6572 203d 206c     len_inter = l
-00009560: 656e 2864 6174 6573 2e69 6e74 6572 7365  en(dates.interse
-00009570: 6374 696f 6e28 7365 6c66 2e61 6e6f 6d61  ction(self.anoma
-00009580: 6c79 5f64 6574 6563 746f 722e 7363 6f72  ly_detector.scor
-00009590: 6573 2e69 6e64 6578 2929 0d0a 2020 2020  es.index))..    
-000095a0: 2020 2020 2020 2020 6966 206c 656e 5f69          if len_i
-000095b0: 6e74 6572 203c 206c 656e 2864 6174 6573  nter < len(dates
-000095c0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000095d0: 2020 2020 616d 6f64 656c 5f70 6172 616d      amodel_param
-000095e0: 7320 3d20 7365 6c66 2e61 6e6f 6d61 6c79  s = self.anomaly
-000095f0: 5f69 6e74 6572 7665 6e74 696f 6e5b 274d  _intervention['M
-00009600: 6f64 656c 5061 7261 6d65 7465 7273 275d  odelParameters']
-00009610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009620: 2020 2320 6e6f 2072 6567 7265 7373 6f72    # no regressor
-00009630: 7320 7061 7373 6564 2068 6572 650d 0a20  s passed here.. 
-00009640: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009650: 6620 2272 6567 7265 7373 696f 6e5f 7479  f "regression_ty
-00009660: 7065 2220 696e 2061 6d6f 6465 6c5f 7061  pe" in amodel_pa
-00009670: 7261 6d73 3a0d 0a20 2020 2020 2020 2020  rams:..         
-00009680: 2020 2020 2020 2020 2020 2061 6d6f 6465             amode
-00009690: 6c5f 7061 7261 6d73 203d 206a 736f 6e2e  l_params = json.
-000096a0: 6c6f 6164 7328 616d 6f64 656c 5f70 6172  loads(amodel_par
-000096b0: 616d 7329 0d0a 2020 2020 2020 2020 2020  ams)..          
-000096c0: 2020 2020 2020 2020 2020 616d 6f64 656c            amodel
-000096d0: 5f70 6172 616d 735b 2772 6567 7265 7373  _params['regress
-000096e0: 696f 6e5f 7479 7065 275d 203d 204e 6f6e  ion_type'] = Non
-000096f0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00009700: 2020 206e 6577 5f73 636f 7265 7320 3d20     new_scores = 
-00009710: 6d6f 6465 6c5f 666f 7265 6361 7374 280d  model_forecast(.
-00009720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009730: 2020 2020 206d 6f64 656c 5f6e 616d 653d       model_name=
-00009740: 7365 6c66 2e61 6e6f 6d61 6c79 5f69 6e74  self.anomaly_int
-00009750: 6572 7665 6e74 696f 6e5b 274d 6f64 656c  ervention['Model
-00009760: 275d 2c0d 0a20 2020 2020 2020 2020 2020  '],..           
-00009770: 2020 2020 2020 2020 206d 6f64 656c 5f70           model_p
-00009780: 6172 616d 5f64 6963 743d 616d 6f64 656c  aram_dict=amodel
-00009790: 5f70 6172 616d 732c 0d0a 2020 2020 2020  _params,..      
-000097a0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-000097b0: 6465 6c5f 7472 616e 7366 6f72 6d5f 6469  del_transform_di
-000097c0: 6374 3d73 656c 662e 616e 6f6d 616c 795f  ct=self.anomaly_
-000097d0: 696e 7465 7276 656e 7469 6f6e 5b0d 0a20  intervention[.. 
-000097e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097f0: 2020 2020 2020 2027 5472 616e 7366 6f72         'Transfor
-00009800: 6d61 7469 6f6e 5061 7261 6d65 7465 7273  mationParameters
-00009810: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
-00009820: 2020 2020 2020 205d 2c0d 0a20 2020 2020         ],..     
-00009830: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00009840: 665f 7472 6169 6e3d 7365 6c66 2e61 6e6f  f_train=self.ano
-00009850: 6d61 6c79 5f64 6574 6563 746f 722e 7363  maly_detector.sc
-00009860: 6f72 6573 2c0d 0a20 2020 2020 2020 2020  ores,..         
-00009870: 2020 2020 2020 2020 2020 2066 6f72 6563             forec
-00009880: 6173 745f 6c65 6e67 7468 3d6c 656e 2864  ast_length=len(d
-00009890: 6174 6573 2920 2d20 6c65 6e5f 696e 7465  ates) - len_inte
-000098a0: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-000098b0: 2020 2020 2020 2020 6672 6571 7565 6e63          frequenc
-000098c0: 793d 7365 6c66 2e66 7265 7175 656e 6379  y=self.frequency
-000098d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000098e0: 2020 2020 2020 2070 7265 6469 6374 696f         predictio
-000098f0: 6e5f 696e 7465 7276 616c 3d73 656c 662e  n_interval=self.
-00009900: 7072 6564 6963 7469 6f6e 5f69 6e74 6572  prediction_inter
-00009910: 7661 6c2c 0d0a 2020 2020 2020 2020 2020  val,..          
-00009920: 2020 2020 2020 2020 2020 6661 696c 5f6f            fail_o
-00009930: 6e5f 666f 7265 6361 7374 5f6e 616e 3d46  n_forecast_nan=F
-00009940: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
-00009950: 2020 2020 2020 2020 2020 2072 616e 646f             rando
-00009960: 6d5f 7365 6564 3d73 656c 662e 7261 6e64  m_seed=self.rand
-00009970: 6f6d 5f73 6565 642c 0d0a 2020 2020 2020  om_seed,..      
-00009980: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-00009990: 7262 6f73 653d 7365 6c66 2e76 6572 626f  rbose=self.verbo
-000099a0: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
-000099b0: 2020 2020 2020 2020 206e 5f6a 6f62 733d           n_jobs=
-000099c0: 7365 6c66 2e6e 5f6a 6f62 732c 0d0a 2020  self.n_jobs,..  
-000099d0: 2020 2020 2020 2020 2020 2020 2020 292e                ).
-000099e0: 666f 7265 6361 7374 0d0a 2020 2020 2020  forecast..      
-000099f0: 2020 2020 2020 2320 6e65 6564 2074 6f20        # need to 
-00009a00: 6d6f 6465 6c20 7468 6573 6520 666f 7220  model these for 
-00009a10: 7072 6564 6963 7469 6f6e 0d0a 2020 2020  prediction..    
-00009a20: 2020 2020 2020 2020 785f 6c69 7374 2e61          x_list.a
-00009a30: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
-00009a40: 2020 2020 2020 2020 7064 2e63 6f6e 6361          pd.conca
-00009a50: 7428 5b73 656c 662e 616e 6f6d 616c 795f  t([self.anomaly_
-00009a60: 6465 7465 6374 6f72 2e73 636f 7265 732c  detector.scores,
-00009a70: 206e 6577 5f73 636f 7265 735d 2c20 6178   new_scores], ax
-00009a80: 6973 3d30 290d 0a20 2020 2020 2020 2020  is=0)..         
-00009a90: 2020 2020 2020 202e 7265 696e 6465 7828         .reindex(
-00009aa0: 6461 7465 7329 0d0a 2020 2020 2020 2020  dates)..        
-00009ab0: 2020 2020 2020 2020 2e72 656e 616d 6528          .rename(
-00009ac0: 636f 6c75 6d6e 733d 6c61 6d62 6461 2078  columns=lambda x
-00009ad0: 3a20 2261 6e6f 6d61 6c79 7363 6f72 6573  : "anomalyscores
-00009ae0: 5f22 202b 2073 7472 2878 2929 0d0a 2020  _" + str(x))..  
-00009af0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00009b00: 2020 2020 2023 2061 6c6c 206f 6620 7468       # all of th
-00009b10: 6520 666f 6c6c 6f77 696e 6720 6172 6520  e following are 
-00009b20: 3120 6461 7920 7061 7374 206c 6167 6765  1 day past lagge
-00009b30: 640d 0a20 2020 2020 2020 2069 6620 7365  d..        if se
-00009b40: 6c66 2e6d 756c 7469 7661 7269 6174 655f  lf.multivariate_
-00009b50: 6665 6174 7572 6520 6973 206e 6f74 204e  feature is not N
-00009b60: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00009b70: 2020 2320 696e 636c 7564 6573 2062 6163    # includes bac
-00009b80: 6b66 696c 6c0d 0a20 2020 2020 2020 2020  kfill..         
-00009b90: 2020 2066 756c 6c5f 6964 7820 3d20 6869     full_idx = hi
-00009ba0: 7374 6f72 795f 6466 2e69 6e64 6578 2e75  story_df.index.u
-00009bb0: 6e69 6f6e 280d 0a20 2020 2020 2020 2020  nion(..         
-00009bc0: 2020 2020 2020 2073 656c 662e 6372 6561         self.crea
-00009bd0: 7465 5f66 6f72 6563 6173 745f 696e 6465  te_forecast_inde
-00009be0: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
-00009bf0: 2020 2020 2020 2020 666f 7265 6361 7374          forecast
-00009c00: 5f6c 656e 6774 683d 312c 206c 6173 745f  _length=1, last_
-00009c10: 6461 7465 3d68 6973 746f 7279 5f64 662e  date=history_df.
-00009c20: 696e 6465 785b 2d31 5d0d 0a20 2020 2020  index[-1]..     
-00009c30: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00009c40: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00009c50: 2020 2020 2020 2020 206c 6167 5f31 5f69           lag_1_i
-00009c60: 6e64 7820 3d20 6e70 2e63 6f6e 6361 7465  ndx = np.concate
-00009c70: 6e61 7465 285b 5b30 5d2c 206e 702e 6172  nate([[0], np.ar
-00009c80: 616e 6765 286c 656e 2868 6973 746f 7279  ange(len(history
-00009c90: 5f64 6629 295d 290d 0a20 2020 2020 2020  _df))])..       
-00009ca0: 2020 2020 2069 6620 7365 6c66 2e6d 756c       if self.mul
-00009cb0: 7469 7661 7269 6174 655f 7472 616e 7366  tivariate_transf
-00009cc0: 6f72 6d61 7469 6f6e 2069 7320 6e6f 7420  ormation is not 
-00009cd0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00009ce0: 2020 2020 2020 2074 7273 5f64 6620 3d20         trs_df = 
-00009cf0: 7365 6c66 2e6d 756c 7469 7661 7269 6174  self.multivariat
-00009d00: 655f 7472 616e 7366 6f72 6d65 722e 7472  e_transformer.tr
-00009d10: 616e 7366 6f72 6d28 6869 7374 6f72 795f  ansform(history_
-00009d20: 6466 290d 0a20 2020 2020 2020 2020 2020  df)..           
-00009d30: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00009d40: 2020 2020 2020 2020 7472 735f 6466 203d          trs_df =
-00009d50: 2068 6973 746f 7279 5f64 662e 636f 7079   history_df.copy
-00009d60: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00009d70: 6966 2073 656c 662e 6d75 6c74 6976 6172  if self.multivar
-00009d80: 6961 7465 5f66 6561 7475 7265 203d 3d20  iate_feature == 
-00009d90: 2266 6561 7475 7265 5f61 6767 6c6f 6d65  "feature_agglome
-00009da0: 7261 7469 6f6e 223a 0d0a 2020 2020 2020  ration":..      
-00009db0: 2020 2020 2020 2020 2020 785f 6c69 7374            x_list
-00009dc0: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
-00009dd0: 2020 2020 2020 2020 2020 2020 2020 7064                pd
-00009de0: 2e44 6174 6146 7261 6d65 280d 0a20 2020  .DataFrame(..   
-00009df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e00: 2020 2020 2073 656c 662e 6167 676c 6f6d       self.agglom
-00009e10: 6572 6174 6f72 2e74 7261 6e73 666f 726d  erator.transform
-00009e20: 2874 7273 5f64 6629 5b6c 6167 5f31 5f69  (trs_df)[lag_1_i
-00009e30: 6e64 785d 2c0d 0a20 2020 2020 2020 2020  ndx],..         
-00009e40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00009e50: 6e64 6578 3d66 756c 6c5f 6964 782c 0d0a  ndex=full_idx,..
-00009e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e70: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
-00009e80: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-00009e90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00009ea0: 6d75 6c74 6976 6172 5f22 202b 2073 7472  multivar_" + str
-00009eb0: 2878 2920 666f 7220 7820 696e 2072 616e  (x) for x in ran
-00009ec0: 6765 2873 656c 662e 6167 676c 6f6d 5f6e  ge(self.agglom_n
-00009ed0: 5f63 6c75 7374 6572 7329 0d0a 2020 2020  _clusters)..    
+00007aa0: 2020 206e 702e 646f 7428 0d0a 2020 2020     np.dot(..    
+00007ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ac0: 2020 2020 2020 2020 635f 785b 7365 6c66          c_x[self
+00007ad0: 2e6b 6565 705f 636f 6c73 5b63 6f6c 5d5d  .keep_cols[col]]
+00007ae0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00007af0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007b00: 656c 662e 7061 7261 6d73 5b63 6f6c 5d5b  elf.params[col][
+00007b10: 7365 6c66 2e6b 6565 705f 636f 6c73 5f69  self.keep_cols_i
+00007b20: 6478 5b63 6f6c 5d5d 2c0d 0a20 2020 2020  dx[col]],..     
+00007b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007b40: 2020 2029 2e66 6c61 7474 656e 2829 2c0d     ).flatten(),.
+00007b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007b60: 2020 2020 2020 2020 206e 616d 653d 636f           name=co
+00007b70: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
+00007b80: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00007b90: 783d 7365 6c66 2e64 662e 696e 6465 782c  x=self.df.index,
+00007ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00007bb0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00007bc0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00007bd0: 2020 2020 2020 2020 7472 656e 645f 7265          trend_re
+00007be0: 7369 6475 616c 7320 3d20 7064 2e63 6f6e  siduals = pd.con
+00007bf0: 6361 7428 7472 656e 645f 7265 7369 6475  cat(trend_residu
+00007c00: 616c 732c 2061 7869 733d 3129 0d0a 2020  als, axis=1)..  
+00007c10: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00007c20: 2020 2020 2020 2020 2023 2052 554e 204c           # RUN L
+00007c30: 494e 4541 5220 4d4f 4445 4c2c 2057 4845  INEAR MODEL, WHE
+00007c40: 4e20 4e4f 204c 4f4f 5045 4420 4645 4154  N NO LOOPED FEAT
+00007c50: 5552 4553 0d0a 2020 2020 2020 2020 2020  URES..          
+00007c60: 2020 7365 6c66 2e6b 6565 705f 636f 6c73    self.keep_cols
+00007c70: 203d 2078 5f61 7272 6179 2e63 6f6c 756d   = x_array.colum
+00007c80: 6e73 5b0d 0a20 2020 2020 2020 2020 2020  ns[..           
+00007c90: 2020 2020 207e 785f 6172 7261 792e 636f       ~x_array.co
+00007ca0: 6c75 6d6e 732e 7374 722e 636f 6e74 6169  lumns.str.contai
+00007cb0: 6e73 2822 7c22 2e6a 6f69 6e28 7265 6d6f  ns("|".join(remo
+00007cc0: 7665 5f70 6174 7465 726e 7329 290d 0a20  ve_patterns)).. 
+00007cd0: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
+00007ce0: 2020 2020 2020 2020 2020 7365 6c66 2e6b            self.k
+00007cf0: 6565 705f 636f 6c73 5f69 6478 203d 2078  eep_cols_idx = x
+00007d00: 5f61 7272 6179 2e63 6f6c 756d 6e73 2e67  _array.columns.g
+00007d10: 6574 5f69 6e64 6578 6572 5f66 6f72 2873  et_indexer_for(s
+00007d20: 656c 662e 6b65 6570 5f63 6f6c 7329 0d0a  elf.keep_cols)..
+00007d30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007d40: 2e63 6f6c 5f67 726f 7570 696e 6773 203d  .col_groupings =
+00007d50: 2073 656c 662e 6b65 6570 5f63 6f6c 732e   self.keep_cols.
+00007d60: 7374 722e 7061 7274 6974 696f 6e28 225f  str.partition("_
+00007d70: 2229 2e67 6574 5f6c 6576 656c 5f76 616c  ").get_level_val
+00007d80: 7565 7328 3029 0d0a 2020 2020 2020 2020  ues(0)..        
+00007d90: 2020 2020 785f 6172 7261 795b 2769 6e74      x_array['int
+00007da0: 6572 6365 7074 275d 203d 2031 0d0a 2020  ercept'] = 1..  
+00007db0: 2020 2020 2020 2020 2020 2320 7275 6e20            # run 
+00007dc0: 6d6f 6465 6c0d 0a20 2020 2020 2020 2020  model..         
+00007dd0: 2020 2073 656c 662e 7061 7261 6d73 203d     self.params =
+00007de0: 206c 696e 6561 725f 6d6f 6465 6c28 785f   linear_model(x_
+00007df0: 6172 7261 792c 2073 656c 662e 6466 2c20  array, self.df, 
+00007e00: 7061 7261 6d73 3d73 656c 662e 6c69 6e65  params=self.line
+00007e10: 6172 5f6d 6f64 656c 290d 0a20 2020 2020  ar_model)..     
+00007e20: 2020 2020 2020 2074 7265 6e64 5f72 6573         trend_res
+00007e30: 6964 7561 6c73 203d 2073 656c 662e 6466  iduals = self.df
+00007e40: 202d 206e 702e 646f 7428 0d0a 2020 2020   - np.dot(..    
+00007e50: 2020 2020 2020 2020 2020 2020 785f 6172              x_ar
+00007e60: 7261 795b 7365 6c66 2e6b 6565 705f 636f  ray[self.keep_co
+00007e70: 6c73 5d2c 2073 656c 662e 7061 7261 6d73  ls], self.params
+00007e80: 5b73 656c 662e 6b65 6570 5f63 6f6c 735f  [self.keep_cols_
+00007e90: 6964 785d 0d0a 2020 2020 2020 2020 2020  idx]..          
+00007ea0: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00007eb0: 2073 656c 662e 785f 6172 7261 7920 3d20   self.x_array = 
+00007ec0: 785f 6172 7261 790d 0a0d 0a20 2020 2020  x_array....     
+00007ed0: 2020 2023 206f 7074 696f 6e20 746f 2072     # option to r
+00007ee0: 756e 2074 7265 6e64 206d 6f64 656c 206f  un trend model o
+00007ef0: 6e20 6675 6c6c 2072 6573 6964 7561 6c73  n full residuals
+00007f00: 206f 7220 6f6e 2072 6f6c 6c69 6e67 2074   or on rolling t
+00007f10: 7265 6e64 0d0a 2020 2020 2020 2020 6966  rend..        if
+00007f20: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+00007f30: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
+00007f40: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
+00007f50: 6d73 2069 7320 6e6f 7420 4e6f 6e65 0d0a  ms is not None..
+00007f60: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
+00007f70: 656c 662e 7472 656e 645f 7769 6e64 6f77  elf.trend_window
+00007f80: 2069 7320 6e6f 7420 4e6f 6e65 0d0a 2020   is not None..  
+00007f90: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
+00007fa0: 2020 2020 2020 2320 726f 6c6c 696e 6720        # rolling 
+00007fb0: 7472 656e 640d 0a20 2020 2020 2020 2020  trend..         
+00007fc0: 2020 2074 7265 6e64 5f70 6f73 7465 7269     trend_posteri
+00007fd0: 6f72 2c20 736c 6f70 652c 2069 6e74 6572  or, slope, inter
+00007fe0: 6365 7074 203d 2073 656c 662e 726f 6c6c  cept = self.roll
+00007ff0: 696e 675f 7472 656e 6428 0d0a 2020 2020  ing_trend(..    
+00008000: 2020 2020 2020 2020 2020 2020 7472 656e              tren
+00008010: 645f 7265 7369 6475 616c 732c 206e 702e  d_residuals, np.
+00008020: 6172 7261 7928 7365 6c66 2e74 5f74 7261  array(self.t_tra
+00008030: 696e 290d 0a20 2020 2020 2020 2020 2020  in)..           
+00008040: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+00008050: 7472 656e 645f 706f 7374 6572 696f 7220  trend_posterior 
+00008060: 3d20 7064 2e44 6174 6146 7261 6d65 280d  = pd.DataFrame(.
+00008070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008080: 2074 7265 6e64 5f70 6f73 7465 7269 6f72   trend_posterior
+00008090: 2c20 696e 6465 783d 7365 6c66 2e64 662e  , index=self.df.
+000080a0: 696e 6465 782c 2063 6f6c 756d 6e73 3d73  index, columns=s
+000080b0: 656c 662e 6466 2e63 6f6c 756d 6e73 0d0a  elf.df.columns..
+000080c0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+000080d0: 2020 2020 2020 2020 2020 2072 6573 5f64             res_d
+000080e0: 6966 203d 2074 7265 6e64 5f72 6573 6964  if = trend_resid
+000080f0: 7561 6c73 202d 2074 7265 6e64 5f70 6f73  uals - trend_pos
+00008100: 7465 7269 6f72 0d0a 2020 2020 2020 2020  terior..        
+00008110: 2020 2020 7265 735f 7570 7065 7220 3d20      res_upper = 
+00008120: 7265 735f 6469 665b 7265 735f 6469 6620  res_dif[res_dif 
+00008130: 3e3d 2030 5d0d 0a20 2020 2020 2020 2020  >= 0]..         
+00008140: 2020 2072 6573 5f6c 6f77 6572 203d 2072     res_lower = r
+00008150: 6573 5f64 6966 5b72 6573 5f64 6966 203c  es_dif[res_dif <
+00008160: 3d20 305d 0d0a 2020 2020 2020 2020 2020  = 0]..          
+00008170: 2020 7365 6c66 2e72 6573 6964 7561 6c5f    self.residual_
+00008180: 756e 6365 7274 6169 6e74 795f 7570 7065  uncertainty_uppe
+00008190: 7220 3d20 7265 735f 7570 7065 722e 6d65  r = res_upper.me
+000081a0: 616e 2829 0d0a 2020 2020 2020 2020 2020  an()..          
+000081b0: 2020 7365 6c66 2e72 6573 6964 7561 6c5f    self.residual_
+000081c0: 756e 6365 7274 6169 6e74 795f 6c6f 7765  uncertainty_lowe
+000081d0: 7220 3d20 7265 735f 6c6f 7765 722e 6d65  r = res_lower.me
+000081e0: 616e 2829 2e61 6273 2829 0d0a 2020 2020  an().abs()..    
+000081f0: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
+00008200: 6964 7561 6c5f 756e 6365 7274 6169 6e74  idual_uncertaint
+00008210: 795f 7570 7065 725f 7374 6420 3d20 7265  y_upper_std = re
+00008220: 735f 7570 7065 722e 7374 6428 290d 0a20  s_upper.std().. 
+00008230: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008240: 7265 7369 6475 616c 5f75 6e63 6572 7461  residual_uncerta
+00008250: 696e 7479 5f6c 6f77 6572 5f73 7464 203d  inty_lower_std =
+00008260: 2072 6573 5f6c 6f77 6572 2e73 7464 2829   res_lower.std()
+00008270: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00008280: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008290: 662e 7265 7369 6475 616c 5f75 6e63 6572  f.residual_uncer
+000082a0: 7461 696e 7479 5f75 7070 6572 203d 2070  tainty_upper = p
+000082b0: 642e 5365 7269 6573 2830 2c20 696e 6465  d.Series(0, inde
+000082c0: 783d 7365 6c66 2e64 662e 636f 6c75 6d6e  x=self.df.column
+000082d0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+000082e0: 7365 6c66 2e72 6573 6964 7561 6c5f 756e  self.residual_un
+000082f0: 6365 7274 6169 6e74 795f 6c6f 7765 7220  certainty_lower 
+00008300: 3d20 7064 2e53 6572 6965 7328 302c 2069  = pd.Series(0, i
+00008310: 6e64 6578 3d73 656c 662e 6466 2e63 6f6c  ndex=self.df.col
+00008320: 756d 6e73 290d 0a20 2020 2020 2020 2020  umns)..         
+00008330: 2020 2073 656c 662e 7265 7369 6475 616c     self.residual
+00008340: 5f75 6e63 6572 7461 696e 7479 5f75 7070  _uncertainty_upp
+00008350: 6572 5f73 7464 203d 2070 642e 5365 7269  er_std = pd.Seri
+00008360: 6573 2830 2c20 696e 6465 783d 7365 6c66  es(0, index=self
+00008370: 2e64 662e 636f 6c75 6d6e 7329 0d0a 2020  .df.columns)..  
+00008380: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+00008390: 6573 6964 7561 6c5f 756e 6365 7274 6169  esidual_uncertai
+000083a0: 6e74 795f 6c6f 7765 725f 7374 6420 3d20  nty_lower_std = 
+000083b0: 7064 2e53 6572 6965 7328 302c 2069 6e64  pd.Series(0, ind
+000083c0: 6578 3d73 656c 662e 6466 2e63 6f6c 756d  ex=self.df.colum
+000083d0: 6e73 290d 0a20 2020 2020 2020 2069 6620  ns)..        if 
+000083e0: 7365 6c66 2e74 7265 6e64 5f77 696e 646f  self.trend_windo
+000083f0: 7720 6973 206e 6f74 204e 6f6e 653a 0d0a  w is not None:..
+00008400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00008410: 2e74 7265 6e64 5f74 7261 696e 203d 2074  .trend_train = t
+00008420: 7265 6e64 5f70 6f73 7465 7269 6f72 0d0a  rend_posterior..
+00008430: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00008440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008450: 7472 656e 645f 7472 6169 6e20 3d20 7064  trend_train = pd
+00008460: 2e44 6174 6146 7261 6d65 280d 0a20 2020  .DataFrame(..   
+00008470: 2020 2020 2020 2020 2020 2020 2074 7265               tre
+00008480: 6e64 5f72 6573 6964 7561 6c73 2c20 696e  nd_residuals, in
+00008490: 6465 783d 7365 6c66 2e64 662e 696e 6465  dex=self.df.inde
+000084a0: 782c 2063 6f6c 756d 6e73 3d73 656c 662e  x, columns=self.
+000084b0: 6466 2e63 6f6c 756d 6e73 0d0a 2020 2020  df.columns..    
+000084c0: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
+000084d0: 2020 2020 2028 0d0a 2020 2020 2020 2020       (..        
+000084e0: 2020 2020 7365 6c66 2e7a 6572 6f5f 6372      self.zero_cr
+000084f0: 6f73 7369 6e67 732c 0d0a 2020 2020 2020  ossings,..      
+00008500: 2020 2020 2020 7365 6c66 2e63 6861 6e67        self.chang
+00008510: 6570 6f69 6e74 732c 0d0a 2020 2020 2020  epoints,..      
+00008520: 2020 2020 2020 7365 6c66 2e73 6c6f 7065        self.slope
+00008530: 5f73 6967 6e2c 0d0a 2020 2020 2020 2020  _sign,..        
+00008540: 2020 2020 7365 6c66 2e61 6363 656c 2c0d      self.accel,.
+00008550: 0a20 2020 2020 2020 2029 203d 2073 656c  .        ) = sel
+00008560: 662e 616e 616c 797a 655f 7472 656e 6428  f.analyze_trend(
+00008570: 736c 6f70 652c 2069 6e64 6578 3d73 656c  slope, index=sel
+00008580: 662e 7472 656e 645f 7472 6169 6e2e 696e  f.trend_train.in
+00008590: 6465 7829 0d0a 2020 2020 2020 2020 6966  dex)..        if
+000085a0: 2046 616c 7365 3a0d 0a20 2020 2020 2020   False:..       
+000085b0: 2020 2020 2073 656c 662e 7472 656e 645f       self.trend_
+000085c0: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+000085d0: 203d 2041 6e6f 6d61 6c79 5265 6d6f 7661   = AnomalyRemova
+000085e0: 6c28 0d0a 2020 2020 2020 2020 2020 2020  l(..            
+000085f0: 2020 2020 2a2a 7365 6c66 2e74 7265 6e64      **self.trend
+00008600: 5f61 6e6f 6d61 6c79 5f64 6574 6563 746f  _anomaly_detecto
+00008610: 725f 7061 7261 6d73 0d0a 2020 2020 2020  r_params..      
+00008620: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00008630: 2020 2020 2023 2044 4946 4620 7468 6520       # DIFF the 
+00008640: 6c65 6e67 7468 206f 6620 5720 286f 7220  length of W (or 
+00008650: 772d 313f 290d 0a20 2020 2020 2020 2020  w-1?)..         
+00008660: 2020 2073 6866 745f 6964 7820 3d20 6e70     shft_idx = np
+00008670: 2e63 6f6e 6361 7465 6e61 7465 285b 5b30  .concatenate([[0
+00008680: 5d2c 206e 702e 6172 616e 6765 286c 656e  ], np.arange(len
+00008690: 2873 6c6f 7065 2929 5d29 5b30 203a 206c  (slope))])[0 : l
+000086a0: 656e 2873 6c6f 7065 295d 0d0a 2020 2020  en(slope)]..    
+000086b0: 2020 2020 2020 2020 736c 6f70 655f 6469          slope_di
+000086c0: 6666 203d 2073 6c6f 7065 202d 2073 6c6f  ff = slope - slo
+000086d0: 7065 5b73 6866 745f 6964 785d 0d0a 2020  pe[shft_idx]..  
+000086e0: 2020 2020 2020 2020 2020 7368 6674 5f69            shft_i
+000086f0: 6478 203d 206e 702e 636f 6e63 6174 656e  dx = np.concaten
+00008700: 6174 6528 0d0a 2020 2020 2020 2020 2020  ate(..          
+00008710: 2020 2020 2020 5b6e 702e 7265 7065 6174        [np.repeat
+00008720: 285b 305d 2c20 7365 6c66 2e74 7265 6e64  ([0], self.trend
+00008730: 5f77 696e 646f 7729 2c20 6e70 2e61 7261  _window), np.ara
+00008740: 6e67 6528 6c65 6e28 736c 6f70 6529 295d  nge(len(slope))]
+00008750: 0d0a 2020 2020 2020 2020 2020 2020 295b  ..            )[
+00008760: 3020 3a20 6c65 6e28 736c 6f70 6529 5d0d  0 : len(slope)].
+00008770: 0a20 2020 2020 2020 2020 2020 2073 6c6f  .            slo
+00008780: 7065 5f64 6966 6620 3d20 736c 6f70 655f  pe_diff = slope_
+00008790: 6469 6666 202b 2073 6c6f 7065 5f64 6966  diff + slope_dif
+000087a0: 665b 7368 6674 5f69 6478 5d0d 0a20 2020  f[shft_idx]..   
+000087b0: 2020 2020 2020 2020 2023 206e 702e 6375           # np.cu
+000087c0: 6d73 756d 2873 6c6f 7065 2c20 6178 6973  msum(slope, axis
+000087d0: 3d30 290d 0a20 2020 2020 2020 2020 2020  =0)..           
+000087e0: 2023 2070 642e 4461 7461 4672 616d 6528   # pd.DataFrame(
+000087f0: 736c 6f70 6529 2e72 6f6c 6c69 6e67 2839  slope).rolling(9
+00008800: 302c 2063 656e 7465 723d 5472 7565 2c20  0, center=True, 
+00008810: 6d69 6e5f 7065 7269 6f64 733d 3229 2e6d  min_periods=2).m
+00008820: 6561 6e28 290d 0a20 2020 2020 2020 2020  ean()..         
+00008830: 2020 2023 2070 642e 4461 7461 4672 616d     # pd.DataFram
+00008840: 6528 736c 6f70 652c 2069 6e64 6578 3d64  e(slope, index=d
+00008850: 662e 696e 6465 7829 2e72 6f6c 6c69 6e67  f.index).rolling
+00008860: 2833 3635 2c20 6365 6e74 6572 3d54 7275  (365, center=Tru
+00008870: 652c 206d 696e 5f70 6572 696f 6473 3d32  e, min_periods=2
+00008880: 292e 6d65 616e 2829 5b30 5d2e 706c 6f74  ).mean()[0].plot
+00008890: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000088a0: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
+000088b0: 6c79 5f64 6574 6563 746f 722e 6669 7428  ly_detector.fit(
+000088c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000088d0: 2020 7064 2e44 6174 6146 7261 6d65 2828    pd.DataFrame((
+000088e0: 736c 6f70 6520 2d20 736c 6f70 655b 7368  slope - slope[sh
+000088f0: 6674 5f69 6478 5d29 2c20 696e 6465 783d  ft_idx]), index=
+00008900: 7365 6c66 2e64 662e 696e 6465 7829 0d0a  self.df.index)..
+00008910: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
+00008920: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
+00008930: 745f 7275 6e74 696d 6520 3d20 7365 6c66  t_runtime = self
+00008940: 2e74 696d 6528 2920 2d20 7365 6c66 2e73  .time() - self.s
+00008950: 7461 7274 5469 6d65 0d0a 2020 2020 2020  tartTime..      
+00008960: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
+00008970: 0a20 2020 2064 6566 2061 6e61 6c79 7a65  .    def analyze
+00008980: 5f74 7265 6e64 2873 656c 662c 2073 6c6f  _trend(self, slo
+00008990: 7065 2c20 696e 6465 7829 3a0d 0a20 2020  pe, index):..   
+000089a0: 2020 2020 2023 2064 6573 6972 6564 2062       # desired b
+000089b0: 6568 6176 696f 7220 6973 2073 7461 7969  ehavior is stayi
+000089c0: 6e67 203e 3d30 206f 7220 7374 6179 696e  ng >=0 or stayin
+000089d0: 6720 3c3d 2030 2c20 6f6e 6c79 2067 6574  g <= 0, only get
+000089e0: 7469 6e67 2062 6579 6f6e 6420 3020 636f  ting beyond 0 co
+000089f0: 756e 7420 6173 2074 7572 6e69 6e67 2070  unt as turning p
+00008a00: 6f69 6e74 0d0a 2020 2020 2020 2020 6661  oint..        fa
+00008a10: 6c73 655f 726f 7720 3d20 6e70 2e7a 6572  lse_row = np.zer
+00008a20: 6f73 2828 312c 2073 6c6f 7065 2e73 6861  os((1, slope.sha
+00008a30: 7065 5b31 5d29 292e 6173 7479 7065 2862  pe[1])).astype(b
+00008a40: 6f6f 6c29 0d0a 2020 2020 2020 2020 2320  ool)..        # 
+00008a50: 7768 6572 6520 7468 6520 736c 6f70 6520  where the slope 
+00008a60: 6372 6f73 7365 7320 3020 746f 202d 3120  crosses 0 to -1 
+00008a70: 6f72 2072 6576 6572 7365 0d0a 2020 2020  or reverse..    
+00008a80: 2020 2020 736c 6f70 655f 7369 676e 203d      slope_sign =
+00008a90: 206e 702e 7369 676e 6269 7428 736c 6f70   np.signbit(slop
+00008aa0: 6529 0d0a 2020 2020 2020 2020 7a65 726f  e)..        zero
+00008ab0: 5f63 726f 7373 696e 6773 203d 206e 702e  _crossings = np.
+00008ac0: 7673 7461 636b 280d 0a20 2020 2020 2020  vstack(..       
+00008ad0: 2020 2020 2028 6e70 2e64 6966 6628 736c       (np.diff(sl
+00008ae0: 6f70 655f 7369 676e 2c20 6178 6973 3d30  ope_sign, axis=0
+00008af0: 292c 2066 616c 7365 5f72 6f77 290d 0a20  ), false_row).. 
+00008b00: 2020 2020 2020 2029 2020 2320 5573 6520         )  # Use 
+00008b10: 6f6e 2065 6172 6c69 6573 742c 2066 696c  on earliest, fil
+00008b20: 6c20 656e 640d 0a20 2020 2020 2020 2023  l end..        #
+00008b30: 2077 6865 7265 2074 6865 2072 6174 6520   where the rate 
+00008b40: 6f66 2063 6861 6e67 6520 6f66 2074 6865  of change of the
+00008b50: 2072 6174 6520 6f66 2063 6861 6e67 6520   rate of change 
+00008b60: 6372 6f73 7365 7320 3020 746f 202d 3120  crosses 0 to -1 
+00008b70: 6f72 2072 6576 6572 7365 0d0a 2020 2020  or reverse..    
+00008b80: 2020 2020 6163 6365 6c20 3d20 6e70 2e64      accel = np.d
+00008b90: 6966 6628 736c 6f70 652c 2061 7869 733d  iff(slope, axis=
+00008ba0: 3029 0d0a 2020 2020 2020 2020 6368 616e  0)..        chan
+00008bb0: 6765 706f 696e 7473 203d 206e 702e 7673  gepoints = np.vs
+00008bc0: 7461 636b 280d 0a20 2020 2020 2020 2020  tack(..         
+00008bd0: 2020 2028 6661 6c73 655f 726f 772c 206e     (false_row, n
+00008be0: 702e 6469 6666 286e 702e 7369 676e 6269  p.diff(np.signbi
+00008bf0: 7428 6163 6365 6c29 2c20 6178 6973 3d30  t(accel), axis=0
+00008c00: 292c 2066 616c 7365 5f72 6f77 290d 0a20  ), false_row).. 
+00008c10: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00008c20: 2020 6966 2073 656c 662e 7472 656e 645f    if self.trend_
+00008c30: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+00008c40: 5f70 6172 616d 7320 6973 206e 6f74 204e  _params is not N
+00008c50: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00008c60: 2020 7365 6c66 2e74 7265 6e64 5f61 6e6f    self.trend_ano
+00008c70: 6d61 6c79 5f64 6574 6563 746f 722e 6669  maly_detector.fi
+00008c80: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
+00008c90: 2020 2020 7064 2e44 6174 6146 7261 6d65      pd.DataFrame
+00008ca0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00008cb0: 2020 2020 2020 206e 702e 7768 6572 6528         np.where(
+00008cc0: 6368 616e 6765 706f 696e 7473 2c20 736c  changepoints, sl
+00008cd0: 6f70 652c 2030 292c 0d0a 2020 2020 2020  ope, 0),..      
+00008ce0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00008cf0: 6465 783d 696e 6465 782c 0d0a 2020 2020  dex=index,..    
+00008d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d10: 636f 6c75 6d6e 733d 7365 6c66 2e63 6f6c  columns=self.col
+00008d20: 756d 6e5f 6e61 6d65 732c 2020 2320 4e65  umn_names,  # Ne
+00008d30: 6564 2064 6966 6665 7265 6e74 2073 6f75  ed different sou
+00008d40: 7263 6520 666f 7220 696e 6465 780d 0a20  rce for index.. 
+00008d50: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00008d60: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
+00008d70: 0a20 2020 2020 2020 2023 204e 6f74 6573  .        # Notes
+00008d80: 206f 6e20 6f74 6865 7220 6170 7072 6f61   on other approa
+00008d90: 6368 6573 0d0a 2020 2020 2020 2020 2320  ches..        # 
+00008da0: 6e70 2e6e 6f6e 7a65 726f 286e 702e 6469  np.nonzero(np.di
+00008db0: 6666 286e 702e 7369 676e 2873 6c6f 7065  ff(np.sign(slope
+00008dc0: 292c 2061 7869 733d 3029 2920 2874 6869  ), axis=0)) (thi
+00008dd0: 7320 6661 766f 7273 2070 7265 7669 6f75  s favors previou
+00008de0: 7320 706f 696e 742c 2061 6464 2031 2074  s point, add 1 t
+00008df0: 6f20 6265 2061 6674 6572 290d 0a20 2020  o be after)..   
+00008e00: 2020 2020 2023 2072 6570 6c61 6369 6e67       # replacing
+00008e10: 2030 2077 6974 6820 2d31 2061 626f 7665   0 with -1 above
+00008e20: 206d 6967 6874 2077 6f72 6b0d 0a20 2020   might work..   
+00008e30: 2020 2020 2023 2068 7474 7073 3a2f 2f73       # https://s
+00008e40: 7461 636b 6f76 6572 666c 6f77 2e63 6f6d  tackoverflow.com
+00008e50: 2f71 7565 7374 696f 6e73 2f33 3834 3330  /questions/38430
+00008e60: 3137 2f65 6666 6963 6965 6e74 6c79 2d64  17/efficiently-d
+00008e70: 6574 6563 742d 7369 676e 2d63 6861 6e67  etect-sign-chang
+00008e80: 6573 2d69 6e2d 7079 7468 6f6e 0d0a 2020  es-in-python..  
+00008e90: 2020 2020 2020 2320 6e70 2e77 6865 7265        # np.where
+00008ea0: 286e 702e 6469 6666 286e 702e 7369 676e  (np.diff(np.sign
+00008eb0: 6269 7428 6129 2929 5b30 5d20 2866 696e  bit(a)))[0] (fin
+00008ec0: 6473 207a 6572 6f20 6174 2062 6567 696e  ds zero at begin
+00008ed0: 6e69 6e67 2061 6e64 206e 6f74 2061 7420  ning and not at 
+00008ee0: 656e 6429 0d0a 2020 2020 2020 2020 2320  end)..        # 
+00008ef0: 6e70 2e77 6865 7265 286e 702e 6269 7477  np.where(np.bitw
+00008f00: 6973 655f 786f 7228 706f 7369 7469 7665  ise_xor(positive
+00008f10: 5b31 3a5d 2c20 706f 7369 7469 7665 5b3a  [1:], positive[:
+00008f20: 2d31 5d29 295b 305d 0d0a 2020 2020 2020  -1]))[0]..      
+00008f30: 2020 7265 7475 726e 207a 6572 6f5f 6372    return zero_cr
+00008f40: 6f73 7369 6e67 732c 2063 6861 6e67 6570  ossings, changep
+00008f50: 6f69 6e74 732c 2073 6c6f 7065 5f73 6967  oints, slope_sig
+00008f60: 6e2c 2061 6363 656c 0d0a 0d0a 2020 2020  n, accel....    
+00008f70: 6465 6620 726f 6c6c 696e 675f 7472 656e  def rolling_tren
+00008f80: 6428 7365 6c66 2c20 7472 656e 645f 7265  d(self, trend_re
+00008f90: 7369 6475 616c 732c 2074 293a 0d0a 2020  siduals, t):..  
+00008fa0: 2020 2020 2020 6461 7465 735f 3264 203d        dates_2d =
+00008fb0: 206e 702e 7265 7065 6174 280d 0a20 2020   np.repeat(..   
+00008fc0: 2020 2020 2020 2020 2074 5b2e 2e2e 2c20           t[..., 
+00008fd0: 4e6f 6e65 5d2c 0d0a 2020 2020 2020 2020  None],..        
+00008fe0: 2020 2020 2320 6466 5f68 6f6c 6964 6179      # df_holiday
+00008ff0: 5f73 6361 6c65 642e 696e 6465 782e 746f  _scaled.index.to
+00009000: 5f6a 756c 6961 6e5f 6461 7465 2829 2e74  _julian_date().t
+00009010: 6f5f 6e75 6d70 7928 295b 2e2e 2e2c 204e  o_numpy()[..., N
+00009020: 6f6e 655d 2c0d 0a20 2020 2020 2020 2020  one],..         
+00009030: 2020 2074 7265 6e64 5f72 6573 6964 7561     trend_residua
+00009040: 6c73 2e73 6861 7065 5b31 5d2c 0d0a 2020  ls.shape[1],..  
+00009050: 2020 2020 2020 2020 2020 6178 6973 3d31            axis=1
+00009060: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
+00009070: 2020 2020 2020 7769 6e64 203d 2033 3020        wind = 30 
+00009080: 6966 2073 656c 662e 7472 656e 645f 7769  if self.trend_wi
+00009090: 6e64 6f77 2069 7320 4e6f 6e65 2065 6c73  ndow is None els
+000090a0: 6520 7365 6c66 2e74 7265 6e64 5f77 696e  e self.trend_win
+000090b0: 646f 770d 0a20 2020 2020 2020 2077 5f31  dow..        w_1
+000090c0: 203d 2077 696e 6420 2d20 310d 0a20 2020   = wind - 1..   
+000090d0: 2020 2020 2073 7465 7073 5f61 6864 203d       steps_ahd =
+000090e0: 2069 6e74 2877 5f31 202f 2032 290d 0a20   int(w_1 / 2).. 
+000090f0: 2020 2020 2020 2079 3020 3d20 6e70 2e72         y0 = np.r
+00009100: 6570 6561 7428 6e70 2e61 7272 6179 2874  epeat(np.array(t
+00009110: 7265 6e64 5f72 6573 6964 7561 6c73 5b30  rend_residuals[0
+00009120: 3a31 5d29 2c20 7374 6570 735f 6168 642c  :1]), steps_ahd,
+00009130: 2061 7869 733d 3029 0d0a 2020 2020 2020   axis=0)..      
+00009140: 2020 6430 203d 202d 3120 2a20 6461 7465    d0 = -1 * date
+00009150: 735f 3264 5b31 203a 2079 302e 7368 6170  s_2d[1 : y0.shap
+00009160: 655b 305d 202b 2031 5d5b 3a3a 2d31 5d0d  e[0] + 1][::-1].
+00009170: 0a20 2020 2020 2020 2073 6861 7065 3220  .        shape2 
+00009180: 3d20 2877 5f31 202d 2073 7465 7073 5f61  = (w_1 - steps_a
+00009190: 6864 2c20 7930 2e73 6861 7065 5b31 5d29  hd, y0.shape[1])
+000091a0: 0d0a 2020 2020 2020 2020 7932 203d 206e  ..        y2 = n
+000091b0: 702e 636f 6e63 6174 656e 6174 6528 0d0a  p.concatenate(..
+000091c0: 2020 2020 2020 2020 2020 2020 5b0d 0a20              [.. 
+000091d0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+000091e0: 302c 0d0a 2020 2020 2020 2020 2020 2020  0,..            
+000091f0: 2020 2020 7472 656e 645f 7265 7369 6475      trend_residu
+00009200: 616c 732c 0d0a 2020 2020 2020 2020 2020  als,..          
+00009210: 2020 2020 2020 6e70 2e66 756c 6c28 7368        np.full(sh
+00009220: 6170 6532 2c20 6e70 2e6e 616e 292c 0d0a  ape2, np.nan),..
+00009230: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
+00009240: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00009250: 2020 6420 3d20 6e70 2e63 6f6e 6361 7465    d = np.concate
+00009260: 6e61 7465 280d 0a20 2020 2020 2020 2020  nate(..         
+00009270: 2020 205b 0d0a 2020 2020 2020 2020 2020     [..          
+00009280: 2020 2020 2020 6430 2c0d 0a20 2020 2020        d0,..     
+00009290: 2020 2020 2020 2020 2020 2064 6174 6573             dates
+000092a0: 5f32 642c 0d0a 2020 2020 2020 2020 2020  _2d,..          
+000092b0: 2020 2020 2020 6e70 2e66 756c 6c28 7368        np.full(sh
+000092c0: 6170 6532 2c20 6e70 2e6e 616e 292c 0d0a  ape2, np.nan),..
+000092d0: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
+000092e0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000092f0: 2020 736c 6f70 652c 2069 6e74 6572 6365    slope, interce
+00009300: 7074 203d 2077 696e 646f 775f 6c69 6e5f  pt = window_lin_
+00009310: 7265 675f 6d65 616e 2864 2c20 7932 2c20  reg_mean(d, y2, 
+00009320: 7769 6e64 290d 0a20 2020 2020 2020 2074  wind)..        t
+00009330: 7265 6e64 5f70 6f73 7465 7269 6f72 203d  rend_posterior =
+00009340: 2073 6c6f 7065 202a 2074 5b2e 2e2e 2c20   slope * t[..., 
+00009350: 4e6f 6e65 5d20 2b20 696e 7465 7263 6570  None] + intercep
+00009360: 740d 0a20 2020 2020 2020 2072 6574 7572  t..        retur
+00009370: 6e20 7472 656e 645f 706f 7374 6572 696f  n trend_posterio
+00009380: 722c 2073 6c6f 7065 2c20 696e 7465 7263  r, slope, interc
+00009390: 6570 740d 0a0d 0a20 2020 2064 6566 205f  ept....    def _
+000093a0: 7072 6564 6963 745f 6c69 6e65 6172 280d  predict_linear(.
+000093b0: 0a20 2020 2020 2020 2073 656c 662c 0d0a  .        self,..
+000093c0: 2020 2020 2020 2020 6461 7465 732c 0d0a          dates,..
+000093d0: 2020 2020 2020 2020 6869 7374 6f72 795f          history_
+000093e0: 6466 2c0d 0a20 2020 2020 2020 2066 7574  df,..        fut
+000093f0: 7572 655f 7265 6772 6573 736f 722c 0d0a  ure_regressor,..
+00009400: 2020 2020 2020 2020 7265 6772 6573 736f          regresso
+00009410: 725f 7065 725f 7365 7269 6573 2c0d 0a20  r_per_series,.. 
+00009420: 2020 2020 2020 2066 6c61 675f 7265 6772         flag_regr
+00009430: 6573 736f 7273 2c0d 0a20 2020 2020 2020  essors,..       
+00009440: 2069 6d70 6163 7473 2c0d 0a20 2020 2020   impacts,..     
+00009450: 2020 2072 6574 7572 6e5f 636f 6d70 6f6e     return_compon
+00009460: 656e 7473 3d46 616c 7365 2c0d 0a20 2020  ents=False,..   
+00009470: 2029 3a0d 0a20 2020 2020 2020 2023 2061   ):..        # a
+00009480: 6363 6570 7473 2061 6e79 2064 6174 6520  ccepts any date 
+00009490: 696e 2068 6973 746f 7279 2028 6f72 206c  in history (or l
+000094a0: 6167 2062 6579 6f6e 6429 2061 7320 6c6f  ag beyond) as lo
+000094b0: 6e67 2061 7320 7265 6772 6573 736f 7273  ng as regressors
+000094c0: 2069 6e63 6c75 6465 2074 686f 7365 2064   include those d
+000094d0: 6174 6573 2069 6e20 696e 6465 7820 6173  ates in index as
+000094e0: 2077 656c 6c0d 0a0d 0a20 2020 2020 2020   well....       
+000094f0: 2073 656c 662e 745f 7072 6564 6963 7420   self.t_predict 
+00009500: 3d20 7365 6c66 2e63 7265 6174 655f 7428  = self.create_t(
+00009510: 6461 7465 7329 0d0a 2020 2020 2020 2020  dates)..        
+00009520: 785f 6c69 7374 203d 205b 5d0d 0a20 2020  x_list = []..   
+00009530: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00009540: 6365 2873 656c 662e 616e 6f6d 616c 795f  ce(self.anomaly_
+00009550: 696e 7465 7276 656e 7469 6f6e 2c20 6469  intervention, di
+00009560: 6374 293a 0d0a 2020 2020 2020 2020 2020  ct):..          
+00009570: 2020 2320 666f 7265 6361 7374 2061 6e6f    # forecast ano
+00009580: 6d61 6c79 2073 636f 7265 7320 6173 2074  maly scores as t
+00009590: 696d 6520 7365 7269 6573 0d0a 2020 2020  ime series..    
+000095a0: 2020 2020 2020 2020 6c65 6e5f 696e 7465          len_inte
+000095b0: 7220 3d20 6c65 6e28 6461 7465 732e 696e  r = len(dates.in
+000095c0: 7465 7273 6563 7469 6f6e 2873 656c 662e  tersection(self.
+000095d0: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+000095e0: 2e73 636f 7265 732e 696e 6465 7829 290d  .scores.index)).
+000095f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00009600: 6c65 6e5f 696e 7465 7220 3c20 6c65 6e28  len_inter < len(
+00009610: 6461 7465 7329 3a0d 0a20 2020 2020 2020  dates):..       
+00009620: 2020 2020 2020 2020 2061 6d6f 6465 6c5f           amodel_
+00009630: 7061 7261 6d73 203d 2073 656c 662e 616e  params = self.an
+00009640: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
+00009650: 6f6e 5b27 4d6f 6465 6c50 6172 616d 6574  on['ModelParamet
+00009660: 6572 7327 5d0d 0a20 2020 2020 2020 2020  ers']..         
+00009670: 2020 2020 2020 2023 206e 6f20 7265 6772         # no regr
+00009680: 6573 736f 7273 2070 6173 7365 6420 6865  essors passed he
+00009690: 7265 0d0a 2020 2020 2020 2020 2020 2020  re..            
+000096a0: 2020 2020 6966 2022 7265 6772 6573 7369      if "regressi
+000096b0: 6f6e 5f74 7970 6522 2069 6e20 616d 6f64  on_type" in amod
+000096c0: 656c 5f70 6172 616d 733a 0d0a 2020 2020  el_params:..    
+000096d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000096e0: 616d 6f64 656c 5f70 6172 616d 7320 3d20  amodel_params = 
+000096f0: 6a73 6f6e 2e6c 6f61 6473 2861 6d6f 6465  json.loads(amode
+00009700: 6c5f 7061 7261 6d73 290d 0a20 2020 2020  l_params)..     
+00009710: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00009720: 6d6f 6465 6c5f 7061 7261 6d73 5b27 7265  model_params['re
+00009730: 6772 6573 7369 6f6e 5f74 7970 6527 5d20  gression_type'] 
+00009740: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+00009750: 2020 2020 2020 2020 6e65 775f 7363 6f72          new_scor
+00009760: 6573 203d 206d 6f64 656c 5f66 6f72 6563  es = model_forec
+00009770: 6173 7428 0d0a 2020 2020 2020 2020 2020  ast(..          
+00009780: 2020 2020 2020 2020 2020 6d6f 6465 6c5f            model_
+00009790: 6e61 6d65 3d73 656c 662e 616e 6f6d 616c  name=self.anomal
+000097a0: 795f 696e 7465 7276 656e 7469 6f6e 5b27  y_intervention['
+000097b0: 4d6f 6465 6c27 5d2c 0d0a 2020 2020 2020  Model'],..      
+000097c0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+000097d0: 6465 6c5f 7061 7261 6d5f 6469 6374 3d61  del_param_dict=a
+000097e0: 6d6f 6465 6c5f 7061 7261 6d73 2c0d 0a20  model_params,.. 
+000097f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009800: 2020 206d 6f64 656c 5f74 7261 6e73 666f     model_transfo
+00009810: 726d 5f64 6963 743d 7365 6c66 2e61 6e6f  rm_dict=self.ano
+00009820: 6d61 6c79 5f69 6e74 6572 7665 6e74 696f  maly_interventio
+00009830: 6e5b 0d0a 2020 2020 2020 2020 2020 2020  n[..            
+00009840: 2020 2020 2020 2020 2020 2020 2754 7261              'Tra
+00009850: 6e73 666f 726d 6174 696f 6e50 6172 616d  nsformationParam
+00009860: 6574 6572 7327 0d0a 2020 2020 2020 2020  eters'..        
+00009870: 2020 2020 2020 2020 2020 2020 5d2c 0d0a              ],..
+00009880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009890: 2020 2020 6466 5f74 7261 696e 3d73 656c      df_train=sel
+000098a0: 662e 616e 6f6d 616c 795f 6465 7465 6374  f.anomaly_detect
+000098b0: 6f72 2e73 636f 7265 732c 0d0a 2020 2020  or.scores,..    
+000098c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000098d0: 666f 7265 6361 7374 5f6c 656e 6774 683d  forecast_length=
+000098e0: 6c65 6e28 6461 7465 7329 202d 206c 656e  len(dates) - len
+000098f0: 5f69 6e74 6572 2c0d 0a20 2020 2020 2020  _inter,..       
+00009900: 2020 2020 2020 2020 2020 2020 2066 7265               fre
+00009910: 7175 656e 6379 3d73 656c 662e 6672 6571  quency=self.freq
+00009920: 7565 6e63 792c 0d0a 2020 2020 2020 2020  uency,..        
+00009930: 2020 2020 2020 2020 2020 2020 7072 6564              pred
+00009940: 6963 7469 6f6e 5f69 6e74 6572 7661 6c3d  iction_interval=
+00009950: 7365 6c66 2e70 7265 6469 6374 696f 6e5f  self.prediction_
+00009960: 696e 7465 7276 616c 2c0d 0a20 2020 2020  interval,..     
+00009970: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00009980: 6169 6c5f 6f6e 5f66 6f72 6563 6173 745f  ail_on_forecast_
+00009990: 6e61 6e3d 4661 6c73 652c 0d0a 2020 2020  nan=False,..    
+000099a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099b0: 7261 6e64 6f6d 5f73 6565 643d 7365 6c66  random_seed=self
+000099c0: 2e72 616e 646f 6d5f 7365 6564 2c0d 0a20  .random_seed,.. 
+000099d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099e0: 2020 2076 6572 626f 7365 3d73 656c 662e     verbose=self.
+000099f0: 7665 7262 6f73 652c 0d0a 2020 2020 2020  verbose,..      
+00009a00: 2020 2020 2020 2020 2020 2020 2020 6e5f                n_
+00009a10: 6a6f 6273 3d73 656c 662e 6e5f 6a6f 6273  jobs=self.n_jobs
+00009a20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00009a30: 2020 2029 2e66 6f72 6563 6173 740d 0a20     ).forecast.. 
+00009a40: 2020 2020 2020 2020 2020 2023 206e 6565             # nee
+00009a50: 6420 746f 206d 6f64 656c 2074 6865 7365  d to model these
+00009a60: 2066 6f72 2070 7265 6469 6374 696f 6e0d   for prediction.
+00009a70: 0a20 2020 2020 2020 2020 2020 2078 5f6c  .            x_l
+00009a80: 6973 742e 6170 7065 6e64 280d 0a20 2020  ist.append(..   
+00009a90: 2020 2020 2020 2020 2020 2020 2070 642e               pd.
+00009aa0: 636f 6e63 6174 285b 7365 6c66 2e61 6e6f  concat([self.ano
+00009ab0: 6d61 6c79 5f64 6574 6563 746f 722e 7363  maly_detector.sc
+00009ac0: 6f72 6573 2c20 6e65 775f 7363 6f72 6573  ores, new_scores
+00009ad0: 5d2c 2061 7869 733d 3029 0d0a 2020 2020  ], axis=0)..    
+00009ae0: 2020 2020 2020 2020 2020 2020 2e72 6569              .rei
+00009af0: 6e64 6578 2864 6174 6573 290d 0a20 2020  ndex(dates)..   
+00009b00: 2020 2020 2020 2020 2020 2020 202e 7265               .re
+00009b10: 6e61 6d65 2863 6f6c 756d 6e73 3d6c 616d  name(columns=lam
+00009b20: 6264 6120 783a 2022 616e 6f6d 616c 7973  bda x: "anomalys
+00009b30: 636f 7265 735f 2220 2b20 7374 7228 7829  cores_" + str(x)
+00009b40: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
+00009b50: 0d0a 2020 2020 2020 2020 2320 616c 6c20  ..        # all 
+00009b60: 6f66 2074 6865 2066 6f6c 6c6f 7769 6e67  of the following
+00009b70: 2061 7265 2031 2064 6179 2070 6173 7420   are 1 day past 
+00009b80: 6c61 6767 6564 0d0a 2020 2020 2020 2020  lagged..        
+00009b90: 6966 2073 656c 662e 6d75 6c74 6976 6172  if self.multivar
+00009ba0: 6961 7465 5f66 6561 7475 7265 2069 7320  iate_feature is 
+00009bb0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00009bc0: 2020 2020 2020 2023 2069 6e63 6c75 6465         # include
+00009bd0: 7320 6261 636b 6669 6c6c 0d0a 2020 2020  s backfill..    
+00009be0: 2020 2020 2020 2020 6675 6c6c 5f69 6478          full_idx
+00009bf0: 203d 2068 6973 746f 7279 5f64 662e 696e   = history_df.in
+00009c00: 6465 782e 756e 696f 6e28 0d0a 2020 2020  dex.union(..    
+00009c10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00009c20: 2e63 7265 6174 655f 666f 7265 6361 7374  .create_forecast
+00009c30: 5f69 6e64 6578 280d 0a20 2020 2020 2020  _index(..       
+00009c40: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00009c50: 6563 6173 745f 6c65 6e67 7468 3d31 2c20  ecast_length=1, 
+00009c60: 6c61 7374 5f64 6174 653d 6869 7374 6f72  last_date=histor
+00009c70: 795f 6466 2e69 6e64 6578 5b2d 315d 0d0a  y_df.index[-1]..
+00009c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c90: 290d 0a20 2020 2020 2020 2020 2020 2029  )..            )
+00009ca0: 0d0a 2020 2020 2020 2020 2020 2020 6c61  ..            la
+00009cb0: 675f 315f 696e 6478 203d 206e 702e 636f  g_1_indx = np.co
+00009cc0: 6e63 6174 656e 6174 6528 5b5b 305d 2c20  ncatenate([[0], 
+00009cd0: 6e70 2e61 7261 6e67 6528 6c65 6e28 6869  np.arange(len(hi
+00009ce0: 7374 6f72 795f 6466 2929 5d29 0d0a 2020  story_df))])..  
+00009cf0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00009d00: 662e 6d75 6c74 6976 6172 6961 7465 5f74  f.multivariate_t
+00009d10: 7261 6e73 666f 726d 6174 696f 6e20 6973  ransformation is
+00009d20: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00009d30: 2020 2020 2020 2020 2020 2020 7472 735f              trs_
+00009d40: 6466 203d 2073 656c 662e 6d75 6c74 6976  df = self.multiv
+00009d50: 6172 6961 7465 5f74 7261 6e73 666f 726d  ariate_transform
+00009d60: 6572 2e74 7261 6e73 666f 726d 2868 6973  er.transform(his
+00009d70: 746f 7279 5f64 6629 0d0a 2020 2020 2020  tory_df)..      
+00009d80: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00009d90: 2020 2020 2020 2020 2020 2020 2074 7273               trs
+00009da0: 5f64 6620 3d20 6869 7374 6f72 795f 6466  _df = history_df
+00009db0: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
+00009dc0: 2020 2020 2069 6620 7365 6c66 2e6d 756c       if self.mul
+00009dd0: 7469 7661 7269 6174 655f 6665 6174 7572  tivariate_featur
+00009de0: 6520 3d3d 2022 6665 6174 7572 655f 6167  e == "feature_ag
+00009df0: 676c 6f6d 6572 6174 696f 6e22 3a0d 0a20  glomeration":.. 
+00009e00: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00009e10: 5f6c 6973 742e 6170 7065 6e64 280d 0a20  _list.append(.. 
+00009e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e30: 2020 2070 642e 4461 7461 4672 616d 6528     pd.DataFrame(
+00009e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009e50: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00009e60: 6767 6c6f 6d65 7261 746f 722e 7472 616e  gglomerator.tran
+00009e70: 7366 6f72 6d28 7472 735f 6466 295b 6c61  sform(trs_df)[la
+00009e80: 675f 315f 696e 6478 5d2c 0d0a 2020 2020  g_1_indx],..    
+00009e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ea0: 2020 2020 696e 6465 783d 6675 6c6c 5f69      index=full_i
+00009eb0: 6478 2c0d 0a20 2020 2020 2020 2020 2020  dx,..           
+00009ec0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00009ed0: 756d 6e73 3d5b 0d0a 2020 2020 2020 2020  umns=[..        
 00009ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ef0: 2020 2020 5d2c 0d0a 2020 2020 2020 2020      ],..        
-00009f00: 2020 2020 2020 2020 2020 2020 292e 7265              ).re
-00009f10: 696e 6465 7828 6461 7465 7329 0d0a 2020  index(dates)..  
-00009f20: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-00009f30: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00009f40: 6620 7365 6c66 2e6d 756c 7469 7661 7269  f self.multivari
-00009f50: 6174 655f 6665 6174 7572 6520 3d3d 2022  ate_feature == "
-00009f60: 6772 6f75 705f 6176 6572 6167 6522 3a0d  group_average":.
-00009f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009f80: 206d 756c 7469 7661 725f 6466 203d 2028   multivar_df = (
-00009f90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009fa0: 2020 2020 2020 7472 735f 6466 2e67 726f        trs_df.gro
-00009fb0: 7570 6279 2873 656c 662e 6361 7465 676f  upby(self.catego
-00009fc0: 7269 6361 6c5f 6772 6f75 7073 2c20 6178  rical_groups, ax
-00009fd0: 6973 3d31 290d 0a20 2020 2020 2020 2020  is=1)..         
-00009fe0: 2020 2020 2020 2020 2020 202e 6d65 616e             .mean
-00009ff0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0000a000: 2020 2020 2020 2020 2e69 6c6f 635b 6c61          .iloc[la
-0000a010: 675f 315f 696e 6478 5d0d 0a20 2020 2020  g_1_indx]..     
-0000a020: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-0000a030: 2020 2020 2020 2020 2020 2020 2020 6d75                mu
-0000a040: 6c74 6976 6172 5f64 662e 696e 6465 7820  ltivar_df.index 
-0000a050: 3d20 6675 6c6c 5f69 6478 0d0a 2020 2020  = full_idx..    
-0000a060: 2020 2020 2020 2020 2020 2020 785f 6c69              x_li
-0000a070: 7374 2e61 7070 656e 6428 0d0a 2020 2020  st.append(..    
-0000a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a090: 6d75 6c74 6976 6172 5f64 662e 7265 696e  multivar_df.rein
-0000a0a0: 6465 7828 6461 7465 7329 2e72 656e 616d  dex(dates).renam
-0000a0b0: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-0000a0c0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
-0000a0d0: 6d6e 733d 6c61 6d62 6461 2078 3a20 226d  mns=lambda x: "m
-0000a0e0: 756c 7469 7661 725f 2220 2b20 7374 7228  ultivar_" + str(
-0000a0f0: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
-0000a100: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000a110: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-0000a120: 2020 2020 2020 2020 2020 656c 6966 2073            elif s
-0000a130: 656c 662e 6d75 6c74 6976 6172 6961 7465  elf.multivariate
-0000a140: 5f66 6561 7475 7265 203d 3d20 226f 7363  _feature == "osc
-0000a150: 696c 6c61 746f 7222 3a0d 0a20 2020 2020  illator":..     
-0000a160: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000a170: 6e20 4e6f 7449 6d70 6c65 6d65 6e74 6564  n NotImplemented
-0000a180: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000a190: 662e 7365 6173 6f6e 616c 6974 6965 7320  f.seasonalities 
-0000a1a0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-0000a1b0: 2020 2020 2020 2020 2020 735f 6c69 7374            s_list
-0000a1c0: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
-0000a1d0: 2020 2066 6f72 2073 6561 736f 6e61 6c69     for seasonali
-0000a1e0: 7479 2069 6e20 7365 6c66 2e73 6561 736f  ty in self.seaso
-0000a1f0: 6e61 6c69 7469 6573 3a0d 0a20 2020 2020  nalities:..     
-0000a200: 2020 2020 2020 2020 2020 2073 5f6c 6973             s_lis
-0000a210: 742e 6170 7065 6e64 280d 0a20 2020 2020  t.append(..     
-0000a220: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000a230: 7265 6174 655f 7365 6173 6f6e 616c 6974  reate_seasonalit
-0000a240: 795f 6665 6174 7572 6528 0d0a 2020 2020  y_feature(..    
+00009ef0: 2020 2020 226d 756c 7469 7661 725f 2220      "multivar_" 
+00009f00: 2b20 7374 7228 7829 2066 6f72 2078 2069  + str(x) for x i
+00009f10: 6e20 7261 6e67 6528 7365 6c66 2e61 6767  n range(self.agg
+00009f20: 6c6f 6d5f 6e5f 636c 7573 7465 7273 290d  lom_n_clusters).
+00009f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009f40: 2020 2020 2020 2020 205d 2c0d 0a20 2020           ],..   
+00009f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f60: 2029 2e72 6569 6e64 6578 2864 6174 6573   ).reindex(dates
+00009f70: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00009f80: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00009f90: 2020 656c 6966 2073 656c 662e 6d75 6c74    elif self.mult
+00009fa0: 6976 6172 6961 7465 5f66 6561 7475 7265  ivariate_feature
+00009fb0: 203d 3d20 2267 726f 7570 5f61 7665 7261   == "group_avera
+00009fc0: 6765 223a 0d0a 2020 2020 2020 2020 2020  ge":..          
+00009fd0: 2020 2020 2020 6d75 6c74 6976 6172 5f64        multivar_d
+00009fe0: 6620 3d20 280d 0a20 2020 2020 2020 2020  f = (..         
+00009ff0: 2020 2020 2020 2020 2020 2074 7273 5f64             trs_d
+0000a000: 662e 6772 6f75 7062 7928 7365 6c66 2e63  f.groupby(self.c
+0000a010: 6174 6567 6f72 6963 616c 5f67 726f 7570  ategorical_group
+0000a020: 732c 2061 7869 733d 3129 0d0a 2020 2020  s, axis=1)..    
+0000a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a040: 2e6d 6561 6e28 290d 0a20 2020 2020 2020  .mean()..       
+0000a050: 2020 2020 2020 2020 2020 2020 202e 696c               .il
+0000a060: 6f63 5b6c 6167 5f31 5f69 6e64 785d 0d0a  oc[lag_1_indx]..
+0000a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a080: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000a090: 2020 206d 756c 7469 7661 725f 6466 2e69     multivar_df.i
+0000a0a0: 6e64 6578 203d 2066 756c 6c5f 6964 780d  ndex = full_idx.
+0000a0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a0c0: 2078 5f6c 6973 742e 6170 7065 6e64 280d   x_list.append(.
+0000a0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a0e0: 2020 2020 206d 756c 7469 7661 725f 6466       multivar_df
+0000a0f0: 2e72 6569 6e64 6578 2864 6174 6573 292e  .reindex(dates).
+0000a100: 7265 6e61 6d65 280d 0a20 2020 2020 2020  rename(..       
+0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a120: 2063 6f6c 756d 6e73 3d6c 616d 6264 6120   columns=lambda 
+0000a130: 783a 2022 6d75 6c74 6976 6172 5f22 202b  x: "multivar_" +
+0000a140: 2073 7472 2878 290d 0a20 2020 2020 2020   str(x)..       
+0000a150: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a170: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+0000a180: 6c69 6620 7365 6c66 2e6d 756c 7469 7661  lif self.multiva
+0000a190: 7269 6174 655f 6665 6174 7572 6520 3d3d  riate_feature ==
+0000a1a0: 2022 6f73 6369 6c6c 6174 6f72 223a 0d0a   "oscillator":..
+0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1c0: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
+0000a1d0: 656e 7465 640d 0a20 2020 2020 2020 2069  ented..        i
+0000a1e0: 6620 7365 6c66 2e73 6561 736f 6e61 6c69  f self.seasonali
+0000a1f0: 7469 6573 2069 7320 6e6f 7420 4e6f 6e65  ties is not None
+0000a200: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0000a210: 5f6c 6973 7420 3d20 5b5d 0d0a 2020 2020  _list = []..    
+0000a220: 2020 2020 2020 2020 666f 7220 7365 6173          for seas
+0000a230: 6f6e 616c 6974 7920 696e 2073 656c 662e  onality in self.
+0000a240: 7365 6173 6f6e 616c 6974 6965 733a 0d0a  seasonalities:..
 0000a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a260: 2020 2020 6461 7465 732c 0d0a 2020 2020      dates,..    
+0000a260: 735f 6c69 7374 2e61 7070 656e 6428 0d0a  s_list.append(..
 0000a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a280: 2020 2020 7365 6c66 2e74 5f70 7265 6469      self.t_predi
-0000a290: 6374 2c0d 0a20 2020 2020 2020 2020 2020  ct,..           
-0000a2a0: 2020 2020 2020 2020 2020 2020 2073 6561               sea
-0000a2b0: 736f 6e61 6c69 7479 2c0d 0a20 2020 2020  sonality,..     
-0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2d0: 2020 2068 6973 746f 7279 5f64 6179 733d     history_days=
-0000a2e0: 7365 6c66 2e68 6973 746f 7279 5f64 6179  self.history_day
-0000a2f0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0000a300: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000a310: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-0000a320: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000a330: 494e 5445 5241 4354 494f 4e53 204e 4f54  INTERACTIONS NOT
-0000a340: 2049 4d50 4c45 4d45 4e54 4544 0d0a 2020   IMPLEMENTED..  
-0000a350: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000a360: 4f52 4445 5220 5350 4543 4946 4943 4154  ORDER SPECIFICAT
-0000a370: 494f 4e20 4e4f 5420 494d 504c 454d 454e  ION NOT IMPLEMEN
-0000a380: 5445 440d 0a20 2020 2020 2020 2020 2020  TED..           
-0000a390: 2073 5f64 6620 3d20 7064 2e63 6f6e 6361   s_df = pd.conca
-0000a3a0: 7428 735f 6c69 7374 2c20 6178 6973 3d31  t(s_list, axis=1
-0000a3b0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0000a3c0: 5f64 662e 696e 6465 7820 3d20 6461 7465  _df.index = date
-0000a3d0: 730d 0a20 2020 2020 2020 2020 2020 2078  s..            x
-0000a3e0: 5f6c 6973 742e 6170 7065 6e64 2873 5f64  _list.append(s_d
-0000a3f0: 6629 0d0a 2020 2020 2020 2020 6966 2066  f)..        if f
-0000a400: 7574 7572 655f 7265 6772 6573 736f 7220  uture_regressor 
-0000a410: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0000a420: 7365 6c66 2e72 6567 7265 7373 6f72 735f  self.regressors_
-0000a430: 7573 6564 3a0d 0a20 2020 2020 2020 2020  used:..         
-0000a440: 2020 2078 5f6c 6973 742e 6170 7065 6e64     x_list.append
-0000a450: 2866 7574 7572 655f 7265 6772 6573 736f  (future_regresso
-0000a460: 722e 7265 696e 6465 7828 6461 7465 7329  r.reindex(dates)
-0000a470: 290d 0a20 2020 2020 2020 2069 6620 666c  )..        if fl
-0000a480: 6167 5f72 6567 7265 7373 6f72 7320 6973  ag_regressors is
-0000a490: 206e 6f74 204e 6f6e 6520 616e 6420 7365   not None and se
-0000a4a0: 6c66 2e72 6567 7265 7373 6f72 735f 7573  lf.regressors_us
-0000a4b0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-0000a4c0: 2078 5f6c 6973 742e 6170 7065 6e64 280d   x_list.append(.
-0000a4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a4e0: 2066 6c61 675f 7265 6772 6573 736f 7273   flag_regressors
-0000a4f0: 2e72 6569 6e64 6578 2864 6174 6573 290d  .reindex(dates).
-0000a500: 0a20 2020 2020 2020 2020 2020 2029 2020  .            )  
-0000a510: 2320 646f 6573 6e27 7420 6368 6563 6b20  # doesn't check 
-0000a520: 666f 7220 6d69 7373 696e 6720 6461 7461  for missing data
-0000a530: 0d0a 2020 2020 2020 2020 6966 2028 0d0a  ..        if (..
-0000a540: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000a550: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
-0000a560: 6573 2069 7320 6e6f 7420 4e6f 6e65 0d0a  es is not None..
-0000a570: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000a580: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
-0000a590: 656c 662e 686f 6c69 6461 795f 636f 756e  elf.holiday_coun
-0000a5a0: 7472 6965 732c 2064 6963 7429 0d0a 2020  tries, dict)..  
-0000a5b0: 2020 2020 2020 2020 2020 616e 6420 7365            and se
-0000a5c0: 6c66 2e68 6f6c 6964 6179 5f63 6f75 6e74  lf.holiday_count
-0000a5d0: 7269 6573 5f75 7365 640d 0a20 2020 2020  ries_used..     
-0000a5e0: 2020 2029 3a0d 0a20 2020 2020 2020 2020     ):..         
-0000a5f0: 2020 2066 6f72 2068 6f6c 6964 6179 5f63     for holiday_c
-0000a600: 6f75 6e74 7279 2069 6e20 7365 6c66 2e68  ountry in self.h
-0000a610: 6f6c 6964 6179 5f63 6f75 6e74 7269 6573  oliday_countries
-0000a620: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000a630: 2020 2078 5f6c 6973 742e 6170 7065 6e64     x_list.append
-0000a640: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000a650: 2020 2020 2020 2068 6f6c 6964 6179 5f66         holiday_f
-0000a660: 6c61 6728 0d0a 2020 2020 2020 2020 2020  lag(..          
-0000a670: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0000a680: 7465 732c 0d0a 2020 2020 2020 2020 2020  tes,..          
-0000a690: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0000a6a0: 756e 7472 793d 686f 6c69 6461 795f 636f  untry=holiday_co
-0000a6b0: 756e 7472 792c 0d0a 2020 2020 2020 2020  untry,..        
+0000a280: 2020 2020 6372 6561 7465 5f73 6561 736f      create_seaso
+0000a290: 6e61 6c69 7479 5f66 6561 7475 7265 280d  nality_feature(.
+0000a2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a2b0: 2020 2020 2020 2020 2064 6174 6573 2c0d           dates,.
+0000a2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a2d0: 2020 2020 2020 2020 2073 656c 662e 745f           self.t_
+0000a2e0: 7072 6564 6963 742c 0d0a 2020 2020 2020  predict,..      
+0000a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a300: 2020 7365 6173 6f6e 616c 6974 792c 0d0a    seasonality,..
+0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a320: 2020 2020 2020 2020 6869 7374 6f72 795f          history_
+0000a330: 6461 7973 3d73 656c 662e 6869 7374 6f72  days=self.histor
+0000a340: 795f 6461 7973 2c0d 0a20 2020 2020 2020  y_days,..       
+0000a350: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000a360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a370: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000a380: 2020 2023 2049 4e54 4552 4143 5449 4f4e     # INTERACTION
+0000a390: 5320 4e4f 5420 494d 504c 454d 454e 5445  S NOT IMPLEMENTE
+0000a3a0: 440d 0a20 2020 2020 2020 2020 2020 2020  D..             
+0000a3b0: 2020 2023 204f 5244 4552 2053 5045 4349     # ORDER SPECI
+0000a3c0: 4649 4341 5449 4f4e 204e 4f54 2049 4d50  FICATION NOT IMP
+0000a3d0: 4c45 4d45 4e54 4544 0d0a 2020 2020 2020  LEMENTED..      
+0000a3e0: 2020 2020 2020 735f 6466 203d 2070 642e        s_df = pd.
+0000a3f0: 636f 6e63 6174 2873 5f6c 6973 742c 2061  concat(s_list, a
+0000a400: 7869 733d 3129 0d0a 2020 2020 2020 2020  xis=1)..        
+0000a410: 2020 2020 735f 6466 2e69 6e64 6578 203d      s_df.index =
+0000a420: 2064 6174 6573 0d0a 2020 2020 2020 2020   dates..        
+0000a430: 2020 2020 785f 6c69 7374 2e61 7070 656e      x_list.appen
+0000a440: 6428 735f 6466 290d 0a20 2020 2020 2020  d(s_df)..       
+0000a450: 2069 6620 6675 7475 7265 5f72 6567 7265   if future_regre
+0000a460: 7373 6f72 2069 7320 6e6f 7420 4e6f 6e65  ssor is not None
+0000a470: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
+0000a480: 736f 7273 5f75 7365 643a 0d0a 2020 2020  sors_used:..    
+0000a490: 2020 2020 2020 2020 785f 6c69 7374 2e61          x_list.a
+0000a4a0: 7070 656e 6428 6675 7475 7265 5f72 6567  ppend(future_reg
+0000a4b0: 7265 7373 6f72 2e72 6569 6e64 6578 2864  ressor.reindex(d
+0000a4c0: 6174 6573 2929 0d0a 2020 2020 2020 2020  ates))..        
+0000a4d0: 6966 2066 6c61 675f 7265 6772 6573 736f  if flag_regresso
+0000a4e0: 7273 2069 7320 6e6f 7420 4e6f 6e65 2061  rs is not None a
+0000a4f0: 6e64 2073 656c 662e 7265 6772 6573 736f  nd self.regresso
+0000a500: 7273 5f75 7365 643a 0d0a 2020 2020 2020  rs_used:..      
+0000a510: 2020 2020 2020 785f 6c69 7374 2e61 7070        x_list.app
+0000a520: 656e 6428 0d0a 2020 2020 2020 2020 2020  end(..          
+0000a530: 2020 2020 2020 666c 6167 5f72 6567 7265        flag_regre
+0000a540: 7373 6f72 732e 7265 696e 6465 7828 6461  ssors.reindex(da
+0000a550: 7465 7329 0d0a 2020 2020 2020 2020 2020  tes)..          
+0000a560: 2020 2920 2023 2064 6f65 736e 2774 2063    )  # doesn't c
+0000a570: 6865 636b 2066 6f72 206d 6973 7369 6e67  heck for missing
+0000a580: 2064 6174 610d 0a20 2020 2020 2020 2069   data..        i
+0000a590: 6620 280d 0a20 2020 2020 2020 2020 2020  f (..           
+0000a5a0: 2073 656c 662e 686f 6c69 6461 795f 636f   self.holiday_co
+0000a5b0: 756e 7472 6965 7320 6973 206e 6f74 204e  untries is not N
+0000a5c0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+0000a5d0: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
+0000a5e0: 6e63 6528 7365 6c66 2e68 6f6c 6964 6179  nce(self.holiday
+0000a5f0: 5f63 6f75 6e74 7269 6573 2c20 6469 6374  _countries, dict
+0000a600: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
+0000a610: 6e64 2073 656c 662e 686f 6c69 6461 795f  nd self.holiday_
+0000a620: 636f 756e 7472 6965 735f 7573 6564 0d0a  countries_used..
+0000a630: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
+0000a640: 2020 2020 2020 2020 666f 7220 686f 6c69          for holi
+0000a650: 6461 795f 636f 756e 7472 7920 696e 2073  day_country in s
+0000a660: 656c 662e 686f 6c69 6461 795f 636f 756e  elf.holiday_coun
+0000a670: 7472 6965 733a 0d0a 2020 2020 2020 2020  tries:..        
+0000a680: 2020 2020 2020 2020 785f 6c69 7374 2e61          x_list.a
+0000a690: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
+0000a6a0: 2020 2020 2020 2020 2020 2020 686f 6c69              holi
+0000a6b0: 6461 795f 666c 6167 280d 0a20 2020 2020  day_flag(..     
 0000a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6d0: 656e 636f 6465 5f68 6f6c 6964 6179 5f74  encode_holiday_t
-0000a6e0: 7970 653d 5472 7565 2c0d 0a20 2020 2020  ype=True,..     
-0000a6f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000a700: 2e72 656e 616d 6528 636f 6c75 6d6e 733d  .rename(columns=
-0000a710: 6c61 6d62 6461 2078 3a20 2268 6f6c 6964  lambda x: "holid
-0000a720: 6179 5f22 202b 2073 7472 2878 2929 2c0d  ay_" + str(x)),.
-0000a730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a740: 2029 0d0a 2020 2020 2020 2020 2320 7075   )..        # pu
-0000a750: 7420 7468 6973 2074 6f20 7468 6520 656e  t this to the en
-0000a760: 6420 6173 2069 7420 7461 6b65 7320 7570  d as it takes up
-0000a770: 206c 6f74 7320 6f66 2066 6561 7475 7265   lots of feature
-0000a780: 2073 7061 6365 2073 6f6d 6574 696d 6573   space sometimes
-0000a790: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000a7a0: 662e 686f 6c69 6461 795f 6465 7465 6374  f.holiday_detect
-0000a7b0: 6f72 5f70 6172 616d 7320 6973 206e 6f74  or_params is not
-0000a7c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000a7d0: 2020 2020 785f 6c69 7374 2e61 7070 656e      x_list.appen
-0000a7e0: 6428 0d0a 2020 2020 2020 2020 2020 2020  d(..            
-0000a7f0: 2020 2020 7365 6c66 2e68 6f6c 6964 6179      self.holiday
-0000a800: 5f64 6574 6563 746f 722e 6461 7465 735f  _detector.dates_
-0000a810: 746f 5f68 6f6c 6964 6179 7328 6461 7465  to_holidays(date
-0000a820: 732c 2073 7479 6c65 3d22 666c 6167 2229  s, style="flag")
-0000a830: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a840: 2020 2e63 6c69 7028 7570 7065 723d 3129    .clip(upper=1)
-0000a850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a860: 2020 2e72 656e 616d 6528 636f 6c75 6d6e    .rename(column
-0000a870: 733d 6c61 6d62 6461 2078 3a20 2268 6f6c  s=lambda x: "hol
-0000a880: 6964 6179 5f22 202b 2073 7472 2878 2929  iday_" + str(x))
-0000a890: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-0000a8a0: 0a0d 0a20 2020 2020 2020 2023 2046 494e  ...        # FIN
-0000a8b0: 414c 2046 4541 5455 5245 2050 524f 4345  AL FEATURE PROCE
-0000a8c0: 5353 494e 470d 0a20 2020 2020 2020 2078  SSING..        x
-0000a8d0: 5f61 7272 6179 203d 2070 642e 636f 6e63  _array = pd.conc
-0000a8e0: 6174 2878 5f6c 6973 742c 2061 7869 733d  at(x_list, axis=
-0000a8f0: 3129 0d0a 2020 2020 2020 2020 7365 6c66  1)..        self
-0000a900: 2e70 7265 6469 6374 5f78 5f61 7272 6179  .predict_x_array
-0000a910: 203d 2078 5f61 7272 6179 2020 2320 6361   = x_array  # ca
-0000a920: 6e20 7265 6d6f 7665 2074 6869 7320 6c61  n remove this la
-0000a930: 7465 722c 2069 7420 6973 2066 6f72 2064  ter, it is for d
-0000a940: 6562 7567 6769 6e67 0d0a 2020 2020 2020  ebugging..      
-0000a950: 2020 6966 206e 702e 616e 7928 6e70 2e69    if np.any(np.i
-0000a960: 736e 616e 2878 5f61 7272 6179 2e61 7374  snan(x_array.ast
-0000a970: 7970 6528 666c 6f61 7429 2929 3a20 2023  ype(float))):  #
-0000a980: 2072 656d 6f76 6520 6c61 7465 722c 2066   remove later, f
-0000a990: 6f72 2064 6562 7567 6769 6e67 0d0a 2020  or debugging..  
-0000a9a0: 2020 2020 2020 2020 2020 6e75 6c7a 203d            nulz =
-0000a9b0: 2078 5f61 7272 6179 2e69 736e 756c 6c28   x_array.isnull(
-0000a9c0: 292e 7375 6d28 290d 0a20 2020 2020 2020  ).sum()..       
-0000a9d0: 2020 2020 2070 7269 6e74 280d 0a20 2020       print(..   
-0000a9e0: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
-0000a9f0: 6865 2066 6f6c 6c6f 7769 6e67 2063 6f6c  he following col
-0000aa00: 756d 6e73 2063 6f6e 7461 696e 206e 616e  umns contain nan
-0000aa10: 2076 616c 7565 733a 207b 6e75 6c7a 5b6e   values: {nulz[n
-0000aa20: 756c 7a20 3e20 305d 2e69 6e64 6578 2e74  ulz > 0].index.t
-0000aa30: 6f6c 6973 7428 297d 220d 0a20 2020 2020  olist()}"..     
-0000aa40: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-0000aa50: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000aa60: 6545 7272 6f72 2822 6e61 6e20 7661 6c75  eError("nan valu
-0000aa70: 6573 2069 6e20 7072 6564 6963 745f 785f  es in predict_x_
-0000aa80: 6172 7261 7922 290d 0a0d 0a20 2020 2020  array")....     
-0000aa90: 2020 2023 2052 554e 204c 494e 4541 5220     # RUN LINEAR 
-0000aaa0: 4d4f 4445 4c0d 0a20 2020 2020 2020 2023  MODEL..        #
-0000aab0: 2061 6464 2078 2066 6561 7475 7265 7320   add x features 
-0000aac0: 7468 6174 2064 6f6e 2774 2061 7070 6c79  that don't apply
-0000aad0: 2074 6f20 616c 6c2c 2061 6e64 206e 6565   to all, and nee
-0000aae0: 6420 746f 2062 6520 6c6f 6f70 6564 0d0a  d to be looped..
-0000aaf0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000ab00: 6c6f 6f70 5f72 6571 7569 7265 643a 0d0a  loop_required:..
-0000ab10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ab20: 2e70 7265 6469 6374 5f78 5f61 7272 6179  .predict_x_array
-0000ab30: 203d 207b 7d0d 0a20 2020 2020 2020 2020   = {}..         
-0000ab40: 2020 2073 656c 662e 636f 6d70 6f6e 656e     self.componen
-0000ab50: 7473 203d 205b 5d0d 0a20 2020 2020 2020  ts = []..       
-0000ab60: 2020 2020 2070 7265 6469 6374 7320 3d20       predicts = 
-0000ab70: 5b5d 0d0a 2020 2020 2020 2020 2020 2020  []..            
-0000ab80: 666f 7220 636f 6c20 696e 2073 656c 662e  for col in self.
-0000ab90: 6466 2e63 6f6c 756d 6e73 3a0d 0a20 2020  df.columns:..   
-0000aba0: 2020 2020 2020 2020 2020 2020 2063 5f78               c_x
-0000abb0: 203d 2078 5f61 7272 6179 2e63 6f70 7928   = x_array.copy(
-0000abc0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000abd0: 2020 2023 2069 6d70 6c65 6d65 6e74 2070     # implement p
-0000abe0: 6572 5f73 6572 6965 7320 686f 6c69 6461  er_series holida
-0000abf0: 7920 636f 756e 7472 6965 7320 666c 6167  y countries flag
-0000ac00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ac10: 2020 6966 2028 0d0a 2020 2020 2020 2020    if (..        
-0000ac20: 2020 2020 2020 2020 2020 2020 6973 696e              isin
-0000ac30: 7374 616e 6365 2873 656c 662e 686f 6c69  stance(self.holi
-0000ac40: 6461 795f 636f 756e 7472 6965 732c 2064  day_countries, d
-0000ac50: 6963 7429 0d0a 2020 2020 2020 2020 2020  ict)..          
-0000ac60: 2020 2020 2020 2020 2020 616e 6420 7365            and se
-0000ac70: 6c66 2e68 6f6c 6964 6179 5f63 6f75 6e74  lf.holiday_count
-0000ac80: 7269 6573 5f75 7365 640d 0a20 2020 2020  ries_used..     
-0000ac90: 2020 2020 2020 2020 2020 2029 3a0d 0a20             ):.. 
-0000aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acb0: 2020 2068 6320 3d20 7365 6c66 2e68 6f6c     hc = self.hol
-0000acc0: 6964 6179 5f63 6f75 6e74 7269 6573 2e67  iday_countries.g
-0000acd0: 6574 2863 6f6c 2c20 4e6f 6e65 290d 0a20  et(col, None).. 
+0000a6d0: 2020 2064 6174 6573 2c0d 0a20 2020 2020     dates,..     
+0000a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6f0: 2020 2063 6f75 6e74 7279 3d68 6f6c 6964     country=holid
+0000a700: 6179 5f63 6f75 6e74 7279 2c0d 0a20 2020  ay_country,..   
+0000a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a720: 2020 2020 2065 6e63 6f64 655f 686f 6c69       encode_holi
+0000a730: 6461 795f 7479 7065 3d54 7275 652c 0d0a  day_type=True,..
+0000a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a750: 2020 2020 292e 7265 6e61 6d65 2863 6f6c      ).rename(col
+0000a760: 756d 6e73 3d6c 616d 6264 6120 783a 2022  umns=lambda x: "
+0000a770: 686f 6c69 6461 795f 2220 2b20 7374 7228  holiday_" + str(
+0000a780: 7829 292c 0d0a 2020 2020 2020 2020 2020  x)),..          
+0000a790: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000a7a0: 2023 2070 7574 2074 6869 7320 746f 2074   # put this to t
+0000a7b0: 6865 2065 6e64 2061 7320 6974 2074 616b  he end as it tak
+0000a7c0: 6573 2075 7020 6c6f 7473 206f 6620 6665  es up lots of fe
+0000a7d0: 6174 7572 6520 7370 6163 6520 736f 6d65  ature space some
+0000a7e0: 7469 6d65 730d 0a20 2020 2020 2020 2069  times..        i
+0000a7f0: 6620 7365 6c66 2e68 6f6c 6964 6179 5f64  f self.holiday_d
+0000a800: 6574 6563 746f 725f 7061 7261 6d73 2069  etector_params i
+0000a810: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+0000a820: 2020 2020 2020 2020 2078 5f6c 6973 742e           x_list.
+0000a830: 6170 7065 6e64 280d 0a20 2020 2020 2020  append(..       
+0000a840: 2020 2020 2020 2020 2073 656c 662e 686f           self.ho
+0000a850: 6c69 6461 795f 6465 7465 6374 6f72 2e64  liday_detector.d
+0000a860: 6174 6573 5f74 6f5f 686f 6c69 6461 7973  ates_to_holidays
+0000a870: 2864 6174 6573 2c20 7374 796c 653d 2266  (dates, style="f
+0000a880: 6c61 6722 290d 0a20 2020 2020 2020 2020  lag")..         
+0000a890: 2020 2020 2020 202e 636c 6970 2875 7070         .clip(upp
+0000a8a0: 6572 3d31 290d 0a20 2020 2020 2020 2020  er=1)..         
+0000a8b0: 2020 2020 2020 202e 7265 6e61 6d65 2863         .rename(c
+0000a8c0: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
+0000a8d0: 2022 686f 6c69 6461 795f 2220 2b20 7374   "holiday_" + st
+0000a8e0: 7228 7829 290d 0a20 2020 2020 2020 2020  r(x))..         
+0000a8f0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+0000a900: 2320 4649 4e41 4c20 4645 4154 5552 4520  # FINAL FEATURE 
+0000a910: 5052 4f43 4553 5349 4e47 0d0a 2020 2020  PROCESSING..    
+0000a920: 2020 2020 785f 6172 7261 7920 3d20 7064      x_array = pd
+0000a930: 2e63 6f6e 6361 7428 785f 6c69 7374 2c20  .concat(x_list, 
+0000a940: 6178 6973 3d31 290d 0a20 2020 2020 2020  axis=1)..       
+0000a950: 2073 656c 662e 7072 6564 6963 745f 785f   self.predict_x_
+0000a960: 6172 7261 7920 3d20 785f 6172 7261 7920  array = x_array 
+0000a970: 2023 2063 616e 2072 656d 6f76 6520 7468   # can remove th
+0000a980: 6973 206c 6174 6572 2c20 6974 2069 7320  is later, it is 
+0000a990: 666f 7220 6465 6275 6767 696e 670d 0a20  for debugging.. 
+0000a9a0: 2020 2020 2020 2069 6620 6e70 2e61 6e79         if np.any
+0000a9b0: 286e 702e 6973 6e61 6e28 785f 6172 7261  (np.isnan(x_arra
+0000a9c0: 792e 6173 7479 7065 2866 6c6f 6174 2929  y.astype(float))
+0000a9d0: 293a 2020 2320 7265 6d6f 7665 206c 6174  ):  # remove lat
+0000a9e0: 6572 2c20 666f 7220 6465 6275 6767 696e  er, for debuggin
+0000a9f0: 670d 0a20 2020 2020 2020 2020 2020 206e  g..            n
+0000aa00: 756c 7a20 3d20 785f 6172 7261 792e 6973  ulz = x_array.is
+0000aa10: 6e75 6c6c 2829 2e73 756d 2829 0d0a 2020  null().sum()..  
+0000aa20: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000aa30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000aa40: 2020 6622 7468 6520 666f 6c6c 6f77 696e    f"the followin
+0000aa50: 6720 636f 6c75 6d6e 7320 636f 6e74 6169  g columns contai
+0000aa60: 6e20 6e61 6e20 7661 6c75 6573 3a20 7b6e  n nan values: {n
+0000aa70: 756c 7a5b 6e75 6c7a 203e 2030 5d2e 696e  ulz[nulz > 0].in
+0000aa80: 6465 782e 746f 6c69 7374 2829 7d22 0d0a  dex.tolist()}"..
+0000aa90: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000aaa0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000aab0: 2056 616c 7565 4572 726f 7228 226e 616e   ValueError("nan
+0000aac0: 2076 616c 7565 7320 696e 2070 7265 6469   values in predi
+0000aad0: 6374 5f78 5f61 7272 6179 2229 0d0a 0d0a  ct_x_array")....
+0000aae0: 2020 2020 2020 2020 2320 5255 4e20 4c49          # RUN LI
+0000aaf0: 4e45 4152 204d 4f44 454c 0d0a 2020 2020  NEAR MODEL..    
+0000ab00: 2020 2020 2320 6164 6420 7820 6665 6174      # add x feat
+0000ab10: 7572 6573 2074 6861 7420 646f 6e27 7420  ures that don't 
+0000ab20: 6170 706c 7920 746f 2061 6c6c 2c20 616e  apply to all, an
+0000ab30: 6420 6e65 6564 2074 6f20 6265 206c 6f6f  d need to be loo
+0000ab40: 7065 640d 0a20 2020 2020 2020 2069 6620  ped..        if 
+0000ab50: 7365 6c66 2e6c 6f6f 705f 7265 7175 6972  self.loop_requir
+0000ab60: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+0000ab70: 2073 656c 662e 7072 6564 6963 745f 785f   self.predict_x_
+0000ab80: 6172 7261 7920 3d20 7b7d 0d0a 2020 2020  array = {}..    
+0000ab90: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
+0000aba0: 706f 6e65 6e74 7320 3d20 5b5d 0d0a 2020  ponents = []..  
+0000abb0: 2020 2020 2020 2020 2020 7072 6564 6963            predic
+0000abc0: 7473 203d 205b 5d0d 0a20 2020 2020 2020  ts = []..       
+0000abd0: 2020 2020 2066 6f72 2063 6f6c 2069 6e20       for col in 
+0000abe0: 7365 6c66 2e64 662e 636f 6c75 6d6e 733a  self.df.columns:
+0000abf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ac00: 2020 635f 7820 3d20 785f 6172 7261 792e    c_x = x_array.
+0000ac10: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
+0000ac20: 2020 2020 2020 2020 2320 696d 706c 656d          # implem
+0000ac30: 656e 7420 7065 725f 7365 7269 6573 2068  ent per_series h
+0000ac40: 6f6c 6964 6179 2063 6f75 6e74 7269 6573  oliday countries
+0000ac50: 2066 6c61 670d 0a20 2020 2020 2020 2020   flag..         
+0000ac60: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
+0000ac70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac80: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+0000ac90: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
+0000aca0: 6573 2c20 6469 6374 290d 0a20 2020 2020  es, dict)..     
+0000acb0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000acc0: 6e64 2073 656c 662e 686f 6c69 6461 795f  nd self.holiday_
+0000acd0: 636f 756e 7472 6965 735f 7573 6564 0d0a  countries_used..
 0000ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acf0: 2020 2069 6620 6863 2069 7320 6e6f 7420     if hc is not 
-0000ad00: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0000ad10: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000ad20: 5f68 6320 3d20 686f 6c69 6461 795f 666c  _hc = holiday_fl
-0000ad30: 6167 280d 0a20 2020 2020 2020 2020 2020  ag(..           
-0000ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad50: 2064 6174 6573 2c0d 0a20 2020 2020 2020   dates,..       
+0000acf0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000ad00: 2020 2020 2020 2020 6863 203d 2073 656c          hc = sel
+0000ad10: 662e 686f 6c69 6461 795f 636f 756e 7472  f.holiday_countr
+0000ad20: 6965 732e 6765 7428 636f 6c2c 204e 6f6e  ies.get(col, Non
+0000ad30: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+0000ad40: 2020 2020 2020 2020 6966 2068 6320 6973          if hc is
+0000ad50: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
 0000ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad70: 2020 2020 2063 6f75 6e74 7279 3d68 632c       country=hc,
-0000ad80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ad90: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0000ada0: 636f 6465 5f68 6f6c 6964 6179 5f74 7970  code_holiday_typ
-0000adb0: 653d 5472 7565 2c0d 0a20 2020 2020 2020  e=True,..       
-0000adc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000add0: 2029 2e72 656e 616d 6528 636f 6c75 6d6e   ).rename(column
-0000ade0: 733d 6c61 6d62 6461 2078 3a20 2268 6f6c  s=lambda x: "hol
-0000adf0: 6964 6179 5f22 202b 2073 7472 2878 2929  iday_" + str(x))
-0000ae00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ae10: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000ae20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae30: 2020 2020 2063 5f68 6320 3d20 7064 2e44       c_hc = pd.D
-0000ae40: 6174 6146 7261 6d65 2830 2c20 696e 6465  ataFrame(0, inde
-0000ae50: 783d 6461 7465 732c 2063 6f6c 756d 6e73  x=dates, columns
-0000ae60: 3d5b 2268 6f6c 6964 6179 5f30 225d 290d  =["holiday_0"]).
-0000ae70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ae80: 2020 2020 2063 5f78 203d 2070 642e 636f       c_x = pd.co
-0000ae90: 6e63 6174 285b 635f 782c 2063 5f68 635d  ncat([c_x, c_hc]
-0000aea0: 2c20 6178 6973 3d31 290d 0a20 2020 2020  , axis=1)..     
-0000aeb0: 2020 2020 2020 2020 2020 2023 2069 6d70             # imp
-0000aec0: 6c65 6d65 6e74 2072 6567 7265 7373 6f72  lement regressor
-0000aed0: 7320 7065 7220 7365 7269 6573 0d0a 2020  s per series..  
-0000aee0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000aef0: 2069 7369 6e73 7461 6e63 6528 7265 6772   isinstance(regr
-0000af00: 6573 736f 725f 7065 725f 7365 7269 6573  essor_per_series
-0000af10: 2c20 6469 6374 2920 616e 6420 7365 6c66  , dict) and self
-0000af20: 2e72 6567 7265 7373 6f72 735f 7573 6564  .regressors_used
-0000af30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000af40: 2020 2020 2020 2068 6320 3d20 7265 6772         hc = regr
-0000af50: 6573 736f 725f 7065 725f 7365 7269 6573  essor_per_series
-0000af60: 2e67 6574 2863 6f6c 2c20 4e6f 6e65 290d  .get(col, None).
-0000af70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000af80: 2020 2020 2069 6620 6863 2069 7320 6e6f       if hc is no
-0000af90: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0000afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afb0: 2063 5f68 6320 3d20 280d 0a20 2020 2020   c_hc = (..     
-0000afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afd0: 2020 2020 2020 2070 642e 4461 7461 4672         pd.DataFr
-0000afe0: 616d 6528 6863 290d 0a20 2020 2020 2020  ame(hc)..       
+0000ad70: 2020 2020 635f 6863 203d 2068 6f6c 6964      c_hc = holid
+0000ad80: 6179 5f66 6c61 6728 0d0a 2020 2020 2020  ay_flag(..      
+0000ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ada0: 2020 2020 2020 6461 7465 732c 0d0a 2020        dates,..  
+0000adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000adc0: 2020 2020 2020 2020 2020 636f 756e 7472            countr
+0000add0: 793d 6863 2c0d 0a20 2020 2020 2020 2020  y=hc,..         
+0000ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000adf0: 2020 2065 6e63 6f64 655f 686f 6c69 6461     encode_holida
+0000ae00: 795f 7479 7065 3d54 7275 652c 0d0a 2020  y_type=True,..  
+0000ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae20: 2020 2020 2020 292e 7265 6e61 6d65 2863        ).rename(c
+0000ae30: 6f6c 756d 6e73 3d6c 616d 6264 6120 783a  olumns=lambda x:
+0000ae40: 2022 686f 6c69 6461 795f 2220 2b20 7374   "holiday_" + st
+0000ae50: 7228 7829 290d 0a20 2020 2020 2020 2020  r(x))..         
+0000ae60: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000ae70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ae80: 2020 2020 2020 2020 2020 635f 6863 203d            c_hc =
+0000ae90: 2070 642e 4461 7461 4672 616d 6528 302c   pd.DataFrame(0,
+0000aea0: 2069 6e64 6578 3d64 6174 6573 2c20 636f   index=dates, co
+0000aeb0: 6c75 6d6e 733d 5b22 686f 6c69 6461 795f  lumns=["holiday_
+0000aec0: 3022 5d29 0d0a 2020 2020 2020 2020 2020  0"])..          
+0000aed0: 2020 2020 2020 2020 2020 635f 7820 3d20            c_x = 
+0000aee0: 7064 2e63 6f6e 6361 7428 5b63 5f78 2c20  pd.concat([c_x, 
+0000aef0: 635f 6863 5d2c 2061 7869 733d 3129 0d0a  c_hc], axis=1)..
+0000af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af10: 2320 696d 706c 656d 656e 7420 7265 6772  # implement regr
+0000af20: 6573 736f 7273 2070 6572 2073 6572 6965  essors per serie
+0000af30: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+0000af40: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000af50: 2872 6567 7265 7373 6f72 5f70 6572 5f73  (regressor_per_s
+0000af60: 6572 6965 732c 2064 6963 7429 2061 6e64  eries, dict) and
+0000af70: 2073 656c 662e 7265 6772 6573 736f 7273   self.regressors
+0000af80: 5f75 7365 643a 0d0a 2020 2020 2020 2020  _used:..        
+0000af90: 2020 2020 2020 2020 2020 2020 6863 203d              hc =
+0000afa0: 2072 6567 7265 7373 6f72 5f70 6572 5f73   regressor_per_s
+0000afb0: 6572 6965 732e 6765 7428 636f 6c2c 204e  eries.get(col, N
+0000afc0: 6f6e 6529 0d0a 2020 2020 2020 2020 2020  one)..          
+0000afd0: 2020 2020 2020 2020 2020 6966 2068 6320            if hc 
+0000afe0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
 0000aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b000: 2020 2020 202e 7265 6e61 6d65 2863 6f6c       .rename(col
-0000b010: 756d 6e73 3d6c 616d 6264 6120 783a 2022  umns=lambda x: "
-0000b020: 7265 6772 7065 7273 6572 6965 735f 2220  regrperseries_" 
-0000b030: 2b20 7374 7228 7829 290d 0a20 2020 2020  + str(x))..     
+0000b000: 2020 2020 2020 635f 6863 203d 2028 0d0a        c_hc = (..
+0000b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b020: 2020 2020 2020 2020 2020 2020 7064 2e44              pd.D
+0000b030: 6174 6146 7261 6d65 2868 6329 0d0a 2020  ataFrame(hc)..  
 0000b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b050: 2020 2020 2020 202e 7265 696e 6465 7828         .reindex(
-0000b060: 6461 7465 7329 0d0a 2020 2020 2020 2020  dates)..        
-0000b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b080: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000b090: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b0b0: 2020 2020 2020 635f 6863 203d 2070 642e        c_hc = pd.
-0000b0c0: 4461 7461 4672 616d 6528 302c 2069 6e64  DataFrame(0, ind
-0000b0d0: 6578 3d64 6174 6573 2c20 636f 6c75 6d6e  ex=dates, column
-0000b0e0: 733d 5b22 7265 6772 7065 7273 6572 6965  s=["regrperserie
-0000b0f0: 735f 3022 5d29 0d0a 2020 2020 2020 2020  s_0"])..        
-0000b100: 2020 2020 2020 2020 2020 2020 635f 7820              c_x 
-0000b110: 3d20 7064 2e63 6f6e 6361 7428 5b63 5f78  = pd.concat([c_x
-0000b120: 2c20 635f 6863 5d2c 2061 7869 733d 3129  , c_hc], axis=1)
-0000b130: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b140: 2020 2320 696d 706c 656d 656e 7420 7061    # implement pa
-0000b150: 7374 5f69 6d70 6163 7473 2061 7320 7265  st_impacts as re
-0000b160: 6772 6573 736f 720d 0a20 2020 2020 2020  gressor..       
-0000b170: 2020 2020 2020 2020 2069 6620 280d 0a20           if (.. 
-0000b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b190: 2020 2069 7369 6e73 7461 6e63 6528 696d     isinstance(im
-0000b1a0: 7061 6374 732c 2070 642e 4461 7461 4672  pacts, pd.DataFr
-0000b1b0: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
-0000b1c0: 2020 2020 2020 2020 2020 616e 6420 7365            and se
-0000b1d0: 6c66 2e70 6173 745f 696d 7061 6374 735f  lf.past_impacts_
-0000b1e0: 696e 7465 7276 656e 7469 6f6e 203d 3d20  intervention == 
-0000b1f0: 2272 6567 7265 7373 6f72 220d 0a20 2020  "regressor"..   
-0000b200: 2020 2020 2020 2020 2020 2020 2029 3a0d               ):.
-0000b210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b220: 2020 2020 2063 5f78 203d 2070 642e 636f       c_x = pd.co
-0000b230: 6e63 6174 280d 0a20 2020 2020 2020 2020  ncat(..         
-0000b240: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0000b050: 2020 2020 2020 2020 2020 2e72 656e 616d            .renam
+0000b060: 6528 636f 6c75 6d6e 733d 6c61 6d62 6461  e(columns=lambda
+0000b070: 2078 3a20 2272 6567 7270 6572 7365 7269   x: "regrperseri
+0000b080: 6573 5f22 202b 2073 7472 2878 2929 0d0a  es_" + str(x))..
+0000b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0a0: 2020 2020 2020 2020 2020 2020 2e72 6569              .rei
+0000b0b0: 6e64 6578 2864 6174 6573 290d 0a20 2020  ndex(dates)..   
+0000b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0d0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0000b0e0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000b0f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000b100: 2020 2020 2020 2020 2020 2063 5f68 6320             c_hc 
+0000b110: 3d20 7064 2e44 6174 6146 7261 6d65 2830  = pd.DataFrame(0
+0000b120: 2c20 696e 6465 783d 6461 7465 732c 2063  , index=dates, c
+0000b130: 6f6c 756d 6e73 3d5b 2272 6567 7270 6572  olumns=["regrper
+0000b140: 7365 7269 6573 5f30 225d 290d 0a20 2020  series_0"])..   
+0000b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b160: 2063 5f78 203d 2070 642e 636f 6e63 6174   c_x = pd.concat
+0000b170: 285b 635f 782c 2063 5f68 635d 2c20 6178  ([c_x, c_hc], ax
+0000b180: 6973 3d31 290d 0a20 2020 2020 2020 2020  is=1)..         
+0000b190: 2020 2020 2020 2023 2069 6d70 6c65 6d65         # impleme
+0000b1a0: 6e74 2070 6173 745f 696d 7061 6374 7320  nt past_impacts 
+0000b1b0: 6173 2072 6567 7265 7373 6f72 0d0a 2020  as regressor..  
+0000b1c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000b1d0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
+0000b1e0: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
+0000b1f0: 6365 2869 6d70 6163 7473 2c20 7064 2e44  ce(impacts, pd.D
+0000b200: 6174 6146 7261 6d65 290d 0a20 2020 2020  ataFrame)..     
+0000b210: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000b220: 6e64 2073 656c 662e 7061 7374 5f69 6d70  nd self.past_imp
+0000b230: 6163 7473 5f69 6e74 6572 7665 6e74 696f  acts_interventio
+0000b240: 6e20 3d3d 2022 7265 6772 6573 736f 7222  n == "regressor"
 0000b250: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b260: 2020 2020 2020 2020 2020 2020 2020 635f                c_
-0000b270: 782c 0d0a 2020 2020 2020 2020 2020 2020  x,..            
-0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b290: 696d 7061 6374 732e 7265 696e 6465 7828  impacts.reindex(
-0000b2a0: 6461 7465 7329 5b63 6f6c 5d0d 0a20 2020  dates)[col]..   
+0000b260: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
+0000b270: 2020 2020 2020 2020 2020 635f 7820 3d20            c_x = 
+0000b280: 7064 2e63 6f6e 6361 7428 0d0a 2020 2020  pd.concat(..    
+0000b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2a0: 2020 2020 5b0d 0a20 2020 2020 2020 2020      [..         
 0000b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2c0: 2020 2020 2020 2020 202e 746f 5f66 7261           .to_fra
-0000b2d0: 6d65 2829 0d0a 2020 2020 2020 2020 2020  me()..          
-0000b2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b2f0: 2020 2e66 696c 6c6e 6128 3029 0d0a 2020    .fillna(0)..  
-0000b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b310: 2020 2020 2020 2020 2020 2e72 656e 616d            .renam
-0000b320: 6528 636f 6c75 6d6e 733d 6c61 6d62 6461  e(columns=lambda
-0000b330: 2078 3a20 2269 6d70 6163 7473 5f22 202b   x: "impacts_" +
-0000b340: 2073 7472 2878 2929 2c0d 0a20 2020 2020   str(x)),..     
-0000b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b360: 2020 205d 2c0d 0a20 2020 2020 2020 2020     ],..         
-0000b370: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000b380: 7869 733d 312c 0d0a 2020 2020 2020 2020  xis=1,..        
-0000b390: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-0000b3a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000b3b0: 2061 6464 2041 5220 6665 6174 7572 6573   add AR features
-0000b3c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b3d0: 2020 6966 2073 656c 662e 6172 5f6c 6167    if self.ar_lag
-0000b3e0: 7320 6973 206e 6f74 204e 6f6e 653a 0d0a  s is not None:..
-0000b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b400: 2020 2020 2320 736f 6d65 7768 6174 2069      # somewhat i
-0000b410: 6e65 6666 6963 6965 6e74 2074 6f20 6372  nefficient to cr
-0000b420: 6561 7465 2066 756c 6c20 6466 206f 6620  eate full df of 
-0000b430: 6461 7465 732c 2062 7574 2073 696d 706c  dates, but simpl
-0000b440: 6573 7420 7468 6973 2077 6179 2066 6f72  est this way for
-0000b450: 2027 616e 7920 6461 7465 270d 0a20 2020   'any date'..   
-0000b460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b470: 2066 6f72 206c 6167 2069 6e20 7365 6c66   for lag in self
-0000b480: 2e61 725f 6c61 6773 3a0d 0a20 2020 2020  .ar_lags:..     
-0000b490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4a0: 2020 2066 756c 6c5f 6964 7820 3d20 6869     full_idx = hi
-0000b4b0: 7374 6f72 795f 6466 2e69 6e64 6578 2e75  story_df.index.u
-0000b4c0: 6e69 6f6e 280d 0a20 2020 2020 2020 2020  nion(..         
-0000b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4e0: 2020 2073 656c 662e 6372 6561 7465 5f66     self.create_f
-0000b4f0: 6f72 6563 6173 745f 696e 6465 7828 0d0a  orecast_index(..
-0000b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b520: 666f 7265 6361 7374 5f6c 656e 6774 683d  forecast_length=
-0000b530: 6c61 672c 206c 6173 745f 6461 7465 3d68  lag, last_date=h
-0000b540: 6973 746f 7279 5f64 662e 696e 6465 785b  istory_df.index[
-0000b550: 2d31 5d0d 0a20 2020 2020 2020 2020 2020  -1]..           
+0000b2c0: 2020 2063 5f78 2c0d 0a20 2020 2020 2020     c_x,..       
+0000b2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2e0: 2020 2020 2069 6d70 6163 7473 2e72 6569       impacts.rei
+0000b2f0: 6e64 6578 2864 6174 6573 295b 636f 6c5d  ndex(dates)[col]
+0000b300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b310: 2020 2020 2020 2020 2020 2020 2020 2e74                .t
+0000b320: 6f5f 6672 616d 6528 290d 0a20 2020 2020  o_frame()..     
+0000b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b340: 2020 2020 2020 202e 6669 6c6c 6e61 2830         .fillna(0
+0000b350: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000b360: 2020 2020 2020 2020 2020 2020 2020 202e                 .
+0000b370: 7265 6e61 6d65 2863 6f6c 756d 6e73 3d6c  rename(columns=l
+0000b380: 616d 6264 6120 783a 2022 696d 7061 6374  ambda x: "impact
+0000b390: 735f 2220 2b20 7374 7228 7829 292c 0d0a  s_" + str(x)),..
+0000b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3b0: 2020 2020 2020 2020 5d2c 0d0a 2020 2020          ],..    
+0000b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3d0: 2020 2020 6178 6973 3d31 2c0d 0a20 2020      axis=1,..   
+0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3f0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+0000b400: 2020 2020 2320 6164 6420 4152 2066 6561      # add AR fea
+0000b410: 7475 7265 730d 0a20 2020 2020 2020 2020  tures..         
+0000b420: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
+0000b430: 725f 6c61 6773 2069 7320 6e6f 7420 4e6f  r_lags is not No
+0000b440: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0000b450: 2020 2020 2020 2020 2023 2073 6f6d 6577           # somew
+0000b460: 6861 7420 696e 6566 6669 6369 656e 7420  hat inefficient 
+0000b470: 746f 2063 7265 6174 6520 6675 6c6c 2064  to create full d
+0000b480: 6620 6f66 2064 6174 6573 2c20 6275 7420  f of dates, but 
+0000b490: 7369 6d70 6c65 7374 2074 6869 7320 7761  simplest this wa
+0000b4a0: 7920 666f 7220 2761 6e79 2064 6174 6527  y for 'any date'
+0000b4b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b4c0: 2020 2020 2020 666f 7220 6c61 6720 696e        for lag in
+0000b4d0: 2073 656c 662e 6172 5f6c 6167 733a 0d0a   self.ar_lags:..
+0000b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4f0: 2020 2020 2020 2020 6675 6c6c 5f69 6478          full_idx
+0000b500: 203d 2068 6973 746f 7279 5f64 662e 696e   = history_df.in
+0000b510: 6465 782e 756e 696f 6e28 0d0a 2020 2020  dex.union(..    
+0000b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b530: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
+0000b540: 6174 655f 666f 7265 6361 7374 5f69 6e64  ate_forecast_ind
+0000b550: 6578 280d 0a20 2020 2020 2020 2020 2020  ex(..           
 0000b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b570: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-0000b580: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-0000b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b5a0: 2020 2020 2020 206c 6167 5f69 6478 203d         lag_idx =
-0000b5b0: 206e 702e 636f 6e63 6174 656e 6174 6528   np.concatenate(
-0000b5c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b5d0: 2020 2020 2020 2020 2020 2020 2020 5b6e                [n
-0000b5e0: 702e 7265 7065 6174 285b 305d 2c20 6c61  p.repeat([0], la
-0000b5f0: 6729 2c20 6e70 2e61 7261 6e67 6528 6c65  g), np.arange(le
-0000b600: 6e28 6869 7374 6f72 795f 6466 2929 5d0d  n(history_df))].
-0000b610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b620: 2020 2020 2020 2020 2029 2020 2320 5b30           )  # [0
-0000b630: 3a6c 656e 2868 6973 746f 7279 5f64 6629  :len(history_df)
-0000b640: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0000b650: 2020 2020 2020 2020 2020 206c 6167 5f73             lag_s
-0000b660: 203d 2068 6973 746f 7279 5f64 665b 636f   = history_df[co
-0000b670: 6c5d 2e69 6c6f 635b 6c61 675f 6964 785d  l].iloc[lag_idx]
-0000b680: 2e72 656e 616d 6528 6622 6c61 677b 6c61  .rename(f"lag{la
-0000b690: 677d 5f22 290d 0a20 2020 2020 2020 2020  g}_")..         
-0000b6a0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000b6b0: 6167 5f73 2e69 6e64 6578 203d 2066 756c  ag_s.index = ful
-0000b6c0: 6c5f 6964 780d 0a20 2020 2020 2020 2020  l_idx..         
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000b6e0: 6167 5f73 203d 206c 6167 5f73 2e72 6569  ag_s = lag_s.rei
-0000b6f0: 6e64 6578 2864 6174 6573 290d 0a20 2020  ndex(dates)..   
-0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b710: 2020 2020 2069 6620 7365 6c66 2e61 725f       if self.ar_
-0000b720: 696e 7465 7261 6374 696f 6e5f 7365 6173  interaction_seas
-0000b730: 6f6e 616c 6974 7920 6973 206e 6f74 204e  onality is not N
-0000b740: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0000b750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b760: 2020 735f 6665 6174 203d 2063 7265 6174    s_feat = creat
-0000b770: 655f 7365 6173 6f6e 616c 6974 795f 6665  e_seasonality_fe
-0000b780: 6174 7572 6528 0d0a 2020 2020 2020 2020  ature(..        
-0000b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7a0: 2020 2020 2020 2020 6461 7465 732c 0d0a          dates,..
-0000b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7d0: 7365 6c66 2e74 5f70 7265 6469 6374 2c0d  self.t_predict,.
-0000b7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b800: 2073 656c 662e 6172 5f69 6e74 6572 6163   self.ar_interac
-0000b810: 7469 6f6e 5f73 6561 736f 6e61 6c69 7479  tion_seasonality
-0000b820: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b840: 2020 2068 6973 746f 7279 5f64 6179 733d     history_days=
-0000b850: 7365 6c66 2e68 6973 746f 7279 5f64 6179  self.history_day
-0000b860: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
-0000b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b880: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000b890: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b8a0: 5f66 6561 742e 696e 6465 7820 3d20 6c61  _feat.index = la
-0000b8b0: 675f 732e 696e 6465 780d 0a20 2020 2020  g_s.index..     
+0000b570: 2020 2020 2066 6f72 6563 6173 745f 6c65       forecast_le
+0000b580: 6e67 7468 3d6c 6167 2c20 6c61 7374 5f64  ngth=lag, last_d
+0000b590: 6174 653d 6869 7374 6f72 795f 6466 2e69  ate=history_df.i
+0000b5a0: 6e64 6578 5b2d 315d 0d0a 2020 2020 2020  ndex[-1]..      
+0000b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5e0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
+0000b5f0: 2020 2020 2020 2020 2020 2020 6c61 675f              lag_
+0000b600: 6964 7820 3d20 6e70 2e63 6f6e 6361 7465  idx = np.concate
+0000b610: 6e61 7465 280d 0a20 2020 2020 2020 2020  nate(..         
+0000b620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b630: 2020 205b 6e70 2e72 6570 6561 7428 5b30     [np.repeat([0
+0000b640: 5d2c 206c 6167 292c 206e 702e 6172 616e  ], lag), np.aran
+0000b650: 6765 286c 656e 2868 6973 746f 7279 5f64  ge(len(history_d
+0000b660: 6629 295d 0d0a 2020 2020 2020 2020 2020  f))]..          
+0000b670: 2020 2020 2020 2020 2020 2020 2020 2920                ) 
+0000b680: 2023 205b 303a 6c65 6e28 6869 7374 6f72   # [0:len(histor
+0000b690: 795f 6466 295d 0d0a 2020 2020 2020 2020  y_df)]..        
+0000b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6b0: 6c61 675f 7320 3d20 6869 7374 6f72 795f  lag_s = history_
+0000b6c0: 6466 5b63 6f6c 5d2e 696c 6f63 5b6c 6167  df[col].iloc[lag
+0000b6d0: 5f69 6478 5d2e 7265 6e61 6d65 2866 226c  _idx].rename(f"l
+0000b6e0: 6167 7b6c 6167 7d5f 2229 0d0a 2020 2020  ag{lag}_")..    
+0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b700: 2020 2020 6c61 675f 732e 696e 6465 7820      lag_s.index 
+0000b710: 3d20 6675 6c6c 5f69 6478 0d0a 2020 2020  = full_idx..    
+0000b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b730: 2020 2020 6c61 675f 7320 3d20 6c61 675f      lag_s = lag_
+0000b740: 732e 7265 696e 6465 7828 6461 7465 7329  s.reindex(dates)
+0000b750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b760: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000b770: 662e 6172 5f69 6e74 6572 6163 7469 6f6e  f.ar_interaction
+0000b780: 5f73 6561 736f 6e61 6c69 7479 2069 7320  _seasonality is 
+0000b790: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0000b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7b0: 2020 2020 2020 2073 5f66 6561 7420 3d20         s_feat = 
+0000b7c0: 6372 6561 7465 5f73 6561 736f 6e61 6c69  create_seasonali
+0000b7d0: 7479 5f66 6561 7475 7265 280d 0a20 2020  ty_feature(..   
+0000b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7f0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0000b800: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
+0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b820: 2020 2020 2073 656c 662e 745f 7072 6564       self.t_pred
+0000b830: 6963 742c 0d0a 2020 2020 2020 2020 2020  ict,..          
+0000b840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b850: 2020 2020 2020 7365 6c66 2e61 725f 696e        self.ar_in
+0000b860: 7465 7261 6374 696f 6e5f 7365 6173 6f6e  teraction_season
+0000b870: 616c 6974 792c 0d0a 2020 2020 2020 2020  ality,..        
+0000b880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b890: 2020 2020 2020 2020 6869 7374 6f72 795f          history_
+0000b8a0: 6461 7973 3d73 656c 662e 6869 7374 6f72  days=self.histor
+0000b8b0: 795f 6461 7973 2c0d 0a20 2020 2020 2020  y_days,..       
 0000b8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8d0: 2020 2020 2020 206c 6167 5f73 203d 2073         lag_s = s
-0000b8e0: 5f66 6561 742e 6d75 6c28 6c61 675f 732c  _feat.mul(lag_s,
-0000b8f0: 2061 7869 733d 3029 2e72 656e 616d 6528   axis=0).rename(
-0000b900: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000b8d0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0000b8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8f0: 2020 2020 735f 6665 6174 2e69 6e64 6578      s_feat.index
+0000b900: 203d 206c 6167 5f73 2e69 6e64 6578 0d0a   = lag_s.index..
 0000b910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b920: 2020 636f 6c75 6d6e 733d 6c61 6d62 6461    columns=lambda
-0000b930: 2078 3a20 6622 6c61 677b 6c61 677d 5f22   x: f"lag{lag}_"
-0000b940: 202b 2073 7472 2878 290d 0a20 2020 2020   + str(x)..     
-0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b960: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-0000b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b980: 2020 635f 7820 3d20 7064 2e63 6f6e 6361    c_x = pd.conca
-0000b990: 7428 5b63 5f78 2c20 6c61 675f 735d 2c20  t([c_x, lag_s], 
-0000b9a0: 6178 6973 3d31 290d 0a0d 0a20 2020 2020  axis=1)....     
-0000b9b0: 2020 2020 2020 2020 2020 2023 2041 4444             # ADD
-0000b9c0: 494e 4720 5245 4345 4e43 5920 5745 4947  ING RECENCY WEIG
-0000b9d0: 4854 494e 4720 414e 4420 5249 4447 4520  HTING AND RIDGE 
-0000b9e0: 5041 5241 4d53 0d0a 2020 2020 2020 2020  PARAMS..        
-0000b9f0: 2020 2020 2020 2020 6966 206e 702e 616e          if np.an
-0000ba00: 7928 6e70 2e69 736e 616e 2863 5f78 2e61  y(np.isnan(c_x.a
-0000ba10: 7374 7970 6528 666c 6f61 7429 2929 3a20  stype(float))): 
-0000ba20: 2023 2072 656d 6f76 6520 6c61 7465 722c   # remove later,
-0000ba30: 2066 6f72 2064 6562 7567 6769 6e67 0d0a   for debugging..
-0000ba40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba50: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000ba60: 7272 6f72 2822 6e61 6e20 7661 6c75 6573  rror("nan values
-0000ba70: 2069 6e20 7072 6564 6963 7420 635f 785f   in predict c_x_
-0000ba80: 6172 7261 7922 290d 0a20 2020 2020 2020  array")..       
-0000ba90: 2020 2020 2020 2020 2070 7265 6469 6374           predict
-0000baa0: 732e 6170 7065 6e64 280d 0a20 2020 2020  s.append(..     
-0000bab0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000bac0: 642e 5365 7269 6573 280d 0a20 2020 2020  d.Series(..     
-0000bad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bae0: 2020 206e 702e 646f 7428 0d0a 2020 2020     np.dot(..    
-0000baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb00: 2020 2020 2020 2020 635f 785b 7365 6c66          c_x[self
-0000bb10: 2e6b 6565 705f 636f 6c73 5b63 6f6c 5d5d  .keep_cols[col]]
-0000bb20: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-0000bb30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000bb40: 656c 662e 7061 7261 6d73 5b63 6f6c 5d5b  elf.params[col][
-0000bb50: 7365 6c66 2e6b 6565 705f 636f 6c73 5f69  self.keep_cols_i
-0000bb60: 6478 5b63 6f6c 5d5d 2c0d 0a20 2020 2020  dx[col]],..     
-0000bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb80: 2020 2029 2e66 6c61 7474 656e 2829 2c0d     ).flatten(),.
-0000bb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bba0: 2020 2020 2020 2020 206e 616d 653d 636f           name=co
-0000bbb0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-0000bbc0: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-0000bbd0: 783d 6461 7465 732c 0d0a 2020 2020 2020  x=dates,..      
-0000bbe0: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-0000bbf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bc00: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-0000bc10: 2020 2020 7365 6c66 2e70 7265 6469 6374      self.predict
-0000bc20: 5f78 5f61 7272 6179 5b63 6f6c 5d20 3d20  _x_array[col] = 
-0000bc30: 635f 780d 0a20 2020 2020 2020 2020 2020  c_x..           
-0000bc40: 2020 2020 2069 6620 7265 7475 726e 5f63       if return_c
-0000bc50: 6f6d 706f 6e65 6e74 733a 0d0a 2020 2020  omponents:..    
-0000bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc70: 696e 6469 6365 7320 3d20 5b0d 0a20 2020  indices = [..   
-0000bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc90: 2020 2020 2074 7570 6c65 2867 726f 7570       tuple(group
-0000bca0: 295b 2d31 5d5b 305d 0d0a 2020 2020 2020  )[-1][0]..      
-0000bcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bcc0: 2020 666f 7220 6b65 792c 2067 726f 7570    for key, group
-0000bcd0: 2069 6e20 6772 6f75 7062 7928 0d0a 2020   in groupby(..  
-0000bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bcf0: 2020 2020 2020 2020 2020 656e 756d 6572            enumer
-0000bd00: 6174 6528 7365 6c66 2e63 6f6c 5f67 726f  ate(self.col_gro
-0000bd10: 7570 696e 6773 5b63 6f6c 5d29 2c20 6b65  upings[col]), ke
-0000bd20: 793d 6974 656d 6765 7474 6572 2831 290d  y=itemgetter(1).
-0000bd30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bd40: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-0000bd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd60: 5d5b 3a2d 315d 0d0a 2020 2020 2020 2020  ][:-1]..        
-0000bd70: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000bd80: 696e 6478 203d 205b 305d 202b 205b 7820  indx = [0] + [x 
-0000bd90: 2b20 3120 666f 7220 7820 696e 2069 6e64  + 1 for x in ind
-0000bda0: 6963 6573 5d0d 0a20 2020 2020 2020 2020  ices]..         
-0000bdb0: 2020 2020 2020 2020 2020 2074 656d 7020             temp 
-0000bdc0: 3d20 280d 0a20 2020 2020 2020 2020 2020  = (..           
-0000bdd0: 2020 2020 2020 2020 2020 2020 2063 5f78               c_x
-0000bde0: 5b73 656c 662e 6b65 6570 5f63 6f6c 735b  [self.keep_cols[
-0000bdf0: 636f 6c5d 5d0d 0a20 2020 2020 2020 2020  col]]..         
-0000be00: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0000be10: 2073 656c 662e 7061 7261 6d73 5b63 6f6c   self.params[col
-0000be20: 5d5b 7365 6c66 2e6b 6565 705f 636f 6c73  ][self.keep_cols
-0000be30: 5f69 6478 5b63 6f6c 5d5d 2e66 6c61 7474  _idx[col]].flatt
-0000be40: 656e 2829 0d0a 2020 2020 2020 2020 2020  en()..          
-0000be50: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-0000be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be70: 2073 656c 662e 636f 6d70 6f6e 656e 7473   self.components
-0000be80: 2e61 7070 656e 6428 0d0a 2020 2020 2020  .append(..      
-0000be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bea0: 2020 6e70 2e61 6464 2e72 6564 7563 6561    np.add.reducea
-0000beb0: 7428 6e70 2e61 7361 7272 6179 2874 656d  t(np.asarray(tem
-0000bec0: 7029 2c20 736f 7274 6564 286e 6577 5f69  p), sorted(new_i
-0000bed0: 6e64 7829 2c20 6178 6973 3d31 290d 0a20  ndx), axis=1).. 
+0000b920: 2020 2020 2020 2020 2020 2020 6c61 675f              lag_
+0000b930: 7320 3d20 735f 6665 6174 2e6d 756c 286c  s = s_feat.mul(l
+0000b940: 6167 5f73 2c20 6178 6973 3d30 292e 7265  ag_s, axis=0).re
+0000b950: 6e61 6d65 280d 0a20 2020 2020 2020 2020  name(..         
+0000b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b970: 2020 2020 2020 2063 6f6c 756d 6e73 3d6c         columns=l
+0000b980: 616d 6264 6120 783a 2066 226c 6167 7b6c  ambda x: f"lag{l
+0000b990: 6167 7d5f 2220 2b20 7374 7228 7829 0d0a  ag}_" + str(x)..
+0000b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9b0: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000b9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9d0: 2020 2020 2020 2063 5f78 203d 2070 642e         c_x = pd.
+0000b9e0: 636f 6e63 6174 285b 635f 782c 206c 6167  concat([c_x, lag
+0000b9f0: 5f73 5d2c 2061 7869 733d 3129 0d0a 0d0a  _s], axis=1)....
+0000ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba10: 2320 4144 4449 4e47 2052 4543 454e 4359  # ADDING RECENCY
+0000ba20: 2057 4549 4748 5449 4e47 2041 4e44 2052   WEIGHTING AND R
+0000ba30: 4944 4745 2050 4152 414d 530d 0a20 2020  IDGE PARAMS..   
+0000ba40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000ba50: 6e70 2e61 6e79 286e 702e 6973 6e61 6e28  np.any(np.isnan(
+0000ba60: 635f 782e 6173 7479 7065 2866 6c6f 6174  c_x.astype(float
+0000ba70: 2929 293a 2020 2320 7265 6d6f 7665 206c  ))):  # remove l
+0000ba80: 6174 6572 2c20 666f 7220 6465 6275 6767  ater, for debugg
+0000ba90: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
+0000baa0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0000bab0: 616c 7565 4572 726f 7228 226e 616e 2076  alueError("nan v
+0000bac0: 616c 7565 7320 696e 2070 7265 6469 6374  alues in predict
+0000bad0: 2063 5f78 5f61 7272 6179 2229 0d0a 2020   c_x_array")..  
+0000bae0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000baf0: 6564 6963 7473 2e61 7070 656e 6428 0d0a  edicts.append(..
+0000bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb10: 2020 2020 7064 2e53 6572 6965 7328 0d0a      pd.Series(..
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb30: 2020 2020 2020 2020 6e70 2e64 6f74 280d          np.dot(.
+0000bb40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bb50: 2020 2020 2020 2020 2020 2020 2063 5f78               c_x
+0000bb60: 5b73 656c 662e 6b65 6570 5f63 6f6c 735b  [self.keep_cols[
+0000bb70: 636f 6c5d 5d2c 0d0a 2020 2020 2020 2020  col]],..        
+0000bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb90: 2020 2020 7365 6c66 2e70 6172 616d 735b      self.params[
+0000bba0: 636f 6c5d 5b73 656c 662e 6b65 6570 5f63  col][self.keep_c
+0000bbb0: 6f6c 735f 6964 785b 636f 6c5d 5d2c 0d0a  ols_idx[col]],..
+0000bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbd0: 2020 2020 2020 2020 292e 666c 6174 7465          ).flatte
+0000bbe0: 6e28 292c 0d0a 2020 2020 2020 2020 2020  n(),..          
+0000bbf0: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+0000bc00: 6d65 3d63 6f6c 2c0d 0a20 2020 2020 2020  me=col,..       
+0000bc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc20: 2069 6e64 6578 3d64 6174 6573 2c0d 0a20   index=dates,.. 
+0000bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc40: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+0000bc50: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000bc60: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000bc70: 6564 6963 745f 785f 6172 7261 795b 636f  edict_x_array[co
+0000bc80: 6c5d 203d 2063 5f78 0d0a 2020 2020 2020  l] = c_x..      
+0000bc90: 2020 2020 2020 2020 2020 6966 2072 6574            if ret
+0000bca0: 7572 6e5f 636f 6d70 6f6e 656e 7473 3a0d  urn_components:.
+0000bcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bcc0: 2020 2020 2069 6e64 6963 6573 203d 205b       indices = [
+0000bcd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bce0: 2020 2020 2020 2020 2020 7475 706c 6528            tuple(
+0000bcf0: 6772 6f75 7029 5b2d 315d 5b30 5d0d 0a20  group)[-1][0].. 
+0000bd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd10: 2020 2020 2020 2066 6f72 206b 6579 2c20         for key, 
+0000bd20: 6772 6f75 7020 696e 2067 726f 7570 6279  group in groupby
+0000bd30: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000bd40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000bd50: 6e75 6d65 7261 7465 2873 656c 662e 636f  numerate(self.co
+0000bd60: 6c5f 6772 6f75 7069 6e67 735b 636f 6c5d  l_groupings[col]
+0000bd70: 292c 206b 6579 3d69 7465 6d67 6574 7465  ), key=itemgette
+0000bd80: 7228 3129 0d0a 2020 2020 2020 2020 2020  r(1)..          
+0000bd90: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+0000bda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bdb0: 2020 2020 205d 5b3a 2d31 5d0d 0a20 2020       ][:-1]..   
+0000bdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bdd0: 206e 6577 5f69 6e64 7820 3d20 5b30 5d20   new_indx = [0] 
+0000bde0: 2b20 5b78 202b 2031 2066 6f72 2078 2069  + [x + 1 for x i
+0000bdf0: 6e20 696e 6469 6365 735d 0d0a 2020 2020  n indices]..    
+0000be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be10: 7465 6d70 203d 2028 0d0a 2020 2020 2020  temp = (..      
+0000be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be30: 2020 635f 785b 7365 6c66 2e6b 6565 705f    c_x[self.keep_
+0000be40: 636f 6c73 5b63 6f6c 5d5d 0d0a 2020 2020  cols[col]]..    
+0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be60: 2020 2020 2a20 7365 6c66 2e70 6172 616d      * self.param
+0000be70: 735b 636f 6c5d 5b73 656c 662e 6b65 6570  s[col][self.keep
+0000be80: 5f63 6f6c 735f 6964 785b 636f 6c5d 5d2e  _cols_idx[col]].
+0000be90: 666c 6174 7465 6e28 290d 0a20 2020 2020  flatten()..     
+0000bea0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000beb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bec0: 2020 2020 2020 7365 6c66 2e63 6f6d 706f        self.compo
+0000bed0: 6e65 6e74 732e 6170 7065 6e64 280d 0a20  nents.append(.. 
 0000bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bef0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-0000bf00: 2020 6966 2072 6574 7572 6e5f 636f 6d70    if return_comp
-0000bf10: 6f6e 656e 7473 3a0d 0a20 2020 2020 2020  onents:..       
-0000bf20: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-0000bf30: 6d70 6f6e 656e 7473 203d 206e 702e 6d6f  mponents = np.mo
-0000bf40: 7665 6178 6973 286e 702e 6172 7261 7928  veaxis(np.array(
-0000bf50: 7365 6c66 2e63 6f6d 706f 6e65 6e74 7329  self.components)
-0000bf60: 2c20 302c 2032 290d 0a20 2020 2020 2020  , 0, 2)..       
-0000bf70: 2020 2020 2020 2020 2073 656c 662e 6c61           self.la
-0000bf80: 7374 5f75 7365 6420 3d20 636f 6c0d 0a20  st_used = col.. 
-0000bf90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000bfa0: 656c 662e 636f 6d70 6f6e 656e 745f 696e  elf.component_in
-0000bfb0: 6478 203d 2028 0d0a 2020 2020 2020 2020  dx = (..        
-0000bfc0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000bfd0: 696e 6478 2020 2320 686f 7065 6675 6c6c  indx  # hopefull
-0000bfe0: 7920 6e6f 206d 6973 6d61 7463 6869 6e67  y no mismatching
-0000bff0: 2066 6f72 2064 6966 6620 7365 7269 6573   for diff series
-0000c000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c010: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-0000c020: 2072 6574 7572 6e20 7064 2e63 6f6e 6361   return pd.conca
-0000c030: 7428 7072 6564 6963 7473 2c20 6178 6973  t(predicts, axis
-0000c040: 3d31 290d 0a20 2020 2020 2020 2065 6c73  =1)..        els
-0000c050: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000c060: 2320 7275 6e20 6d6f 6465 6c0d 0a20 2020  # run model..   
-0000c070: 2020 2020 2020 2020 2072 6573 203d 206e           res = n
-0000c080: 702e 646f 7428 785f 6172 7261 795b 7365  p.dot(x_array[se
-0000c090: 6c66 2e6b 6565 705f 636f 6c73 5d2c 2073  lf.keep_cols], s
-0000c0a0: 656c 662e 7061 7261 6d73 5b73 656c 662e  elf.params[self.
-0000c0b0: 6b65 6570 5f63 6f6c 735f 6964 785d 290d  keep_cols_idx]).
-0000c0c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c0d0: 7265 7475 726e 5f63 6f6d 706f 6e65 6e74  return_component
-0000c0e0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000c0f0: 2020 2020 6172 7220 3d20 785f 6172 7261      arr = x_arra
-0000c100: 795b 7365 6c66 2e6b 6565 705f 636f 6c73  y[self.keep_cols
-0000c110: 5d2e 746f 5f6e 756d 7079 2829 0d0a 2020  ].to_numpy()..  
-0000c120: 2020 2020 2020 2020 2020 2020 2020 7465                te
-0000c130: 6d70 203d 2028 0d0a 2020 2020 2020 2020  mp = (..        
-0000c140: 2020 2020 2020 2020 2020 2020 6e70 2e6d              np.m
-0000c150: 6f76 6561 7869 7328 0d0a 2020 2020 2020  oveaxis(..      
-0000c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c170: 2020 6e70 2e62 726f 6164 6361 7374 5f74    np.broadcast_t
-0000c180: 6f28 0d0a 2020 2020 2020 2020 2020 2020  o(..            
+0000bef0: 2020 2020 2020 206e 702e 6164 642e 7265         np.add.re
+0000bf00: 6475 6365 6174 286e 702e 6173 6172 7261  duceat(np.asarra
+0000bf10: 7928 7465 6d70 292c 2073 6f72 7465 6428  y(temp), sorted(
+0000bf20: 6e65 775f 696e 6478 292c 2061 7869 733d  new_indx), axis=
+0000bf30: 3129 0d0a 2020 2020 2020 2020 2020 2020  1)..            
+0000bf40: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+0000bf50: 2020 2020 2020 2069 6620 7265 7475 726e         if return
+0000bf60: 5f63 6f6d 706f 6e65 6e74 733a 0d0a 2020  _components:..  
+0000bf70: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000bf80: 6c66 2e63 6f6d 706f 6e65 6e74 7320 3d20  lf.components = 
+0000bf90: 6e70 2e6d 6f76 6561 7869 7328 6e70 2e61  np.moveaxis(np.a
+0000bfa0: 7272 6179 2873 656c 662e 636f 6d70 6f6e  rray(self.compon
+0000bfb0: 656e 7473 292c 2030 2c20 3229 0d0a 2020  ents), 0, 2)..  
+0000bfc0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000bfd0: 6c66 2e6c 6173 745f 7573 6564 203d 2063  lf.last_used = c
+0000bfe0: 6f6c 0d0a 2020 2020 2020 2020 2020 2020  ol..            
+0000bff0: 2020 2020 7365 6c66 2e63 6f6d 706f 6e65      self.compone
+0000c000: 6e74 5f69 6e64 7820 3d20 280d 0a20 2020  nt_indx = (..   
+0000c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c020: 206e 6577 5f69 6e64 7820 2023 2068 6f70   new_indx  # hop
+0000c030: 6566 756c 6c79 206e 6f20 6d69 736d 6174  efully no mismat
+0000c040: 6368 696e 6720 666f 7220 6469 6666 2073  ching for diff s
+0000c050: 6572 6965 730d 0a20 2020 2020 2020 2020  eries..         
+0000c060: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000c070: 2020 2020 2020 7265 7475 726e 2070 642e        return pd.
+0000c080: 636f 6e63 6174 2870 7265 6469 6374 732c  concat(predicts,
+0000c090: 2061 7869 733d 3129 0d0a 2020 2020 2020   axis=1)..      
+0000c0a0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0000c0b0: 2020 2020 2023 2072 756e 206d 6f64 656c       # run model
+0000c0c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000c0d0: 7320 3d20 6e70 2e64 6f74 2878 5f61 7272  s = np.dot(x_arr
+0000c0e0: 6179 5b73 656c 662e 6b65 6570 5f63 6f6c  ay[self.keep_col
+0000c0f0: 735d 2c20 7365 6c66 2e70 6172 616d 735b  s], self.params[
+0000c100: 7365 6c66 2e6b 6565 705f 636f 6c73 5f69  self.keep_cols_i
+0000c110: 6478 5d29 0d0a 2020 2020 2020 2020 2020  dx])..          
+0000c120: 2020 6966 2072 6574 7572 6e5f 636f 6d70    if return_comp
+0000c130: 6f6e 656e 7473 3a0d 0a20 2020 2020 2020  onents:..       
+0000c140: 2020 2020 2020 2020 2061 7272 203d 2078           arr = x
+0000c150: 5f61 7272 6179 5b73 656c 662e 6b65 6570  _array[self.keep
+0000c160: 5f63 6f6c 735d 2e74 6f5f 6e75 6d70 7928  _cols].to_numpy(
+0000c170: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000c180: 2020 2074 656d 7020 3d20 280d 0a20 2020     temp = (..   
 0000c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1a0: 6172 722c 205b 7365 6c66 2e70 6172 616d  arr, [self.param
-0000c1b0: 732e 7368 6170 655b 315d 2c20 6172 722e  s.shape[1], arr.
-0000c1c0: 7368 6170 655b 305d 2c20 6172 722e 7368  shape[0], arr.sh
-0000c1d0: 6170 655b 315d 5d0d 0a20 2020 2020 2020  ape[1]]..       
+0000c1a0: 206e 702e 6d6f 7665 6178 6973 280d 0a20   np.moveaxis(.. 
+0000c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1c0: 2020 2020 2020 206e 702e 6272 6f61 6463         np.broadc
+0000c1d0: 6173 745f 746f 280d 0a20 2020 2020 2020  ast_to(..       
 0000c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1f0: 2029 2c0d 0a20 2020 2020 2020 2020 2020   ),..           
-0000c200: 2020 2020 2020 2020 2020 2020 2030 2c0d               0,.
-0000c210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c220: 2020 2020 2020 2020 2032 2c0d 0a20 2020           2,..   
+0000c1f0: 2020 2020 2061 7272 2c20 5b73 656c 662e       arr, [self.
+0000c200: 7061 7261 6d73 2e73 6861 7065 5b31 5d2c  params.shape[1],
+0000c210: 2061 7272 2e73 6861 7065 5b30 5d2c 2061   arr.shape[0], a
+0000c220: 7272 2e73 6861 7065 5b31 5d5d 0d0a 2020  rr.shape[1]]..  
 0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c240: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-0000c250: 2020 2020 2020 2020 2a20 7365 6c66 2e70          * self.p
-0000c260: 6172 616d 735b 7365 6c66 2e6b 6565 705f  arams[self.keep_
-0000c270: 636f 6c73 5f69 6478 5d0d 0a20 2020 2020  cols_idx]..     
-0000c280: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-0000c290: 2020 2020 2020 2020 2020 2020 2020 696e                in
-0000c2a0: 6469 6365 7320 3d20 5b0d 0a20 2020 2020  dices = [..     
-0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000c2c0: 7570 6c65 2867 726f 7570 295b 2d31 5d5b  uple(group)[-1][
-0000c2d0: 305d 0d0a 2020 2020 2020 2020 2020 2020  0]..            
-0000c2e0: 2020 2020 2020 2020 666f 7220 6b65 792c          for key,
-0000c2f0: 2067 726f 7570 2069 6e20 6772 6f75 7062   group in groupb
-0000c300: 7928 0d0a 2020 2020 2020 2020 2020 2020  y(..            
-0000c310: 2020 2020 2020 2020 2020 2020 656e 756d              enum
-0000c320: 6572 6174 6528 7365 6c66 2e63 6f6c 5f67  erate(self.col_g
-0000c330: 726f 7570 696e 6773 292c 206b 6579 3d69  roupings), key=i
-0000c340: 7465 6d67 6574 7465 7228 3129 0d0a 2020  temgetter(1)..  
-0000c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c360: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-0000c370: 2020 2020 205d 5b3a 2d31 5d0d 0a20 2020       ][:-1]..   
-0000c380: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0000c390: 5f69 6e64 7820 3d20 5b30 5d20 2b20 5b78  _indx = [0] + [x
-0000c3a0: 202b 2031 2066 6f72 2078 2069 6e20 696e   + 1 for x in in
-0000c3b0: 6469 6365 735d 0d0a 2020 2020 2020 2020  dices]..        
-0000c3c0: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
-0000c3d0: 706f 6e65 6e74 5f69 6e64 7820 3d20 6e65  ponent_indx = ne
-0000c3e0: 775f 696e 6478 0d0a 2020 2020 2020 2020  w_indx..        
-0000c3f0: 2020 2020 2020 2020 7365 6c66 2e63 6f6d          self.com
-0000c400: 706f 6e65 6e74 7320 3d20 6e70 2e61 6464  ponents = np.add
-0000c410: 2e72 6564 7563 6561 7428 0d0a 2020 2020  .reduceat(..    
-0000c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c430: 7465 6d70 2c20 736f 7274 6564 286e 6577  temp, sorted(new
-0000c440: 5f69 6e64 7829 2c20 6178 6973 3d31 0d0a  _indx), axis=1..
-0000c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c460: 2920 2023 2028 6461 7465 732c 2063 6f6d  )  # (dates, com
-0000c470: 7073 2c20 7365 7269 6573 290d 0a20 2020  ps, series)..   
-0000c480: 2020 2020 2020 2020 2020 2020 2023 206e               # n
-0000c490: 702e 616c 6c63 6c6f 7365 286e 702e 6164  p.allclose(np.ad
-0000c4a0: 642e 7265 6475 6365 6174 2874 656d 702c  d.reduceat(temp,
-0000c4b0: 205b 305d 2c20 6178 6973 3d31 295b 3a2c   [0], axis=1)[:,
-0000c4c0: 2030 2c20 3a5d 2c20 6e70 2e64 6f74 286d   0, :], np.dot(m
-0000c4d0: 6f64 2e70 7265 6469 6374 5f78 5f61 7272  od.predict_x_arr
-0000c4e0: 6179 5b6d 6f64 2e6b 6565 705f 636f 6c73  ay[mod.keep_cols
-0000c4f0: 5d2c 206d 6f64 2e70 6172 616d 735b 6d6f  ], mod.params[mo
-0000c500: 642e 6b65 6570 5f63 6f6c 735f 6964 785d  d.keep_cols_idx]
-0000c510: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-0000c520: 7265 7475 726e 2072 6573 0d0a 0d0a 2020  return res....  
-0000c530: 2020 6465 6620 7072 6f63 6573 735f 636f    def process_co
-0000c540: 6d70 6f6e 656e 7473 2873 656c 662c 2074  mponents(self, t
-0000c550: 6f5f 6f72 6967 696e 5f73 7061 6365 3d54  o_origin_space=T
-0000c560: 7275 6529 3a0d 0a20 2020 2020 2020 2022  rue):..        "
-0000c570: 2222 5363 616c 6520 616e 6420 7374 616e  ""Scale and stan
-0000c580: 6461 7264 697a 6520 636f 6d70 6f6e 656e  dardize componen
-0000c590: 7420 6f75 7470 7574 732e 2222 220d 0a20  t outputs.""".. 
-0000c5a0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-0000c5b0: 6f6d 706f 6e65 6e74 7320 6973 204e 6f6e  omponents is Non
-0000c5c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000c5d0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000c5e0: 2822 4d6f 6465 6c20 6861 7320 6e6f 7420  ("Model has not 
-0000c5f0: 7965 7420 6861 6420 6120 7072 6564 6963  yet had a predic
-0000c600: 7469 6f6e 2067 656e 6572 6174 6564 2e22  tion generated."
-0000c610: 290d 0a0d 0a20 2020 2020 2020 2074 5f69  )....        t_i
-0000c620: 6e64 7820 3d20 280d 0a20 2020 2020 2020  ndx = (..       
-0000c630: 2020 2020 206e 6578 7428 6974 6572 2873       next(iter(s
-0000c640: 656c 662e 7072 6564 6963 745f 785f 6172  elf.predict_x_ar
-0000c650: 7261 792e 7661 6c75 6573 2829 2929 2e69  ray.values())).i
-0000c660: 6e64 6578 0d0a 2020 2020 2020 2020 2020  ndex..          
-0000c670: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000c680: 7365 6c66 2e70 7265 6469 6374 5f78 5f61  self.predict_x_a
-0000c690: 7272 6179 2c20 6469 6374 290d 0a20 2020  rray, dict)..   
-0000c6a0: 2020 2020 2020 2020 2065 6c73 6520 7365           else se
-0000c6b0: 6c66 2e70 7265 6469 6374 5f78 5f61 7272  lf.predict_x_arr
-0000c6c0: 6179 2e69 6e64 6578 0d0a 2020 2020 2020  ay.index..      
-0000c6d0: 2020 290d 0a20 2020 2020 2020 2063 6f6d    )..        com
-0000c6e0: 705f 6c69 7374 203d 205b 5d0d 0a20 2020  p_list = []..   
-0000c6f0: 2020 2020 2063 6f6c 5f67 726f 7570 203d       col_group =
-0000c700: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-0000c710: 7365 6c66 2e63 6f6c 5f67 726f 7570 696e  self.col_groupin
-0000c720: 6773 5b73 656c 662e 6c61 7374 5f75 7365  gs[self.last_use
-0000c730: 645d 0d0a 2020 2020 2020 2020 2020 2020  d]..            
-0000c740: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
-0000c750: 6c66 2e63 6f6c 5f67 726f 7570 696e 6773  lf.col_groupings
-0000c760: 2c20 6469 6374 290d 0a20 2020 2020 2020  , dict)..       
-0000c770: 2020 2020 2065 6c73 6520 7365 6c66 2e63       else self.c
-0000c780: 6f6c 5f67 726f 7570 696e 6773 0d0a 2020  ol_groupings..  
-0000c790: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-0000c7a0: 2023 2075 6e66 6f72 7475 6e61 7465 6c79   # unfortunately
-0000c7b0: 2c20 6e6f 2063 686f 6963 6520 6275 7420  , no choice but 
-0000c7c0: 746f 206c 6f6f 7020 7468 6174 2049 2073  to loop that I s
-0000c7d0: 6565 2074 6f20 6170 706c 7920 696e 7665  ee to apply inve
-0000c7e0: 7273 6520 7472 616e 730d 0a20 2020 2020  rse trans..     
-0000c7f0: 2020 2066 6f72 2063 6f6d 7020 696e 2072     for comp in r
-0000c800: 616e 6765 2873 656c 662e 636f 6d70 6f6e  ange(self.compon
-0000c810: 656e 7473 2e73 6861 7065 5b31 5d29 3a0d  ents.shape[1]):.
-0000c820: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c830: 746f 5f6f 7269 6769 6e5f 7370 6163 653a  to_origin_space:
-0000c840: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c850: 2020 2320 7769 6c6c 2068 6176 6520 6973    # will have is
-0000c860: 7375 6573 206f 6e20 696e 7665 7273 6520  sues on inverse 
-0000c870: 7769 7468 2073 6f6d 6520 7472 616e 7366  with some transf
-0000c880: 6f72 6d65 7273 0d0a 2020 2020 2020 2020  ormers..        
-0000c890: 2020 2020 2020 2020 636f 6d70 5f64 6620          comp_df 
-0000c8a0: 3d20 7365 6c66 2e74 6f5f 6f72 6967 696e  = self.to_origin
-0000c8b0: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
-0000c8c0: 2020 2020 2020 2020 2020 2020 2070 642e               pd.
-0000c8d0: 4461 7461 4672 616d 6528 0d0a 2020 2020  DataFrame(..    
-0000c8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c8f0: 2020 2020 7365 6c66 2e63 6f6d 706f 6e65      self.compone
-0000c900: 6e74 735b 3a2c 2063 6f6d 702c 203a 5d2c  nts[:, comp, :],
-0000c910: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c920: 2020 2020 2020 2020 2020 696e 6465 783d            index=
-0000c930: 745f 696e 6478 2c0d 0a20 2020 2020 2020  t_indx,..       
-0000c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c950: 2063 6f6c 756d 6e73 3d73 656c 662e 636f   columns=self.co
-0000c960: 6c75 6d6e 5f6e 616d 6573 2c0d 0a20 2020  lumn_names,..   
-0000c970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c980: 2029 2c0d 0a20 2020 2020 2020 2020 2020   ),..           
-0000c990: 2020 2020 2020 2020 2063 6f6d 706f 6e65           compone
-0000c9a0: 6e74 733d 5472 7565 2c0d 0a20 2020 2020  nts=True,..     
-0000c9b0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000c9c0: 6f75 6e64 733d 5472 7565 2c0d 0a20 2020  ounds=True,..   
-0000c9d0: 2020 2020 2020 2020 2020 2020 2029 2020               )  
-0000c9e0: 2320 626f 756e 6473 3d54 7275 6520 746f  # bounds=True to
-0000c9f0: 2061 6c69 676e 2062 6574 7465 720d 0a20   align better.. 
-0000ca00: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000ca10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ca20: 2020 636f 6d70 5f64 6620 3d20 7064 2e44    comp_df = pd.D
-0000ca30: 6174 6146 7261 6d65 280d 0a20 2020 2020  ataFrame(..     
-0000ca40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000ca50: 656c 662e 636f 6d70 6f6e 656e 7473 5b3a  elf.components[:
-0000ca60: 2c20 636f 6d70 2c20 3a5d 2c0d 0a20 2020  , comp, :],..   
-0000ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ca80: 2069 6e64 6578 3d74 5f69 6e64 782c 0d0a   index=t_indx,..
+0000c240: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
+0000c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c260: 2020 302c 0d0a 2020 2020 2020 2020 2020    0,..          
+0000c270: 2020 2020 2020 2020 2020 2020 2020 322c                2,
+0000c280: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c290: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000c2a0: 2020 2020 2020 2020 2020 2020 202a 2073               * s
+0000c2b0: 656c 662e 7061 7261 6d73 5b73 656c 662e  elf.params[self.
+0000c2c0: 6b65 6570 5f63 6f6c 735f 6964 785d 0d0a  keep_cols_idx]..
+0000c2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c2e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000c2f0: 2020 2069 6e64 6963 6573 203d 205b 0d0a     indices = [..
+0000c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c310: 2020 2020 7475 706c 6528 6772 6f75 7029      tuple(group)
+0000c320: 5b2d 315d 5b30 5d0d 0a20 2020 2020 2020  [-1][0]..       
+0000c330: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0000c340: 206b 6579 2c20 6772 6f75 7020 696e 2067   key, group in g
+0000c350: 726f 7570 6279 280d 0a20 2020 2020 2020  roupby(..       
+0000c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c370: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
+0000c380: 636f 6c5f 6772 6f75 7069 6e67 7329 2c20  col_groupings), 
+0000c390: 6b65 793d 6974 656d 6765 7474 6572 2831  key=itemgetter(1
+0000c3a0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000c3b0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000c3c0: 2020 2020 2020 2020 2020 5d5b 3a2d 315d            ][:-1]
+0000c3d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c3e0: 2020 6e65 775f 696e 6478 203d 205b 305d    new_indx = [0]
+0000c3f0: 202b 205b 7820 2b20 3120 666f 7220 7820   + [x + 1 for x 
+0000c400: 696e 2069 6e64 6963 6573 5d0d 0a20 2020  in indices]..   
+0000c410: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c420: 662e 636f 6d70 6f6e 656e 745f 696e 6478  f.component_indx
+0000c430: 203d 206e 6577 5f69 6e64 780d 0a20 2020   = new_indx..   
+0000c440: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c450: 662e 636f 6d70 6f6e 656e 7473 203d 206e  f.components = n
+0000c460: 702e 6164 642e 7265 6475 6365 6174 280d  p.add.reduceat(.
+0000c470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c480: 2020 2020 2074 656d 702c 2073 6f72 7465       temp, sorte
+0000c490: 6428 6e65 775f 696e 6478 292c 2061 7869  d(new_indx), axi
+0000c4a0: 733d 310d 0a20 2020 2020 2020 2020 2020  s=1..           
+0000c4b0: 2020 2020 2029 2020 2320 2864 6174 6573       )  # (dates
+0000c4c0: 2c20 636f 6d70 732c 2073 6572 6965 7329  , comps, series)
+0000c4d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c4e0: 2020 2320 6e70 2e61 6c6c 636c 6f73 6528    # np.allclose(
+0000c4f0: 6e70 2e61 6464 2e72 6564 7563 6561 7428  np.add.reduceat(
+0000c500: 7465 6d70 2c20 5b30 5d2c 2061 7869 733d  temp, [0], axis=
+0000c510: 3129 5b3a 2c20 302c 203a 5d2c 206e 702e  1)[:, 0, :], np.
+0000c520: 646f 7428 6d6f 642e 7072 6564 6963 745f  dot(mod.predict_
+0000c530: 785f 6172 7261 795b 6d6f 642e 6b65 6570  x_array[mod.keep
+0000c540: 5f63 6f6c 735d 2c20 6d6f 642e 7061 7261  _cols], mod.para
+0000c550: 6d73 5b6d 6f64 2e6b 6565 705f 636f 6c73  ms[mod.keep_cols
+0000c560: 5f69 6478 5d29 290d 0a20 2020 2020 2020  _idx]))..       
+0000c570: 2020 2020 2072 6574 7572 6e20 7265 730d       return res.
+0000c580: 0a0d 0a20 2020 2064 6566 2070 726f 6365  ...    def proce
+0000c590: 7373 5f63 6f6d 706f 6e65 6e74 7328 7365  ss_components(se
+0000c5a0: 6c66 2c20 746f 5f6f 7269 6769 6e5f 7370  lf, to_origin_sp
+0000c5b0: 6163 653d 5472 7565 293a 0d0a 2020 2020  ace=True):..    
+0000c5c0: 2020 2020 2222 2253 6361 6c65 2061 6e64      """Scale and
+0000c5d0: 2073 7461 6e64 6172 6469 7a65 2063 6f6d   standardize com
+0000c5e0: 706f 6e65 6e74 206f 7574 7075 7473 2e22  ponent outputs."
+0000c5f0: 2222 0d0a 2020 2020 2020 2020 6966 2073  ""..        if s
+0000c600: 656c 662e 636f 6d70 6f6e 656e 7473 2069  elf.components i
+0000c610: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0000c620: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000c630: 4572 726f 7228 224d 6f64 656c 2068 6173  Error("Model has
+0000c640: 206e 6f74 2079 6574 2068 6164 2061 2070   not yet had a p
+0000c650: 7265 6469 6374 696f 6e20 6765 6e65 7261  rediction genera
+0000c660: 7465 642e 2229 0d0a 0d0a 2020 2020 2020  ted.")....      
+0000c670: 2020 745f 696e 6478 203d 2028 0d0a 2020    t_indx = (..  
+0000c680: 2020 2020 2020 2020 2020 6e65 7874 2869            next(i
+0000c690: 7465 7228 7365 6c66 2e70 7265 6469 6374  ter(self.predict
+0000c6a0: 5f78 5f61 7272 6179 2e76 616c 7565 7328  _x_array.values(
+0000c6b0: 2929 292e 696e 6465 780d 0a20 2020 2020  ))).index..     
+0000c6c0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000c6d0: 616e 6365 2873 656c 662e 7072 6564 6963  ance(self.predic
+0000c6e0: 745f 785f 6172 7261 792c 2064 6963 7429  t_x_array, dict)
+0000c6f0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0000c700: 7365 2073 656c 662e 7072 6564 6963 745f  se self.predict_
+0000c710: 785f 6172 7261 792e 696e 6465 780d 0a20  x_array.index.. 
+0000c720: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+0000c730: 2020 636f 6d70 5f6c 6973 7420 3d20 5b5d    comp_list = []
+0000c740: 0d0a 2020 2020 2020 2020 636f 6c5f 6772  ..        col_gr
+0000c750: 6f75 7020 3d20 280d 0a20 2020 2020 2020  oup = (..       
+0000c760: 2020 2020 2073 656c 662e 636f 6c5f 6772       self.col_gr
+0000c770: 6f75 7069 6e67 735b 7365 6c66 2e6c 6173  oupings[self.las
+0000c780: 745f 7573 6564 5d0d 0a20 2020 2020 2020  t_used]..       
+0000c790: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000c7a0: 6365 2873 656c 662e 636f 6c5f 6772 6f75  ce(self.col_grou
+0000c7b0: 7069 6e67 732c 2064 6963 7429 0d0a 2020  pings, dict)..  
+0000c7c0: 2020 2020 2020 2020 2020 656c 7365 2073            else s
+0000c7d0: 656c 662e 636f 6c5f 6772 6f75 7069 6e67  elf.col_grouping
+0000c7e0: 730d 0a20 2020 2020 2020 2029 0d0a 2020  s..        )..  
+0000c7f0: 2020 2020 2020 2320 756e 666f 7274 756e        # unfortun
+0000c800: 6174 656c 792c 206e 6f20 6368 6f69 6365  ately, no choice
+0000c810: 2062 7574 2074 6f20 6c6f 6f70 2074 6861   but to loop tha
+0000c820: 7420 4920 7365 6520 746f 2061 7070 6c79  t I see to apply
+0000c830: 2069 6e76 6572 7365 2074 7261 6e73 0d0a   inverse trans..
+0000c840: 2020 2020 2020 2020 666f 7220 636f 6d70          for comp
+0000c850: 2069 6e20 7261 6e67 6528 7365 6c66 2e63   in range(self.c
+0000c860: 6f6d 706f 6e65 6e74 732e 7368 6170 655b  omponents.shape[
+0000c870: 315d 293a 0d0a 2020 2020 2020 2020 2020  1]):..          
+0000c880: 2020 6966 2074 6f5f 6f72 6967 696e 5f73    if to_origin_s
+0000c890: 7061 6365 3a0d 0a20 2020 2020 2020 2020  pace:..         
+0000c8a0: 2020 2020 2020 2023 2077 696c 6c20 6861         # will ha
+0000c8b0: 7665 2069 7373 7565 7320 6f6e 2069 6e76  ve issues on inv
+0000c8c0: 6572 7365 2077 6974 6820 736f 6d65 2074  erse with some t
+0000c8d0: 7261 6e73 666f 726d 6572 730d 0a20 2020  ransformers..   
+0000c8e0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+0000c8f0: 705f 6466 203d 2073 656c 662e 746f 5f6f  p_df = self.to_o
+0000c900: 7269 6769 6e5f 7370 6163 6528 0d0a 2020  rigin_space(..  
+0000c910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c920: 2020 7064 2e44 6174 6146 7261 6d65 280d    pd.DataFrame(.
+0000c930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c940: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+0000c950: 6d70 6f6e 656e 7473 5b3a 2c20 636f 6d70  mponents[:, comp
+0000c960: 2c20 3a5d 2c0d 0a20 2020 2020 2020 2020  , :],..         
+0000c970: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000c980: 6e64 6578 3d74 5f69 6e64 782c 0d0a 2020  ndex=t_indx,..  
+0000c990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c9a0: 2020 2020 2020 636f 6c75 6d6e 733d 7365        columns=se
+0000c9b0: 6c66 2e63 6f6c 756d 6e5f 6e61 6d65 732c  lf.column_names,
+0000c9c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c9d0: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
+0000c9e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0000c9f0: 6d70 6f6e 656e 7473 3d54 7275 652c 0d0a  mponents=True,..
+0000ca00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca10: 2020 2020 626f 756e 6473 3d54 7275 652c      bounds=True,
+0000ca20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ca30: 2020 2920 2023 2062 6f75 6e64 733d 5472    )  # bounds=Tr
+0000ca40: 7565 2074 6f20 616c 6967 6e20 6265 7474  ue to align bett
+0000ca50: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+0000ca60: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000ca70: 2020 2020 2020 2063 6f6d 705f 6466 203d         comp_df =
+0000ca80: 2070 642e 4461 7461 4672 616d 6528 0d0a   pd.DataFrame(..
 0000ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000caa0: 2020 2020 636f 6c75 6d6e 733d 7365 6c66      columns=self
-0000cab0: 2e63 6f6c 756d 6e5f 6e61 6d65 732c 0d0a  .column_names,..
-0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cad0: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0000cae0: 2063 6f6c 756d 6e20 6e61 6d65 206e 6565   column name nee
-0000caf0: 6473 2074 6f20 6265 2075 6e6c 696b 656c  ds to be unlikel
-0000cb00: 7920 746f 206f 6363 7572 2069 6e20 616e  y to occur in an
-0000cb10: 2061 6374 7561 6c20 6461 7461 7365 740d   actual dataset.
-0000cb20: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
-0000cb30: 705f 6466 5b27 6373 6d6f 645f 636f 6d70  p_df['csmod_comp
-0000cb40: 6f6e 656e 7427 5d20 3d20 636f 6c5f 6772  onent'] = col_gr
-0000cb50: 6f75 705b 7365 6c66 2e63 6f6d 706f 6e65  oup[self.compone
-0000cb60: 6e74 5f69 6e64 785b 636f 6d70 5d5d 0d0a  nt_indx[comp]]..
-0000cb70: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-0000cb80: 5f6c 6973 742e 6170 7065 6e64 2863 6f6d  _list.append(com
-0000cb90: 705f 6466 290d 0a20 2020 2020 2020 2072  p_df)..        r
-0000cba0: 6574 7572 6e20 7064 2e70 6976 6f74 2870  eturn pd.pivot(p
-0000cbb0: 642e 636f 6e63 6174 2863 6f6d 705f 6c69  d.concat(comp_li
-0000cbc0: 7374 2c20 6178 6973 3d30 292c 2063 6f6c  st, axis=0), col
-0000cbd0: 756d 6e73 3d27 6373 6d6f 645f 636f 6d70  umns='csmod_comp
-0000cbe0: 6f6e 656e 7427 290d 0a0d 0a20 2020 2064  onent')....    d
-0000cbf0: 6566 205f 7072 6564 6963 745f 7374 6570  ef _predict_step
-0000cc00: 280d 0a20 2020 2020 2020 2073 656c 662c  (..        self,
-0000cc10: 0d0a 2020 2020 2020 2020 6461 7465 732c  ..        dates,
-0000cc20: 0d0a 2020 2020 2020 2020 7472 656e 645f  ..        trend_
-0000cc30: 636f 6d70 6f6e 656e 742c 0d0a 2020 2020  component,..    
-0000cc40: 2020 2020 6869 7374 6f72 795f 6466 2c0d      history_df,.
-0000cc50: 0a20 2020 2020 2020 2066 7574 7572 655f  .        future_
-0000cc60: 7265 6772 6573 736f 722c 0d0a 2020 2020  regressor,..    
-0000cc70: 2020 2020 666c 6167 5f72 6567 7265 7373      flag_regress
-0000cc80: 6f72 732c 0d0a 2020 2020 2020 2020 696d  ors,..        im
-0000cc90: 7061 6374 732c 0d0a 2020 2020 2020 2020  pacts,..        
-0000cca0: 7265 6772 6573 736f 725f 7065 725f 7365  regressor_per_se
-0000ccb0: 7269 6573 2c0d 0a20 2020 2029 3a0d 0a20  ries,..    ):.. 
-0000ccc0: 2020 2020 2020 2023 204e 6f74 6520 7468         # Note th
-0000ccd0: 6973 2069 7320 7363 616c 6564 2061 6e64  is is scaled and
-0000cce0: 2064 6f65 736e 2774 2061 6363 6f75 6e74   doesn't account
-0000ccf0: 2066 6f72 2069 6d70 6163 7473 0d0a 2020   for impacts..  
-0000cd00: 2020 2020 2020 6c69 6e65 6172 5f70 7265        linear_pre
-0000cd10: 6420 3d20 7365 6c66 2e5f 7072 6564 6963  d = self._predic
-0000cd20: 745f 6c69 6e65 6172 280d 0a20 2020 2020  t_linear(..     
-0000cd30: 2020 2020 2020 2064 6174 6573 2c0d 0a20         dates,.. 
-0000cd40: 2020 2020 2020 2020 2020 2068 6973 746f             histo
-0000cd50: 7279 5f64 663d 6869 7374 6f72 795f 6466  ry_df=history_df
-0000cd60: 2c0d 0a20 2020 2020 2020 2020 2020 2066  ,..            f
-0000cd70: 7574 7572 655f 7265 6772 6573 736f 723d  uture_regressor=
-0000cd80: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
-0000cd90: 2c0d 0a20 2020 2020 2020 2020 2020 2066  ,..            f
-0000cda0: 6c61 675f 7265 6772 6573 736f 7273 3d66  lag_regressors=f
-0000cdb0: 6c61 675f 7265 6772 6573 736f 7273 2c0d  lag_regressors,.
-0000cdc0: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
-0000cdd0: 6163 7473 3d69 6d70 6163 7473 2c0d 0a20  acts=impacts,.. 
-0000cde0: 2020 2020 2020 2020 2020 2072 6567 7265             regre
-0000cdf0: 7373 6f72 5f70 6572 5f73 6572 6965 733d  ssor_per_series=
-0000ce00: 7265 6772 6573 736f 725f 7065 725f 7365  regressor_per_se
-0000ce10: 7269 6573 2c0d 0a20 2020 2020 2020 2020  ries,..         
-0000ce20: 2020 2072 6574 7572 6e5f 636f 6d70 6f6e     return_compon
-0000ce30: 656e 7473 3d54 7275 652c 0d0a 2020 2020  ents=True,..    
-0000ce40: 2020 2020 290d 0a20 2020 2020 2020 2023      )..        #
-0000ce50: 2041 4444 2050 5245 5052 4f43 4553 5349   ADD PREPROCESSI
-0000ce60: 4e47 2042 4546 4f52 4520 5452 454e 4420  NG BEFORE TREND 
-0000ce70: 2846 4954 2058 2c20 5245 5645 5253 4520  (FIT X, REVERSE 
-0000ce80: 6f6e 2050 5245 4449 4354 2c20 5448 454e  on PREDICT, THEN
-0000ce90: 2054 5245 4e44 290d 0a20 2020 2020 2020   TREND)..       
-0000cea0: 207a 6572 6f73 5f64 6620 3d20 7064 2e44   zeros_df = pd.D
-0000ceb0: 6174 6146 7261 6d65 280d 0a20 2020 2020  ataFrame(..     
-0000cec0: 2020 2020 2020 2030 2c0d 0a20 2020 2020         0,..     
-0000ced0: 2020 2020 2020 2069 6e64 6578 3d74 7265         index=tre
-0000cee0: 6e64 5f63 6f6d 706f 6e65 6e74 2e66 6f72  nd_component.for
-0000cef0: 6563 6173 742e 696e 6465 782c 0d0a 2020  ecast.index,..  
-0000cf00: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-0000cf10: 733d 7472 656e 645f 636f 6d70 6f6e 656e  s=trend_componen
-0000cf20: 742e 666f 7265 6361 7374 2e63 6f6c 756d  t.forecast.colum
-0000cf30: 6e73 2c0d 0a20 2020 2020 2020 2029 0d0a  ns,..        )..
-0000cf40: 2020 2020 2020 2020 7570 7065 725f 6164          upper_ad
-0000cf50: 6a75 7374 203d 2028 7a65 726f 735f 6466  just = (zeros_df
-0000cf60: 202b 2073 656c 662e 7265 7369 6475 616c   + self.residual
-0000cf70: 5f75 6e63 6572 7461 696e 7479 5f75 7070  _uncertainty_upp
-0000cf80: 6572 2920 2b20 280d 0a20 2020 2020 2020  er) + (..       
-0000cf90: 2020 2020 2073 656c 662e 7265 7369 6475       self.residu
-0000cfa0: 616c 5f75 6e63 6572 7461 696e 7479 5f75  al_uncertainty_u
-0000cfb0: 7070 6572 5f73 7464 202a 2073 656c 662e  pper_std * self.
-0000cfc0: 696e 745f 7374 645f 6465 760d 0a20 2020  int_std_dev..   
-0000cfd0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-0000cfe0: 6c6f 7765 725f 6164 6a75 7374 203d 2028  lower_adjust = (
-0000cff0: 7a65 726f 735f 6466 202b 2073 656c 662e  zeros_df + self.
-0000d000: 7265 7369 6475 616c 5f75 6e63 6572 7461  residual_uncerta
-0000d010: 696e 7479 5f6c 6f77 6572 2920 2b20 280d  inty_lower) + (.
-0000d020: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000d030: 662e 7265 7369 6475 616c 5f75 6e63 6572  f.residual_uncer
-0000d040: 7461 696e 7479 5f6c 6f77 6572 5f73 7464  tainty_lower_std
-0000d050: 202a 2073 656c 662e 696e 745f 7374 645f   * self.int_std_
-0000d060: 6465 760d 0a20 2020 2020 2020 2029 0d0a  dev..        )..
-0000d070: 2020 2020 2020 2020 2320 6164 6420 6120          # add a 
-0000d080: 6772 6164 7561 6c20 696e 6372 6561 7365  gradual increase
-0000d090: 2074 6f20 6675 6c6c 2075 6e63 6572 7461   to full uncerta
-0000d0a0: 696e 7479 0d0a 2020 2020 2020 2020 6966  inty..        if
-0000d0b0: 206c 696e 6561 725f 7072 6564 2e73 6861   linear_pred.sha
-0000d0c0: 7065 5b30 5d20 3e20 343a 0d0a 2020 2020  pe[0] > 4:..    
-0000d0d0: 2020 2020 2020 2020 6669 7273 745f 6164          first_ad
-0000d0e0: 6a75 7374 203d 207a 6572 6f73 5f64 6620  just = zeros_df 
-0000d0f0: 2b20 310d 0a20 2020 2020 2020 2020 2020  + 1..           
-0000d100: 2066 6972 7374 5f61 646a 7573 742e 696c   first_adjust.il
-0000d110: 6f63 5b30 5d20 3d20 302e 350d 0a20 2020  oc[0] = 0.5..   
-0000d120: 2020 2020 2020 2020 2066 6972 7374 5f61           first_a
-0000d130: 646a 7573 742e 696c 6f63 5b31 5d20 3d20  djust.iloc[1] = 
-0000d140: 302e 370d 0a20 2020 2020 2020 2020 2020  0.7..           
-0000d150: 2075 7070 6572 5f61 646a 7573 7420 3d20   upper_adjust = 
-0000d160: 7570 7065 725f 6164 6a75 7374 202a 2066  upper_adjust * f
-0000d170: 6972 7374 5f61 646a 7573 740d 0a20 2020  irst_adjust..   
-0000d180: 2020 2020 2020 2020 206c 6f77 6572 5f61           lower_a
-0000d190: 646a 7573 7420 3d20 6c6f 7765 725f 6164  djust = lower_ad
-0000d1a0: 6a75 7374 202a 2066 6972 7374 5f61 646a  just * first_adj
-0000d1b0: 7573 740d 0a20 2020 2020 2020 2075 7070  ust..        upp
-0000d1c0: 6572 203d 2028 0d0a 2020 2020 2020 2020  er = (..        
-0000d1d0: 2020 2020 7472 656e 645f 636f 6d70 6f6e      trend_compon
-0000d1e0: 656e 742e 7570 7065 725f 666f 7265 6361  ent.upper_foreca
-0000d1f0: 7374 2e72 6569 6e64 6578 2864 6174 6573  st.reindex(dates
-0000d200: 2920 2b20 6c69 6e65 6172 5f70 7265 6420  ) + linear_pred 
-0000d210: 2b20 7570 7065 725f 6164 6a75 7374 0d0a  + upper_adjust..
-0000d220: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000d230: 2020 206c 6f77 6572 203d 2028 0d0a 2020     lower = (..  
-0000d240: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
-0000d250: 636f 6d70 6f6e 656e 742e 6c6f 7765 725f  component.lower_
-0000d260: 666f 7265 6361 7374 2e72 6569 6e64 6578  forecast.reindex
-0000d270: 2864 6174 6573 2920 2b20 6c69 6e65 6172  (dates) + linear
-0000d280: 5f70 7265 6420 2d20 6c6f 7765 725f 6164  _pred - lower_ad
-0000d290: 6a75 7374 0d0a 2020 2020 2020 2020 290d  just..        ).
-0000d2a0: 0a0d 0a20 2020 2020 2020 2064 665f 666f  ...        df_fo
-0000d2b0: 7265 6361 7374 203d 2050 7265 6469 6374  recast = Predict
-0000d2c0: 696f 6e4f 626a 6563 7428 0d0a 2020 2020  ionObject(..    
-0000d2d0: 2020 2020 2020 2020 6d6f 6465 6c5f 6e61          model_na
-0000d2e0: 6d65 3d73 656c 662e 6e61 6d65 2c0d 0a20  me=self.name,.. 
-0000d2f0: 2020 2020 2020 2020 2020 2066 6f72 6563             forec
-0000d300: 6173 745f 6c65 6e67 7468 3d6c 656e 2864  ast_length=len(d
-0000d310: 6174 6573 292c 0d0a 2020 2020 2020 2020  ates),..        
-0000d320: 2020 2020 666f 7265 6361 7374 5f69 6e64      forecast_ind
-0000d330: 6578 3d64 6174 6573 2c0d 0a20 2020 2020  ex=dates,..     
-0000d340: 2020 2020 2020 2066 6f72 6563 6173 745f         forecast_
-0000d350: 636f 6c75 6d6e 733d 7472 656e 645f 636f  columns=trend_co
-0000d360: 6d70 6f6e 656e 742e 666f 7265 6361 7374  mponent.forecast
-0000d370: 2e63 6f6c 756d 6e73 2c0d 0a20 2020 2020  .columns,..     
-0000d380: 2020 2020 2020 206c 6f77 6572 5f66 6f72         lower_for
-0000d390: 6563 6173 743d 6c6f 7765 722c 0d0a 2020  ecast=lower,..  
-0000d3a0: 2020 2020 2020 2020 2020 666f 7265 6361            foreca
-0000d3b0: 7374 3d74 7265 6e64 5f63 6f6d 706f 6e65  st=trend_compone
-0000d3c0: 6e74 2e66 6f72 6563 6173 742e 7265 696e  nt.forecast.rein
-0000d3d0: 6465 7828 6461 7465 7329 202b 206c 696e  dex(dates) + lin
-0000d3e0: 6561 725f 7072 6564 2c0d 0a20 2020 2020  ear_pred,..     
-0000d3f0: 2020 2020 2020 2075 7070 6572 5f66 6f72         upper_for
-0000d400: 6563 6173 743d 7570 7065 722c 0d0a 2020  ecast=upper,..  
-0000d410: 2020 2020 2020 2020 2020 7072 6564 6963            predic
-0000d420: 7469 6f6e 5f69 6e74 6572 7661 6c3d 7365  tion_interval=se
-0000d430: 6c66 2e70 7265 6469 6374 696f 6e5f 696e  lf.prediction_in
-0000d440: 7465 7276 616c 2c0d 0a20 2020 2020 2020  terval,..       
-0000d450: 2020 2020 2066 6974 5f72 756e 7469 6d65       fit_runtime
-0000d460: 3d73 656c 662e 6669 745f 7275 6e74 696d  =self.fit_runtim
-0000d470: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
-0000d480: 6d6f 6465 6c5f 7061 7261 6d65 7465 7273  model_parameters
-0000d490: 3d73 656c 662e 6765 745f 7061 7261 6d73  =self.get_params
-0000d4a0: 2829 2c0d 0a20 2020 2020 2020 2029 0d0a  (),..        )..
-0000d4b0: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-0000d4c0: 665f 666f 7265 6361 7374 0d0a 0d0a 2020  f_forecast....  
-0000d4d0: 2020 6465 6620 7072 6564 6963 7428 0d0a    def predict(..
-0000d4e0: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
-0000d4f0: 2020 2020 2020 2066 6f72 6563 6173 745f         forecast_
-0000d500: 6c65 6e67 7468 2c0d 0a20 2020 2020 2020  length,..       
-0000d510: 2069 6e63 6c75 6465 5f68 6973 746f 7279   include_history
-0000d520: 3d46 616c 7365 2c0d 0a20 2020 2020 2020  =False,..       
-0000d530: 2066 7574 7572 655f 7265 6772 6573 736f   future_regresso
-0000d540: 723d 4e6f 6e65 2c0d 0a20 2020 2020 2020  r=None,..       
-0000d550: 2072 6567 7265 7373 6f72 5f70 6572 5f73   regressor_per_s
-0000d560: 6572 6965 733d 4e6f 6e65 2c0d 0a20 2020  eries=None,..   
-0000d570: 2020 2020 2066 6c61 675f 7265 6772 6573       flag_regres
-0000d580: 736f 7273 3d4e 6f6e 652c 0d0a 2020 2020  sors=None,..    
-0000d590: 2020 2020 6675 7475 7265 5f69 6d70 6163      future_impac
-0000d5a0: 7473 3d4e 6f6e 652c 0d0a 2020 2020 2020  ts=None,..      
-0000d5b0: 2020 6e65 775f 6466 3d4e 6f6e 652c 0d0a    new_df=None,..
-0000d5c0: 2020 2020 2020 2020 7265 6772 6573 736f          regresso
-0000d5d0: 725f 666f 7265 6361 7374 5f6d 6f64 656c  r_forecast_model
-0000d5e0: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
-0000d5f0: 7265 6772 6573 736f 725f 666f 7265 6361  regressor_foreca
-0000d600: 7374 5f6d 6f64 656c 5f70 6172 616d 733d  st_model_params=
-0000d610: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2072  None,..        r
-0000d620: 6567 7265 7373 6f72 5f66 6f72 6563 6173  egressor_forecas
-0000d630: 745f 7472 616e 7366 6f72 6d61 7469 6f6e  t_transformation
-0000d640: 733d 4e6f 6e65 2c0d 0a20 2020 2020 2020  s=None,..       
-0000d650: 2069 6e63 6c75 6465 5f6f 7267 616e 6963   include_organic
-0000d660: 3d46 616c 7365 2c0d 0a20 2020 2029 3a0d  =False,..    ):.
-0000d670: 0a20 2020 2020 2020 2022 2222 4765 6e65  .        """Gene
-0000d680: 7261 7465 2061 2066 6f72 6563 6173 742e  rate a forecast.
-0000d690: 0d0a 0d0a 2020 2020 2020 2020 6675 7475  ....        futu
-0000d6a0: 7265 5f72 6567 7265 7373 6f72 2061 6e64  re_regressor and
-0000d6b0: 2072 6567 7265 7373 6f72 5f70 6572 5f73   regressor_per_s
-0000d6c0: 6572 6965 7320 7368 6f75 6c64 206f 6e6c  eries should onl
-0000d6d0: 7920 696e 636c 7564 6520 6e65 7720 6675  y include new fu
-0000d6e0: 7475 7265 2076 616c 7565 732c 2068 6973  ture values, his
-0000d6f0: 746f 7279 2069 7320 616c 7265 6164 7920  tory is already 
-0000d700: 7374 6f72 6564 0d0a 2020 2020 2020 2020  stored..        
-0000d710: 7468 6579 2073 686f 756c 6420 6d61 7463  they should matc
-0000d720: 6820 6f6e 2066 6f72 6563 6173 745f 6c65  h on forecast_le
-0000d730: 6e67 7468 2061 6e64 2069 6e64 6578 206f  ngth and index o
-0000d740: 6620 666f 7265 6361 7374 730d 0a20 2020  f forecasts..   
-0000d750: 2020 2020 2022 2222 0d0a 2020 2020 2020       """..      
-0000d760: 2020 7365 6c66 2e66 6f72 6563 6173 745f    self.forecast_
-0000d770: 6c65 6e67 7468 203d 2066 6f72 6563 6173  length = forecas
-0000d780: 745f 6c65 6e67 7468 0d0a 2020 2020 2020  t_length..      
-0000d790: 2020 7072 6564 6963 7453 7461 7274 5469    predictStartTi
-0000d7a0: 6d65 203d 2073 656c 662e 7469 6d65 2829  me = self.time()
-0000d7b0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000d7c0: 662e 7472 656e 645f 7472 6169 6e20 6973  f.trend_train is
-0000d7d0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000d7e0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000d7f0: 7272 6f72 2822 4361 7373 616e 6472 6120  rror("Cassandra 
-0000d800: 6d75 7374 2066 6972 7374 2062 6520 2e66  must first be .f
-0000d810: 6974 2829 2073 7563 6365 7373 6675 6c6c  it() successfull
-0000d820: 792e 2229 0d0a 0d0a 2020 2020 2020 2020  y.")....        
-0000d830: 2320 7363 616c 6520 6e65 775f 6466 2069  # scale new_df i
-0000d840: 6620 6769 7665 6e0d 0a20 2020 2020 2020  f given..       
-0000d850: 2069 6620 6e65 775f 6466 2069 7320 6e6f   if new_df is no
-0000d860: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0000d870: 2020 2020 2064 6620 3d20 7365 6c66 2e73       df = self.s
-0000d880: 6361 6c65 5f64 6174 6128 6e65 775f 6466  cale_data(new_df
-0000d890: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-0000d8a0: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-0000d8b0: 203d 2073 656c 662e 6466 2e63 6f70 7928   = self.df.copy(
-0000d8c0: 290d 0a20 2020 2020 2020 2023 2069 6620  )..        # if 
-0000d8d0: 6675 7475 7265 2072 6567 7265 7373 6f72  future regressor
-0000d8e0: 7320 6172 6520 4e6f 6e65 2028 2620 5553  s are None (& US
-0000d8f0: 4544 292c 2062 7574 2077 6572 6520 7072  ED), but were pr
-0000d900: 6f76 6964 6564 2066 6f72 2068 6973 746f  ovided for histo
-0000d910: 7279 2c20 696e 7374 6561 6420 7573 6520  ry, instead use 
-0000d920: 666f 7265 6361 7374 7320 6f66 2074 6865  forecasts of the
-0000d930: 7365 2066 6561 7475 7265 7320 2877 6172  se features (war
-0000d940: 6e29 0d0a 2020 2020 2020 2020 6675 6c6c  n)..        full
-0000d950: 5f72 6567 7220 3d20 4e6f 6e65 0d0a 2020  _regr = None..  
-0000d960: 2020 2020 2020 6966 2028 0d0a 2020 2020        if (..    
-0000d970: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
-0000d980: 6567 7265 7373 6f72 2069 7320 4e6f 6e65  egressor is None
-0000d990: 0d0a 2020 2020 2020 2020 2020 2020 616e  ..            an
-0000d9a0: 6420 7365 6c66 2e66 7574 7572 655f 7265  d self.future_re
-0000d9b0: 6772 6573 736f 725f 7472 6169 6e20 6973  gressor_train is
-0000d9c0: 206e 6f74 204e 6f6e 650d 0a20 2020 2020   not None..     
-0000d9d0: 2020 2020 2020 2061 6e64 2066 6f72 6563         and forec
-0000d9e0: 6173 745f 6c65 6e67 7468 2069 7320 6e6f  ast_length is no
-0000d9f0: 7420 4e6f 6e65 0d0a 2020 2020 2020 2020  t None..        
-0000da00: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000da10: 6966 2073 656c 662e 7665 7262 6f73 6520  if self.verbose 
-0000da20: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
-0000da30: 2020 2020 2020 7072 696e 7428 0d0a 2020        print(..  
-0000da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da50: 2020 2266 7574 7572 655f 7265 6772 6573    "future_regres
-0000da60: 736f 7220 6e6f 7420 7072 6f76 6964 6564  sor not provided
-0000da70: 2074 6f20 4361 7373 616e 6472 612c 2075   to Cassandra, u
-0000da80: 7369 6e67 2066 6f72 6563 6173 7473 206f  sing forecasts o
-0000da90: 6620 6869 7374 6f72 6963 616c 220d 0a20  f historical".. 
-0000daa0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000dab0: 0d0a 2020 2020 2020 2020 2020 2020 6675  ..            fu
-0000dac0: 7475 7265 5f72 6567 7265 7373 6f72 203d  ture_regressor =
-0000dad0: 206d 6f64 656c 5f66 6f72 6563 6173 7428   model_forecast(
-0000dae0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000daf0: 2020 6d6f 6465 6c5f 6e61 6d65 3d73 656c    model_name=sel
-0000db00: 662e 7472 656e 645f 6d6f 6465 6c5b 274d  f.trend_model['M
-0000db10: 6f64 656c 275d 0d0a 2020 2020 2020 2020  odel']..        
-0000db20: 2020 2020 2020 2020 6966 2072 6567 7265          if regre
-0000db30: 7373 6f72 5f66 6f72 6563 6173 745f 6d6f  ssor_forecast_mo
-0000db40: 6465 6c20 6973 204e 6f6e 650d 0a20 2020  del is None..   
-0000db50: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000db60: 6520 7265 6772 6573 736f 725f 666f 7265  e regressor_fore
-0000db70: 6361 7374 5f6d 6f64 656c 2c0d 0a20 2020  cast_model,..   
-0000db80: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0000db90: 656c 5f70 6172 616d 5f64 6963 743d 7365  el_param_dict=se
-0000dba0: 6c66 2e74 7265 6e64 5f6d 6f64 656c 5b27  lf.trend_model['
-0000dbb0: 4d6f 6465 6c50 6172 616d 6574 6572 7327  ModelParameters'
-0000dbc0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0000dbd0: 2020 2069 6620 7265 6772 6573 736f 725f     if regressor_
-0000dbe0: 666f 7265 6361 7374 5f6d 6f64 656c 5f70  forecast_model_p
-0000dbf0: 6172 616d 7320 6973 204e 6f6e 650d 0a20  arams is None.. 
-0000dc00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000dc10: 6c73 6520 7265 6772 6573 736f 725f 666f  lse regressor_fo
-0000dc20: 7265 6361 7374 5f6d 6f64 656c 5f70 6172  recast_model_par
-0000dc30: 616d 732c 0d0a 2020 2020 2020 2020 2020  ams,..          
-0000dc40: 2020 2020 2020 6d6f 6465 6c5f 7472 616e        model_tran
-0000dc50: 7366 6f72 6d5f 6469 6374 3d73 656c 662e  sform_dict=self.
-0000dc60: 7072 6570 726f 6365 7373 696e 675f 7472  preprocessing_tr
-0000dc70: 616e 7366 6f72 6d61 7469 6f6e 0d0a 2020  ansformation..  
-0000dc80: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000dc90: 2072 6567 7265 7373 6f72 5f66 6f72 6563   regressor_forec
-0000dca0: 6173 745f 7472 616e 7366 6f72 6d61 7469  ast_transformati
-0000dcb0: 6f6e 7320 6973 204e 6f6e 650d 0a20 2020  ons is None..   
-0000dcc0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-0000dcd0: 6520 7265 6772 6573 736f 725f 666f 7265  e regressor_fore
-0000dce0: 6361 7374 5f74 7261 6e73 666f 726d 6174  cast_transformat
-0000dcf0: 696f 6e73 2c0d 0a20 2020 2020 2020 2020  ions,..         
-0000dd00: 2020 2020 2020 2064 665f 7472 6169 6e3d         df_train=
-0000dd10: 7365 6c66 2e66 7574 7572 655f 7265 6772  self.future_regr
-0000dd20: 6573 736f 725f 7472 6169 6e2c 0d0a 2020  essor_train,..  
-0000dd30: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000dd40: 7265 6361 7374 5f6c 656e 6774 683d 666f  recast_length=fo
-0000dd50: 7265 6361 7374 5f6c 656e 6774 682c 0d0a  recast_length,..
-0000dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd70: 6672 6571 7565 6e63 793d 7365 6c66 2e66  frequency=self.f
-0000dd80: 7265 7175 656e 6379 2c0d 0a20 2020 2020  requency,..     
-0000dd90: 2020 2020 2020 2020 2020 2070 7265 6469             predi
-0000dda0: 6374 696f 6e5f 696e 7465 7276 616c 3d73  ction_interval=s
-0000ddb0: 656c 662e 7072 6564 6963 7469 6f6e 5f69  elf.prediction_i
-0000ddc0: 6e74 6572 7661 6c2c 0d0a 2020 2020 2020  nterval,..      
-0000ddd0: 2020 2020 2020 2020 2020 6661 696c 5f6f            fail_o
-0000dde0: 6e5f 666f 7265 6361 7374 5f6e 616e 3d46  n_forecast_nan=F
-0000ddf0: 616c 7365 2c0d 0a20 2020 2020 2020 2020  alse,..         
-0000de00: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
-0000de10: 6564 3d73 656c 662e 7261 6e64 6f6d 5f73  ed=self.random_s
-0000de20: 6565 642c 0d0a 2020 2020 2020 2020 2020  eed,..          
-0000de30: 2020 2020 2020 7665 7262 6f73 653d 7365        verbose=se
-0000de40: 6c66 2e76 6572 626f 7365 2c0d 0a20 2020  lf.verbose,..   
-0000de50: 2020 2020 2020 2020 2020 2020 206e 5f6a               n_j
-0000de60: 6f62 733d 7365 6c66 2e6e 5f6a 6f62 732c  obs=self.n_jobs,
-0000de70: 0d0a 2020 2020 2020 2020 2020 2020 292e  ..            ).
-0000de80: 666f 7265 6361 7374 0d0a 2020 2020 2020  forecast..      
-0000de90: 2020 2020 2020 6675 6c6c 5f72 6567 7220        full_regr 
-0000dea0: 3d20 7064 2e63 6f6e 6361 7428 5b73 656c  = pd.concat([sel
-0000deb0: 662e 6675 7475 7265 5f72 6567 7265 7373  f.future_regress
-0000dec0: 6f72 5f74 7261 696e 2c20 6675 7475 7265  or_train, future
-0000ded0: 5f72 6567 7265 7373 6f72 5d29 0d0a 2020  _regressor])..  
-0000dee0: 2020 2020 2020 6966 2066 6f72 6563 6173        if forecas
-0000def0: 745f 6c65 6e67 7468 2069 7320 4e6f 6e65  t_length is None
-0000df00: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
-0000df10: 7870 6563 7465 645f 666f 7265 5f6c 656e  xpected_fore_len
-0000df20: 203d 206c 656e 2864 6629 0d0a 2020 2020   = len(df)..    
-0000df30: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000df40: 2020 2020 2020 2065 7870 6563 7465 645f         expected_
-0000df50: 666f 7265 5f6c 656e 203d 2028 0d0a 2020  fore_len = (..  
-0000df60: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000df70: 7265 6361 7374 5f6c 656e 6774 6820 2b20  recast_length + 
-0000df80: 6c65 6e28 6466 2920 6966 2069 6e63 6c75  len(df) if inclu
-0000df90: 6465 5f68 6973 746f 7279 2065 6c73 6520  de_history else 
-0000dfa0: 666f 7265 6361 7374 5f6c 656e 6774 680d  forecast_length.
-0000dfb0: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-0000dfc0: 2020 2020 2020 2020 6966 2066 7574 7572          if futur
-0000dfd0: 655f 7265 6772 6573 736f 7220 6973 206e  e_regressor is n
-0000dfe0: 6f74 204e 6f6e 6520 616e 6420 7365 6c66  ot None and self
-0000dff0: 2e72 6567 7265 7373 6f72 735f 7573 6564  .regressors_used
-0000e000: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0000e010: 6620 6c65 6e28 6675 7475 7265 5f72 6567  f len(future_reg
-0000e020: 7265 7373 6f72 2920 3d3d 2065 7870 6563  ressor) == expec
-0000e030: 7465 645f 666f 7265 5f6c 656e 3a0d 0a20  ted_fore_len:.. 
-0000e040: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000e050: 756c 6c5f 7265 6772 203d 2073 656c 662e  ull_regr = self.
-0000e060: 7265 6772 6573 736f 725f 7472 616e 7366  regressor_transf
-0000e070: 6f72 6d65 722e 7472 616e 7366 6f72 6d28  ormer.transform(
-0000e080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e090: 2020 2020 2020 636c 6561 6e5f 7265 6772        clean_regr
-0000e0a0: 6573 736f 7228 6675 7475 7265 5f72 6567  essor(future_reg
-0000e0b0: 7265 7373 6f72 290d 0a20 2020 2020 2020  ressor)..       
-0000e0c0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
-0000e0d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0000e0e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000e0f0: 756c 6c5f 7265 6772 203d 2070 642e 636f  ull_regr = pd.co
-0000e100: 6e63 6174 280d 0a20 2020 2020 2020 2020  ncat(..         
-0000e110: 2020 2020 2020 2020 2020 205b 0d0a 2020             [..  
-0000e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e130: 2020 2020 2020 7365 6c66 2e66 7574 7572        self.futur
-0000e140: 655f 7265 6772 6573 736f 725f 7472 6169  e_regressor_trai
-0000e150: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-0000e160: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e170: 2e72 6567 7265 7373 6f72 5f74 7261 6e73  .regressor_trans
-0000e180: 666f 726d 6572 2e74 7261 6e73 666f 726d  former.transform
-0000e190: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000e1a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000e1b0: 6c65 616e 5f72 6567 7265 7373 6f72 280d  lean_regressor(.
-0000e1c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e1e0: 2066 7574 7572 655f 7265 6772 6573 736f   future_regresso
-0000e1f0: 722e 6c6f 635b 0d0a 2020 2020 2020 2020  r.loc[..        
-0000e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e210: 2020 2020 2020 2020 2020 2020 6675 7475              futu
-0000e220: 7265 5f72 6567 7265 7373 6f72 2e69 6e64  re_regressor.ind
-0000e230: 6578 2e64 6966 6665 7265 6e63 6528 0d0a  ex.difference(..
-0000e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000caa0: 2020 2020 7365 6c66 2e63 6f6d 706f 6e65      self.compone
+0000cab0: 6e74 735b 3a2c 2063 6f6d 702c 203a 5d2c  nts[:, comp, :],
+0000cac0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cad0: 2020 2020 2020 696e 6465 783d 745f 696e        index=t_in
+0000cae0: 6478 2c0d 0a20 2020 2020 2020 2020 2020  dx,..           
+0000caf0: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
+0000cb00: 3d73 656c 662e 636f 6c75 6d6e 5f6e 616d  =self.column_nam
+0000cb10: 6573 2c0d 0a20 2020 2020 2020 2020 2020  es,..           
+0000cb20: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0000cb30: 2020 2020 2320 636f 6c75 6d6e 206e 616d      # column nam
+0000cb40: 6520 6e65 6564 7320 746f 2062 6520 756e  e needs to be un
+0000cb50: 6c69 6b65 6c79 2074 6f20 6f63 6375 7220  likely to occur 
+0000cb60: 696e 2061 6e20 6163 7475 616c 2064 6174  in an actual dat
+0000cb70: 6173 6574 0d0a 2020 2020 2020 2020 2020  aset..          
+0000cb80: 2020 636f 6d70 5f64 665b 2763 736d 6f64    comp_df['csmod
+0000cb90: 5f63 6f6d 706f 6e65 6e74 275d 203d 2063  _component'] = c
+0000cba0: 6f6c 5f67 726f 7570 5b73 656c 662e 636f  ol_group[self.co
+0000cbb0: 6d70 6f6e 656e 745f 696e 6478 5b63 6f6d  mponent_indx[com
+0000cbc0: 705d 5d0d 0a20 2020 2020 2020 2020 2020  p]]..           
+0000cbd0: 2063 6f6d 705f 6c69 7374 2e61 7070 656e   comp_list.appen
+0000cbe0: 6428 636f 6d70 5f64 6629 0d0a 2020 2020  d(comp_df)..    
+0000cbf0: 2020 2020 7265 7475 726e 2070 642e 7069      return pd.pi
+0000cc00: 766f 7428 7064 2e63 6f6e 6361 7428 636f  vot(pd.concat(co
+0000cc10: 6d70 5f6c 6973 742c 2061 7869 733d 3029  mp_list, axis=0)
+0000cc20: 2c20 636f 6c75 6d6e 733d 2763 736d 6f64  , columns='csmod
+0000cc30: 5f63 6f6d 706f 6e65 6e74 2729 0d0a 0d0a  _component')....
+0000cc40: 2020 2020 6465 6620 5f70 7265 6469 6374      def _predict
+0000cc50: 5f73 7465 7028 0d0a 2020 2020 2020 2020  _step(..        
+0000cc60: 7365 6c66 2c0d 0a20 2020 2020 2020 2064  self,..        d
+0000cc70: 6174 6573 2c0d 0a20 2020 2020 2020 2074  ates,..        t
+0000cc80: 7265 6e64 5f63 6f6d 706f 6e65 6e74 2c0d  rend_component,.
+0000cc90: 0a20 2020 2020 2020 2068 6973 746f 7279  .        history
+0000cca0: 5f64 662c 0d0a 2020 2020 2020 2020 6675  _df,..        fu
+0000ccb0: 7475 7265 5f72 6567 7265 7373 6f72 2c0d  ture_regressor,.
+0000ccc0: 0a20 2020 2020 2020 2066 6c61 675f 7265  .        flag_re
+0000ccd0: 6772 6573 736f 7273 2c0d 0a20 2020 2020  gressors,..     
+0000cce0: 2020 2069 6d70 6163 7473 2c0d 0a20 2020     impacts,..   
+0000ccf0: 2020 2020 2072 6567 7265 7373 6f72 5f70       regressor_p
+0000cd00: 6572 5f73 6572 6965 732c 0d0a 2020 2020  er_series,..    
+0000cd10: 293a 0d0a 2020 2020 2020 2020 2320 4e6f  ):..        # No
+0000cd20: 7465 2074 6869 7320 6973 2073 6361 6c65  te this is scale
+0000cd30: 6420 616e 6420 646f 6573 6e27 7420 6163  d and doesn't ac
+0000cd40: 636f 756e 7420 666f 7220 696d 7061 6374  count for impact
+0000cd50: 730d 0a20 2020 2020 2020 206c 696e 6561  s..        linea
+0000cd60: 725f 7072 6564 203d 2073 656c 662e 5f70  r_pred = self._p
+0000cd70: 7265 6469 6374 5f6c 696e 6561 7228 0d0a  redict_linear(..
+0000cd80: 2020 2020 2020 2020 2020 2020 6461 7465              date
+0000cd90: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000cda0: 6869 7374 6f72 795f 6466 3d68 6973 746f  history_df=histo
+0000cdb0: 7279 5f64 662c 0d0a 2020 2020 2020 2020  ry_df,..        
+0000cdc0: 2020 2020 6675 7475 7265 5f72 6567 7265      future_regre
+0000cdd0: 7373 6f72 3d66 7574 7572 655f 7265 6772  ssor=future_regr
+0000cde0: 6573 736f 722c 0d0a 2020 2020 2020 2020  essor,..        
+0000cdf0: 2020 2020 666c 6167 5f72 6567 7265 7373      flag_regress
+0000ce00: 6f72 733d 666c 6167 5f72 6567 7265 7373  ors=flag_regress
+0000ce10: 6f72 732c 0d0a 2020 2020 2020 2020 2020  ors,..          
+0000ce20: 2020 696d 7061 6374 733d 696d 7061 6374    impacts=impact
+0000ce30: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0000ce40: 7265 6772 6573 736f 725f 7065 725f 7365  regressor_per_se
+0000ce50: 7269 6573 3d72 6567 7265 7373 6f72 5f70  ries=regressor_p
+0000ce60: 6572 5f73 6572 6965 732c 0d0a 2020 2020  er_series,..    
+0000ce70: 2020 2020 2020 2020 7265 7475 726e 5f63          return_c
+0000ce80: 6f6d 706f 6e65 6e74 733d 5472 7565 2c0d  omponents=True,.
+0000ce90: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+0000cea0: 2020 2020 2320 4144 4420 5052 4550 524f      # ADD PREPRO
+0000ceb0: 4345 5353 494e 4720 4245 464f 5245 2054  CESSING BEFORE T
+0000cec0: 5245 4e44 2028 4649 5420 582c 2052 4556  REND (FIT X, REV
+0000ced0: 4552 5345 206f 6e20 5052 4544 4943 542c  ERSE on PREDICT,
+0000cee0: 2054 4845 4e20 5452 454e 4429 0d0a 2020   THEN TREND)..  
+0000cef0: 2020 2020 2020 7a65 726f 735f 6466 203d        zeros_df =
+0000cf00: 2070 642e 4461 7461 4672 616d 6528 0d0a   pd.DataFrame(..
+0000cf10: 2020 2020 2020 2020 2020 2020 302c 0d0a              0,..
+0000cf20: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+0000cf30: 783d 7472 656e 645f 636f 6d70 6f6e 656e  x=trend_componen
+0000cf40: 742e 666f 7265 6361 7374 2e69 6e64 6578  t.forecast.index
+0000cf50: 2c0d 0a20 2020 2020 2020 2020 2020 2063  ,..            c
+0000cf60: 6f6c 756d 6e73 3d74 7265 6e64 5f63 6f6d  olumns=trend_com
+0000cf70: 706f 6e65 6e74 2e66 6f72 6563 6173 742e  ponent.forecast.
+0000cf80: 636f 6c75 6d6e 732c 0d0a 2020 2020 2020  columns,..      
+0000cf90: 2020 290d 0a20 2020 2020 2020 2075 7070    )..        upp
+0000cfa0: 6572 5f61 646a 7573 7420 3d20 287a 6572  er_adjust = (zer
+0000cfb0: 6f73 5f64 6620 2b20 7365 6c66 2e72 6573  os_df + self.res
+0000cfc0: 6964 7561 6c5f 756e 6365 7274 6169 6e74  idual_uncertaint
+0000cfd0: 795f 7570 7065 7229 202b 2028 0d0a 2020  y_upper) + (..  
+0000cfe0: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+0000cff0: 6573 6964 7561 6c5f 756e 6365 7274 6169  esidual_uncertai
+0000d000: 6e74 795f 7570 7065 725f 7374 6420 2a20  nty_upper_std * 
+0000d010: 7365 6c66 2e69 6e74 5f73 7464 5f64 6576  self.int_std_dev
+0000d020: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+0000d030: 2020 2020 206c 6f77 6572 5f61 646a 7573       lower_adjus
+0000d040: 7420 3d20 287a 6572 6f73 5f64 6620 2b20  t = (zeros_df + 
+0000d050: 7365 6c66 2e72 6573 6964 7561 6c5f 756e  self.residual_un
+0000d060: 6365 7274 6169 6e74 795f 6c6f 7765 7229  certainty_lower)
+0000d070: 202b 2028 0d0a 2020 2020 2020 2020 2020   + (..          
+0000d080: 2020 7365 6c66 2e72 6573 6964 7561 6c5f    self.residual_
+0000d090: 756e 6365 7274 6169 6e74 795f 6c6f 7765  uncertainty_lowe
+0000d0a0: 725f 7374 6420 2a20 7365 6c66 2e69 6e74  r_std * self.int
+0000d0b0: 5f73 7464 5f64 6576 0d0a 2020 2020 2020  _std_dev..      
+0000d0c0: 2020 290d 0a20 2020 2020 2020 2023 2061    )..        # a
+0000d0d0: 6464 2061 2067 7261 6475 616c 2069 6e63  dd a gradual inc
+0000d0e0: 7265 6173 6520 746f 2066 756c 6c20 756e  rease to full un
+0000d0f0: 6365 7274 6169 6e74 790d 0a20 2020 2020  certainty..     
+0000d100: 2020 2069 6620 6c69 6e65 6172 5f70 7265     if linear_pre
+0000d110: 642e 7368 6170 655b 305d 203e 2034 3a0d  d.shape[0] > 4:.
+0000d120: 0a20 2020 2020 2020 2020 2020 2066 6972  .            fir
+0000d130: 7374 5f61 646a 7573 7420 3d20 7a65 726f  st_adjust = zero
+0000d140: 735f 6466 202b 2031 0d0a 2020 2020 2020  s_df + 1..      
+0000d150: 2020 2020 2020 6669 7273 745f 6164 6a75        first_adju
+0000d160: 7374 2e69 6c6f 635b 305d 203d 2030 2e35  st.iloc[0] = 0.5
+0000d170: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+0000d180: 7273 745f 6164 6a75 7374 2e69 6c6f 635b  rst_adjust.iloc[
+0000d190: 315d 203d 2030 2e37 0d0a 2020 2020 2020  1] = 0.7..      
+0000d1a0: 2020 2020 2020 7570 7065 725f 6164 6a75        upper_adju
+0000d1b0: 7374 203d 2075 7070 6572 5f61 646a 7573  st = upper_adjus
+0000d1c0: 7420 2a20 6669 7273 745f 6164 6a75 7374  t * first_adjust
+0000d1d0: 0d0a 2020 2020 2020 2020 2020 2020 6c6f  ..            lo
+0000d1e0: 7765 725f 6164 6a75 7374 203d 206c 6f77  wer_adjust = low
+0000d1f0: 6572 5f61 646a 7573 7420 2a20 6669 7273  er_adjust * firs
+0000d200: 745f 6164 6a75 7374 0d0a 2020 2020 2020  t_adjust..      
+0000d210: 2020 7570 7065 7220 3d20 280d 0a20 2020    upper = (..   
+0000d220: 2020 2020 2020 2020 2074 7265 6e64 5f63           trend_c
+0000d230: 6f6d 706f 6e65 6e74 2e75 7070 6572 5f66  omponent.upper_f
+0000d240: 6f72 6563 6173 742e 7265 696e 6465 7828  orecast.reindex(
+0000d250: 6461 7465 7329 202b 206c 696e 6561 725f  dates) + linear_
+0000d260: 7072 6564 202b 2075 7070 6572 5f61 646a  pred + upper_adj
+0000d270: 7573 740d 0a20 2020 2020 2020 2029 0d0a  ust..        )..
+0000d280: 2020 2020 2020 2020 6c6f 7765 7220 3d20          lower = 
+0000d290: 280d 0a20 2020 2020 2020 2020 2020 2074  (..            t
+0000d2a0: 7265 6e64 5f63 6f6d 706f 6e65 6e74 2e6c  rend_component.l
+0000d2b0: 6f77 6572 5f66 6f72 6563 6173 742e 7265  ower_forecast.re
+0000d2c0: 696e 6465 7828 6461 7465 7329 202b 206c  index(dates) + l
+0000d2d0: 696e 6561 725f 7072 6564 202d 206c 6f77  inear_pred - low
+0000d2e0: 6572 5f61 646a 7573 740d 0a20 2020 2020  er_adjust..     
+0000d2f0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+0000d300: 6466 5f66 6f72 6563 6173 7420 3d20 5072  df_forecast = Pr
+0000d310: 6564 6963 7469 6f6e 4f62 6a65 6374 280d  edictionObject(.
+0000d320: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
+0000d330: 656c 5f6e 616d 653d 7365 6c66 2e6e 616d  el_name=self.nam
+0000d340: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
+0000d350: 666f 7265 6361 7374 5f6c 656e 6774 683d  forecast_length=
+0000d360: 6c65 6e28 6461 7465 7329 2c0d 0a20 2020  len(dates),..   
+0000d370: 2020 2020 2020 2020 2066 6f72 6563 6173           forecas
+0000d380: 745f 696e 6465 783d 6461 7465 732c 0d0a  t_index=dates,..
+0000d390: 2020 2020 2020 2020 2020 2020 666f 7265              fore
+0000d3a0: 6361 7374 5f63 6f6c 756d 6e73 3d74 7265  cast_columns=tre
+0000d3b0: 6e64 5f63 6f6d 706f 6e65 6e74 2e66 6f72  nd_component.for
+0000d3c0: 6563 6173 742e 636f 6c75 6d6e 732c 0d0a  ecast.columns,..
+0000d3d0: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
+0000d3e0: 725f 666f 7265 6361 7374 3d6c 6f77 6572  r_forecast=lower
+0000d3f0: 2c0d 0a20 2020 2020 2020 2020 2020 2066  ,..            f
+0000d400: 6f72 6563 6173 743d 7472 656e 645f 636f  orecast=trend_co
+0000d410: 6d70 6f6e 656e 742e 666f 7265 6361 7374  mponent.forecast
+0000d420: 2e72 6569 6e64 6578 2864 6174 6573 2920  .reindex(dates) 
+0000d430: 2b20 6c69 6e65 6172 5f70 7265 642c 0d0a  + linear_pred,..
+0000d440: 2020 2020 2020 2020 2020 2020 7570 7065              uppe
+0000d450: 725f 666f 7265 6361 7374 3d75 7070 6572  r_forecast=upper
+0000d460: 2c0d 0a20 2020 2020 2020 2020 2020 2070  ,..            p
+0000d470: 7265 6469 6374 696f 6e5f 696e 7465 7276  rediction_interv
+0000d480: 616c 3d73 656c 662e 7072 6564 6963 7469  al=self.predicti
+0000d490: 6f6e 5f69 6e74 6572 7661 6c2c 0d0a 2020  on_interval,..  
+0000d4a0: 2020 2020 2020 2020 2020 6669 745f 7275            fit_ru
+0000d4b0: 6e74 696d 653d 7365 6c66 2e66 6974 5f72  ntime=self.fit_r
+0000d4c0: 756e 7469 6d65 2c0d 0a20 2020 2020 2020  untime,..       
+0000d4d0: 2020 2020 206d 6f64 656c 5f70 6172 616d       model_param
+0000d4e0: 6574 6572 733d 7365 6c66 2e67 6574 5f70  eters=self.get_p
+0000d4f0: 6172 616d 7328 292c 0d0a 2020 2020 2020  arams(),..      
+0000d500: 2020 290d 0a20 2020 2020 2020 2072 6574    )..        ret
+0000d510: 7572 6e20 6466 5f66 6f72 6563 6173 740d  urn df_forecast.
+0000d520: 0a0d 0a20 2020 2064 6566 2070 7265 6469  ...    def predi
+0000d530: 6374 280d 0a20 2020 2020 2020 2073 656c  ct(..        sel
+0000d540: 662c 0d0a 2020 2020 2020 2020 666f 7265  f,..        fore
+0000d550: 6361 7374 5f6c 656e 6774 682c 0d0a 2020  cast_length,..  
+0000d560: 2020 2020 2020 696e 636c 7564 655f 6869        include_hi
+0000d570: 7374 6f72 793d 4661 6c73 652c 0d0a 2020  story=False,..  
+0000d580: 2020 2020 2020 6675 7475 7265 5f72 6567        future_reg
+0000d590: 7265 7373 6f72 3d4e 6f6e 652c 0d0a 2020  ressor=None,..  
+0000d5a0: 2020 2020 2020 7265 6772 6573 736f 725f        regressor_
+0000d5b0: 7065 725f 7365 7269 6573 3d4e 6f6e 652c  per_series=None,
+0000d5c0: 0d0a 2020 2020 2020 2020 666c 6167 5f72  ..        flag_r
+0000d5d0: 6567 7265 7373 6f72 733d 4e6f 6e65 2c0d  egressors=None,.
+0000d5e0: 0a20 2020 2020 2020 2066 7574 7572 655f  .        future_
+0000d5f0: 696d 7061 6374 733d 4e6f 6e65 2c0d 0a20  impacts=None,.. 
+0000d600: 2020 2020 2020 206e 6577 5f64 663d 4e6f         new_df=No
+0000d610: 6e65 2c0d 0a20 2020 2020 2020 2072 6567  ne,..        reg
+0000d620: 7265 7373 6f72 5f66 6f72 6563 6173 745f  ressor_forecast_
+0000d630: 6d6f 6465 6c3d 4e6f 6e65 2c0d 0a20 2020  model=None,..   
+0000d640: 2020 2020 2072 6567 7265 7373 6f72 5f66       regressor_f
+0000d650: 6f72 6563 6173 745f 6d6f 6465 6c5f 7061  orecast_model_pa
+0000d660: 7261 6d73 3d4e 6f6e 652c 0d0a 2020 2020  rams=None,..    
+0000d670: 2020 2020 7265 6772 6573 736f 725f 666f      regressor_fo
+0000d680: 7265 6361 7374 5f74 7261 6e73 666f 726d  recast_transform
+0000d690: 6174 696f 6e73 3d4e 6f6e 652c 0d0a 2020  ations=None,..  
+0000d6a0: 2020 2020 2020 696e 636c 7564 655f 6f72        include_or
+0000d6b0: 6761 6e69 633d 4661 6c73 652c 0d0a 2020  ganic=False,..  
+0000d6c0: 2020 293a 0d0a 2020 2020 2020 2020 2222    ):..        ""
+0000d6d0: 2247 656e 6572 6174 6520 6120 666f 7265  "Generate a fore
+0000d6e0: 6361 7374 2e0d 0a0d 0a20 2020 2020 2020  cast.....       
+0000d6f0: 2066 7574 7572 655f 7265 6772 6573 736f   future_regresso
+0000d700: 7220 616e 6420 7265 6772 6573 736f 725f  r and regressor_
+0000d710: 7065 725f 7365 7269 6573 2073 686f 756c  per_series shoul
+0000d720: 6420 6f6e 6c79 2069 6e63 6c75 6465 206e  d only include n
+0000d730: 6577 2066 7574 7572 6520 7661 6c75 6573  ew future values
+0000d740: 2c20 6869 7374 6f72 7920 6973 2061 6c72  , history is alr
+0000d750: 6561 6479 2073 746f 7265 640d 0a20 2020  eady stored..   
+0000d760: 2020 2020 2074 6865 7920 7368 6f75 6c64       they should
+0000d770: 206d 6174 6368 206f 6e20 666f 7265 6361   match on foreca
+0000d780: 7374 5f6c 656e 6774 6820 616e 6420 696e  st_length and in
+0000d790: 6465 7820 6f66 2066 6f72 6563 6173 7473  dex of forecasts
+0000d7a0: 0d0a 2020 2020 2020 2020 2222 220d 0a20  ..        """.. 
+0000d7b0: 2020 2020 2020 2073 656c 662e 666f 7265         self.fore
+0000d7c0: 6361 7374 5f6c 656e 6774 6820 3d20 666f  cast_length = fo
+0000d7d0: 7265 6361 7374 5f6c 656e 6774 680d 0a20  recast_length.. 
+0000d7e0: 2020 2020 2020 2070 7265 6469 6374 5374         predictSt
+0000d7f0: 6172 7454 696d 6520 3d20 7365 6c66 2e74  artTime = self.t
+0000d800: 696d 6528 290d 0a20 2020 2020 2020 2069  ime()..        i
+0000d810: 6620 7365 6c66 2e74 7265 6e64 5f74 7261  f self.trend_tra
+0000d820: 696e 2069 7320 4e6f 6e65 3a0d 0a20 2020  in is None:..   
+0000d830: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0000d840: 616c 7565 4572 726f 7228 2243 6173 7361  alueError("Cassa
+0000d850: 6e64 7261 206d 7573 7420 6669 7273 7420  ndra must first 
+0000d860: 6265 202e 6669 7428 2920 7375 6363 6573  be .fit() succes
+0000d870: 7366 756c 6c79 2e22 290d 0a0d 0a20 2020  sfully.")....   
+0000d880: 2020 2020 2023 2073 6361 6c65 206e 6577       # scale new
+0000d890: 5f64 6620 6966 2067 6976 656e 0d0a 2020  _df if given..  
+0000d8a0: 2020 2020 2020 6966 206e 6577 5f64 6620        if new_df 
+0000d8b0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+0000d8c0: 2020 2020 2020 2020 2020 6466 203d 2073            df = s
+0000d8d0: 656c 662e 7363 616c 655f 6461 7461 286e  elf.scale_data(n
+0000d8e0: 6577 5f64 6629 0d0a 2020 2020 2020 2020  ew_df)..        
+0000d8f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000d900: 2020 2064 6620 3d20 7365 6c66 2e64 662e     df = self.df.
+0000d910: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
+0000d920: 2320 6966 2066 7574 7572 6520 7265 6772  # if future regr
+0000d930: 6573 736f 7273 2061 7265 204e 6f6e 6520  essors are None 
+0000d940: 2826 2055 5345 4429 2c20 6275 7420 7765  (& USED), but we
+0000d950: 7265 2070 726f 7669 6465 6420 666f 7220  re provided for 
+0000d960: 6869 7374 6f72 792c 2069 6e73 7465 6164  history, instead
+0000d970: 2075 7365 2066 6f72 6563 6173 7473 206f   use forecasts o
+0000d980: 6620 7468 6573 6520 6665 6174 7572 6573  f these features
+0000d990: 2028 7761 726e 290d 0a20 2020 2020 2020   (warn)..       
+0000d9a0: 2066 756c 6c5f 7265 6772 203d 204e 6f6e   full_regr = Non
+0000d9b0: 650d 0a20 2020 2020 2020 2069 6620 280d  e..        if (.
+0000d9c0: 0a20 2020 2020 2020 2020 2020 2066 7574  .            fut
+0000d9d0: 7572 655f 7265 6772 6573 736f 7220 6973  ure_regressor is
+0000d9e0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+0000d9f0: 2020 2061 6e64 2073 656c 662e 6675 7475     and self.futu
+0000da00: 7265 5f72 6567 7265 7373 6f72 5f74 7261  re_regressor_tra
+0000da10: 696e 2069 7320 6e6f 7420 4e6f 6e65 0d0a  in is not None..
+0000da20: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0000da30: 666f 7265 6361 7374 5f6c 656e 6774 6820  forecast_length 
+0000da40: 6973 206e 6f74 204e 6f6e 650d 0a20 2020  is not None..   
+0000da50: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
+0000da60: 2020 2020 2069 6620 7365 6c66 2e76 6572       if self.ver
+0000da70: 626f 7365 203e 2030 3a0d 0a20 2020 2020  bose > 0:..     
+0000da80: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000da90: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000daa0: 2020 2020 2020 2022 6675 7475 7265 5f72         "future_r
+0000dab0: 6567 7265 7373 6f72 206e 6f74 2070 726f  egressor not pro
+0000dac0: 7669 6465 6420 746f 2043 6173 7361 6e64  vided to Cassand
+0000dad0: 7261 2c20 7573 696e 6720 666f 7265 6361  ra, using foreca
+0000dae0: 7374 7320 6f66 2068 6973 746f 7269 6361  sts of historica
+0000daf0: 6c22 0d0a 2020 2020 2020 2020 2020 2020  l"..            
+0000db00: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+0000db10: 2020 2066 7574 7572 655f 7265 6772 6573     future_regres
+0000db20: 736f 7220 3d20 6d6f 6465 6c5f 666f 7265  sor = model_fore
+0000db30: 6361 7374 280d 0a20 2020 2020 2020 2020  cast(..         
+0000db40: 2020 2020 2020 206d 6f64 656c 5f6e 616d         model_nam
+0000db50: 653d 7365 6c66 2e74 7265 6e64 5f6d 6f64  e=self.trend_mod
+0000db60: 656c 5b27 4d6f 6465 6c27 5d0d 0a20 2020  el['Model']..   
+0000db70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000db80: 7265 6772 6573 736f 725f 666f 7265 6361  regressor_foreca
+0000db90: 7374 5f6d 6f64 656c 2069 7320 4e6f 6e65  st_model is None
+0000dba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000dbb0: 2020 656c 7365 2072 6567 7265 7373 6f72    else regressor
+0000dbc0: 5f66 6f72 6563 6173 745f 6d6f 6465 6c2c  _forecast_model,
+0000dbd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000dbe0: 2020 6d6f 6465 6c5f 7061 7261 6d5f 6469    model_param_di
+0000dbf0: 6374 3d73 656c 662e 7472 656e 645f 6d6f  ct=self.trend_mo
+0000dc00: 6465 6c5b 274d 6f64 656c 5061 7261 6d65  del['ModelParame
+0000dc10: 7465 7273 275d 0d0a 2020 2020 2020 2020  ters']..        
+0000dc20: 2020 2020 2020 2020 6966 2072 6567 7265          if regre
+0000dc30: 7373 6f72 5f66 6f72 6563 6173 745f 6d6f  ssor_forecast_mo
+0000dc40: 6465 6c5f 7061 7261 6d73 2069 7320 4e6f  del_params is No
+0000dc50: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+0000dc60: 2020 2020 656c 7365 2072 6567 7265 7373      else regress
+0000dc70: 6f72 5f66 6f72 6563 6173 745f 6d6f 6465  or_forecast_mode
+0000dc80: 6c5f 7061 7261 6d73 2c0d 0a20 2020 2020  l_params,..     
+0000dc90: 2020 2020 2020 2020 2020 206d 6f64 656c             model
+0000dca0: 5f74 7261 6e73 666f 726d 5f64 6963 743d  _transform_dict=
+0000dcb0: 7365 6c66 2e70 7265 7072 6f63 6573 7369  self.preprocessi
+0000dcc0: 6e67 5f74 7261 6e73 666f 726d 6174 696f  ng_transformatio
+0000dcd0: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+0000dce0: 2020 2069 6620 7265 6772 6573 736f 725f     if regressor_
+0000dcf0: 666f 7265 6361 7374 5f74 7261 6e73 666f  forecast_transfo
+0000dd00: 726d 6174 696f 6e73 2069 7320 4e6f 6e65  rmations is None
+0000dd10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000dd20: 2020 656c 7365 2072 6567 7265 7373 6f72    else regressor
+0000dd30: 5f66 6f72 6563 6173 745f 7472 616e 7366  _forecast_transf
+0000dd40: 6f72 6d61 7469 6f6e 732c 0d0a 2020 2020  ormations,..    
+0000dd50: 2020 2020 2020 2020 2020 2020 6466 5f74              df_t
+0000dd60: 7261 696e 3d73 656c 662e 6675 7475 7265  rain=self.future
+0000dd70: 5f72 6567 7265 7373 6f72 5f74 7261 696e  _regressor_train
+0000dd80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000dd90: 2020 2066 6f72 6563 6173 745f 6c65 6e67     forecast_leng
+0000dda0: 7468 3d66 6f72 6563 6173 745f 6c65 6e67  th=forecast_leng
+0000ddb0: 7468 2c0d 0a20 2020 2020 2020 2020 2020  th,..           
+0000ddc0: 2020 2020 2066 7265 7175 656e 6379 3d73       frequency=s
+0000ddd0: 656c 662e 6672 6571 7565 6e63 792c 0d0a  elf.frequency,..
+0000dde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddf0: 7072 6564 6963 7469 6f6e 5f69 6e74 6572  prediction_inter
+0000de00: 7661 6c3d 7365 6c66 2e70 7265 6469 6374  val=self.predict
+0000de10: 696f 6e5f 696e 7465 7276 616c 2c0d 0a20  ion_interval,.. 
+0000de20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000de30: 6169 6c5f 6f6e 5f66 6f72 6563 6173 745f  ail_on_forecast_
+0000de40: 6e61 6e3d 4661 6c73 652c 0d0a 2020 2020  nan=False,..    
+0000de50: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
+0000de60: 6f6d 5f73 6565 643d 7365 6c66 2e72 616e  om_seed=self.ran
+0000de70: 646f 6d5f 7365 6564 2c0d 0a20 2020 2020  dom_seed,..     
+0000de80: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
+0000de90: 7365 3d73 656c 662e 7665 7262 6f73 652c  se=self.verbose,
+0000dea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000deb0: 2020 6e5f 6a6f 6273 3d73 656c 662e 6e5f    n_jobs=self.n_
+0000dec0: 6a6f 6273 2c0d 0a20 2020 2020 2020 2020  jobs,..         
+0000ded0: 2020 2029 2e66 6f72 6563 6173 740d 0a20     ).forecast.. 
+0000dee0: 2020 2020 2020 2020 2020 2066 756c 6c5f             full_
+0000def0: 7265 6772 203d 2070 642e 636f 6e63 6174  regr = pd.concat
+0000df00: 285b 7365 6c66 2e66 7574 7572 655f 7265  ([self.future_re
+0000df10: 6772 6573 736f 725f 7472 6169 6e2c 2066  gressor_train, f
+0000df20: 7574 7572 655f 7265 6772 6573 736f 725d  uture_regressor]
+0000df30: 290d 0a20 2020 2020 2020 2069 6620 666f  )..        if fo
+0000df40: 7265 6361 7374 5f6c 656e 6774 6820 6973  recast_length is
+0000df50: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0000df60: 2020 2020 6578 7065 6374 6564 5f66 6f72      expected_for
+0000df70: 655f 6c65 6e20 3d20 6c65 6e28 6466 290d  e_len = len(df).
+0000df80: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0000df90: 2020 2020 2020 2020 2020 2020 6578 7065              expe
+0000dfa0: 6374 6564 5f66 6f72 655f 6c65 6e20 3d20  cted_fore_len = 
+0000dfb0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000dfc0: 2020 2066 6f72 6563 6173 745f 6c65 6e67     forecast_leng
+0000dfd0: 7468 202b 206c 656e 2864 6629 2069 6620  th + len(df) if 
+0000dfe0: 696e 636c 7564 655f 6869 7374 6f72 7920  include_history 
+0000dff0: 656c 7365 2066 6f72 6563 6173 745f 6c65  else forecast_le
+0000e000: 6e67 7468 0d0a 2020 2020 2020 2020 2020  ngth..          
+0000e010: 2020 290d 0a20 2020 2020 2020 2069 6620    )..        if 
+0000e020: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
+0000e030: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0000e040: 2073 656c 662e 7265 6772 6573 736f 7273   self.regressors
+0000e050: 5f75 7365 643a 0d0a 2020 2020 2020 2020  _used:..        
+0000e060: 2020 2020 6966 206c 656e 2866 7574 7572      if len(futur
+0000e070: 655f 7265 6772 6573 736f 7229 203d 3d20  e_regressor) == 
+0000e080: 6578 7065 6374 6564 5f66 6f72 655f 6c65  expected_fore_le
+0000e090: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+0000e0a0: 2020 2020 6675 6c6c 5f72 6567 7220 3d20      full_regr = 
+0000e0b0: 7365 6c66 2e72 6567 7265 7373 6f72 5f74  self.regressor_t
+0000e0c0: 7261 6e73 666f 726d 6572 2e74 7261 6e73  ransformer.trans
+0000e0d0: 666f 726d 280d 0a20 2020 2020 2020 2020  form(..         
+0000e0e0: 2020 2020 2020 2020 2020 2063 6c65 616e             clean
+0000e0f0: 5f72 6567 7265 7373 6f72 2866 7574 7572  _regressor(futur
+0000e100: 655f 7265 6772 6573 736f 7229 0d0a 2020  e_regressor)..  
+0000e110: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+0000e120: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000e130: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000e140: 2020 2020 6675 6c6c 5f72 6567 7220 3d20      full_regr = 
+0000e150: 7064 2e63 6f6e 6361 7428 0d0a 2020 2020  pd.concat(..    
+0000e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e170: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
+0000e180: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e190: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
+0000e1a0: 5f74 7261 696e 2c0d 0a20 2020 2020 2020  _train,..       
+0000e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1c0: 2073 656c 662e 7265 6772 6573 736f 725f   self.regressor_
+0000e1d0: 7472 616e 7366 6f72 6d65 722e 7472 616e  transformer.tran
+0000e1e0: 7366 6f72 6d28 0d0a 2020 2020 2020 2020  sform(..        
+0000e1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e200: 2020 2020 636c 6561 6e5f 7265 6772 6573      clean_regres
+0000e210: 736f 7228 0d0a 2020 2020 2020 2020 2020  sor(..          
+0000e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e230: 2020 2020 2020 6675 7475 7265 5f72 6567        future_reg
+0000e240: 7265 7373 6f72 2e6c 6f63 5b0d 0a20 2020  ressor.loc[..   
 0000e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e260: 2020 2020 2020 2020 7365 6c66 2e66 7574          self.fut
-0000e270: 7572 655f 7265 6772 6573 736f 725f 7472  ure_regressor_tr
-0000e280: 6169 6e2e 696e 6465 780d 0a20 2020 2020  ain.index..     
-0000e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000e2b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2d0: 2020 5d0d 0a20 2020 2020 2020 2020 2020    ]..           
+0000e260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e270: 2066 7574 7572 655f 7265 6772 6573 736f   future_regresso
+0000e280: 722e 696e 6465 782e 6469 6666 6572 656e  r.index.differen
+0000e290: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+0000e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2b0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000e2c0: 662e 6675 7475 7265 5f72 6567 7265 7373  f.future_regress
+0000e2d0: 6f72 5f74 7261 696e 2e69 6e64 6578 0d0a  or_train.index..
 0000e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2f0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-0000e300: 2020 2020 2020 2020 2020 2020 292c 0d0a              ),..
+0000e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e300: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
 0000e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e320: 2020 2020 5d0d 0a20 2020 2020 2020 2020      ]..         
-0000e330: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-0000e340: 2020 6966 2028 0d0a 2020 2020 2020 2020    if (..        
-0000e350: 2020 2020 666c 6167 5f72 6567 7265 7373      flag_regress
-0000e360: 6f72 7320 6973 206e 6f74 204e 6f6e 650d  ors is not None.
-0000e370: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
-0000e380: 2066 6f72 6563 6173 745f 6c65 6e67 7468   forecast_length
-0000e390: 2069 7320 6e6f 7420 4e6f 6e65 0d0a 2020   is not None..  
-0000e3a0: 2020 2020 2020 2020 2020 616e 6420 7365            and se
-0000e3b0: 6c66 2e72 6567 7265 7373 6f72 735f 7573  lf.regressors_us
-0000e3c0: 6564 0d0a 2020 2020 2020 2020 293a 0d0a  ed..        ):..
-0000e3d0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000e3e0: 656e 2866 6c61 675f 7265 6772 6573 736f  en(flag_regresso
-0000e3f0: 7273 2920 3d3d 2065 7870 6563 7465 645f  rs) == expected_
-0000e400: 666f 7265 5f6c 656e 3a0d 0a20 2020 2020  fore_len:..     
-0000e410: 2020 2020 2020 2020 2020 2061 6c6c 5f66             all_f
-0000e420: 6c61 6773 203d 2063 6c65 616e 5f72 6567  lags = clean_reg
-0000e430: 7265 7373 6f72 2866 6c61 675f 7265 6772  ressor(flag_regr
-0000e440: 6573 736f 7273 2c20 7072 6566 6978 3d22  essors, prefix="
-0000e450: 7265 6772 666c 6167 735f 2229 0d0a 2020  regrflags_")..  
-0000e460: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0000e470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e480: 2061 6c6c 5f66 6c61 6773 203d 2070 642e   all_flags = pd.
-0000e490: 636f 6e63 6174 280d 0a20 2020 2020 2020  concat(..       
-0000e4a0: 2020 2020 2020 2020 2020 2020 205b 0d0a               [..
-0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e4c0: 2020 2020 2020 2020 7365 6c66 2e66 6c61          self.fla
-0000e4d0: 675f 7265 6772 6573 736f 725f 7472 6169  g_regressor_trai
-0000e4e0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-0000e4f0: 2020 2020 2020 2020 2020 2020 636c 6561              clea
-0000e500: 6e5f 7265 6772 6573 736f 7228 0d0a 2020  n_regressor(..  
-0000e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e520: 2020 2020 2020 2020 2020 666c 6167 5f72            flag_r
-0000e530: 6567 7265 7373 6f72 732e 6c6f 635b 0d0a  egressors.loc[..
+0000e320: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
+0000e330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e340: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e360: 2029 2c0d 0a20 2020 2020 2020 2020 2020   ),..           
+0000e370: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
+0000e380: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000e390: 2020 2020 2020 2069 6620 280d 0a20 2020         if (..   
+0000e3a0: 2020 2020 2020 2020 2066 6c61 675f 7265           flag_re
+0000e3b0: 6772 6573 736f 7273 2069 7320 6e6f 7420  gressors is not 
+0000e3c0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+0000e3d0: 2020 616e 6420 666f 7265 6361 7374 5f6c    and forecast_l
+0000e3e0: 656e 6774 6820 6973 206e 6f74 204e 6f6e  ength is not Non
+0000e3f0: 650d 0a20 2020 2020 2020 2020 2020 2061  e..            a
+0000e400: 6e64 2073 656c 662e 7265 6772 6573 736f  nd self.regresso
+0000e410: 7273 5f75 7365 640d 0a20 2020 2020 2020  rs_used..       
+0000e420: 2029 3a0d 0a20 2020 2020 2020 2020 2020   ):..           
+0000e430: 2069 6620 6c65 6e28 666c 6167 5f72 6567   if len(flag_reg
+0000e440: 7265 7373 6f72 7329 203d 3d20 6578 7065  ressors) == expe
+0000e450: 6374 6564 5f66 6f72 655f 6c65 6e3a 0d0a  cted_fore_len:..
+0000e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e470: 616c 6c5f 666c 6167 7320 3d20 636c 6561  all_flags = clea
+0000e480: 6e5f 7265 6772 6573 736f 7228 666c 6167  n_regressor(flag
+0000e490: 5f72 6567 7265 7373 6f72 732c 2070 7265  _regressors, pre
+0000e4a0: 6669 783d 2272 6567 7266 6c61 6773 5f22  fix="regrflags_"
+0000e4b0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+0000e4c0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0000e4d0: 2020 2020 2020 616c 6c5f 666c 6167 7320        all_flags 
+0000e4e0: 3d20 7064 2e63 6f6e 6361 7428 0d0a 2020  = pd.concat(..  
+0000e4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e500: 2020 5b0d 0a20 2020 2020 2020 2020 2020    [..           
+0000e510: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000e520: 662e 666c 6167 5f72 6567 7265 7373 6f72  f.flag_regressor
+0000e530: 5f74 7261 696e 2c0d 0a20 2020 2020 2020  _train,..       
 0000e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e560: 666c 6167 5f72 6567 7265 7373 6f72 732e  flag_regressors.
-0000e570: 696e 6465 782e 6469 6666 6572 656e 6365  index.difference
-0000e580: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000e590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5a0: 2020 2020 2020 2073 656c 662e 666c 6167         self.flag
-0000e5b0: 5f72 6567 7265 7373 6f72 5f74 7261 696e  _regressor_train
-0000e5c0: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
-0000e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e5e0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e600: 2020 2020 2020 205d 2c0d 0a20 2020 2020         ],..     
-0000e610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e620: 2020 2020 2020 2070 7265 6669 783d 2272         prefix="r
-0000e630: 6567 7266 6c61 6773 5f22 2c0d 0a20 2020  egrflags_",..   
+0000e550: 2063 6c65 616e 5f72 6567 7265 7373 6f72   clean_regressor
+0000e560: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000e570: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000e580: 6c61 675f 7265 6772 6573 736f 7273 2e6c  lag_regressors.l
+0000e590: 6f63 5b0d 0a20 2020 2020 2020 2020 2020  oc[..           
+0000e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5b0: 2020 2020 2066 6c61 675f 7265 6772 6573       flag_regres
+0000e5c0: 736f 7273 2e69 6e64 6578 2e64 6966 6665  sors.index.diffe
+0000e5d0: 7265 6e63 6528 0d0a 2020 2020 2020 2020  rence(..        
+0000e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e5f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000e600: 2e66 6c61 675f 7265 6772 6573 736f 725f  .flag_regressor_
+0000e610: 7472 6169 6e2e 696e 6465 780d 0a20 2020  train.index..   
+0000e620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e630: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
 0000e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e650: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
-0000e660: 2020 2020 2020 2020 2020 2020 205d 0d0a               ]..
-0000e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e680: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-0000e690: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000e6a0: 2028 0d0a 2020 2020 2020 2020 2020 2020   (..            
-0000e6b0: 2020 2020 7365 6c66 2e66 6c61 675f 7265      self.flag_re
-0000e6c0: 6772 6573 736f 725f 7472 6169 6e20 6973  gressor_train is
-0000e6d0: 206e 6f74 204e 6f6e 650d 0a20 2020 2020   not None..     
-0000e6e0: 2020 2020 2020 2020 2020 2061 6e64 2066             and f
-0000e6f0: 6f72 6563 6173 745f 6c65 6e67 7468 2069  orecast_length i
-0000e700: 7320 6e6f 7420 4e6f 6e65 0d0a 2020 2020  s not None..    
-0000e710: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000e720: 7365 6c66 2e72 6567 7265 7373 6f72 735f  self.regressors_
-0000e730: 7573 6564 0d0a 2020 2020 2020 2020 2020  used..          
-0000e740: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
-0000e750: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000e760: 6545 7272 6f72 2822 666c 6167 5f72 6567  eError("flag_reg
-0000e770: 7265 7373 6f72 7320 7375 7070 6c69 6564  ressors supplied
-0000e780: 2069 6e20 7472 6169 6e69 6e67 2062 7574   in training but
-0000e790: 206e 6f74 2070 7265 6469 6374 2229 0d0a   not predict")..
-0000e7a0: 2020 2020 2020 2020 2020 2020 616c 6c5f              all_
-0000e7b0: 666c 6167 7320 3d20 7365 6c66 2e66 6c61  flags = self.fla
-0000e7c0: 675f 7265 6772 6573 736f 725f 7472 6169  g_regressor_trai
-0000e7d0: 6e0d 0a20 2020 2020 2020 2069 6620 6675  n..        if fu
-0000e7e0: 7475 7265 5f69 6d70 6163 7473 2069 7320  ture_impacts is 
-0000e7f0: 6e6f 7420 4e6f 6e65 2061 6e64 2066 6f72  not None and for
-0000e800: 6563 6173 745f 6c65 6e67 7468 2069 7320  ecast_length is 
-0000e810: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-0000e820: 2020 2020 2020 2069 6620 6c65 6e28 6675         if len(fu
-0000e830: 7475 7265 5f69 6d70 6163 7473 2920 3d3d  ture_impacts) ==
-0000e840: 2065 7870 6563 7465 645f 666f 7265 5f6c   expected_fore_l
-0000e850: 656e 3a0d 0a20 2020 2020 2020 2020 2020  en:..           
-0000e860: 2020 2020 2069 6d70 6163 7473 203d 2066       impacts = f
-0000e870: 7574 7572 655f 696d 7061 6374 730d 0a20  uture_impacts.. 
-0000e880: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000e890: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e8a0: 2020 696d 7061 6374 7320 3d20 7064 2e63    impacts = pd.c
-0000e8b0: 6f6e 6361 7428 5b73 656c 662e 7061 7374  oncat([self.past
-0000e8c0: 5f69 6d70 6163 7473 2c20 6675 7475 7265  _impacts, future
-0000e8d0: 5f69 6d70 6163 7473 5d29 0d0a 2020 2020  _impacts])..    
-0000e8e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000e650: 2020 2020 2020 2020 2020 2020 5d2c 0d0a              ],..
+0000e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e670: 2020 2020 2020 2020 2020 2020 7072 6566              pref
+0000e680: 6978 3d22 7265 6772 666c 6167 735f 222c  ix="regrflags_",
+0000e690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e6a0: 2020 2020 2020 2020 2020 292c 0d0a 2020            ),..  
+0000e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6c0: 2020 5d0d 0a20 2020 2020 2020 2020 2020    ]..           
+0000e6d0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0000e6e0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000e6f0: 2020 2069 6620 280d 0a20 2020 2020 2020     if (..       
+0000e700: 2020 2020 2020 2020 2073 656c 662e 666c           self.fl
+0000e710: 6167 5f72 6567 7265 7373 6f72 5f74 7261  ag_regressor_tra
+0000e720: 696e 2069 7320 6e6f 7420 4e6f 6e65 0d0a  in is not None..
+0000e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e740: 616e 6420 666f 7265 6361 7374 5f6c 656e  and forecast_len
+0000e750: 6774 6820 6973 206e 6f74 204e 6f6e 650d  gth is not None.
+0000e760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e770: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
+0000e780: 736f 7273 5f75 7365 640d 0a20 2020 2020  sors_used..     
+0000e790: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
+0000e7a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000e7b0: 2056 616c 7565 4572 726f 7228 2266 6c61   ValueError("fla
+0000e7c0: 675f 7265 6772 6573 736f 7273 2073 7570  g_regressors sup
+0000e7d0: 706c 6965 6420 696e 2074 7261 696e 696e  plied in trainin
+0000e7e0: 6720 6275 7420 6e6f 7420 7072 6564 6963  g but not predic
+0000e7f0: 7422 290d 0a20 2020 2020 2020 2020 2020  t")..           
+0000e800: 2061 6c6c 5f66 6c61 6773 203d 2073 656c   all_flags = sel
+0000e810: 662e 666c 6167 5f72 6567 7265 7373 6f72  f.flag_regressor
+0000e820: 5f74 7261 696e 0d0a 2020 2020 2020 2020  _train..        
+0000e830: 6966 2066 7574 7572 655f 696d 7061 6374  if future_impact
+0000e840: 7320 6973 206e 6f74 204e 6f6e 6520 616e  s is not None an
+0000e850: 6420 666f 7265 6361 7374 5f6c 656e 6774  d forecast_lengt
+0000e860: 6820 6973 206e 6f74 204e 6f6e 653a 0d0a  h is not None:..
+0000e870: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000e880: 656e 2866 7574 7572 655f 696d 7061 6374  en(future_impact
+0000e890: 7329 203d 3d20 6578 7065 6374 6564 5f66  s) == expected_f
+0000e8a0: 6f72 655f 6c65 6e3a 0d0a 2020 2020 2020  ore_len:..      
+0000e8b0: 2020 2020 2020 2020 2020 696d 7061 6374            impact
+0000e8c0: 7320 3d20 6675 7475 7265 5f69 6d70 6163  s = future_impac
+0000e8d0: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
+0000e8e0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
 0000e8f0: 2020 2020 2020 2069 6d70 6163 7473 203d         impacts =
-0000e900: 2073 656c 662e 7061 7374 5f69 6d70 6163   self.past_impac
-0000e910: 7473 0d0a 2020 2020 2020 2020 2320 4920  ts..        # I 
-0000e920: 646f 6e27 7420 7468 696e 6b20 7468 6572  don't think ther
-0000e930: 6520 6973 2061 206d 6f72 6520 6566 6669  e is a more effi
-0000e940: 6369 656e 7420 7761 7920 746f 2063 6f6d  cient way to com
-0000e950: 6269 6e65 2074 6865 7365 2064 6963 7473  bine these dicts
-0000e960: 206f 6620 6461 7461 6672 616d 6573 0d0a   of dataframes..
-0000e970: 2020 2020 2020 2020 6966 2072 6567 7265          if regre
-0000e980: 7373 6f72 5f70 6572 5f73 6572 6965 7320  ssor_per_series 
-0000e990: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0000e9a0: 7365 6c66 2e72 6567 7265 7373 6f72 735f  self.regressors_
-0000e9b0: 7573 6564 3a0d 0a20 2020 2020 2020 2020  used:..         
-0000e9c0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-0000e9d0: 616e 6365 2872 6567 7265 7373 6f72 5f70  ance(regressor_p
-0000e9e0: 6572 5f73 6572 6965 732c 2064 6963 7429  er_series, dict)
-0000e9f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000ea00: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000ea10: 726f 7228 2272 6567 7265 7373 6f72 5f70  ror("regressor_p
-0000ea20: 6572 5f73 6572 6965 7320 6d75 7374 2062  er_series must b
-0000ea30: 6520 6469 6374 2229 0d0a 2020 2020 2020  e dict")..      
-0000ea40: 2020 2020 2020 7265 6772 5f70 735f 666f        regr_ps_fo
-0000ea50: 7265 203d 207b 7d0d 0a20 2020 2020 2020  re = {}..       
-0000ea60: 2020 2020 2066 6f72 206b 6579 2c20 7661       for key, va
-0000ea70: 6c75 6520 696e 2073 656c 662e 7265 6772  lue in self.regr
-0000ea80: 5f70 6572 5f73 6572 6965 735f 7472 2e69  _per_series_tr.i
-0000ea90: 7465 6d73 2829 3a0d 0a20 2020 2020 2020  tems():..       
-0000eaa0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0000eab0: 7265 6772 6573 736f 725f 7065 725f 7365  regressor_per_se
-0000eac0: 7269 6573 5b6b 6579 5d29 203d 3d20 6578  ries[key]) == ex
-0000ead0: 7065 6374 6564 5f66 6f72 655f 6c65 6e3a  pected_fore_len:
-0000eae0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000eaf0: 2020 2020 2020 7265 6772 5f70 735f 666f        regr_ps_fo
-0000eb00: 7265 5b6b 6579 5d20 3d20 7265 6772 6573  re[key] = regres
-0000eb10: 736f 725f 7065 725f 7365 7269 6573 5b6b  sor_per_series[k
-0000eb20: 6579 5d0d 0a20 2020 2020 2020 2020 2020  ey]..           
-0000eb30: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0000eb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb50: 7265 6772 5f70 735f 666f 7265 5b6b 6579  regr_ps_fore[key
-0000eb60: 5d20 3d20 7064 2e63 6f6e 6361 7428 0d0a  ] = pd.concat(..
-0000eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb80: 2020 2020 2020 2020 5b73 656c 662e 7265          [self.re
-0000eb90: 6772 5f70 6572 5f73 6572 6965 735f 7472  gr_per_series_tr
-0000eba0: 5b6b 6579 5d2c 2072 6567 7265 7373 6f72  [key], regressor
-0000ebb0: 5f70 6572 5f73 6572 6965 735b 6b65 795d  _per_series[key]
-0000ebc0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0000ebd0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-0000ebe0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000ebf0: 6772 5f70 735f 666f 7265 5b6b 6579 5d20  gr_ps_fore[key] 
-0000ec00: 3d20 7265 6772 5f70 735f 666f 7265 5b6b  = regr_ps_fore[k
-0000ec10: 6579 5d2e 696c 6f63 5b0d 0a20 2020 2020  ey].iloc[..     
-0000ec20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec30: 2020 207e 7265 6772 5f70 735f 666f 7265     ~regr_ps_fore
-0000ec40: 5b6b 6579 5d2e 696e 6465 782e 6475 706c  [key].index.dupl
-0000ec50: 6963 6174 6564 2829 0d0a 2020 2020 2020  icated()..      
-0000ec60: 2020 2020 2020 2020 2020 2020 2020 5d0d                ].
-0000ec70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ec80: 2073 656c 662e 7265 6772 5f70 7320 3d20   self.regr_ps = 
-0000ec90: 7265 6772 5f70 735f 666f 7265 0d0a 2020  regr_ps_fore..  
-0000eca0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000ecb0: 2020 2020 2020 2020 2072 6567 725f 7073           regr_ps
-0000ecc0: 5f66 6f72 6520 3d20 7365 6c66 2e72 6567  _fore = self.reg
-0000ecd0: 725f 7065 725f 7365 7269 6573 5f74 720d  r_per_series_tr.
-0000ece0: 0a0d 0a20 2020 2020 2020 2023 2067 656e  ...        # gen
-0000ecf0: 6572 6174 6520 7472 656e 640d 0a20 2020  erate trend..   
-0000ed00: 2020 2020 2023 204d 4159 2057 414e 5420       # MAY WANT 
-0000ed10: 544f 2050 4153 5320 6675 7475 7265 5f72  TO PASS future_r
-0000ed20: 6567 7265 7373 6f72 2048 4552 450d 0a20  egressor HERE.. 
-0000ed30: 2020 2020 2020 2072 6573 6964 203d 204e         resid = N
-0000ed40: 6f6e 650d 0a20 2020 2020 2020 2069 6620  one..        if 
-0000ed50: 666f 7265 6361 7374 5f6c 656e 6774 6820  forecast_length 
-0000ed60: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-0000ed70: 2020 2020 2020 2020 2020 2320 6372 6561            # crea
-0000ed80: 7465 206e 6577 2072 6f6c 6c69 6e67 2072  te new rolling r
-0000ed90: 6573 6964 7561 6c20 6966 206e 6577 2064  esidual if new d
-0000eda0: 6174 6120 7072 6f76 6964 6564 0d0a 2020  ata provided..  
-0000edb0: 2020 2020 2020 2020 2020 6966 206e 6577            if new
-0000edc0: 5f64 6620 6973 206e 6f74 204e 6f6e 653a  _df is not None:
-0000edd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ede0: 2020 7265 7369 6420 3d20 6466 202d 2073    resid = df - s
-0000edf0: 656c 662e 5f70 7265 6469 6374 5f6c 696e  elf._predict_lin
-0000ee00: 6561 7228 0d0a 2020 2020 2020 2020 2020  ear(..          
-0000ee10: 2020 2020 2020 2020 2020 6461 7465 733d            dates=
-0000ee20: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
-0000ee30: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0000ee40: 6973 746f 7279 5f64 663d 6466 2c0d 0a20  istory_df=df,.. 
-0000ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee60: 2020 2066 7574 7572 655f 7265 6772 6573     future_regres
-0000ee70: 736f 723d 6675 6c6c 5f72 6567 722c 0d0a  sor=full_regr,..
+0000e900: 2070 642e 636f 6e63 6174 285b 7365 6c66   pd.concat([self
+0000e910: 2e70 6173 745f 696d 7061 6374 732c 2066  .past_impacts, f
+0000e920: 7574 7572 655f 696d 7061 6374 735d 290d  uture_impacts]).
+0000e930: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0000e940: 2020 2020 2020 2020 2020 2020 696d 7061              impa
+0000e950: 6374 7320 3d20 7365 6c66 2e70 6173 745f  cts = self.past_
+0000e960: 696d 7061 6374 730d 0a20 2020 2020 2020  impacts..       
+0000e970: 2023 2049 2064 6f6e 2774 2074 6869 6e6b   # I don't think
+0000e980: 2074 6865 7265 2069 7320 6120 6d6f 7265   there is a more
+0000e990: 2065 6666 6963 6965 6e74 2077 6179 2074   efficient way t
+0000e9a0: 6f20 636f 6d62 696e 6520 7468 6573 6520  o combine these 
+0000e9b0: 6469 6374 7320 6f66 2064 6174 6166 7261  dicts of datafra
+0000e9c0: 6d65 730d 0a20 2020 2020 2020 2069 6620  mes..        if 
+0000e9d0: 7265 6772 6573 736f 725f 7065 725f 7365  regressor_per_se
+0000e9e0: 7269 6573 2069 7320 6e6f 7420 4e6f 6e65  ries is not None
+0000e9f0: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
+0000ea00: 736f 7273 5f75 7365 643a 0d0a 2020 2020  sors_used:..    
+0000ea10: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+0000ea20: 7369 6e73 7461 6e63 6528 7265 6772 6573  sinstance(regres
+0000ea30: 736f 725f 7065 725f 7365 7269 6573 2c20  sor_per_series, 
+0000ea40: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
+0000ea50: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0000ea60: 6c75 6545 7272 6f72 2822 7265 6772 6573  lueError("regres
+0000ea70: 736f 725f 7065 725f 7365 7269 6573 206d  sor_per_series m
+0000ea80: 7573 7420 6265 2064 6963 7422 290d 0a20  ust be dict").. 
+0000ea90: 2020 2020 2020 2020 2020 2072 6567 725f             regr_
+0000eaa0: 7073 5f66 6f72 6520 3d20 7b7d 0d0a 2020  ps_fore = {}..  
+0000eab0: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+0000eac0: 792c 2076 616c 7565 2069 6e20 7365 6c66  y, value in self
+0000ead0: 2e72 6567 725f 7065 725f 7365 7269 6573  .regr_per_series
+0000eae0: 5f74 722e 6974 656d 7328 293a 0d0a 2020  _tr.items():..  
+0000eaf0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000eb00: 206c 656e 2872 6567 7265 7373 6f72 5f70   len(regressor_p
+0000eb10: 6572 5f73 6572 6965 735b 6b65 795d 2920  er_series[key]) 
+0000eb20: 3d3d 2065 7870 6563 7465 645f 666f 7265  == expected_fore
+0000eb30: 5f6c 656e 3a0d 0a20 2020 2020 2020 2020  _len:..         
+0000eb40: 2020 2020 2020 2020 2020 2072 6567 725f             regr_
+0000eb50: 7073 5f66 6f72 655b 6b65 795d 203d 2072  ps_fore[key] = r
+0000eb60: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
+0000eb70: 6965 735b 6b65 795d 0d0a 2020 2020 2020  ies[key]..      
+0000eb80: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0000eb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eba0: 2020 2020 2072 6567 725f 7073 5f66 6f72       regr_ps_for
+0000ebb0: 655b 6b65 795d 203d 2070 642e 636f 6e63  e[key] = pd.conc
+0000ebc0: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
+0000ebd0: 2020 2020 2020 2020 2020 2020 205b 7365               [se
+0000ebe0: 6c66 2e72 6567 725f 7065 725f 7365 7269  lf.regr_per_seri
+0000ebf0: 6573 5f74 725b 6b65 795d 2c20 7265 6772  es_tr[key], regr
+0000ec00: 6573 736f 725f 7065 725f 7365 7269 6573  essor_per_series
+0000ec10: 5b6b 6579 5d5d 0d0a 2020 2020 2020 2020  [key]]..        
+0000ec20: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec40: 2020 2072 6567 725f 7073 5f66 6f72 655b     regr_ps_fore[
+0000ec50: 6b65 795d 203d 2072 6567 725f 7073 5f66  key] = regr_ps_f
+0000ec60: 6f72 655b 6b65 795d 2e69 6c6f 635b 0d0a  ore[key].iloc[..
+0000ec70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec80: 2020 2020 2020 2020 7e72 6567 725f 7073          ~regr_ps
+0000ec90: 5f66 6f72 655b 6b65 795d 2e69 6e64 6578  _fore[key].index
+0000eca0: 2e64 7570 6c69 6361 7465 6428 290d 0a20  .duplicated().. 
+0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ecc0: 2020 205d 0d0a 2020 2020 2020 2020 2020     ]..          
+0000ecd0: 2020 2020 2020 7365 6c66 2e72 6567 725f        self.regr_
+0000ece0: 7073 203d 2072 6567 725f 7073 5f66 6f72  ps = regr_ps_for
+0000ecf0: 650d 0a20 2020 2020 2020 2065 6c73 653a  e..        else:
+0000ed00: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000ed10: 6772 5f70 735f 666f 7265 203d 2073 656c  gr_ps_fore = sel
+0000ed20: 662e 7265 6772 5f70 6572 5f73 6572 6965  f.regr_per_serie
+0000ed30: 735f 7472 0d0a 0d0a 2020 2020 2020 2020  s_tr....        
+0000ed40: 2320 6765 6e65 7261 7465 2074 7265 6e64  # generate trend
+0000ed50: 0d0a 2020 2020 2020 2020 2320 4d41 5920  ..        # MAY 
+0000ed60: 5741 4e54 2054 4f20 5041 5353 2066 7574  WANT TO PASS fut
+0000ed70: 7572 655f 7265 6772 6573 736f 7220 4845  ure_regressor HE
+0000ed80: 5245 0d0a 2020 2020 2020 2020 7265 7369  RE..        resi
+0000ed90: 6420 3d20 4e6f 6e65 0d0a 2020 2020 2020  d = None..      
+0000eda0: 2020 6966 2066 6f72 6563 6173 745f 6c65    if forecast_le
+0000edb0: 6e67 7468 2069 7320 6e6f 7420 4e6f 6e65  ngth is not None
+0000edc0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0000edd0: 2063 7265 6174 6520 6e65 7720 726f 6c6c   create new roll
+0000ede0: 696e 6720 7265 7369 6475 616c 2069 6620  ing residual if 
+0000edf0: 6e65 7720 6461 7461 2070 726f 7669 6465  new data provide
+0000ee00: 640d 0a20 2020 2020 2020 2020 2020 2069  d..            i
+0000ee10: 6620 6e65 775f 6466 2069 7320 6e6f 7420  f new_df is not 
+0000ee20: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000ee30: 2020 2020 2020 2072 6573 6964 203d 2064         resid = d
+0000ee40: 6620 2d20 7365 6c66 2e5f 7072 6564 6963  f - self._predic
+0000ee50: 745f 6c69 6e65 6172 280d 0a20 2020 2020  t_linear(..     
+0000ee60: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000ee70: 6174 6573 3d64 662e 696e 6465 782c 0d0a  ates=df.index,..
 0000ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee90: 2020 2020 666c 6167 5f72 6567 7265 7373      flag_regress
-0000eea0: 6f72 733d 616c 6c5f 666c 6167 732c 0d0a  ors=all_flags,..
-0000eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eec0: 2020 2020 696d 7061 6374 733d 696d 7061      impacts=impa
-0000eed0: 6374 732c 0d0a 2020 2020 2020 2020 2020  cts,..          
-0000eee0: 2020 2020 2020 2020 2020 7265 6772 6573            regres
-0000eef0: 736f 725f 7065 725f 7365 7269 6573 3d72  sor_per_series=r
-0000ef00: 6567 725f 7073 5f66 6f72 652c 0d0a 2020  egr_ps_fore,..  
-0000ef10: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-0000ef20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef30: 2069 6620 7365 6c66 2e74 7265 6e64 5f77   if self.trend_w
-0000ef40: 696e 646f 7720 6973 206e 6f74 204e 6f6e  indow is not Non
-0000ef50: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0000ef60: 2020 2020 2020 2020 7265 7369 642c 2073          resid, s
-0000ef70: 6c6f 7065 2c20 696e 7465 7263 6570 7420  lope, intercept 
-0000ef80: 3d20 7365 6c66 2e72 6f6c 6c69 6e67 5f74  = self.rolling_t
-0000ef90: 7265 6e64 280d 0a20 2020 2020 2020 2020  rend(..         
-0000efa0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000efb0: 6573 6964 2c20 6e70 2e61 7272 6179 2873  esid, np.array(s
-0000efc0: 656c 662e 6372 6561 7465 5f74 2864 662e  elf.create_t(df.
-0000efd0: 696e 6465 7829 290d 0a20 2020 2020 2020  index))..       
-0000efe0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000ee90: 2020 2020 6869 7374 6f72 795f 6466 3d64      history_df=d
+0000eea0: 662c 0d0a 2020 2020 2020 2020 2020 2020  f,..            
+0000eeb0: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
+0000eec0: 6567 7265 7373 6f72 3d66 756c 6c5f 7265  egressor=full_re
+0000eed0: 6772 2c0d 0a20 2020 2020 2020 2020 2020  gr,..           
+0000eee0: 2020 2020 2020 2020 2066 6c61 675f 7265           flag_re
+0000eef0: 6772 6573 736f 7273 3d61 6c6c 5f66 6c61  gressors=all_fla
+0000ef00: 6773 2c0d 0a20 2020 2020 2020 2020 2020  gs,..           
+0000ef10: 2020 2020 2020 2020 2069 6d70 6163 7473           impacts
+0000ef20: 3d69 6d70 6163 7473 2c0d 0a20 2020 2020  =impacts,..     
+0000ef30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000ef40: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
+0000ef50: 6965 733d 7265 6772 5f70 735f 666f 7265  ies=regr_ps_fore
+0000ef60: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000ef70: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+0000ef80: 2020 2020 2020 6966 2073 656c 662e 7472        if self.tr
+0000ef90: 656e 645f 7769 6e64 6f77 2069 7320 6e6f  end_window is no
+0000efa0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0000efb0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0000efc0: 6964 2c20 736c 6f70 652c 2069 6e74 6572  id, slope, inter
+0000efd0: 6365 7074 203d 2073 656c 662e 726f 6c6c  cept = self.roll
+0000efe0: 696e 675f 7472 656e 6428 0d0a 2020 2020  ing_trend(..    
 0000eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f000: 2020 2020 7265 7369 6420 3d20 7064 2e44      resid = pd.D
-0000f010: 6174 6146 7261 6d65 2872 6573 6964 2c20  ataFrame(resid, 
-0000f020: 696e 6465 783d 6466 2e69 6e64 6578 2c20  index=df.index, 
-0000f030: 636f 6c75 6d6e 733d 6466 2e63 6f6c 756d  columns=df.colum
-0000f040: 6e73 290d 0a20 2020 2020 2020 2020 2020  ns)..           
-0000f050: 2064 665f 7472 6169 6e20 3d20 7365 6c66   df_train = self
-0000f060: 2e74 7265 6e64 5f74 7261 696e 2069 6620  .trend_train if 
-0000f070: 7265 7369 6420 6973 204e 6f6e 6520 656c  resid is None el
-0000f080: 7365 2072 6573 6964 0d0a 2020 2020 2020  se resid..      
-0000f090: 2020 2020 2020 2320 636f 6d62 696e 6520        # combine 
-0000f0a0: 7265 6772 6573 736f 7220 7479 7065 7320  regressor types 
-0000f0b0: 6465 7065 6e64 696e 6720 6f6e 2077 6861  depending on wha
-0000f0c0: 7420 6973 2067 6976 656e 0d0a 2020 2020  t is given..    
-0000f0d0: 2020 2020 2020 2020 6966 2028 0d0a 2020          if (..  
-0000f0e0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000f0f0: 6c66 2e66 7574 7572 655f 7265 6772 6573  lf.future_regres
-0000f100: 736f 725f 7472 6169 6e20 6973 204e 6f6e  sor_train is Non
-0000f110: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0000f120: 2020 2061 6e64 2073 656c 662e 666c 6167     and self.flag
-0000f130: 5f72 6567 7265 7373 6f72 5f74 7261 696e  _regressor_train
-0000f140: 2069 7320 6e6f 7420 4e6f 6e65 0d0a 2020   is not None..  
-0000f150: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0000f160: 6420 7365 6c66 2e72 6567 7265 7373 6f72  d self.regressor
-0000f170: 735f 7573 6564 0d0a 2020 2020 2020 2020  s_used..        
-0000f180: 2020 2020 293a 0d0a 2020 2020 2020 2020      ):..        
-0000f190: 2020 2020 2020 2020 636f 6d70 5f72 6567          comp_reg
-0000f1a0: 725f 7472 6169 6e20 3d20 7365 6c66 2e66  r_train = self.f
-0000f1b0: 6c61 675f 7265 6772 6573 736f 725f 7472  lag_regressor_tr
-0000f1c0: 6169 6e2e 7265 696e 6465 7828 0d0a 2020  ain.reindex(..  
-0000f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1e0: 2020 696e 6465 783d 6466 5f74 7261 696e    index=df_train
-0000f1f0: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
-0000f200: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000f210: 2020 2020 2020 2020 2020 2063 6f6d 705f             comp_
-0000f220: 7265 6772 203d 2061 6c6c 5f66 6c61 6773  regr = all_flags
-0000f230: 2e74 6169 6c28 666f 7265 6361 7374 5f6c  .tail(forecast_l
-0000f240: 656e 6774 6829 0d0a 2020 2020 2020 2020  ength)..        
-0000f250: 2020 2020 656c 6966 2028 0d0a 2020 2020      elif (..    
-0000f260: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f270: 2e66 7574 7572 655f 7265 6772 6573 736f  .future_regresso
-0000f280: 725f 7472 6169 6e20 6973 206e 6f74 204e  r_train is not N
-0000f290: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0000f2a0: 2020 2020 2061 6e64 2073 656c 662e 666c       and self.fl
-0000f2b0: 6167 5f72 6567 7265 7373 6f72 5f74 7261  ag_regressor_tra
-0000f2c0: 696e 2069 7320 4e6f 6e65 0d0a 2020 2020  in is None..    
-0000f2d0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000f2e0: 7365 6c66 2e72 6567 7265 7373 6f72 735f  self.regressors_
-0000f2f0: 7573 6564 0d0a 2020 2020 2020 2020 2020  used..          
-0000f300: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
-0000f310: 2020 2020 2020 636f 6d70 5f72 6567 725f        comp_regr_
-0000f320: 7472 6169 6e20 3d20 7365 6c66 2e66 7574  train = self.fut
-0000f330: 7572 655f 7265 6772 6573 736f 725f 7472  ure_regressor_tr
-0000f340: 6169 6e2e 7265 696e 6465 7828 0d0a 2020  ain.reindex(..  
-0000f350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f360: 2020 696e 6465 783d 6466 5f74 7261 696e    index=df_train
-0000f370: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
-0000f380: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000f390: 2020 2020 2020 2020 2020 2063 6f6d 705f             comp_
-0000f3a0: 7265 6772 203d 2066 756c 6c5f 7265 6772  regr = full_regr
-0000f3b0: 2e74 6169 6c28 666f 7265 6361 7374 5f6c  .tail(forecast_l
-0000f3c0: 656e 6774 6829 0d0a 2020 2020 2020 2020  ength)..        
-0000f3d0: 2020 2020 656c 6966 2028 0d0a 2020 2020      elif (..    
-0000f3e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f3f0: 2e66 7574 7572 655f 7265 6772 6573 736f  .future_regresso
-0000f400: 725f 7472 6169 6e20 6973 206e 6f74 204e  r_train is not N
-0000f410: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0000f420: 2020 2020 2061 6e64 2073 656c 662e 666c       and self.fl
-0000f430: 6167 5f72 6567 7265 7373 6f72 5f74 7261  ag_regressor_tra
-0000f440: 696e 2069 7320 6e6f 7420 4e6f 6e65 0d0a  in is not None..
-0000f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f460: 616e 6420 7365 6c66 2e72 6567 7265 7373  and self.regress
-0000f470: 6f72 735f 7573 6564 0d0a 2020 2020 2020  ors_used..      
-0000f480: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
-0000f490: 2020 2020 2020 2020 2020 636f 6d70 5f72            comp_r
-0000f4a0: 6567 725f 7472 6169 6e20 3d20 7064 2e63  egr_train = pd.c
-0000f4b0: 6f6e 6361 7428 0d0a 2020 2020 2020 2020  oncat(..        
-0000f4c0: 2020 2020 2020 2020 2020 2020 5b73 656c              [sel
-0000f4d0: 662e 6675 7475 7265 5f72 6567 7265 7373  f.future_regress
-0000f4e0: 6f72 5f74 7261 696e 2c20 7365 6c66 2e66  or_train, self.f
-0000f4f0: 6c61 675f 7265 6772 6573 736f 725f 7472  lag_regressor_tr
-0000f500: 6169 6e5d 2c20 6178 6973 3d31 0d0a 2020  ain], axis=1..  
-0000f510: 2020 2020 2020 2020 2020 2020 2020 292e                ).
-0000f520: 7265 696e 6465 7828 696e 6465 783d 6466  reindex(index=df
-0000f530: 5f74 7261 696e 2e69 6e64 6578 290d 0a20  _train.index).. 
-0000f540: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000f550: 6f6d 705f 7265 6772 203d 2070 642e 636f  omp_regr = pd.co
-0000f560: 6e63 6174 285b 6675 6c6c 5f72 6567 722c  ncat([full_regr,
-0000f570: 2061 6c6c 5f66 6c61 6773 5d2c 2061 7869   all_flags], axi
-0000f580: 733d 3129 2e74 6169 6c28 0d0a 2020 2020  s=1).tail(..    
-0000f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5a0: 666f 7265 6361 7374 5f6c 656e 6774 680d  forecast_length.
-0000f5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f5c0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-0000f5d0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0000f5e0: 2020 2020 2020 2063 6f6d 705f 7265 6772         comp_regr
-0000f5f0: 5f74 7261 696e 203d 204e 6f6e 650d 0a20  _train = None.. 
-0000f600: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000f610: 6f6d 705f 7265 6772 203d 204e 6f6e 650d  omp_regr = None.
-0000f620: 0a0d 0a20 2020 2020 2020 2020 2020 2074  ...            t
-0000f630: 7265 6e64 5f66 6f72 6563 6173 7420 3d20  rend_forecast = 
-0000f640: 6d6f 6465 6c5f 666f 7265 6361 7374 280d  model_forecast(.
-0000f650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f660: 206d 6f64 656c 5f6e 616d 653d 7365 6c66   model_name=self
-0000f670: 2e74 7265 6e64 5f6d 6f64 656c 5b27 4d6f  .trend_model['Mo
-0000f680: 6465 6c27 5d2c 0d0a 2020 2020 2020 2020  del'],..        
-0000f690: 2020 2020 2020 2020 6d6f 6465 6c5f 7061          model_pa
-0000f6a0: 7261 6d5f 6469 6374 3d73 656c 662e 7472  ram_dict=self.tr
-0000f6b0: 656e 645f 6d6f 6465 6c5b 274d 6f64 656c  end_model['Model
-0000f6c0: 5061 7261 6d65 7465 7273 275d 2c0d 0a20  Parameters'],.. 
-0000f6d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000f6e0: 6f64 656c 5f74 7261 6e73 666f 726d 5f64  odel_transform_d
-0000f6f0: 6963 743d 7365 6c66 2e74 7265 6e64 5f74  ict=self.trend_t
-0000f700: 7261 6e73 666f 726d 6174 696f 6e2c 0d0a  ransformation,..
-0000f710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f720: 6466 5f74 7261 696e 3d64 665f 7472 6169  df_train=df_trai
-0000f730: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-0000f740: 2020 2020 666f 7265 6361 7374 5f6c 656e      forecast_len
-0000f750: 6774 683d 666f 7265 6361 7374 5f6c 656e  gth=forecast_len
-0000f760: 6774 682c 0d0a 2020 2020 2020 2020 2020  gth,..          
-0000f770: 2020 2020 2020 6672 6571 7565 6e63 793d        frequency=
-0000f780: 7365 6c66 2e66 7265 7175 656e 6379 2c0d  self.frequency,.
-0000f790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f7a0: 2070 7265 6469 6374 696f 6e5f 696e 7465   prediction_inte
-0000f7b0: 7276 616c 3d73 656c 662e 7072 6564 6963  rval=self.predic
-0000f7c0: 7469 6f6e 5f69 6e74 6572 7661 6c2c 0d0a  tion_interval,..
-0000f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f7e0: 2320 6e6f 5f6e 6567 6174 6976 6573 3d6e  # no_negatives=n
-0000f7f0: 6f5f 6e65 6761 7469 7665 732c 0d0a 2020  o_negatives,..  
-0000f800: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000f810: 636f 6e73 7472 6169 6e74 3d63 6f6e 7374  constraint=const
-0000f820: 7261 696e 742c 0d0a 2020 2020 2020 2020  raint,..        
-0000f830: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
-0000f840: 6567 7265 7373 6f72 5f74 7261 696e 3d63  egressor_train=c
-0000f850: 6f6d 705f 7265 6772 5f74 7261 696e 2c0d  omp_regr_train,.
-0000f860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f870: 2066 7574 7572 655f 7265 6772 6573 736f   future_regresso
-0000f880: 725f 666f 7265 6361 7374 3d63 6f6d 705f  r_forecast=comp_
-0000f890: 7265 6772 2c0d 0a20 2020 2020 2020 2020  regr,..         
-0000f8a0: 2020 2020 2020 2023 2068 6f6c 6964 6179         # holiday
-0000f8b0: 5f63 6f75 6e74 7279 3d68 6f6c 6964 6179  _country=holiday
-0000f8c0: 5f63 6f75 6e74 7279 2c0d 0a20 2020 2020  _country,..     
-0000f8d0: 2020 2020 2020 2020 2020 2066 6169 6c5f             fail_
-0000f8e0: 6f6e 5f66 6f72 6563 6173 745f 6e61 6e3d  on_forecast_nan=
-0000f8f0: 5472 7565 2c0d 0a20 2020 2020 2020 2020  True,..         
-0000f900: 2020 2020 2020 2072 616e 646f 6d5f 7365         random_se
-0000f910: 6564 3d73 656c 662e 7261 6e64 6f6d 5f73  ed=self.random_s
-0000f920: 6565 642c 0d0a 2020 2020 2020 2020 2020  eed,..          
-0000f930: 2020 2020 2020 7665 7262 6f73 653d 7365        verbose=se
-0000f940: 6c66 2e76 6572 626f 7365 2c0d 0a20 2020  lf.verbose,..   
-0000f950: 2020 2020 2020 2020 2020 2020 206e 5f6a               n_j
-0000f960: 6f62 733d 7365 6c66 2e6e 5f6a 6f62 732c  obs=self.n_jobs,
-0000f970: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-0000f980: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-0000f990: 6869 2069 7320 6f6e 2066 7574 7572 6520  hi is on future 
-0000f9a0: 7072 6564 6963 7420 7374 6570 206f 6e6c  predict step onl
-0000f9b0: 790d 0a20 2020 2020 2020 2020 2020 2069  y..            i
-0000f9c0: 6620 7365 6c66 2e74 7265 6e64 5f70 6869  f self.trend_phi
-0000f9d0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0000f9e0: 2073 656c 662e 7472 656e 645f 7068 6920   self.trend_phi 
-0000f9f0: 213d 2031 3a0d 0a20 2020 2020 2020 2020  != 1:..         
-0000fa00: 2020 2020 2020 2074 656d 7020 3d20 7472         temp = tr
-0000fa10: 656e 645f 666f 7265 6361 7374 2e66 6f72  end_forecast.for
-0000fa20: 6563 6173 742e 6d75 6c28 0d0a 2020 2020  ecast.mul(..    
-0000fa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa40: 7064 2e53 6572 6965 7328 0d0a 2020 2020  pd.Series(..    
-0000fa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa60: 2020 2020 5b73 656c 662e 7472 656e 645f      [self.trend_
-0000fa70: 7068 695d 202a 2074 7265 6e64 5f66 6f72  phi] * trend_for
-0000fa80: 6563 6173 742e 666f 7265 6361 7374 2e73  ecast.forecast.s
-0000fa90: 6861 7065 5b30 5d2c 0d0a 2020 2020 2020  hape[0],..      
-0000faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fab0: 2020 696e 6465 783d 7472 656e 645f 666f    index=trend_fo
-0000fac0: 7265 6361 7374 2e66 6f72 6563 6173 742e  recast.forecast.
-0000fad0: 696e 6465 782c 0d0a 2020 2020 2020 2020  index,..        
-0000fae0: 2020 2020 2020 2020 2020 2020 292e 706f              ).po
-0000faf0: 7728 7261 6e67 6528 7472 656e 645f 666f  w(range(trend_fo
-0000fb00: 7265 6361 7374 2e66 6f72 6563 6173 742e  recast.forecast.
-0000fb10: 7368 6170 655b 305d 2929 2c0d 0a20 2020  shape[0])),..   
-0000fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb30: 2061 7869 733d 302c 0d0a 2020 2020 2020   axis=0,..      
-0000fb40: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-0000fb50: 2020 2020 2020 2020 2020 2020 2023 206f               # o
-0000fb60: 7665 7277 7269 7465 2062 6f75 6e64 7320  verwrite bounds 
-0000fb70: 6966 2075 7369 6e67 2070 6869 0d0a 2020  if using phi..  
-0000fb80: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0000fb90: 656e 645f 666f 7265 6361 7374 2e66 6f72  end_forecast.for
-0000fba0: 6563 6173 7420 3d20 7472 656e 645f 666f  ecast = trend_fo
-0000fbb0: 7265 6361 7374 2e66 6f72 6563 6173 7420  recast.forecast 
-0000fbc0: 2b20 7465 6d70 0d0a 2020 2020 2020 2020  + temp..        
-0000fbd0: 2020 2020 2020 2020 7472 656e 645f 666f          trend_fo
-0000fbe0: 7265 6361 7374 2e75 7070 6572 5f66 6f72  recast.upper_for
-0000fbf0: 6563 6173 7420 3d20 7472 656e 645f 666f  ecast = trend_fo
-0000fc00: 7265 6361 7374 2e66 6f72 6563 6173 740d  recast.forecast.
-0000fc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fc20: 2074 7265 6e64 5f66 6f72 6563 6173 742e   trend_forecast.
-0000fc30: 6c6f 7765 725f 666f 7265 6361 7374 203d  lower_forecast =
-0000fc40: 2074 7265 6e64 5f66 6f72 6563 6173 742e   trend_forecast.
-0000fc50: 666f 7265 6361 7374 0d0a 2020 2020 2020  forecast..      
-0000fc60: 2020 2020 2020 6966 2069 6e63 6c75 6465        if include
-0000fc70: 5f68 6973 746f 7279 3a0d 0a20 2020 2020  _history:..     
-0000fc80: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
-0000fc90: 5f66 6f72 6563 6173 742e 666f 7265 6361  _forecast.foreca
-0000fca0: 7374 203d 2070 642e 636f 6e63 6174 280d  st = pd.concat(.
-0000fcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fcc0: 2020 2020 205b 0d0a 2020 2020 2020 2020       [..        
+0000f000: 2020 2020 7265 7369 642c 206e 702e 6172      resid, np.ar
+0000f010: 7261 7928 7365 6c66 2e63 7265 6174 655f  ray(self.create_
+0000f020: 7428 6466 2e69 6e64 6578 2929 0d0a 2020  t(df.index))..  
+0000f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f040: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+0000f050: 2020 2020 2020 2020 2072 6573 6964 203d           resid =
+0000f060: 2070 642e 4461 7461 4672 616d 6528 7265   pd.DataFrame(re
+0000f070: 7369 642c 2069 6e64 6578 3d64 662e 696e  sid, index=df.in
+0000f080: 6465 782c 2063 6f6c 756d 6e73 3d64 662e  dex, columns=df.
+0000f090: 636f 6c75 6d6e 7329 0d0a 2020 2020 2020  columns)..      
+0000f0a0: 2020 2020 2020 6466 5f74 7261 696e 203d        df_train =
+0000f0b0: 2073 656c 662e 7472 656e 645f 7472 6169   self.trend_trai
+0000f0c0: 6e20 6966 2072 6573 6964 2069 7320 4e6f  n if resid is No
+0000f0d0: 6e65 2065 6c73 6520 7265 7369 640d 0a20  ne else resid.. 
+0000f0e0: 2020 2020 2020 2020 2020 2023 2063 6f6d             # com
+0000f0f0: 6269 6e65 2072 6567 7265 7373 6f72 2074  bine regressor t
+0000f100: 7970 6573 2064 6570 656e 6469 6e67 206f  ypes depending o
+0000f110: 6e20 7768 6174 2069 7320 6769 7665 6e0d  n what is given.
+0000f120: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000f130: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000f140: 2020 2073 656c 662e 6675 7475 7265 5f72     self.future_r
+0000f150: 6567 7265 7373 6f72 5f74 7261 696e 2069  egressor_train i
+0000f160: 7320 4e6f 6e65 0d0a 2020 2020 2020 2020  s None..        
+0000f170: 2020 2020 2020 2020 616e 6420 7365 6c66          and self
+0000f180: 2e66 6c61 675f 7265 6772 6573 736f 725f  .flag_regressor_
+0000f190: 7472 6169 6e20 6973 206e 6f74 204e 6f6e  train is not Non
+0000f1a0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0000f1b0: 2020 2061 6e64 2073 656c 662e 7265 6772     and self.regr
+0000f1c0: 6573 736f 7273 5f75 7365 640d 0a20 2020  essors_used..   
+0000f1d0: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
+0000f1e0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+0000f1f0: 705f 7265 6772 5f74 7261 696e 203d 2073  p_regr_train = s
+0000f200: 656c 662e 666c 6167 5f72 6567 7265 7373  elf.flag_regress
+0000f210: 6f72 5f74 7261 696e 2e72 6569 6e64 6578  or_train.reindex
+0000f220: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000f230: 2020 2020 2020 2069 6e64 6578 3d64 665f         index=df_
+0000f240: 7472 6169 6e2e 696e 6465 780d 0a20 2020  train.index..   
+0000f250: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f270: 636f 6d70 5f72 6567 7220 3d20 616c 6c5f  comp_regr = all_
+0000f280: 666c 6167 732e 7461 696c 2866 6f72 6563  flags.tail(forec
+0000f290: 6173 745f 6c65 6e67 7468 290d 0a20 2020  ast_length)..   
+0000f2a0: 2020 2020 2020 2020 2065 6c69 6620 280d           elif (.
+0000f2b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f2c0: 2073 656c 662e 6675 7475 7265 5f72 6567   self.future_reg
+0000f2d0: 7265 7373 6f72 5f74 7261 696e 2069 7320  ressor_train is 
+0000f2e0: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
+0000f2f0: 2020 2020 2020 2020 2020 616e 6420 7365            and se
+0000f300: 6c66 2e66 6c61 675f 7265 6772 6573 736f  lf.flag_regresso
+0000f310: 725f 7472 6169 6e20 6973 204e 6f6e 650d  r_train is None.
+0000f320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f330: 2061 6e64 2073 656c 662e 7265 6772 6573   and self.regres
+0000f340: 736f 7273 5f75 7365 640d 0a20 2020 2020  sors_used..     
+0000f350: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
+0000f360: 2020 2020 2020 2020 2020 2063 6f6d 705f             comp_
+0000f370: 7265 6772 5f74 7261 696e 203d 2073 656c  regr_train = sel
+0000f380: 662e 6675 7475 7265 5f72 6567 7265 7373  f.future_regress
+0000f390: 6f72 5f74 7261 696e 2e72 6569 6e64 6578  or_train.reindex
+0000f3a0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+0000f3b0: 2020 2020 2020 2069 6e64 6578 3d64 665f         index=df_
+0000f3c0: 7472 6169 6e2e 696e 6465 780d 0a20 2020  train.index..   
+0000f3d0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3f0: 636f 6d70 5f72 6567 7220 3d20 6675 6c6c  comp_regr = full
+0000f400: 5f72 6567 722e 7461 696c 2866 6f72 6563  _regr.tail(forec
+0000f410: 6173 745f 6c65 6e67 7468 290d 0a20 2020  ast_length)..   
+0000f420: 2020 2020 2020 2020 2065 6c69 6620 280d           elif (.
+0000f430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f440: 2073 656c 662e 6675 7475 7265 5f72 6567   self.future_reg
+0000f450: 7265 7373 6f72 5f74 7261 696e 2069 7320  ressor_train is 
+0000f460: 6e6f 7420 4e6f 6e65 0d0a 2020 2020 2020  not None..      
+0000f470: 2020 2020 2020 2020 2020 616e 6420 7365            and se
+0000f480: 6c66 2e66 6c61 675f 7265 6772 6573 736f  lf.flag_regresso
+0000f490: 725f 7472 6169 6e20 6973 206e 6f74 204e  r_train is not N
+0000f4a0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+0000f4b0: 2020 2020 2061 6e64 2073 656c 662e 7265       and self.re
+0000f4c0: 6772 6573 736f 7273 5f75 7365 640d 0a20  gressors_used.. 
+0000f4d0: 2020 2020 2020 2020 2020 2029 3a0d 0a20             ):.. 
+0000f4e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000f4f0: 6f6d 705f 7265 6772 5f74 7261 696e 203d  omp_regr_train =
+0000f500: 2070 642e 636f 6e63 6174 280d 0a20 2020   pd.concat(..   
+0000f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f520: 205b 7365 6c66 2e66 7574 7572 655f 7265   [self.future_re
+0000f530: 6772 6573 736f 725f 7472 6169 6e2c 2073  gressor_train, s
+0000f540: 656c 662e 666c 6167 5f72 6567 7265 7373  elf.flag_regress
+0000f550: 6f72 5f74 7261 696e 5d2c 2061 7869 733d  or_train], axis=
+0000f560: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+0000f570: 2020 2029 2e72 6569 6e64 6578 2869 6e64     ).reindex(ind
+0000f580: 6578 3d64 665f 7472 6169 6e2e 696e 6465  ex=df_train.inde
+0000f590: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
+0000f5a0: 2020 2020 636f 6d70 5f72 6567 7220 3d20      comp_regr = 
+0000f5b0: 7064 2e63 6f6e 6361 7428 5b66 756c 6c5f  pd.concat([full_
+0000f5c0: 7265 6772 2c20 616c 6c5f 666c 6167 735d  regr, all_flags]
+0000f5d0: 2c20 6178 6973 3d31 292e 7461 696c 280d  , axis=1).tail(.
+0000f5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f5f0: 2020 2020 2066 6f72 6563 6173 745f 6c65       forecast_le
+0000f600: 6e67 7468 0d0a 2020 2020 2020 2020 2020  ngth..          
+0000f610: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+0000f620: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0000f630: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+0000f640: 5f72 6567 725f 7472 6169 6e20 3d20 4e6f  _regr_train = No
+0000f650: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+0000f660: 2020 2020 636f 6d70 5f72 6567 7220 3d20      comp_regr = 
+0000f670: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
+0000f680: 2020 2020 7472 656e 645f 666f 7265 6361      trend_foreca
+0000f690: 7374 203d 206d 6f64 656c 5f66 6f72 6563  st = model_forec
+0000f6a0: 6173 7428 0d0a 2020 2020 2020 2020 2020  ast(..          
+0000f6b0: 2020 2020 2020 6d6f 6465 6c5f 6e61 6d65        model_name
+0000f6c0: 3d73 656c 662e 7472 656e 645f 6d6f 6465  =self.trend_mode
+0000f6d0: 6c5b 274d 6f64 656c 275d 2c0d 0a20 2020  l['Model'],..   
+0000f6e0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0000f6f0: 656c 5f70 6172 616d 5f64 6963 743d 7365  el_param_dict=se
+0000f700: 6c66 2e74 7265 6e64 5f6d 6f64 656c 5b27  lf.trend_model['
+0000f710: 4d6f 6465 6c50 6172 616d 6574 6572 7327  ModelParameters'
+0000f720: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+0000f730: 2020 2020 6d6f 6465 6c5f 7472 616e 7366      model_transf
+0000f740: 6f72 6d5f 6469 6374 3d73 656c 662e 7472  orm_dict=self.tr
+0000f750: 656e 645f 7472 616e 7366 6f72 6d61 7469  end_transformati
+0000f760: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+0000f770: 2020 2020 2064 665f 7472 6169 6e3d 6466       df_train=df
+0000f780: 5f74 7261 696e 2c0d 0a20 2020 2020 2020  _train,..       
+0000f790: 2020 2020 2020 2020 2066 6f72 6563 6173           forecas
+0000f7a0: 745f 6c65 6e67 7468 3d66 6f72 6563 6173  t_length=forecas
+0000f7b0: 745f 6c65 6e67 7468 2c0d 0a20 2020 2020  t_length,..     
+0000f7c0: 2020 2020 2020 2020 2020 2066 7265 7175             frequ
+0000f7d0: 656e 6379 3d73 656c 662e 6672 6571 7565  ency=self.freque
+0000f7e0: 6e63 792c 0d0a 2020 2020 2020 2020 2020  ncy,..          
+0000f7f0: 2020 2020 2020 7072 6564 6963 7469 6f6e        prediction
+0000f800: 5f69 6e74 6572 7661 6c3d 7365 6c66 2e70  _interval=self.p
+0000f810: 7265 6469 6374 696f 6e5f 696e 7465 7276  rediction_interv
+0000f820: 616c 2c0d 0a20 2020 2020 2020 2020 2020  al,..           
+0000f830: 2020 2020 2023 206e 6f5f 6e65 6761 7469       # no_negati
+0000f840: 7665 733d 6e6f 5f6e 6567 6174 6976 6573  ves=no_negatives
+0000f850: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+0000f860: 2020 2023 2063 6f6e 7374 7261 696e 743d     # constraint=
+0000f870: 636f 6e73 7472 6169 6e74 2c0d 0a20 2020  constraint,..   
+0000f880: 2020 2020 2020 2020 2020 2020 2066 7574               fut
+0000f890: 7572 655f 7265 6772 6573 736f 725f 7472  ure_regressor_tr
+0000f8a0: 6169 6e3d 636f 6d70 5f72 6567 725f 7472  ain=comp_regr_tr
+0000f8b0: 6169 6e2c 0d0a 2020 2020 2020 2020 2020  ain,..          
+0000f8c0: 2020 2020 2020 6675 7475 7265 5f72 6567        future_reg
+0000f8d0: 7265 7373 6f72 5f66 6f72 6563 6173 743d  ressor_forecast=
+0000f8e0: 636f 6d70 5f72 6567 722c 0d0a 2020 2020  comp_regr,..    
+0000f8f0: 2020 2020 2020 2020 2020 2020 2320 686f              # ho
+0000f900: 6c69 6461 795f 636f 756e 7472 793d 686f  liday_country=ho
+0000f910: 6c69 6461 795f 636f 756e 7472 792c 0d0a  liday_country,..
+0000f920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f930: 6661 696c 5f6f 6e5f 666f 7265 6361 7374  fail_on_forecast
+0000f940: 5f6e 616e 3d54 7275 652c 0d0a 2020 2020  _nan=True,..    
+0000f950: 2020 2020 2020 2020 2020 2020 7261 6e64              rand
+0000f960: 6f6d 5f73 6565 643d 7365 6c66 2e72 616e  om_seed=self.ran
+0000f970: 646f 6d5f 7365 6564 2c0d 0a20 2020 2020  dom_seed,..     
+0000f980: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
+0000f990: 7365 3d73 656c 662e 7665 7262 6f73 652c  se=self.verbose,
+0000f9a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000f9b0: 2020 6e5f 6a6f 6273 3d73 656c 662e 6e5f    n_jobs=self.n_
+0000f9c0: 6a6f 6273 2c0d 0a20 2020 2020 2020 2020  jobs,..         
+0000f9d0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+0000f9e0: 2020 2320 7068 6920 6973 206f 6e20 6675    # phi is on fu
+0000f9f0: 7475 7265 2070 7265 6469 6374 2073 7465  ture predict ste
+0000fa00: 7020 6f6e 6c79 0d0a 2020 2020 2020 2020  p only..        
+0000fa10: 2020 2020 6966 2073 656c 662e 7472 656e      if self.tren
+0000fa20: 645f 7068 6920 6973 206e 6f74 204e 6f6e  d_phi is not Non
+0000fa30: 6520 616e 6420 7365 6c66 2e74 7265 6e64  e and self.trend
+0000fa40: 5f70 6869 2021 3d20 313a 0d0a 2020 2020  _phi != 1:..    
+0000fa50: 2020 2020 2020 2020 2020 2020 7465 6d70              temp
+0000fa60: 203d 2074 7265 6e64 5f66 6f72 6563 6173   = trend_forecas
+0000fa70: 742e 666f 7265 6361 7374 2e6d 756c 280d  t.forecast.mul(.
+0000fa80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fa90: 2020 2020 2070 642e 5365 7269 6573 280d       pd.Series(.
+0000faa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fab0: 2020 2020 2020 2020 205b 7365 6c66 2e74           [self.t
+0000fac0: 7265 6e64 5f70 6869 5d20 2a20 7472 656e  rend_phi] * tren
+0000fad0: 645f 666f 7265 6361 7374 2e66 6f72 6563  d_forecast.forec
+0000fae0: 6173 742e 7368 6170 655b 305d 2c0d 0a20  ast.shape[0],.. 
+0000faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb00: 2020 2020 2020 2069 6e64 6578 3d74 7265         index=tre
+0000fb10: 6e64 5f66 6f72 6563 6173 742e 666f 7265  nd_forecast.fore
+0000fb20: 6361 7374 2e69 6e64 6578 2c0d 0a20 2020  cast.index,..   
+0000fb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fb40: 2029 2e70 6f77 2872 616e 6765 2874 7265   ).pow(range(tre
+0000fb50: 6e64 5f66 6f72 6563 6173 742e 666f 7265  nd_forecast.fore
+0000fb60: 6361 7374 2e73 6861 7065 5b30 5d29 292c  cast.shape[0])),
+0000fb70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000fb80: 2020 2020 2020 6178 6973 3d30 2c0d 0a20        axis=0,.. 
+0000fb90: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000fba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000fbb0: 2020 2320 6f76 6572 7772 6974 6520 626f    # overwrite bo
+0000fbc0: 756e 6473 2069 6620 7573 696e 6720 7068  unds if using ph
+0000fbd0: 690d 0a20 2020 2020 2020 2020 2020 2020  i..             
+0000fbe0: 2020 2074 7265 6e64 5f66 6f72 6563 6173     trend_forecas
+0000fbf0: 742e 666f 7265 6361 7374 203d 2074 7265  t.forecast = tre
+0000fc00: 6e64 5f66 6f72 6563 6173 742e 666f 7265  nd_forecast.fore
+0000fc10: 6361 7374 202b 2074 656d 700d 0a20 2020  cast + temp..   
+0000fc20: 2020 2020 2020 2020 2020 2020 2074 7265               tre
+0000fc30: 6e64 5f66 6f72 6563 6173 742e 7570 7065  nd_forecast.uppe
+0000fc40: 725f 666f 7265 6361 7374 203d 2074 7265  r_forecast = tre
+0000fc50: 6e64 5f66 6f72 6563 6173 742e 666f 7265  nd_forecast.fore
+0000fc60: 6361 7374 0d0a 2020 2020 2020 2020 2020  cast..          
+0000fc70: 2020 2020 2020 7472 656e 645f 666f 7265        trend_fore
+0000fc80: 6361 7374 2e6c 6f77 6572 5f66 6f72 6563  cast.lower_forec
+0000fc90: 6173 7420 3d20 7472 656e 645f 666f 7265  ast = trend_fore
+0000fca0: 6361 7374 2e66 6f72 6563 6173 740d 0a20  cast.forecast.. 
+0000fcb0: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+0000fcc0: 636c 7564 655f 6869 7374 6f72 793a 0d0a  clude_history:..
 0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fce0: 7365 6c66 2e74 7265 6e64 5f74 7261 696e  self.trend_train
-0000fcf0: 2069 6620 7265 7369 6420 6973 204e 6f6e   if resid is Non
-0000fd00: 6520 656c 7365 2072 6573 6964 2c0d 0a20  e else resid,.. 
-0000fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fd20: 2020 2020 2020 2074 7265 6e64 5f66 6f72         trend_for
-0000fd30: 6563 6173 742e 666f 7265 6361 7374 2c0d  ecast.forecast,.
-0000fd40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fd50: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
-0000fd60: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-0000fd70: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
-0000fd80: 5f66 6f72 6563 6173 742e 6c6f 7765 725f  _forecast.lower_
-0000fd90: 666f 7265 6361 7374 203d 2070 642e 636f  forecast = pd.co
-0000fda0: 6e63 6174 280d 0a20 2020 2020 2020 2020  ncat(..         
-0000fdb0: 2020 2020 2020 2020 2020 205b 0d0a 2020             [..  
+0000fce0: 7472 656e 645f 666f 7265 6361 7374 2e66  trend_forecast.f
+0000fcf0: 6f72 6563 6173 7420 3d20 7064 2e63 6f6e  orecast = pd.con
+0000fd00: 6361 7428 0d0a 2020 2020 2020 2020 2020  cat(..          
+0000fd10: 2020 2020 2020 2020 2020 5b0d 0a20 2020            [..   
+0000fd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd30: 2020 2020 2073 656c 662e 7472 656e 645f       self.trend_
+0000fd40: 7472 6169 6e20 6966 2072 6573 6964 2069  train if resid i
+0000fd50: 7320 4e6f 6e65 2065 6c73 6520 7265 7369  s None else resi
+0000fd60: 642c 0d0a 2020 2020 2020 2020 2020 2020  d,..            
+0000fd70: 2020 2020 2020 2020 2020 2020 7472 656e              tren
+0000fd80: 645f 666f 7265 6361 7374 2e66 6f72 6563  d_forecast.forec
+0000fd90: 6173 742c 0d0a 2020 2020 2020 2020 2020  ast,..          
+0000fda0: 2020 2020 2020 2020 2020 5d0d 0a20 2020            ]..   
+0000fdb0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
 0000fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fdd0: 2020 2020 2020 7365 6c66 2e74 7265 6e64        self.trend
-0000fde0: 5f74 7261 696e 2069 6620 7265 7369 6420  _train if resid 
-0000fdf0: 6973 204e 6f6e 6520 656c 7365 2072 6573  is None else res
-0000fe00: 6964 2c0d 0a20 2020 2020 2020 2020 2020  id,..           
-0000fe10: 2020 2020 2020 2020 2020 2020 2074 7265               tre
-0000fe20: 6e64 5f66 6f72 6563 6173 742e 6c6f 7765  nd_forecast.lowe
-0000fe30: 725f 666f 7265 6361 7374 2c0d 0a20 2020  r_forecast,..   
-0000fe40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe50: 205d 0d0a 2020 2020 2020 2020 2020 2020   ]..            
-0000fe60: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-0000fe70: 2020 2020 2020 2074 7265 6e64 5f66 6f72         trend_for
-0000fe80: 6563 6173 742e 7570 7065 725f 666f 7265  ecast.upper_fore
-0000fe90: 6361 7374 203d 2070 642e 636f 6e63 6174  cast = pd.concat
-0000fea0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-0000feb0: 2020 2020 2020 205b 0d0a 2020 2020 2020         [..      
-0000fec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fed0: 2020 7365 6c66 2e74 7265 6e64 5f74 7261    self.trend_tra
-0000fee0: 696e 2069 6620 7265 7369 6420 6973 204e  in if resid is N
-0000fef0: 6f6e 6520 656c 7365 2072 6573 6964 2c0d  one else resid,.
-0000ff00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ff10: 2020 2020 2020 2020 2074 7265 6e64 5f66           trend_f
-0000ff20: 6f72 6563 6173 742e 7570 7065 725f 666f  orecast.upper_fo
-0000ff30: 7265 6361 7374 2c0d 0a20 2020 2020 2020  recast,..       
-0000ff40: 2020 2020 2020 2020 2020 2020 205d 0d0a               ]..
-0000ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff60: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-0000ff70: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-0000ff80: 656e 645f 666f 7265 6361 7374 203d 2050  end_forecast = P
-0000ff90: 7265 6469 6374 696f 6e4f 626a 6563 7428  redictionObject(
-0000ffa0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ffb0: 2020 666f 7265 6361 7374 3d73 656c 662e    forecast=self.
-0000ffc0: 7472 656e 645f 7472 6169 6e2c 0d0a 2020  trend_train,..  
-0000ffd0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0000ffe0: 7765 725f 666f 7265 6361 7374 3d73 656c  wer_forecast=sel
-0000fff0: 662e 7472 656e 645f 7472 6169 6e2c 0d0a  f.trend_train,..
-00010000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010010: 7570 7065 725f 666f 7265 6361 7374 3d73  upper_forecast=s
-00010020: 656c 662e 7472 656e 645f 7472 6169 6e2c  elf.trend_train,
-00010030: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-00010040: 0a0d 0a20 2020 2020 2020 2023 2061 725f  ...        # ar_
-00010050: 6c61 6773 2c20 6d75 6c74 6976 6172 6961  lags, multivaria
-00010060: 7465 2066 6561 7475 7265 7320 7265 7175  te features requ
-00010070: 6972 6520 3120 7374 6570 206c 6f6f 700d  ire 1 step loop.
-00010080: 0a20 2020 2020 2020 2069 6620 666f 7265  .        if fore
-00010090: 6361 7374 5f6c 656e 6774 6820 6973 204e  cast_length is N
-000100a0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-000100b0: 2020 6466 5f66 6f72 6563 6173 7420 3d20    df_forecast = 
-000100c0: 7365 6c66 2e5f 7072 6564 6963 745f 7374  self._predict_st
-000100d0: 6570 280d 0a20 2020 2020 2020 2020 2020  ep(..           
-000100e0: 2020 2020 2064 6174 6573 3d64 662e 696e       dates=df.in
-000100f0: 6465 782c 0d0a 2020 2020 2020 2020 2020  dex,..          
-00010100: 2020 2020 2020 7472 656e 645f 636f 6d70        trend_comp
-00010110: 6f6e 656e 743d 7472 656e 645f 666f 7265  onent=trend_fore
-00010120: 6361 7374 2c0d 0a20 2020 2020 2020 2020  cast,..         
-00010130: 2020 2020 2020 2068 6973 746f 7279 5f64         history_d
-00010140: 663d 6466 2c0d 0a20 2020 2020 2020 2020  f=df,..         
-00010150: 2020 2020 2020 2066 7574 7572 655f 7265         future_re
-00010160: 6772 6573 736f 723d 6675 6c6c 5f72 6567  gressor=full_reg
-00010170: 722c 0d0a 2020 2020 2020 2020 2020 2020  r,..            
-00010180: 2020 2020 666c 6167 5f72 6567 7265 7373      flag_regress
-00010190: 6f72 733d 616c 6c5f 666c 6167 732c 0d0a  ors=all_flags,..
-000101a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000101b0: 696d 7061 6374 733d 696d 7061 6374 732c  impacts=impacts,
-000101c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000101d0: 2020 7265 6772 6573 736f 725f 7065 725f    regressor_per_
-000101e0: 7365 7269 6573 3d72 6567 725f 7073 5f66  series=regr_ps_f
-000101f0: 6f72 652c 0d0a 2020 2020 2020 2020 2020  ore,..          
-00010200: 2020 290d 0a20 2020 2020 2020 2065 6c69    )..        eli
-00010210: 6620 7365 6c66 2e70 7265 6469 6374 5f6c  f self.predict_l
-00010220: 6f6f 705f 7265 713a 0d0a 2020 2020 2020  oop_req:..      
-00010230: 2020 2020 2020 666f 7220 7374 6570 2069        for step i
-00010240: 6e20 7261 6e67 6528 666f 7265 6361 7374  n range(forecast
-00010250: 5f6c 656e 6774 6829 3a0d 0a20 2020 2020  _length):..     
-00010260: 2020 2020 2020 2020 2020 2066 6f72 6563             forec
-00010270: 6173 745f 696e 6465 7820 3d20 6466 2e69  ast_index = df.i
-00010280: 6e64 6578 2e75 6e69 6f6e 280d 0a20 2020  ndex.union(..   
-00010290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102a0: 2073 656c 662e 6372 6561 7465 5f66 6f72   self.create_for
-000102b0: 6563 6173 745f 696e 6465 7828 312c 206c  ecast_index(1, l
-000102c0: 6173 745f 6461 7465 3d64 662e 696e 6465  ast_date=df.inde
-000102d0: 785b 2d31 5d29 0d0a 2020 2020 2020 2020  x[-1])..        
-000102e0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-000102f0: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
-00010300: 7265 6361 7374 203d 2073 656c 662e 5f70  recast = self._p
-00010310: 7265 6469 6374 5f73 7465 7028 0d0a 2020  redict_step(..  
-00010320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010330: 2020 6461 7465 733d 666f 7265 6361 7374    dates=forecast
-00010340: 5f69 6e64 6578 2c0d 0a20 2020 2020 2020  _index,..       
-00010350: 2020 2020 2020 2020 2020 2020 2074 7265               tre
-00010360: 6e64 5f63 6f6d 706f 6e65 6e74 3d74 7265  nd_component=tre
-00010370: 6e64 5f66 6f72 6563 6173 742c 0d0a 2020  nd_forecast,..  
-00010380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010390: 2020 6869 7374 6f72 795f 6466 3d64 662c    history_df=df,
-000103a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000103b0: 2020 2020 2020 6675 7475 7265 5f72 6567        future_reg
-000103c0: 7265 7373 6f72 3d66 756c 6c5f 7265 6772  ressor=full_regr
+0000fdd0: 7472 656e 645f 666f 7265 6361 7374 2e6c  trend_forecast.l
+0000fde0: 6f77 6572 5f66 6f72 6563 6173 7420 3d20  ower_forecast = 
+0000fdf0: 7064 2e63 6f6e 6361 7428 0d0a 2020 2020  pd.concat(..    
+0000fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe10: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
+0000fe20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000fe30: 7472 656e 645f 7472 6169 6e20 6966 2072  trend_train if r
+0000fe40: 6573 6964 2069 7320 4e6f 6e65 2065 6c73  esid is None els
+0000fe50: 6520 7265 7369 642c 0d0a 2020 2020 2020  e resid,..      
+0000fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fe70: 2020 7472 656e 645f 666f 7265 6361 7374    trend_forecast
+0000fe80: 2e6c 6f77 6572 5f66 6f72 6563 6173 742c  .lower_forecast,
+0000fe90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000fea0: 2020 2020 2020 5d0d 0a20 2020 2020 2020        ]..       
+0000feb0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+0000fec0: 2020 2020 2020 2020 2020 2020 7472 656e              tren
+0000fed0: 645f 666f 7265 6361 7374 2e75 7070 6572  d_forecast.upper
+0000fee0: 5f66 6f72 6563 6173 7420 3d20 7064 2e63  _forecast = pd.c
+0000fef0: 6f6e 6361 7428 0d0a 2020 2020 2020 2020  oncat(..        
+0000ff00: 2020 2020 2020 2020 2020 2020 5b0d 0a20              [.. 
+0000ff10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff20: 2020 2020 2020 2073 656c 662e 7472 656e         self.tren
+0000ff30: 645f 7472 6169 6e20 6966 2072 6573 6964  d_train if resid
+0000ff40: 2069 7320 4e6f 6e65 2065 6c73 6520 7265   is None else re
+0000ff50: 7369 642c 0d0a 2020 2020 2020 2020 2020  sid,..          
+0000ff60: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0000ff70: 656e 645f 666f 7265 6361 7374 2e75 7070  end_forecast.upp
+0000ff80: 6572 5f66 6f72 6563 6173 742c 0d0a 2020  er_forecast,..  
+0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffa0: 2020 5d0d 0a20 2020 2020 2020 2020 2020    ]..           
+0000ffb0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+0000ffc0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000ffd0: 2020 2074 7265 6e64 5f66 6f72 6563 6173     trend_forecas
+0000ffe0: 7420 3d20 5072 6564 6963 7469 6f6e 4f62  t = PredictionOb
+0000fff0: 6a65 6374 280d 0a20 2020 2020 2020 2020  ject(..         
+00010000: 2020 2020 2020 2066 6f72 6563 6173 743d         forecast=
+00010010: 7365 6c66 2e74 7265 6e64 5f74 7261 696e  self.trend_train
+00010020: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00010030: 2020 206c 6f77 6572 5f66 6f72 6563 6173     lower_forecas
+00010040: 743d 7365 6c66 2e74 7265 6e64 5f74 7261  t=self.trend_tra
+00010050: 696e 2c0d 0a20 2020 2020 2020 2020 2020  in,..           
+00010060: 2020 2020 2075 7070 6572 5f66 6f72 6563       upper_forec
+00010070: 6173 743d 7365 6c66 2e74 7265 6e64 5f74  ast=self.trend_t
+00010080: 7261 696e 2c0d 0a20 2020 2020 2020 2020  rain,..         
+00010090: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+000100a0: 2320 6172 5f6c 6167 732c 206d 756c 7469  # ar_lags, multi
+000100b0: 7661 7269 6174 6520 6665 6174 7572 6573  variate features
+000100c0: 2072 6571 7569 7265 2031 2073 7465 7020   require 1 step 
+000100d0: 6c6f 6f70 0d0a 2020 2020 2020 2020 6966  loop..        if
+000100e0: 2066 6f72 6563 6173 745f 6c65 6e67 7468   forecast_length
+000100f0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00010100: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
+00010110: 7374 203d 2073 656c 662e 5f70 7265 6469  st = self._predi
+00010120: 6374 5f73 7465 7028 0d0a 2020 2020 2020  ct_step(..      
+00010130: 2020 2020 2020 2020 2020 6461 7465 733d            dates=
+00010140: 6466 2e69 6e64 6578 2c0d 0a20 2020 2020  df.index,..     
+00010150: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
+00010160: 5f63 6f6d 706f 6e65 6e74 3d74 7265 6e64  _component=trend
+00010170: 5f66 6f72 6563 6173 742c 0d0a 2020 2020  _forecast,..    
+00010180: 2020 2020 2020 2020 2020 2020 6869 7374              hist
+00010190: 6f72 795f 6466 3d64 662c 0d0a 2020 2020  ory_df=df,..    
+000101a0: 2020 2020 2020 2020 2020 2020 6675 7475              futu
+000101b0: 7265 5f72 6567 7265 7373 6f72 3d66 756c  re_regressor=ful
+000101c0: 6c5f 7265 6772 2c0d 0a20 2020 2020 2020  l_regr,..       
+000101d0: 2020 2020 2020 2020 2066 6c61 675f 7265           flag_re
+000101e0: 6772 6573 736f 7273 3d61 6c6c 5f66 6c61  gressors=all_fla
+000101f0: 6773 2c0d 0a20 2020 2020 2020 2020 2020  gs,..           
+00010200: 2020 2020 2069 6d70 6163 7473 3d69 6d70       impacts=imp
+00010210: 6163 7473 2c0d 0a20 2020 2020 2020 2020  acts,..         
+00010220: 2020 2020 2020 2072 6567 7265 7373 6f72         regressor
+00010230: 5f70 6572 5f73 6572 6965 733d 7265 6772  _per_series=regr
+00010240: 5f70 735f 666f 7265 2c0d 0a20 2020 2020  _ps_fore,..     
+00010250: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+00010260: 2020 656c 6966 2073 656c 662e 7072 6564    elif self.pred
+00010270: 6963 745f 6c6f 6f70 5f72 6571 3a0d 0a20  ict_loop_req:.. 
+00010280: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00010290: 7465 7020 696e 2072 616e 6765 2866 6f72  tep in range(for
+000102a0: 6563 6173 745f 6c65 6e67 7468 293a 0d0a  ecast_length):..
+000102b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102c0: 666f 7265 6361 7374 5f69 6e64 6578 203d  forecast_index =
+000102d0: 2064 662e 696e 6465 782e 756e 696f 6e28   df.index.union(
+000102e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000102f0: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
+00010300: 655f 666f 7265 6361 7374 5f69 6e64 6578  e_forecast_index
+00010310: 2831 2c20 6c61 7374 5f64 6174 653d 6466  (1, last_date=df
+00010320: 2e69 6e64 6578 5b2d 315d 290d 0a20 2020  .index[-1])..   
+00010330: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00010340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010350: 6466 5f66 6f72 6563 6173 7420 3d20 7365  df_forecast = se
+00010360: 6c66 2e5f 7072 6564 6963 745f 7374 6570  lf._predict_step
+00010370: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00010380: 2020 2020 2020 2064 6174 6573 3d66 6f72         dates=for
+00010390: 6563 6173 745f 696e 6465 782c 0d0a 2020  ecast_index,..  
+000103a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000103b0: 2020 7472 656e 645f 636f 6d70 6f6e 656e    trend_componen
+000103c0: 743d 7472 656e 645f 666f 7265 6361 7374  t=trend_forecast
 000103d0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000103e0: 2020 2020 2020 2066 6c61 675f 7265 6772         flag_regr
-000103f0: 6573 736f 7273 3d61 6c6c 5f66 6c61 6773  essors=all_flags
-00010400: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00010410: 2020 2020 2020 2069 6d70 6163 7473 3d69         impacts=i
-00010420: 6d70 6163 7473 2c0d 0a20 2020 2020 2020  mpacts,..       
-00010430: 2020 2020 2020 2020 2020 2020 2072 6567               reg
-00010440: 7265 7373 6f72 5f70 6572 5f73 6572 6965  ressor_per_serie
-00010450: 733d 7265 6772 5f70 735f 666f 7265 2c0d  s=regr_ps_fore,.
-00010460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010470: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-00010480: 2020 2020 6466 203d 2070 642e 636f 6e63      df = pd.conc
-00010490: 6174 285b 6466 2c20 6466 5f66 6f72 6563  at([df, df_forec
-000104a0: 6173 742e 666f 7265 6361 7374 2e69 6c6f  ast.forecast.ilo
-000104b0: 635b 2d31 3a5d 5d29 0d0a 2020 2020 2020  c[-1:]])..      
-000104c0: 2020 2020 2020 6966 206e 6f74 2069 6e63        if not inc
-000104d0: 6c75 6465 5f68 6973 746f 7279 3a0d 0a20  lude_history:.. 
-000104e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000104f0: 665f 666f 7265 6361 7374 2e66 6f72 6563  f_forecast.forec
-00010500: 6173 7420 3d20 6466 5f66 6f72 6563 6173  ast = df_forecas
-00010510: 742e 666f 7265 6361 7374 2e74 6169 6c28  t.forecast.tail(
-00010520: 666f 7265 6361 7374 5f6c 656e 6774 6829  forecast_length)
-00010530: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010540: 2020 6466 5f66 6f72 6563 6173 742e 6c6f    df_forecast.lo
-00010550: 7765 725f 666f 7265 6361 7374 203d 2064  wer_forecast = d
-00010560: 665f 666f 7265 6361 7374 2e6c 6f77 6572  f_forecast.lower
-00010570: 5f66 6f72 6563 6173 742e 7461 696c 280d  _forecast.tail(.
-00010580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010590: 2020 2020 2066 6f72 6563 6173 745f 6c65       forecast_le
-000105a0: 6e67 7468 0d0a 2020 2020 2020 2020 2020  ngth..          
-000105b0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-000105c0: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
-000105d0: 6361 7374 2e75 7070 6572 5f66 6f72 6563  cast.upper_forec
-000105e0: 6173 7420 3d20 6466 5f66 6f72 6563 6173  ast = df_forecas
-000105f0: 742e 7570 7065 725f 666f 7265 6361 7374  t.upper_forecast
-00010600: 2e74 6169 6c28 0d0a 2020 2020 2020 2020  .tail(..        
-00010610: 2020 2020 2020 2020 2020 2020 666f 7265              fore
-00010620: 6361 7374 5f6c 656e 6774 680d 0a20 2020  cast_length..   
-00010630: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00010640: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00010650: 2020 2020 2020 2020 2020 2066 6f72 6563             forec
-00010660: 6173 745f 696e 6465 7820 3d20 7365 6c66  ast_index = self
-00010670: 2e63 7265 6174 655f 666f 7265 6361 7374  .create_forecast
-00010680: 5f69 6e64 6578 280d 0a20 2020 2020 2020  _index(..       
-00010690: 2020 2020 2020 2020 2066 6f72 6563 6173           forecas
-000106a0: 745f 6c65 6e67 7468 2c20 6c61 7374 5f64  t_length, last_d
-000106b0: 6174 653d 6466 2e69 6e64 6578 5b2d 315d  ate=df.index[-1]
-000106c0: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-000106d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000106e0: 696e 636c 7564 655f 6869 7374 6f72 793a  include_history:
-000106f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010700: 2020 666f 7265 6361 7374 5f69 6e64 6578    forecast_index
-00010710: 203d 2064 662e 696e 6465 782e 756e 696f   = df.index.unio
-00010720: 6e28 666f 7265 6361 7374 5f69 6e64 6578  n(forecast_index
-00010730: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-00010740: 665f 666f 7265 6361 7374 203d 2073 656c  f_forecast = sel
-00010750: 662e 5f70 7265 6469 6374 5f73 7465 7028  f._predict_step(
-00010760: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010770: 2020 6461 7465 733d 666f 7265 6361 7374    dates=forecast
-00010780: 5f69 6e64 6578 2c0d 0a20 2020 2020 2020  _index,..       
-00010790: 2020 2020 2020 2020 2074 7265 6e64 5f63           trend_c
-000107a0: 6f6d 706f 6e65 6e74 3d74 7265 6e64 5f66  omponent=trend_f
-000107b0: 6f72 6563 6173 742c 0d0a 2020 2020 2020  orecast,..      
-000107c0: 2020 2020 2020 2020 2020 6869 7374 6f72            histor
-000107d0: 795f 6466 3d64 662c 0d0a 2020 2020 2020  y_df=df,..      
-000107e0: 2020 2020 2020 2020 2020 6675 7475 7265            future
-000107f0: 5f72 6567 7265 7373 6f72 3d66 756c 6c5f  _regressor=full_
-00010800: 7265 6772 2c0d 0a20 2020 2020 2020 2020  regr,..         
-00010810: 2020 2020 2020 2066 6c61 675f 7265 6772         flag_regr
-00010820: 6573 736f 7273 3d61 6c6c 5f66 6c61 6773  essors=all_flags
-00010830: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00010840: 2020 2069 6d70 6163 7473 3d69 6d70 6163     impacts=impac
-00010850: 7473 2c0d 0a20 2020 2020 2020 2020 2020  ts,..           
-00010860: 2020 2020 2072 6567 7265 7373 6f72 5f70       regressor_p
-00010870: 6572 5f73 6572 6965 733d 7265 6772 5f70  er_series=regr_p
-00010880: 735f 666f 7265 2c0d 0a20 2020 2020 2020  s_fore,..       
-00010890: 2020 2020 2029 0d0a 0d0a 2020 2020 2020       )....      
-000108a0: 2020 2320 7361 7665 2066 7574 7572 6520    # save future 
-000108b0: 696e 6465 7820 6265 666f 7265 2069 6e63  index before inc
-000108c0: 6c75 6465 5f68 6973 746f 7279 2069 7320  lude_history is 
-000108d0: 6164 6465 640d 0a20 2020 2020 2020 2069  added..        i
-000108e0: 6620 6675 7475 7265 5f69 6d70 6163 7473  f future_impacts
-000108f0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00010900: 2066 6f72 6563 6173 745f 6c65 6e67 7468   forecast_length
-00010910: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00010920: 2020 2020 2020 2020 2020 2066 7574 7572             futur
-00010930: 655f 696d 7061 6374 7320 3d20 6675 7475  e_impacts = futu
-00010940: 7265 5f69 6d70 6163 7473 2e72 6569 6e64  re_impacts.reind
-00010950: 6578 280d 0a20 2020 2020 2020 2020 2020  ex(..           
-00010960: 2020 2020 2063 6f6c 756d 6e73 3d64 665f       columns=df_
-00010970: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
-00010980: 742e 636f 6c75 6d6e 732c 0d0a 2020 2020  t.columns,..    
-00010990: 2020 2020 2020 2020 2020 2020 696e 6465              inde
-000109a0: 783d 7365 6c66 2e66 6f72 6563 6173 745f  x=self.forecast_
-000109b0: 696e 6465 782c 0d0a 2020 2020 2020 2020  index,..        
-000109c0: 2020 2020 2020 2020 6669 6c6c 5f76 616c          fill_val
-000109d0: 7565 3d30 2c0d 0a20 2020 2020 2020 2020  ue=0,..         
-000109e0: 2020 2029 0d0a 2020 2020 2020 2020 2320     )..        # 
-000109f0: 756e 646f 2070 7265 7072 6f63 6573 7369  undo preprocessi
-00010a00: 6e67 2061 6e64 2073 6361 6c69 6e67 0d0a  ng and scaling..
-00010a10: 2020 2020 2020 2020 2320 6163 636f 756e          # accoun
-00010a20: 7420 666f 7220 736f 6d65 2074 7261 6e73  t for some trans
-00010a30: 666f 726d 6572 7320 7265 7175 6972 696e  formers requirin
-00010a40: 6720 6469 6666 6572 656e 7420 6d65 7468  g different meth
-00010a50: 6f64 7320 6f6e 206f 7269 6769 6e61 6c20  ods on original 
-00010a60: 6461 7461 2061 6e64 2066 6f72 6563 6173  data and forecas
-00010a70: 740d 0a20 2020 2020 2020 2069 6620 666f  t..        if fo
-00010a80: 7265 6361 7374 5f6c 656e 6774 6820 6973  recast_length is
-00010a90: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00010aa0: 2020 2020 6466 5f66 6f72 6563 6173 742e      df_forecast.
-00010ab0: 666f 7265 6361 7374 203d 2073 656c 662e  forecast = self.
-00010ac0: 746f 5f6f 7269 6769 6e5f 7370 6163 6528  to_origin_space(
-00010ad0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010ae0: 2020 6466 5f66 6f72 6563 6173 742e 666f    df_forecast.fo
-00010af0: 7265 6361 7374 2c20 7472 616e 735f 6d65  recast, trans_me
-00010b00: 7468 6f64 3d27 6f72 6967 696e 616c 270d  thod='original'.
-00010b10: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
-00010b20: 2020 2020 2020 2020 2020 2020 6466 5f66              df_f
-00010b30: 6f72 6563 6173 742e 6c6f 7765 725f 666f  orecast.lower_fo
-00010b40: 7265 6361 7374 203d 2073 656c 662e 746f  recast = self.to
-00010b50: 5f6f 7269 6769 6e5f 7370 6163 6528 0d0a  _origin_space(..
-00010b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b70: 6466 5f66 6f72 6563 6173 742e 6c6f 7765  df_forecast.lowe
-00010b80: 725f 666f 7265 6361 7374 2c20 7472 616e  r_forecast, tran
-00010b90: 735f 6d65 7468 6f64 3d27 6f72 6967 696e  s_method='origin
-00010ba0: 616c 270d 0a20 2020 2020 2020 2020 2020  al'..           
-00010bb0: 2029 0d0a 2020 2020 2020 2020 2020 2020   )..            
-00010bc0: 6466 5f66 6f72 6563 6173 742e 7570 7065  df_forecast.uppe
-00010bd0: 725f 666f 7265 6361 7374 203d 2073 656c  r_forecast = sel
-00010be0: 662e 746f 5f6f 7269 6769 6e5f 7370 6163  f.to_origin_spac
-00010bf0: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-00010c00: 2020 2020 6466 5f66 6f72 6563 6173 742e      df_forecast.
-00010c10: 7570 7065 725f 666f 7265 6361 7374 2c20  upper_forecast, 
-00010c20: 7472 616e 735f 6d65 7468 6f64 3d27 6f72  trans_method='or
-00010c30: 6967 696e 616c 270d 0a20 2020 2020 2020  iginal'..       
-00010c40: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00010c50: 2020 2020 7365 6c66 2e70 7265 6469 6374      self.predict
-00010c60: 6564 5f74 7265 6e64 203d 2073 656c 662e  ed_trend = self.
-00010c70: 746f 5f6f 7269 6769 6e5f 7370 6163 6528  to_origin_space(
-00010c80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010c90: 2020 7472 656e 645f 666f 7265 6361 7374    trend_forecast
-00010ca0: 2e66 6f72 6563 6173 742c 2074 7261 6e73  .forecast, trans
-00010cb0: 5f6d 6574 686f 643d 276f 7269 6769 6e61  _method='origina
-00010cc0: 6c27 0d0a 2020 2020 2020 2020 2020 2020  l'..            
-00010cd0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-00010ce0: 6e6f 7420 696e 636c 7564 655f 6869 7374  not include_hist
-00010cf0: 6f72 793a 0d0a 2020 2020 2020 2020 2020  ory:..          
-00010d00: 2020 6466 5f66 6f72 6563 6173 742e 666f    df_forecast.fo
-00010d10: 7265 6361 7374 203d 2073 656c 662e 746f  recast = self.to
-00010d20: 5f6f 7269 6769 6e5f 7370 6163 6528 0d0a  _origin_space(..
-00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d40: 6466 5f66 6f72 6563 6173 742e 666f 7265  df_forecast.fore
-00010d50: 6361 7374 2c20 7472 616e 735f 6d65 7468  cast, trans_meth
-00010d60: 6f64 3d27 666f 7265 6361 7374 270d 0a20  od='forecast'.. 
-00010d70: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00010d80: 2020 2020 2020 2020 2020 6466 5f66 6f72            df_for
-00010d90: 6563 6173 742e 6c6f 7765 725f 666f 7265  ecast.lower_fore
-00010da0: 6361 7374 203d 2073 656c 662e 746f 5f6f  cast = self.to_o
-00010db0: 7269 6769 6e5f 7370 6163 6528 0d0a 2020  rigin_space(..  
-00010dc0: 2020 2020 2020 2020 2020 2020 2020 6466                df
-00010dd0: 5f66 6f72 6563 6173 742e 6c6f 7765 725f  _forecast.lower_
-00010de0: 666f 7265 6361 7374 2c20 7472 616e 735f  forecast, trans_
-00010df0: 6d65 7468 6f64 3d27 666f 7265 6361 7374  method='forecast
-00010e00: 270d 0a20 2020 2020 2020 2020 2020 2029  '..            )
-00010e10: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-00010e20: 5f66 6f72 6563 6173 742e 7570 7065 725f  _forecast.upper_
-00010e30: 666f 7265 6361 7374 203d 2073 656c 662e  forecast = self.
-00010e40: 746f 5f6f 7269 6769 6e5f 7370 6163 6528  to_origin_space(
-00010e50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010e60: 2020 6466 5f66 6f72 6563 6173 742e 7570    df_forecast.up
-00010e70: 7065 725f 666f 7265 6361 7374 2c20 7472  per_forecast, tr
-00010e80: 616e 735f 6d65 7468 6f64 3d27 666f 7265  ans_method='fore
-00010e90: 6361 7374 270d 0a20 2020 2020 2020 2020  cast'..         
-00010ea0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-00010eb0: 2020 7365 6c66 2e70 7265 6469 6374 6564    self.predicted
-00010ec0: 5f74 7265 6e64 203d 2073 656c 662e 746f  _trend = self.to
-00010ed0: 5f6f 7269 6769 6e5f 7370 6163 6528 0d0a  _origin_space(..
-00010ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ef0: 7472 656e 645f 666f 7265 6361 7374 2e66  trend_forecast.f
-00010f00: 6f72 6563 6173 742c 2074 7261 6e73 5f6d  orecast, trans_m
-00010f10: 6574 686f 643d 2766 6f72 6563 6173 7427  ethod='forecast'
-00010f20: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-00010f30: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00010f40: 2020 2020 2020 2020 2020 2020 6864 6e20              hdn 
-00010f50: 3d20 6c65 6e28 6466 5f66 6f72 6563 6173  = len(df_forecas
-00010f60: 742e 666f 7265 6361 7374 2920 2d20 666f  t.forecast) - fo
-00010f70: 7265 6361 7374 5f6c 656e 6774 680d 0a20  recast_length.. 
-00010f80: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
-00010f90: 7265 6361 7374 2e66 6f72 6563 6173 7420  recast.forecast 
-00010fa0: 3d20 7064 2e63 6f6e 6361 7428 0d0a 2020  = pd.concat(..  
-00010fb0: 2020 2020 2020 2020 2020 2020 2020 5b0d                [.
-00010fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010fd0: 2020 2020 2073 656c 662e 746f 5f6f 7269       self.to_ori
-00010fe0: 6769 6e5f 7370 6163 6528 0d0a 2020 2020  gin_space(..    
-00010ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011000: 2020 2020 6466 5f66 6f72 6563 6173 742e      df_forecast.
-00011010: 666f 7265 6361 7374 2e68 6561 6428 6864  forecast.head(hd
-00011020: 6e29 2c20 7472 616e 735f 6d65 7468 6f64  n), trans_method
-00011030: 3d27 6f72 6967 696e 616c 270d 0a20 2020  ='original'..   
-00011040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011050: 2029 2c0d 0a20 2020 2020 2020 2020 2020   ),..           
-00011060: 2020 2020 2020 2020 2073 656c 662e 746f           self.to
-00011070: 5f6f 7269 6769 6e5f 7370 6163 6528 0d0a  _origin_space(..
-00011080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011090: 2020 2020 2020 2020 6466 5f66 6f72 6563          df_forec
-000110a0: 6173 742e 666f 7265 6361 7374 2e74 6169  ast.forecast.tai
-000110b0: 6c28 666f 7265 6361 7374 5f6c 656e 6774  l(forecast_lengt
-000110c0: 6829 2c0d 0a20 2020 2020 2020 2020 2020  h),..           
-000110d0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
-000110e0: 6e73 5f6d 6574 686f 643d 2766 6f72 6563  ns_method='forec
-000110f0: 6173 7427 2c0d 0a20 2020 2020 2020 2020  ast',..         
-00011100: 2020 2020 2020 2020 2020 2029 2c0d 0a20             ),.. 
-00011110: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-00011120: 0d0a 2020 2020 2020 2020 2020 2020 290d  ..            ).
-00011130: 0a20 2020 2020 2020 2020 2020 2064 665f  .            df_
-00011140: 666f 7265 6361 7374 2e6c 6f77 6572 5f66  forecast.lower_f
-00011150: 6f72 6563 6173 7420 3d20 7064 2e63 6f6e  orecast = pd.con
-00011160: 6361 7428 0d0a 2020 2020 2020 2020 2020  cat(..          
-00011170: 2020 2020 2020 5b0d 0a20 2020 2020 2020        [..       
-00011180: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00011190: 662e 746f 5f6f 7269 6769 6e5f 7370 6163  f.to_origin_spac
-000111a0: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-000111b0: 2020 2020 2020 2020 2020 2020 6466 5f66              df_f
-000111c0: 6f72 6563 6173 742e 6c6f 7765 725f 666f  orecast.lower_fo
-000111d0: 7265 6361 7374 2e68 6561 6428 6864 6e29  recast.head(hdn)
-000111e0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-000111f0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-00011200: 5f6d 6574 686f 643d 276f 7269 6769 6e61  _method='origina
-00011210: 6c27 2c0d 0a20 2020 2020 2020 2020 2020  l',..           
-00011220: 2020 2020 2020 2020 2020 2020 2062 6f75               bou
-00011230: 6e64 733d 5472 7565 2c0d 0a20 2020 2020  nds=True,..     
-00011240: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00011250: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00011260: 2020 2020 2020 2073 656c 662e 746f 5f6f         self.to_o
-00011270: 7269 6769 6e5f 7370 6163 6528 0d0a 2020  rigin_space(..  
-00011280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011290: 2020 2020 2020 6466 5f66 6f72 6563 6173        df_forecas
-000112a0: 742e 6c6f 7765 725f 666f 7265 6361 7374  t.lower_forecast
-000112b0: 2e74 6169 6c28 666f 7265 6361 7374 5f6c  .tail(forecast_l
-000112c0: 656e 6774 6829 2c0d 0a20 2020 2020 2020  ength),..       
-000112d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112e0: 2074 7261 6e73 5f6d 6574 686f 643d 2766   trans_method='f
-000112f0: 6f72 6563 6173 7427 2c0d 0a20 2020 2020  orecast',..     
-00011300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011310: 2020 2062 6f75 6e64 733d 5472 7565 2c0d     bounds=True,.
-00011320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011330: 2020 2020 2029 2c0d 0a20 2020 2020 2020       ),..       
-00011340: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
-00011350: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-00011360: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
-00011370: 7374 2e75 7070 6572 5f66 6f72 6563 6173  st.upper_forecas
-00011380: 7420 3d20 7064 2e63 6f6e 6361 7428 0d0a  t = pd.concat(..
-00011390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113a0: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-000113b0: 2020 2020 2020 2073 656c 662e 746f 5f6f         self.to_o
-000113c0: 7269 6769 6e5f 7370 6163 6528 0d0a 2020  rigin_space(..  
-000113d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000113e0: 2020 2020 2020 6466 5f66 6f72 6563 6173        df_forecas
-000113f0: 742e 7570 7065 725f 666f 7265 6361 7374  t.upper_forecast
-00011400: 2e68 6561 6428 6864 6e29 2c0d 0a20 2020  .head(hdn),..   
-00011410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011420: 2020 2020 2074 7261 6e73 5f6d 6574 686f       trans_metho
-00011430: 643d 276f 7269 6769 6e61 6c27 2c0d 0a20  d='original',.. 
-00011440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011450: 2020 2020 2020 2062 6f75 6e64 733d 5472         bounds=Tr
-00011460: 7565 2c0d 0a20 2020 2020 2020 2020 2020  ue,..           
-00011470: 2020 2020 2020 2020 2029 2c0d 0a20 2020           ),..   
-00011480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011490: 2073 656c 662e 746f 5f6f 7269 6769 6e5f   self.to_origin_
-000114a0: 7370 6163 6528 0d0a 2020 2020 2020 2020  space(..        
-000114b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114c0: 6466 5f66 6f72 6563 6173 742e 7570 7065  df_forecast.uppe
-000114d0: 725f 666f 7265 6361 7374 2e74 6169 6c28  r_forecast.tail(
-000114e0: 666f 7265 6361 7374 5f6c 656e 6774 6829  forecast_length)
-000114f0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00011500: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-00011510: 5f6d 6574 686f 643d 2766 6f72 6563 6173  _method='forecas
-00011520: 7427 2c0d 0a20 2020 2020 2020 2020 2020  t',..           
-00011530: 2020 2020 2020 2020 2020 2020 2062 6f75               bou
-00011540: 6e64 733d 5472 7565 2c0d 0a20 2020 2020  nds=True,..     
-00011550: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00011560: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00011570: 2020 205d 0d0a 2020 2020 2020 2020 2020     ]..          
-00011580: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
-00011590: 2073 656c 662e 7072 6564 6963 7465 645f   self.predicted_
-000115a0: 7472 656e 6420 3d20 7064 2e63 6f6e 6361  trend = pd.conca
-000115b0: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
-000115c0: 2020 2020 5b0d 0a20 2020 2020 2020 2020      [..         
-000115d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000115e0: 746f 5f6f 7269 6769 6e5f 7370 6163 6528  to_origin_space(
-000115f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011600: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
-00011610: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
-00011620: 742e 6865 6164 2868 646e 292c 2074 7261  t.head(hdn), tra
-00011630: 6e73 5f6d 6574 686f 643d 276f 7269 6769  ns_method='origi
-00011640: 6e61 6c27 0d0a 2020 2020 2020 2020 2020  nal'..          
-00011650: 2020 2020 2020 2020 2020 292c 0d0a 2020            ),..  
-00011660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011670: 2020 7365 6c66 2e74 6f5f 6f72 6967 696e    self.to_origin
-00011680: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
-00011690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116a0: 2074 7265 6e64 5f66 6f72 6563 6173 742e   trend_forecast.
-000116b0: 666f 7265 6361 7374 2e74 6169 6c28 666f  forecast.tail(fo
-000116c0: 7265 6361 7374 5f6c 656e 6774 6829 2c0d  recast_length),.
-000116d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000116e0: 2020 2020 2020 2020 2074 7261 6e73 5f6d           trans_m
-000116f0: 6574 686f 643d 2766 6f72 6563 6173 7427  ethod='forecast'
-00011700: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00011710: 2020 2020 2020 2029 2c0d 0a20 2020 2020         ),..     
-00011720: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
-00011730: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
-00011740: 2020 2020 2020 2023 2075 7064 6174 6520         # update 
-00011750: 7472 656e 6420 616e 616c 7973 6973 2062  trend analysis b
-00011760: 6173 6564 206f 6e20 7472 656e 6420 666f  ased on trend fo
-00011770: 7265 6361 7374 2061 7320 7765 6c6c 0d0a  recast as well..
-00011780: 2020 2020 2020 2020 6966 2066 6f72 6563          if forec
-00011790: 6173 745f 6c65 6e67 7468 2069 7320 6e6f  ast_length is no
-000117a0: 7420 4e6f 6e65 2061 6e64 2069 6e63 6c75  t None and inclu
-000117b0: 6465 5f68 6973 746f 7279 3a0d 0a20 2020  de_history:..   
-000117c0: 2020 2020 2020 2020 2074 7265 6e64 5f70           trend_p
-000117d0: 6f73 7465 7269 6f72 2c20 7365 6c66 2e73  osterior, self.s
-000117e0: 6c6f 7065 2c20 696e 7465 7263 6570 7420  lope, intercept 
-000117f0: 3d20 7365 6c66 2e72 6f6c 6c69 6e67 5f74  = self.rolling_t
-00011800: 7265 6e64 280d 0a20 2020 2020 2020 2020  rend(..         
-00011810: 2020 2020 2020 2073 656c 662e 7072 6564         self.pred
-00011820: 6963 7465 645f 7472 656e 642c 206e 702e  icted_trend, np.
-00011830: 6172 7261 7928 7365 6c66 2e74 5f70 7265  array(self.t_pre
-00011840: 6469 6374 290d 0a20 2020 2020 2020 2020  dict)..         
-00011850: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-00011860: 2020 280d 0a20 2020 2020 2020 2020 2020    (..           
-00011870: 2020 2020 2073 656c 662e 7a65 726f 5f63       self.zero_c
-00011880: 726f 7373 696e 6773 2c0d 0a20 2020 2020  rossings,..     
-00011890: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000118a0: 6368 616e 6765 706f 696e 7473 2c0d 0a20  changepoints,.. 
-000118b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000118c0: 656c 662e 736c 6f70 655f 7369 676e 2c0d  elf.slope_sign,.
-000118d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000118e0: 2073 656c 662e 6163 6365 6c2c 0d0a 2020   self.accel,..  
-000118f0: 2020 2020 2020 2020 2020 2920 3d20 7365            ) = se
-00011900: 6c66 2e61 6e61 6c79 7a65 5f74 7265 6e64  lf.analyze_trend
-00011910: 2873 656c 662e 736c 6f70 652c 2069 6e64  (self.slope, ind
-00011920: 6578 3d73 656c 662e 7072 6564 6963 7465  ex=self.predicte
-00011930: 645f 7472 656e 642e 696e 6465 7829 0d0a  d_trend.index)..
-00011940: 0d0a 2020 2020 2020 2020 2320 646f 6e27  ..        # don'
-00011950: 7420 666f 7267 6574 2074 6f20 6164 6420  t forget to add 
-00011960: 696e 2070 6173 745f 696d 7061 6374 7320  in past_impacts 
-00011970: 2875 7365 2066 7574 7572 6520 696d 7061  (use future impa
-00011980: 6374 7320 6167 6169 6e3f 2920 4146 5445  cts again?) AFTE
-00011990: 5220 756e 7363 616c 696e 670d 0a20 2020  R unscaling..   
-000119a0: 2020 2020 2069 6620 7365 6c66 2e70 6173       if self.pas
-000119b0: 745f 696d 7061 6374 735f 696e 7465 7276  t_impacts_interv
-000119c0: 656e 7469 6f6e 2021 3d20 2272 6567 7265  ention != "regre
-000119d0: 7373 6f72 223a 0d0a 2020 2020 2020 2020  ssor":..        
-000119e0: 2020 2020 6966 2066 7574 7572 655f 696d      if future_im
-000119f0: 7061 6374 7320 6973 206e 6f74 204e 6f6e  pacts is not Non
-00011a00: 6520 616e 6420 7365 6c66 2e70 6173 745f  e and self.past_
-00011a10: 696d 7061 6374 7320 6973 204e 6f6e 653a  impacts is None:
-00011a20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011a30: 2020 7061 7374 5f69 6d70 6163 7473 203d    past_impacts =
-00011a40: 2070 642e 4461 7461 4672 616d 6528 0d0a   pd.DataFrame(..
-00011a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a60: 2020 2020 302c 2069 6e64 6578 3d73 656c      0, index=sel
-00011a70: 662e 6466 2e69 6e64 6578 2c20 636f 6c75  f.df.index, colu
-00011a80: 6d6e 733d 7365 6c66 2e64 662e 636f 6c75  mns=self.df.colu
-00011a90: 6d6e 730d 0a20 2020 2020 2020 2020 2020  mns..           
-00011aa0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00011ab0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00011ac0: 2020 2020 2020 2020 2020 2070 6173 745f             past_
-00011ad0: 696d 7061 6374 7320 3d20 7365 6c66 2e70  impacts = self.p
-00011ae0: 6173 745f 696d 7061 6374 730d 0a20 2020  ast_impacts..   
-00011af0: 2020 2020 2020 2020 2023 2072 6f6c 6c20           # roll 
-00011b00: 666f 7277 6172 6420 7461 696c 206f 6620  forward tail of 
-00011b10: 7061 7374 2069 6d70 6163 7473 2c20 6173  past impacts, as
-00011b20: 7375 6d69 6e67 2069 7420 636f 6e74 696e  suming it contin
-00011b30: 7565 730d 0a20 2020 2020 2020 2020 2020  ues..           
-00011b40: 2069 6620 7365 6c66 2e70 6173 745f 696d   if self.past_im
-00011b50: 7061 6374 7320 6973 206e 6f74 204e 6f6e  pacts is not Non
-00011b60: 6520 616e 6420 666f 7265 6361 7374 5f6c  e and forecast_l
-00011b70: 656e 6774 6820 6973 206e 6f74 204e 6f6e  ength is not Non
-00011b80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00011b90: 2020 2020 6675 7475 7265 5f69 6d70 7473      future_impts
-00011ba0: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
-00011bb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011bc0: 2020 2020 2020 6e70 2e72 6570 6561 7428        np.repeat(
-00011bd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00011be0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00011bf0: 6173 745f 696d 7061 6374 732e 696c 6f63  ast_impacts.iloc
-00011c00: 5b2d 313a 5d2e 746f 5f6e 756d 7079 2829  [-1:].to_numpy()
-00011c10: 2c20 666f 7265 6361 7374 5f6c 656e 6774  , forecast_lengt
-00011c20: 682c 2061 7869 733d 300d 0a20 2020 2020  h, axis=0..     
-00011c30: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00011c40: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00011c50: 2020 2020 2020 2069 6e64 6578 3d64 665f         index=df_
-00011c60: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
-00011c70: 742e 696e 6465 785b 2d66 6f72 6563 6173  t.index[-forecas
-00011c80: 745f 6c65 6e67 7468 3a5d 2c0d 0a20 2020  t_length:],..   
-00011c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ca0: 2063 6f6c 756d 6e73 3d73 656c 662e 7061   columns=self.pa
-00011cb0: 7374 5f69 6d70 6163 7473 2e63 6f6c 756d  st_impacts.colum
-00011cc0: 6e73 2c0d 0a20 2020 2020 2020 2020 2020  ns,..           
-00011cd0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00011ce0: 2020 2020 2020 2020 6966 2066 7574 7572          if futur
-00011cf0: 655f 696d 7061 6374 7320 6973 206e 6f74  e_impacts is not
-00011d00: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00011d10: 2020 2020 2020 2020 2020 2020 6675 7475              futu
-00011d20: 7265 5f69 6d70 7473 203d 2066 7574 7572  re_impts = futur
-00011d30: 655f 696d 7074 7320 2b20 6675 7475 7265  e_impts + future
-00011d40: 5f69 6d70 6163 7473 0d0a 2020 2020 2020  _impacts..      
-00011d50: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00011d60: 2020 2020 2020 2020 2020 2020 2066 7574               fut
-00011d70: 7572 655f 696d 7074 7320 3d20 7064 2e44  ure_impts = pd.D
-00011d80: 6174 6146 7261 6d65 2829 0d0a 2020 2020  ataFrame()..    
-00011d90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00011da0: 7061 7374 5f69 6d70 6163 7473 2069 7320  past_impacts is 
-00011db0: 6e6f 7420 4e6f 6e65 206f 7220 6675 7475  not None or futu
-00011dc0: 7265 5f69 6d70 6163 7473 2069 7320 6e6f  re_impacts is no
-00011dd0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00011de0: 2020 2020 2020 2020 2069 6d70 7473 203d           impts =
-00011df0: 2031 202b 2070 642e 636f 6e63 6174 285b   1 + pd.concat([
-00011e00: 7061 7374 5f69 6d70 6163 7473 2c20 6675  past_impacts, fu
-00011e10: 7475 7265 5f69 6d70 7473 5d2c 2061 7869  ture_impts], axi
-00011e20: 733d 3029 2e72 6569 6e64 6578 280d 0a20  s=0).reindex(.. 
-00011e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e40: 2020 2069 6e64 6578 3d64 665f 666f 7265     index=df_fore
-00011e50: 6361 7374 2e66 6f72 6563 6173 742e 696e  cast.forecast.in
-00011e60: 6465 782c 0d0a 2020 2020 2020 2020 2020  dex,..          
-00011e70: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00011e80: 733d 6466 5f66 6f72 6563 6173 742e 666f  s=df_forecast.fo
-00011e90: 7265 6361 7374 2e63 6f6c 756d 6e73 2c0d  recast.columns,.
-00011ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011eb0: 2020 2020 2066 696c 6c5f 7661 6c75 653d       fill_value=
-00011ec0: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
-00011ed0: 2020 2020 2920 2023 206d 696e 7573 206f      )  # minus o
-00011ee0: 7220 706c 7573 0d0a 2020 2020 2020 2020  r plus..        
-00011ef0: 2020 2020 2020 2020 7365 6c66 2e69 6d70          self.imp
-00011f00: 6163 7473 203d 2069 6d70 7473 0d0a 2020  acts = impts..  
-00011f10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00011f20: 2069 6e63 6c75 6465 5f6f 7267 616e 6963   include_organic
-00011f30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011f40: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
-00011f50: 7374 2e6f 7267 616e 6963 5f66 6f72 6563  st.organic_forec
-00011f60: 6173 7420 3d20 6466 5f66 6f72 6563 6173  ast = df_forecas
-00011f70: 742e 666f 7265 6361 7374 2e63 6f70 7928  t.forecast.copy(
-00011f80: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00011f90: 2020 2064 665f 666f 7265 6361 7374 2e66     df_forecast.f
-00011fa0: 6f72 6563 6173 7420 3d20 6466 5f66 6f72  orecast = df_for
-00011fb0: 6563 6173 742e 666f 7265 6361 7374 202a  ecast.forecast *
-00011fc0: 2069 6d70 7473 0d0a 2020 2020 2020 2020   impts..        
-00011fd0: 2020 2020 2020 2020 6466 5f66 6f72 6563          df_forec
-00011fe0: 6173 742e 6c6f 7765 725f 666f 7265 6361  ast.lower_foreca
-00011ff0: 7374 203d 2064 665f 666f 7265 6361 7374  st = df_forecast
-00012000: 2e6c 6f77 6572 5f66 6f72 6563 6173 7420  .lower_forecast 
-00012010: 2a20 696d 7074 730d 0a20 2020 2020 2020  * impts..       
-00012020: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
-00012030: 6361 7374 2e75 7070 6572 5f66 6f72 6563  cast.upper_forec
-00012040: 6173 7420 3d20 6466 5f66 6f72 6563 6173  ast = df_forecas
-00012050: 742e 7570 7065 725f 666f 7265 6361 7374  t.upper_forecast
-00012060: 202a 2069 6d70 7473 0d0a 0d0a 2020 2020   * impts....    
-00012070: 2020 2020 6966 2073 656c 662e 636f 6e73      if self.cons
-00012080: 7472 6169 6e74 2069 7320 6e6f 7420 4e6f  traint is not No
-00012090: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000120a0: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-000120b0: 656c 662e 636f 6e73 7472 6169 6e74 2c20  elf.constraint, 
-000120c0: 6469 6374 293a 0d0a 2020 2020 2020 2020  dict):..        
-000120d0: 2020 2020 2020 2020 636f 6e73 7472 6169          constrai
-000120e0: 6e74 5f6d 6574 686f 6420 3d20 7365 6c66  nt_method = self
-000120f0: 2e63 6f6e 7374 7261 696e 742e 6765 7428  .constraint.get(
-00012100: 2263 6f6e 7374 7261 696e 745f 6d65 7468  "constraint_meth
-00012110: 6f64 222c 2022 7175 616e 7469 6c65 2229  od", "quantile")
-00012120: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012130: 2020 636f 6e73 7472 6169 6e74 5f72 6567    constraint_reg
-00012140: 756c 6172 697a 6174 696f 6e20 3d20 7365  ularization = se
-00012150: 6c66 2e63 6f6e 7374 7261 696e 742e 6765  lf.constraint.ge
-00012160: 7428 0d0a 2020 2020 2020 2020 2020 2020  t(..            
-00012170: 2020 2020 2020 2020 2263 6f6e 7374 7261          "constra
-00012180: 696e 745f 7265 6775 6c61 7269 7a61 7469  int_regularizati
-00012190: 6f6e 222c 2031 0d0a 2020 2020 2020 2020  on", 1..        
-000121a0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-000121b0: 2020 2020 2020 2020 2020 206c 6f77 6572             lower
-000121c0: 5f63 6f6e 7374 7261 696e 7420 3d20 7365  _constraint = se
-000121d0: 6c66 2e63 6f6e 7374 7261 696e 742e 6765  lf.constraint.ge
-000121e0: 7428 226c 6f77 6572 5f63 6f6e 7374 7261  t("lower_constra
-000121f0: 696e 7422 2c20 3029 0d0a 2020 2020 2020  int", 0)..      
-00012200: 2020 2020 2020 2020 2020 7570 7065 725f            upper_
-00012210: 636f 6e73 7472 6169 6e74 203d 2073 656c  constraint = sel
-00012220: 662e 636f 6e73 7472 6169 6e74 2e67 6574  f.constraint.get
-00012230: 2822 7570 7065 725f 636f 6e73 7472 6169  ("upper_constrai
-00012240: 6e74 222c 2031 290d 0a20 2020 2020 2020  nt", 1)..       
-00012250: 2020 2020 2020 2020 2062 6f75 6e64 7320           bounds 
-00012260: 3d20 7365 6c66 2e63 6f6e 7374 7261 696e  = self.constrain
-00012270: 742e 6765 7428 2262 6f75 6e64 7322 2c20  t.get("bounds", 
-00012280: 4661 6c73 6529 0d0a 2020 2020 2020 2020  False)..        
-00012290: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000122a0: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
-000122b0: 7261 696e 745f 6d65 7468 6f64 203d 2022  raint_method = "
-000122c0: 7374 6465 765f 6d69 6e22 0d0a 2020 2020  stdev_min"..    
-000122d0: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
-000122e0: 725f 636f 6e73 7472 6169 6e74 203d 2066  r_constraint = f
-000122f0: 6c6f 6174 2873 656c 662e 636f 6e73 7472  loat(self.constr
-00012300: 6169 6e74 290d 0a20 2020 2020 2020 2020  aint)..         
-00012310: 2020 2020 2020 2075 7070 6572 5f63 6f6e         upper_con
-00012320: 7374 7261 696e 7420 3d20 666c 6f61 7428  straint = float(
-00012330: 7365 6c66 2e63 6f6e 7374 7261 696e 7429  self.constraint)
-00012340: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012350: 2020 636f 6e73 7472 6169 6e74 5f72 6567    constraint_reg
-00012360: 756c 6172 697a 6174 696f 6e20 3d20 310d  ularization = 1.
-00012370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012380: 2062 6f75 6e64 7320 3d20 4661 6c73 650d   bounds = False.
-00012390: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000123a0: 7365 6c66 2e76 6572 626f 7365 203e 3d20  self.verbose >= 
-000123b0: 333a 0d0a 2020 2020 2020 2020 2020 2020  3:..            
-000123c0: 2020 2020 7072 696e 7428 0d0a 2020 2020      print(..    
-000123d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123e0: 6622 5573 696e 6720 636f 6e73 7472 6169  f"Using constrai
-000123f0: 6e74 2077 6974 6820 6d65 7468 6f64 3a20  nt with method: 
-00012400: 7b63 6f6e 7374 7261 696e 745f 6d65 7468  {constraint_meth
-00012410: 6f64 7d2c 207b 636f 6e73 7472 6169 6e74  od}, {constraint
-00012420: 5f72 6567 756c 6172 697a 6174 696f 6e7d  _regularization}
-00012430: 2c20 7b6c 6f77 6572 5f63 6f6e 7374 7261  , {lower_constra
-00012440: 696e 747d 2c20 7b75 7070 6572 5f63 6f6e  int}, {upper_con
-00012450: 7374 7261 696e 747d 2c20 7b62 6f75 6e64  straint}, {bound
-00012460: 737d 220d 0a20 2020 2020 2020 2020 2020  s}"..           
-00012470: 2020 2020 2029 0d0a 0d0a 2020 2020 2020       )....      
-00012480: 2020 2020 2020 6466 5f66 6f72 6563 6173        df_forecas
-00012490: 7420 3d20 6466 5f66 6f72 6563 6173 742e  t = df_forecast.
-000124a0: 6170 706c 795f 636f 6e73 7472 6169 6e74  apply_constraint
-000124b0: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
-000124c0: 2020 2020 636f 6e73 7472 6169 6e74 5f6d      constraint_m
-000124d0: 6574 686f 642c 0d0a 2020 2020 2020 2020  ethod,..        
-000124e0: 2020 2020 2020 2020 636f 6e73 7472 6169          constrai
-000124f0: 6e74 5f72 6567 756c 6172 697a 6174 696f  nt_regularizatio
-00012500: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
-00012510: 2020 2020 7570 7065 725f 636f 6e73 7472      upper_constr
-00012520: 6169 6e74 2c0d 0a20 2020 2020 2020 2020  aint,..         
-00012530: 2020 2020 2020 206c 6f77 6572 5f63 6f6e         lower_con
-00012540: 7374 7261 696e 742c 0d0a 2020 2020 2020  straint,..      
-00012550: 2020 2020 2020 2020 2020 626f 756e 6473            bounds
-00012560: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00012570: 2020 2073 656c 662e 6466 5f6f 7269 6769     self.df_origi
-00012580: 6e61 6c2c 0d0a 2020 2020 2020 2020 2020  nal,..          
-00012590: 2020 290d 0a20 2020 2020 2020 2023 2052    )..        # R
-000125a0: 4554 5552 4e20 434f 4d50 4f4e 454e 5453  ETURN COMPONENTS
-000125b0: 2028 6c6f 6e67 2073 7479 6c65 2920 6f70   (long style) op
-000125c0: 7469 6f6e 0d0a 2020 2020 2020 2020 6466  tion..        df
-000125d0: 5f66 6f72 6563 6173 742e 7072 6564 6963  _forecast.predic
-000125e0: 745f 7275 6e74 696d 6520 3d20 7365 6c66  t_runtime = self
-000125f0: 2e74 696d 6528 2920 2d20 7072 6564 6963  .time() - predic
-00012600: 7453 7461 7274 5469 6d65 0d0a 2020 2020  tStartTime..    
-00012610: 2020 2020 7265 7475 726e 2064 665f 666f      return df_fo
-00012620: 7265 6361 7374 0d0a 0d0a 2020 2020 6465  recast....    de
-00012630: 6620 6175 746f 5f66 6974 2873 656c 662c  f auto_fit(self,
-00012640: 2064 662c 2076 616c 6964 6174 696f 6e5f   df, validation_
-00012650: 6d65 7468 6f64 293a 2020 2320 616c 736f  method):  # also
-00012660: 2061 6464 2072 6567 7265 7373 6f72 2069   add regressor i
-00012670: 6e70 7574 0d0a 2020 2020 2020 2020 2320  nput..        # 
-00012680: 6f70 7469 6f6e 2074 6f20 636f 6d70 6c65  option to comple
-00012690: 7465 6c79 2073 6b69 7020 736f 6d65 2074  tely skip some t
-000126a0: 6869 6e67 7320 2861 6e6f 6d61 6c69 6573  hings (anomalies
-000126b0: 2c20 686f 6c69 6461 7920 6465 7465 6374  , holiday detect
-000126c0: 6f72 2c20 6172 206c 6167 7329 0d0a 2020  or, ar lags)..  
-000126d0: 2020 2020 2020 2320 7275 6e20 6372 6f73        # run cros
-000126e0: 7320 7661 6c69 6461 7469 6f6e 2074 6f20  s validation to 
-000126f0: 6368 6f6f 7365 0d0a 2020 2020 2020 2020  choose..        
-00012700: 2320 7265 7475 726e 206d 6574 7269 6373  # return metrics
-00012710: 206f 6620 6265 7374 206d 6f64 656c 2c20   of best model, 
-00012720: 7365 7420 6261 7365 2070 6172 616d 730d  set base params.
-00012730: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-00012740: 6172 7469 6e67 5f70 6172 616d 7320 3d20  arting_params = 
-00012750: 7365 6c66 2e67 6574 5f70 6172 616d 7328  self.get_params(
-00012760: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00012770: 6e20 4e6f 7449 6d70 6c65 6d65 6e74 6564  n NotImplemented
-00012780: 0d0a 0d0a 2020 2020 6465 6620 6e65 7874  ....    def next
-00012790: 5f66 6974 2873 656c 6629 3a0d 0a20 2020  _fit(self):..   
-000127a0: 2020 2020 2023 206f 7074 696f 6e20 746f       # option to
-000127b0: 2070 7269 6e74 2061 2067 7261 7068 206f   print a graph o
-000127c0: 6620 6561 6368 2077 6869 6c65 2067 6f69  f each while goi
-000127d0: 6e67 2028 7275 6e20 6167 6169 6e20 756e  ng (run again un
-000127e0: 7469 6c20 796f 7520 7365 6520 6f6e 6520  til you see one 
-000127f0: 796f 7520 6c69 6b65 290d 0a20 2020 2020  you like)..     
-00012800: 2020 2023 2061 7070 656e 6420 746f 2061     # append to a
-00012810: 6e20 696e 7465 726e 616c 2072 6563 6f72  n internal recor
-00012820: 642c 2070 7269 6e74 206e 6577 2070 6172  d, print new par
-00012830: 616d 730d 0a20 2020 2020 2020 2023 2070  ams..        # p
-00012840: 6c6f 743a 2033 2073 7461 636b 6564 2c20  lot: 3 stacked, 
-00012850: 696e 2073 616d 706c 652c 2074 6865 6e20  in sample, then 
-00012860: 6561 6368 2076 616c 6964 6174 696f 6e0d  each validation.
-00012870: 0a20 2020 2020 2020 2023 206d 6179 6265  .        # maybe
-00012880: 2075 7365 2067 656e 6574 6963 206f 7074   use genetic opt
-00012890: 696d 697a 6174 696f 6e20 6966 2074 6869  imization if thi
-000128a0: 7320 7573 6564 2061 6674 6572 2061 7574  s used after aut
-000128b0: 6f5f 6669 740d 0a20 2020 2020 2020 2072  o_fit..        r
-000128c0: 6574 7572 6e20 4e6f 7449 6d70 6c65 6d65  eturn NotImpleme
-000128d0: 6e74 6564 0d0a 0d0a 2020 2020 6465 6620  nted....    def 
-000128e0: 6372 6f73 735f 7661 6c69 6461 7465 2873  cross_validate(s
-000128f0: 656c 662c 2064 662c 2076 616c 6964 6174  elf, df, validat
-00012900: 696f 6e5f 6d65 7468 6f64 293a 0d0a 2020  ion_method):..  
-00012910: 2020 2020 2020 2320 7275 6e20 6f6e 6520        # run one 
-00012920: 6d6f 6465 6c20 616e 6420 7265 7475 726e  model and return
-00012930: 2073 636f 7265 730d 0a20 2020 2020 2020   scores..       
-00012940: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
-00012950: 6d65 6e74 6564 0d0a 0d0a 2020 2020 6465  mented....    de
-00012960: 6620 7472 6561 746d 656e 745f 6361 7573  f treatment_caus
-00012970: 616c 5f69 6d70 6163 7428 0d0a 2020 2020  al_impact(..    
-00012980: 2020 2020 7365 6c66 2c20 6466 2c20 696e      self, df, in
-00012990: 7465 7276 656e 7469 6f6e 5f64 6174 6573  tervention_dates
-000129a0: 0d0a 2020 2020 293a 2020 2320 616c 736f  ..    ):  # also
-000129b0: 2061 6464 2072 6567 7265 7373 6f72 2069   add regressor i
-000129c0: 6e70 7574 0d0a 2020 2020 2020 2020 2320  nput..        # 
-000129d0: 7265 6772 6573 736f 7273 2069 6d70 6f72  regressors impor
-000129e0: 7461 6e74 2c20 6573 7469 6d61 7469 6f6e  tant, estimation
-000129f0: 2062 7920 6c69 6e65 6172 2066 6c61 6720   by linear flag 
-00012a00: 2872 6574 7572 6e20 7374 6174 7329 206f  (return stats) o
-00012a10: 7220 6279 2025 2076 7320 666f 7265 6361  r by % vs foreca
-00012a20: 7374 2066 726f 6d20 6375 746f 6666 0d0a  st from cutoff..
-00012a30: 2020 2020 2020 2020 2320 7374 6172 7420          # start 
-00012a40: 616e 6420 656e 6420 6461 7465 732c 206d  and end dates, m
-00012a50: 756c 7469 706c 6520 7472 6561 746d 656e  ultiple treatmen
-00012a60: 7473 2c20 7661 7279 2062 7920 7365 7269  ts, vary by seri
-00012a70: 6573 0d0a 2020 2020 2020 2020 2320 6f72  es..        # or
-00012a80: 206d 6179 6265 2069 6e73 7465 6164 2c20   maybe instead, 
-00012a90: 6a75 7374 2072 6574 7572 6e20 7468 6520  just return the 
-00012aa0: 7374 6174 7320 666f 7220 616c 6c20 696e  stats for all in
-00012ab0: 7075 7420 7265 6772 6573 736f 7273 0d0a  put regressors..
-00012ac0: 2020 2020 2020 2020 2320 7374 696c 6c20          # still 
-00012ad0: 776f 726b 696e 6720 6f6e 2074 6869 732c  working on this,
-00012ae0: 2070 6f73 7369 626c 7920 6a75 7374 2068   possibly just h
-00012af0: 7474 7073 3a2f 2f6d 6174 682e 7374 6163  ttps://math.stac
-00012b00: 6b65 7863 6861 6e67 652e 636f 6d2f 7175  kexchange.com/qu
-00012b10: 6573 7469 6f6e 732f 3231 3132 3535 332f  estions/2112553/
-00012b20: 7374 6174 6973 7469 6361 6c2d 7369 676e  statistical-sign
-00012b30: 6966 6963 616e 6365 2d6f 662d 6c69 6e65  ificance-of-line
-00012b40: 6172 2d6c 6561 7374 2d73 7175 6172 6573  ar-least-squares
-00012b50: 0d0a 2020 2020 2020 2020 2320 616e 6420  ..        # and 
-00012b60: 6f74 6865 7220 6665 6174 7572 6573 2061  other features a
-00012b70: 6c61 2053 7461 7473 6d6f 6465 6c73 204f  la Statsmodels O
-00012b80: 4c53 2c20 5661 7228 ceb2 5e29 3dcf 8332  LS, Var(..^)=..2
-00012b90: 2858 e280 b258 29e2 8892 3120 7768 6572  (X...X)...1 wher
-00012ba0: 6520 cf83 323e 3020 6973 2074 6865 2063  e ..2>0 is the c
-00012bb0: 6f6d 6d6f 6e20 7661 7269 616e 6365 206f  ommon variance o
-00012bc0: 6620 6561 6368 2065 6c65 6d65 6e74 206f  f each element o
-00012bd0: 6620 7468 6520 6572 726f 7220 7665 6374  f the error vect
-00012be0: 6f72 0d0a 2020 2020 2020 2020 7265 7475  or..        retu
-00012bf0: 726e 204e 6f74 496d 706c 656d 656e 7465  rn NotImplemente
-00012c00: 640d 0a0d 0a20 2020 2064 6566 2070 7265  d....    def pre
-00012c10: 6469 6374 5f6e 6577 5f70 726f 6475 6374  dict_new_product
-00012c20: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00012c30: 2023 2062 6f72 726f 7720 7468 6520 6c69   # borrow the li
-00012c40: 6e65 6172 2063 6f6d 706f 6e65 6e74 7320  near components 
-00012c50: 6672 6f6d 2061 2072 656c 6174 6564 2070  from a related p
-00012c60: 726f 6475 6374 2028 6f72 2061 7667 2f6d  roduct (or avg/m
-00012c70: 6f64 6520 6966 206e 6f74 2067 6976 656e  ode if not given
-00012c80: 290d 0a20 2020 2020 2020 2023 2068 6176  )..        # hav
-00012c90: 6520 7468 6520 7472 656e 6420 7374 6172  e the trend star
-00012ca0: 7420 6174 207a 6572 6f20 7468 656e 2075  t at zero then u
-00012cb0: 702c 206c 696b 6520 7265 7665 7273 6520  p, like reverse 
-00012cc0: 7068 690d 0a20 2020 2020 2020 2023 2070  phi..        # p
-00012cd0: 6f73 7369 626c 7920 626f 7272 6f77 2077  ossibly borrow w
-00012ce0: 6172 6d75 7020 6672 6f6d 2061 6e79 2073  armup from any s
-00012cf0: 6572 6965 7320 7468 6174 2068 6176 6520  eries that have 
-00012d00: 6120 6c6f 6769 7374 6963 2d6c 696b 6520  a logistic-like 
-00012d10: 7472 656e 640d 0a20 2020 2020 2020 2023  trend..        #
-00012d20: 2063 6c75 7374 6572 2061 6e64 2063 686f   cluster and cho
-00012d30: 6f73 6520 7468 6520 6269 6767 6573 7420  ose the biggest 
-00012d40: 636c 7573 7465 7220 2861 7320 6176 6720  cluster (as avg 
-00012d50: 7661 6c75 6520 6e61 6976 6520 6d65 7468  value naive meth
-00012d60: 6f64 2c20 6d61 7962 6520 726f 756e 6420  od, maybe round 
-00012d70: 6f72 2066 696c 7465 7220 6669 7273 7429  or filter first)
-00012d80: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00012d90: 204e 6f74 496d 706c 656d 656e 7465 640d   NotImplemented.
-00012da0: 0a0d 0a20 2020 2064 6566 2066 6561 7475  ...    def featu
-00012db0: 7265 5f69 6d70 6f72 7461 6e63 6528 7365  re_importance(se
-00012dc0: 6c66 293a 0d0a 2020 2020 2020 2020 2320  lf):..        # 
-00012dd0: 7261 6e6b 2063 6f65 6666 6963 6965 6e74  rank coefficient
-00012de0: 7320 6279 2069 6d70 6f72 7461 6e63 650d  s by importance.
-00012df0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00012e00: 4e6f 7449 6d70 6c65 6d65 6e74 6564 0d0a  NotImplemented..
-00012e10: 0d0a 2020 2020 6465 6620 636f 6d70 6172  ..    def compar
-00012e20: 655f 6163 7475 616c 5f63 6f6d 706f 6e65  e_actual_compone
-00012e30: 6e74 7328 7365 6c66 293a 0d0a 2020 2020  nts(self):..    
-00012e40: 2020 2020 7265 7475 726e 204e 6f74 496d      return NotIm
-00012e50: 706c 656d 656e 7465 640d 0a0d 0a20 2020  plemented....   
-00012e60: 2064 6566 2067 6574 5f6e 6577 5f70 6172   def get_new_par
-00012e70: 616d 7328 7365 6c66 2c20 6d65 7468 6f64  ams(self, method
-00012e80: 3d27 6661 7374 2729 3a0d 0a20 2020 2020  ='fast'):..     
-00012e90: 2020 2023 2068 6176 6520 6661 7374 206f     # have fast o
-00012ea0: 7074 696f 6e20 7468 6174 2061 766f 6964  ption that avoid
-00012eb0: 7320 616e 7920 6f66 2074 6865 206c 6f6f  s any of the loo
-00012ec0: 7020 6170 7072 6f61 6368 6573 0d0a 2020  p approaches..  
-00012ed0: 2020 2020 2020 7363 616c 696e 6720 3d20        scaling = 
-00012ee0: 7261 6e64 6f6d 2e63 686f 6963 6573 285b  random.choices([
-00012ef0: 2742 6173 6553 6361 6c65 7227 2c20 276f  'BaseScaler', 'o
-00012f00: 7468 6572 275d 2c20 5b30 2e38 2c20 302e  ther'], [0.8, 0.
-00012f10: 325d 295b 305d 0d0a 2020 2020 2020 2020  2])[0]..        
-00012f20: 6966 2073 6361 6c69 6e67 203d 3d20 226f  if scaling == "o
-00012f30: 7468 6572 223a 0d0a 2020 2020 2020 2020  ther":..        
-00012f40: 2020 2020 7363 616c 696e 6720 3d20 5261      scaling = Ra
-00012f50: 6e64 6f6d 5472 616e 7366 6f72 6d28 0d0a  ndomTransform(..
-00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f70: 7472 616e 7366 6f72 6d65 725f 6c69 7374  transformer_list
-00012f80: 3d73 6361 6c65 7273 2c0d 0a20 2020 2020  =scalers,..     
-00012f90: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-00012fa0: 666f 726d 6572 5f6d 6178 5f64 6570 7468  former_max_depth
-00012fb0: 3d31 2c0d 0a20 2020 2020 2020 2020 2020  =1,..           
-00012fc0: 2020 2020 2061 6c6c 6f77 5f6e 6f6e 653d       allow_none=
-00012fd0: 4661 6c73 652c 0d0a 2020 2020 2020 2020  False,..        
-00012fe0: 2020 2020 2020 2020 6e6f 5f6e 616e 5f66          no_nan_f
-00012ff0: 696c 6c3d 5472 7565 2c0d 0a20 2020 2020  ill=True,..     
-00013000: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00013010: 2020 686f 6c69 6461 795f 7061 7261 6d73    holiday_params
-00013020: 203d 2072 616e 646f 6d2e 6368 6f69 6365   = random.choice
-00013030: 7328 5b4e 6f6e 652c 2027 616e 7927 5d2c  s([None, 'any'],
-00013040: 205b 302e 352c 2030 2e35 5d29 5b30 5d0d   [0.5, 0.5])[0].
-00013050: 0a20 2020 2020 2020 2023 2068 6f6c 6964  .        # holid
-00013060: 6179 5f69 6e74 6572 7665 6e74 696f 6e20  ay_intervention 
-00013070: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-00013080: 6966 2068 6f6c 6964 6179 5f70 6172 616d  if holiday_param
-00013090: 7320 6973 206e 6f74 204e 6f6e 653a 0d0a  s is not None:..
-000130a0: 2020 2020 2020 2020 2020 2020 2320 686f              # ho
-000130b0: 6c69 6461 795f 696e 7465 7276 656e 7469  liday_interventi
-000130c0: 6f6e 203d 2072 616e 646f 6d2e 6368 6f69  on = random.choi
-000130d0: 6365 285b 2763 7265 6174 655f 6665 6174  ce(['create_feat
-000130e0: 7572 6527 2c20 2775 7365 5f69 6d70 6163  ure', 'use_impac
-000130f0: 7427 5d29 0d0a 2020 2020 2020 2020 2020  t'])..          
-00013100: 2020 686f 6c69 6461 795f 7061 7261 6d73    holiday_params
-00013110: 203d 2048 6f6c 6964 6179 5472 616e 7366   = HolidayTransf
-00013120: 6f72 6d65 722e 6765 745f 6e65 775f 7061  ormer.get_new_pa
-00013130: 7261 6d73 286d 6574 686f 643d 6d65 7468  rams(method=meth
-00013140: 6f64 290d 0a20 2020 2020 2020 2020 2020  od)..           
-00013150: 2068 6f6c 6964 6179 5f70 6172 616d 735b   holiday_params[
-00013160: 2769 6d70 6163 7427 5d20 3d20 4e6f 6e65  'impact'] = None
-00013170: 0d0a 2020 2020 2020 2020 2020 2020 686f  ..            ho
-00013180: 6c69 6461 795f 7061 7261 6d73 5b27 7265  liday_params['re
-00013190: 6772 6573 7369 6f6e 5f70 6172 616d 7327  gression_params'
-000131a0: 5d20 3d20 4e6f 6e65 0d0a 2020 2020 2020  ] = None..      
-000131b0: 2020 2020 2020 686f 6c69 6461 795f 7061        holiday_pa
-000131c0: 7261 6d73 5b27 7265 6d6f 7665 5f65 7863  rams['remove_exc
-000131d0: 6573 735f 616e 6f6d 616c 6965 7327 5d20  ess_anomalies'] 
-000131e0: 3d20 7261 6e64 6f6d 2e63 686f 6963 6573  = random.choices
-000131f0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00013200: 2020 205b 5472 7565 2c20 4661 6c73 655d     [True, False]
-00013210: 2c20 5b30 2e30 352c 2030 2e39 355d 0d0a  , [0.05, 0.95]..
-00013220: 2020 2020 2020 2020 2020 2020 295b 305d              )[0]
-00013230: 0d0a 2020 2020 2020 2020 2020 2020 686f  ..            ho
-00013240: 6c69 6461 795f 7061 7261 6d73 5b27 6f75  liday_params['ou
-00013250: 7470 7574 275d 203d 2072 616e 646f 6d2e  tput'] = random.
-00013260: 6368 6f69 6365 7328 0d0a 2020 2020 2020  choices(..      
-00013270: 2020 2020 2020 2020 2020 5b27 6d75 6c74            ['mult
-00013280: 6976 6172 6961 7465 272c 2027 756e 6976  ivariate', 'univ
-00013290: 6172 6961 7465 275d 2c20 5b30 2e39 2c20  ariate'], [0.9, 
-000132a0: 302e 315d 0d0a 2020 2020 2020 2020 2020  0.1]..          
-000132b0: 2020 295b 305d 0d0a 2020 2020 2020 2020    )[0]..        
-000132c0: 616e 6f6d 616c 795f 696e 7465 7276 656e  anomaly_interven
-000132d0: 7469 6f6e 203d 2072 616e 646f 6d2e 6368  tion = random.ch
-000132e0: 6f69 6365 7328 0d0a 2020 2020 2020 2020  oices(..        
-000132f0: 2020 2020 5b4e 6f6e 652c 2027 7265 6d6f      [None, 'remo
-00013300: 7665 272c 2027 6465 7465 6374 5f6f 6e6c  ve', 'detect_onl
-00013310: 7927 2c20 276d 6f64 656c 275d 2c20 5b30  y', 'model'], [0
-00013320: 2e39 2c20 302e 332c 2030 2e30 352c 2030  .9, 0.3, 0.05, 0
-00013330: 2e30 355d 0d0a 2020 2020 2020 2020 295b  .05]..        )[
-00013340: 305d 0d0a 2020 2020 2020 2020 6966 2061  0]..        if a
-00013350: 6e6f 6d61 6c79 5f69 6e74 6572 7665 6e74  nomaly_intervent
-00013360: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
-00013370: 0d0a 2020 2020 2020 2020 2020 2020 616e  ..            an
-00013380: 6f6d 616c 795f 6465 7465 6374 6f72 5f70  omaly_detector_p
-00013390: 6172 616d 7320 3d20 416e 6f6d 616c 7952  arams = AnomalyR
-000133a0: 656d 6f76 616c 2e67 6574 5f6e 6577 5f70  emoval.get_new_p
-000133b0: 6172 616d 7328 6d65 7468 6f64 3d6d 6574  arams(method=met
-000133c0: 686f 6429 0d0a 2020 2020 2020 2020 2020  hod)..          
-000133d0: 2020 6966 2061 6e6f 6d61 6c79 5f69 6e74    if anomaly_int
-000133e0: 6572 7665 6e74 696f 6e20 3d3d 2022 6d6f  ervention == "mo
-000133f0: 6465 6c22 3a0d 0a20 2020 2020 2020 2020  del":..         
-00013400: 2020 2020 2020 2061 6e6f 6d61 6c79 5f69         anomaly_i
-00013410: 6e74 6572 7665 6e74 696f 6e20 3d20 6765  ntervention = ge
-00013420: 6e65 7261 6c5f 7465 6d70 6c61 7465 2e73  neral_template.s
-00013430: 616d 706c 6528 3129 2e74 6f5f 6469 6374  ample(1).to_dict
-00013440: 2822 7265 636f 7264 7322 295b 0d0a 2020  ("records")[..  
-00013450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013460: 2020 300d 0a20 2020 2020 2020 2020 2020    0..           
-00013470: 2020 2020 205d 2020 2320 706c 6163 6568       ]  # placeh
-00013480: 6f6c 6465 722c 2070 726f 6261 626c 790d  older, probably.
-00013490: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-000134a0: 2020 2020 2020 2020 2020 2020 616e 6f6d              anom
-000134b0: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
-000134c0: 616d 7320 3d20 4e6f 6e65 0d0a 0d0a 2020  ams = None....  
-000134d0: 2020 2020 2020 2320 7261 6e64 6f6d 206f        # random o
-000134e0: 7220 7072 6574 6573 7465 6420 6465 6661  r pretested defa
-000134f0: 756c 7473 0d0a 2020 2020 2020 2020 7472  ults..        tr
-00013500: 656e 645f 6261 7365 203d 2072 616e 646f  end_base = rando
-00013510: 6d2e 6368 6f69 6365 7328 0d0a 2020 2020  m.choices(..    
-00013520: 2020 2020 2020 2020 5b27 7062 3127 2c20          ['pb1', 
-00013530: 2770 6232 272c 2027 7062 3327 2c20 2772  'pb2', 'pb3', 'r
-00013540: 616e 646f 6d27 5d2c 205b 302e 312c 2030  andom'], [0.1, 0
-00013550: 2e31 2c20 302e 302c 2030 2e38 5d0d 0a20  .1, 0.0, 0.8].. 
-00013560: 2020 2020 2020 2029 5b30 5d0d 0a20 2020         )[0]..   
-00013570: 2020 2020 2069 6620 7472 656e 645f 6261       if trend_ba
-00013580: 7365 203d 3d20 2272 616e 646f 6d22 3a0d  se == "random":.
-00013590: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-000135a0: 656c 5f73 7472 203d 2072 616e 646f 6d2e  el_str = random.
-000135b0: 6368 6f69 6365 7328 0d0a 2020 2020 2020  choices(..      
-000135c0: 2020 2020 2020 2020 2020 5b0d 0a20 2020            [..   
-000135d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135e0: 2027 4176 6572 6167 6556 616c 7565 4e61   'AverageValueNa
-000135f0: 6976 6527 2c0d 0a20 2020 2020 2020 2020  ive',..         
-00013600: 2020 2020 2020 2020 2020 2027 4d65 7472             'Metr
-00013610: 6963 4d6f 7469 6627 2c0d 0a20 2020 2020  icMotif',..     
-00013620: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00013630: 4c61 7374 5661 6c75 654e 6169 7665 222c  LastValueNaive",
-00013640: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013650: 2020 2020 2020 2753 6561 736f 6e61 6c69        'Seasonali
-00013660: 7479 4d6f 7469 6627 2c0d 0a20 2020 2020  tyMotif',..     
-00013670: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00013680: 5769 6e64 6f77 5265 6772 6573 7369 6f6e  WindowRegression
-00013690: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-000136a0: 2020 2020 2020 2020 2741 5244 4c27 2c0d          'ARDL',.
-000136b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000136c0: 2020 2020 2027 5641 5227 2c0d 0a20 2020       'VAR',..   
-000136d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136e0: 2027 556e 6976 6172 6961 7465 4d6f 7469   'UnivariateMoti
-000136f0: 6627 2c0d 0a20 2020 2020 2020 2020 2020  f',..           
-00013700: 2020 2020 2020 2020 2027 556e 6f62 7365           'Unobse
-00013710: 7276 6564 436f 6d70 6f6e 656e 7473 272c  rvedComponents',
+000103e0: 2020 2020 2020 2068 6973 746f 7279 5f64         history_d
+000103f0: 663d 6466 2c0d 0a20 2020 2020 2020 2020  f=df,..         
+00010400: 2020 2020 2020 2020 2020 2066 7574 7572             futur
+00010410: 655f 7265 6772 6573 736f 723d 6675 6c6c  e_regressor=full
+00010420: 5f72 6567 722c 0d0a 2020 2020 2020 2020  _regr,..        
+00010430: 2020 2020 2020 2020 2020 2020 666c 6167              flag
+00010440: 5f72 6567 7265 7373 6f72 733d 616c 6c5f  _regressors=all_
+00010450: 666c 6167 732c 0d0a 2020 2020 2020 2020  flags,..        
+00010460: 2020 2020 2020 2020 2020 2020 696d 7061              impa
+00010470: 6374 733d 696d 7061 6374 732c 0d0a 2020  cts=impacts,..  
+00010480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010490: 2020 7265 6772 6573 736f 725f 7065 725f    regressor_per_
+000104a0: 7365 7269 6573 3d72 6567 725f 7073 5f66  series=regr_ps_f
+000104b0: 6f72 652c 0d0a 2020 2020 2020 2020 2020  ore,..          
+000104c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000104d0: 2020 2020 2020 2020 2064 6620 3d20 7064           df = pd
+000104e0: 2e63 6f6e 6361 7428 5b64 662c 2064 665f  .concat([df, df_
+000104f0: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
+00010500: 742e 696c 6f63 5b2d 313a 5d5d 290d 0a20  t.iloc[-1:]]).. 
+00010510: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00010520: 7420 696e 636c 7564 655f 6869 7374 6f72  t include_histor
+00010530: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00010540: 2020 2020 6466 5f66 6f72 6563 6173 742e      df_forecast.
+00010550: 666f 7265 6361 7374 203d 2064 665f 666f  forecast = df_fo
+00010560: 7265 6361 7374 2e66 6f72 6563 6173 742e  recast.forecast.
+00010570: 7461 696c 2866 6f72 6563 6173 745f 6c65  tail(forecast_le
+00010580: 6e67 7468 290d 0a20 2020 2020 2020 2020  ngth)..         
+00010590: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
+000105a0: 7374 2e6c 6f77 6572 5f66 6f72 6563 6173  st.lower_forecas
+000105b0: 7420 3d20 6466 5f66 6f72 6563 6173 742e  t = df_forecast.
+000105c0: 6c6f 7765 725f 666f 7265 6361 7374 2e74  lower_forecast.t
+000105d0: 6169 6c28 0d0a 2020 2020 2020 2020 2020  ail(..          
+000105e0: 2020 2020 2020 2020 2020 666f 7265 6361            foreca
+000105f0: 7374 5f6c 656e 6774 680d 0a20 2020 2020  st_length..     
+00010600: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00010610: 2020 2020 2020 2020 2020 2020 2020 6466                df
+00010620: 5f66 6f72 6563 6173 742e 7570 7065 725f  _forecast.upper_
+00010630: 666f 7265 6361 7374 203d 2064 665f 666f  forecast = df_fo
+00010640: 7265 6361 7374 2e75 7070 6572 5f66 6f72  recast.upper_for
+00010650: 6563 6173 742e 7461 696c 280d 0a20 2020  ecast.tail(..   
+00010660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010670: 2066 6f72 6563 6173 745f 6c65 6e67 7468   forecast_length
+00010680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00010690: 2020 290d 0a20 2020 2020 2020 2065 6c73    )..        els
+000106a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000106b0: 666f 7265 6361 7374 5f69 6e64 6578 203d  forecast_index =
+000106c0: 2073 656c 662e 6372 6561 7465 5f66 6f72   self.create_for
+000106d0: 6563 6173 745f 696e 6465 7828 0d0a 2020  ecast_index(..  
+000106e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000106f0: 7265 6361 7374 5f6c 656e 6774 682c 206c  recast_length, l
+00010700: 6173 745f 6461 7465 3d64 662e 696e 6465  ast_date=df.inde
+00010710: 785b 2d31 5d0d 0a20 2020 2020 2020 2020  x[-1]..         
+00010720: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00010730: 2020 6966 2069 6e63 6c75 6465 5f68 6973    if include_his
+00010740: 746f 7279 3a0d 0a20 2020 2020 2020 2020  tory:..         
+00010750: 2020 2020 2020 2066 6f72 6563 6173 745f         forecast_
+00010760: 696e 6465 7820 3d20 6466 2e69 6e64 6578  index = df.index
+00010770: 2e75 6e69 6f6e 2866 6f72 6563 6173 745f  .union(forecast_
+00010780: 696e 6465 7829 0d0a 2020 2020 2020 2020  index)..        
+00010790: 2020 2020 6466 5f66 6f72 6563 6173 7420      df_forecast 
+000107a0: 3d20 7365 6c66 2e5f 7072 6564 6963 745f  = self._predict_
+000107b0: 7374 6570 280d 0a20 2020 2020 2020 2020  step(..         
+000107c0: 2020 2020 2020 2064 6174 6573 3d66 6f72         dates=for
+000107d0: 6563 6173 745f 696e 6465 782c 0d0a 2020  ecast_index,..  
+000107e0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000107f0: 656e 645f 636f 6d70 6f6e 656e 743d 7472  end_component=tr
+00010800: 656e 645f 666f 7265 6361 7374 2c0d 0a20  end_forecast,.. 
+00010810: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00010820: 6973 746f 7279 5f64 663d 6466 2c0d 0a20  istory_df=df,.. 
+00010830: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010840: 7574 7572 655f 7265 6772 6573 736f 723d  uture_regressor=
+00010850: 6675 6c6c 5f72 6567 722c 0d0a 2020 2020  full_regr,..    
+00010860: 2020 2020 2020 2020 2020 2020 666c 6167              flag
+00010870: 5f72 6567 7265 7373 6f72 733d 616c 6c5f  _regressors=all_
+00010880: 666c 6167 732c 0d0a 2020 2020 2020 2020  flags,..        
+00010890: 2020 2020 2020 2020 696d 7061 6374 733d          impacts=
+000108a0: 696d 7061 6374 732c 0d0a 2020 2020 2020  impacts,..      
+000108b0: 2020 2020 2020 2020 2020 7265 6772 6573            regres
+000108c0: 736f 725f 7065 725f 7365 7269 6573 3d72  sor_per_series=r
+000108d0: 6567 725f 7073 5f66 6f72 652c 0d0a 2020  egr_ps_fore,..  
+000108e0: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
+000108f0: 2020 2020 2020 2023 2073 6176 6520 6675         # save fu
+00010900: 7475 7265 2069 6e64 6578 2062 6566 6f72  ture index befor
+00010910: 6520 696e 636c 7564 655f 6869 7374 6f72  e include_histor
+00010920: 7920 6973 2061 6464 6564 0d0a 2020 2020  y is added..    
+00010930: 2020 2020 6966 2066 7574 7572 655f 696d      if future_im
+00010940: 7061 6374 7320 6973 206e 6f74 204e 6f6e  pacts is not Non
+00010950: 6520 616e 6420 666f 7265 6361 7374 5f6c  e and forecast_l
+00010960: 656e 6774 6820 6973 206e 6f74 204e 6f6e  ength is not Non
+00010970: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00010980: 6675 7475 7265 5f69 6d70 6163 7473 203d  future_impacts =
+00010990: 2066 7574 7572 655f 696d 7061 6374 732e   future_impacts.
+000109a0: 7265 696e 6465 7828 0d0a 2020 2020 2020  reindex(..      
+000109b0: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+000109c0: 733d 6466 5f66 6f72 6563 6173 742e 666f  s=df_forecast.fo
+000109d0: 7265 6361 7374 2e63 6f6c 756d 6e73 2c0d  recast.columns,.
+000109e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000109f0: 2069 6e64 6578 3d73 656c 662e 666f 7265   index=self.fore
+00010a00: 6361 7374 5f69 6e64 6578 2c0d 0a20 2020  cast_index,..   
+00010a10: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00010a20: 6c5f 7661 6c75 653d 302c 0d0a 2020 2020  l_value=0,..    
+00010a30: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00010a40: 2020 2023 2075 6e64 6f20 7072 6570 726f     # undo prepro
+00010a50: 6365 7373 696e 6720 616e 6420 7363 616c  cessing and scal
+00010a60: 696e 670d 0a20 2020 2020 2020 2023 2061  ing..        # a
+00010a70: 6363 6f75 6e74 2066 6f72 2073 6f6d 6520  ccount for some 
+00010a80: 7472 616e 7366 6f72 6d65 7273 2072 6571  transformers req
+00010a90: 7569 7269 6e67 2064 6966 6665 7265 6e74  uiring different
+00010aa0: 206d 6574 686f 6473 206f 6e20 6f72 6967   methods on orig
+00010ab0: 696e 616c 2064 6174 6120 616e 6420 666f  inal data and fo
+00010ac0: 7265 6361 7374 0d0a 2020 2020 2020 2020  recast..        
+00010ad0: 6966 2066 6f72 6563 6173 745f 6c65 6e67  if forecast_leng
+00010ae0: 7468 2069 7320 4e6f 6e65 3a0d 0a20 2020  th is None:..   
+00010af0: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
+00010b00: 6361 7374 2e66 6f72 6563 6173 7420 3d20  cast.forecast = 
+00010b10: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
+00010b20: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
+00010b30: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
+00010b40: 7374 2e66 6f72 6563 6173 742c 2074 7261  st.forecast, tra
+00010b50: 6e73 5f6d 6574 686f 643d 276f 7269 6769  ns_method='origi
+00010b60: 6e61 6c27 0d0a 2020 2020 2020 2020 2020  nal'..          
+00010b70: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00010b80: 2064 665f 666f 7265 6361 7374 2e6c 6f77   df_forecast.low
+00010b90: 6572 5f66 6f72 6563 6173 7420 3d20 7365  er_forecast = se
+00010ba0: 6c66 2e74 6f5f 6f72 6967 696e 5f73 7061  lf.to_origin_spa
+00010bb0: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+00010bc0: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
+00010bd0: 2e6c 6f77 6572 5f66 6f72 6563 6173 742c  .lower_forecast,
+00010be0: 2074 7261 6e73 5f6d 6574 686f 643d 276f   trans_method='o
+00010bf0: 7269 6769 6e61 6c27 0d0a 2020 2020 2020  riginal'..      
+00010c00: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00010c10: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
+00010c20: 2e75 7070 6572 5f66 6f72 6563 6173 7420  .upper_forecast 
+00010c30: 3d20 7365 6c66 2e74 6f5f 6f72 6967 696e  = self.to_origin
+00010c40: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
+00010c50: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
+00010c60: 6361 7374 2e75 7070 6572 5f66 6f72 6563  cast.upper_forec
+00010c70: 6173 742c 2074 7261 6e73 5f6d 6574 686f  ast, trans_metho
+00010c80: 643d 276f 7269 6769 6e61 6c27 0d0a 2020  d='original'..  
+00010c90: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00010ca0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00010cb0: 6564 6963 7465 645f 7472 656e 6420 3d20  edicted_trend = 
+00010cc0: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
+00010cd0: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
+00010ce0: 2020 2020 2020 2074 7265 6e64 5f66 6f72         trend_for
+00010cf0: 6563 6173 742e 666f 7265 6361 7374 2c20  ecast.forecast, 
+00010d00: 7472 616e 735f 6d65 7468 6f64 3d27 6f72  trans_method='or
+00010d10: 6967 696e 616c 270d 0a20 2020 2020 2020  iginal'..       
+00010d20: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00010d30: 656c 6966 206e 6f74 2069 6e63 6c75 6465  elif not include
+00010d40: 5f68 6973 746f 7279 3a0d 0a20 2020 2020  _history:..     
+00010d50: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
+00010d60: 7374 2e66 6f72 6563 6173 7420 3d20 7365  st.forecast = se
+00010d70: 6c66 2e74 6f5f 6f72 6967 696e 5f73 7061  lf.to_origin_spa
+00010d80: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+00010d90: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
+00010da0: 2e66 6f72 6563 6173 742c 2074 7261 6e73  .forecast, trans
+00010db0: 5f6d 6574 686f 643d 2766 6f72 6563 6173  _method='forecas
+00010dc0: 7427 0d0a 2020 2020 2020 2020 2020 2020  t'..            
+00010dd0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+00010de0: 665f 666f 7265 6361 7374 2e6c 6f77 6572  f_forecast.lower
+00010df0: 5f66 6f72 6563 6173 7420 3d20 7365 6c66  _forecast = self
+00010e00: 2e74 6f5f 6f72 6967 696e 5f73 7061 6365  .to_origin_space
+00010e10: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00010e20: 2020 2064 665f 666f 7265 6361 7374 2e6c     df_forecast.l
+00010e30: 6f77 6572 5f66 6f72 6563 6173 742c 2074  ower_forecast, t
+00010e40: 7261 6e73 5f6d 6574 686f 643d 2766 6f72  rans_method='for
+00010e50: 6563 6173 7427 0d0a 2020 2020 2020 2020  ecast'..        
+00010e60: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00010e70: 2020 2064 665f 666f 7265 6361 7374 2e75     df_forecast.u
+00010e80: 7070 6572 5f66 6f72 6563 6173 7420 3d20  pper_forecast = 
+00010e90: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
+00010ea0: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
+00010eb0: 2020 2020 2020 2064 665f 666f 7265 6361         df_foreca
+00010ec0: 7374 2e75 7070 6572 5f66 6f72 6563 6173  st.upper_forecas
+00010ed0: 742c 2074 7261 6e73 5f6d 6574 686f 643d  t, trans_method=
+00010ee0: 2766 6f72 6563 6173 7427 0d0a 2020 2020  'forecast'..    
+00010ef0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00010f00: 2020 2020 2020 2073 656c 662e 7072 6564         self.pred
+00010f10: 6963 7465 645f 7472 656e 6420 3d20 7365  icted_trend = se
+00010f20: 6c66 2e74 6f5f 6f72 6967 696e 5f73 7061  lf.to_origin_spa
+00010f30: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+00010f40: 2020 2020 2074 7265 6e64 5f66 6f72 6563       trend_forec
+00010f50: 6173 742e 666f 7265 6361 7374 2c20 7472  ast.forecast, tr
+00010f60: 616e 735f 6d65 7468 6f64 3d27 666f 7265  ans_method='fore
+00010f70: 6361 7374 270d 0a20 2020 2020 2020 2020  cast'..         
+00010f80: 2020 2029 0d0a 2020 2020 2020 2020 656c     )..        el
+00010f90: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00010fa0: 2068 646e 203d 206c 656e 2864 665f 666f   hdn = len(df_fo
+00010fb0: 7265 6361 7374 2e66 6f72 6563 6173 7429  recast.forecast)
+00010fc0: 202d 2066 6f72 6563 6173 745f 6c65 6e67   - forecast_leng
+00010fd0: 7468 0d0a 2020 2020 2020 2020 2020 2020  th..            
+00010fe0: 6466 5f66 6f72 6563 6173 742e 666f 7265  df_forecast.fore
+00010ff0: 6361 7374 203d 2070 642e 636f 6e63 6174  cast = pd.concat
+00011000: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00011010: 2020 205b 0d0a 2020 2020 2020 2020 2020     [..          
+00011020: 2020 2020 2020 2020 2020 7365 6c66 2e74            self.t
+00011030: 6f5f 6f72 6967 696e 5f73 7061 6365 280d  o_origin_space(.
+00011040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011050: 2020 2020 2020 2020 2064 665f 666f 7265           df_fore
+00011060: 6361 7374 2e66 6f72 6563 6173 742e 6865  cast.forecast.he
+00011070: 6164 2868 646e 292c 2074 7261 6e73 5f6d  ad(hdn), trans_m
+00011080: 6574 686f 643d 276f 7269 6769 6e61 6c27  ethod='original'
+00011090: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000110a0: 2020 2020 2020 292c 0d0a 2020 2020 2020        ),..      
+000110b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000110c0: 6c66 2e74 6f5f 6f72 6967 696e 5f73 7061  lf.to_origin_spa
+000110d0: 6365 280d 0a20 2020 2020 2020 2020 2020  ce(..           
+000110e0: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+000110f0: 666f 7265 6361 7374 2e66 6f72 6563 6173  forecast.forecas
+00011100: 742e 7461 696c 2866 6f72 6563 6173 745f  t.tail(forecast_
+00011110: 6c65 6e67 7468 292c 0d0a 2020 2020 2020  length),..      
+00011120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011130: 2020 7472 616e 735f 6d65 7468 6f64 3d27    trans_method='
+00011140: 666f 7265 6361 7374 272c 0d0a 2020 2020  forecast',..    
+00011150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011160: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+00011170: 2020 2020 5d0d 0a20 2020 2020 2020 2020      ]..         
+00011180: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
+00011190: 2020 6466 5f66 6f72 6563 6173 742e 6c6f    df_forecast.lo
+000111a0: 7765 725f 666f 7265 6361 7374 203d 2070  wer_forecast = p
+000111b0: 642e 636f 6e63 6174 280d 0a20 2020 2020  d.concat(..     
+000111c0: 2020 2020 2020 2020 2020 205b 0d0a 2020             [..  
+000111d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000111e0: 2020 7365 6c66 2e74 6f5f 6f72 6967 696e    self.to_origin
+000111f0: 5f73 7061 6365 280d 0a20 2020 2020 2020  _space(..       
+00011200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011210: 2064 665f 666f 7265 6361 7374 2e6c 6f77   df_forecast.low
+00011220: 6572 5f66 6f72 6563 6173 742e 6865 6164  er_forecast.head
+00011230: 2868 646e 292c 0d0a 2020 2020 2020 2020  (hdn),..        
+00011240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011250: 7472 616e 735f 6d65 7468 6f64 3d27 6f72  trans_method='or
+00011260: 6967 696e 616c 272c 0d0a 2020 2020 2020  iginal',..      
+00011270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011280: 2020 626f 756e 6473 3d54 7275 652c 0d0a    bounds=True,..
+00011290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112a0: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
+000112b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000112c0: 2e74 6f5f 6f72 6967 696e 5f73 7061 6365  .to_origin_space
+000112d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000112e0: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
+000112f0: 7265 6361 7374 2e6c 6f77 6572 5f66 6f72  recast.lower_for
+00011300: 6563 6173 742e 7461 696c 2866 6f72 6563  ecast.tail(forec
+00011310: 6173 745f 6c65 6e67 7468 292c 0d0a 2020  ast_length),..  
+00011320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011330: 2020 2020 2020 7472 616e 735f 6d65 7468        trans_meth
+00011340: 6f64 3d27 666f 7265 6361 7374 272c 0d0a  od='forecast',..
+00011350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011360: 2020 2020 2020 2020 626f 756e 6473 3d54          bounds=T
+00011370: 7275 652c 0d0a 2020 2020 2020 2020 2020  rue,..          
+00011380: 2020 2020 2020 2020 2020 292c 0d0a 2020            ),..  
+00011390: 2020 2020 2020 2020 2020 2020 2020 5d0d                ].
+000113a0: 0a20 2020 2020 2020 2020 2020 2029 0d0a  .            )..
+000113b0: 2020 2020 2020 2020 2020 2020 6466 5f66              df_f
+000113c0: 6f72 6563 6173 742e 7570 7065 725f 666f  orecast.upper_fo
+000113d0: 7265 6361 7374 203d 2070 642e 636f 6e63  recast = pd.conc
+000113e0: 6174 280d 0a20 2020 2020 2020 2020 2020  at(..           
+000113f0: 2020 2020 205b 0d0a 2020 2020 2020 2020       [..        
+00011400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011410: 2e74 6f5f 6f72 6967 696e 5f73 7061 6365  .to_origin_space
+00011420: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00011430: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
+00011440: 7265 6361 7374 2e75 7070 6572 5f66 6f72  recast.upper_for
+00011450: 6563 6173 742e 6865 6164 2868 646e 292c  ecast.head(hdn),
+00011460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011470: 2020 2020 2020 2020 2020 7472 616e 735f            trans_
+00011480: 6d65 7468 6f64 3d27 6f72 6967 696e 616c  method='original
+00011490: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
+000114a0: 2020 2020 2020 2020 2020 2020 626f 756e              boun
+000114b0: 6473 3d54 7275 652c 0d0a 2020 2020 2020  ds=True,..      
+000114c0: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+000114d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000114e0: 2020 2020 2020 7365 6c66 2e74 6f5f 6f72        self.to_or
+000114f0: 6967 696e 5f73 7061 6365 280d 0a20 2020  igin_space(..   
+00011500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011510: 2020 2020 2064 665f 666f 7265 6361 7374       df_forecast
+00011520: 2e75 7070 6572 5f66 6f72 6563 6173 742e  .upper_forecast.
+00011530: 7461 696c 2866 6f72 6563 6173 745f 6c65  tail(forecast_le
+00011540: 6e67 7468 292c 0d0a 2020 2020 2020 2020  ngth),..        
+00011550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011560: 7472 616e 735f 6d65 7468 6f64 3d27 666f  trans_method='fo
+00011570: 7265 6361 7374 272c 0d0a 2020 2020 2020  recast',..      
+00011580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011590: 2020 626f 756e 6473 3d54 7275 652c 0d0a    bounds=True,..
+000115a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000115b0: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
+000115c0: 2020 2020 2020 2020 5d0d 0a20 2020 2020          ]..     
+000115d0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000115e0: 2020 2020 2020 7365 6c66 2e70 7265 6469        self.predi
+000115f0: 6374 6564 5f74 7265 6e64 203d 2070 642e  cted_trend = pd.
+00011600: 636f 6e63 6174 280d 0a20 2020 2020 2020  concat(..       
+00011610: 2020 2020 2020 2020 205b 0d0a 2020 2020           [..    
+00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011630: 7365 6c66 2e74 6f5f 6f72 6967 696e 5f73  self.to_origin_s
+00011640: 7061 6365 280d 0a20 2020 2020 2020 2020  pace(..         
+00011650: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00011660: 7265 6e64 5f66 6f72 6563 6173 742e 666f  rend_forecast.fo
+00011670: 7265 6361 7374 2e68 6561 6428 6864 6e29  recast.head(hdn)
+00011680: 2c20 7472 616e 735f 6d65 7468 6f64 3d27  , trans_method='
+00011690: 6f72 6967 696e 616c 270d 0a20 2020 2020  original'..     
+000116a0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000116b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000116c0: 2020 2020 2020 2073 656c 662e 746f 5f6f         self.to_o
+000116d0: 7269 6769 6e5f 7370 6163 6528 0d0a 2020  rigin_space(..  
+000116e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000116f0: 2020 2020 2020 7472 656e 645f 666f 7265        trend_fore
+00011700: 6361 7374 2e66 6f72 6563 6173 742e 7461  cast.forecast.ta
+00011710: 696c 2866 6f72 6563 6173 745f 6c65 6e67  il(forecast_leng
+00011720: 7468 292c 0d0a 2020 2020 2020 2020 2020  th),..          
+00011730: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00011740: 616e 735f 6d65 7468 6f64 3d27 666f 7265  ans_method='fore
+00011750: 6361 7374 272c 0d0a 2020 2020 2020 2020  cast',..        
+00011760: 2020 2020 2020 2020 2020 2020 292c 0d0a              ),..
+00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011780: 5d0d 0a20 2020 2020 2020 2020 2020 2029  ]..            )
+00011790: 0d0a 0d0a 2020 2020 2020 2020 2320 7570  ....        # up
+000117a0: 6461 7465 2074 7265 6e64 2061 6e61 6c79  date trend analy
+000117b0: 7369 7320 6261 7365 6420 6f6e 2074 7265  sis based on tre
+000117c0: 6e64 2066 6f72 6563 6173 7420 6173 2077  nd forecast as w
+000117d0: 656c 6c0d 0a20 2020 2020 2020 2069 6620  ell..        if 
+000117e0: 666f 7265 6361 7374 5f6c 656e 6774 6820  forecast_length 
+000117f0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00011800: 696e 636c 7564 655f 6869 7374 6f72 793a  include_history:
+00011810: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+00011820: 656e 645f 706f 7374 6572 696f 722c 2073  end_posterior, s
+00011830: 656c 662e 736c 6f70 652c 2069 6e74 6572  elf.slope, inter
+00011840: 6365 7074 203d 2073 656c 662e 726f 6c6c  cept = self.roll
+00011850: 696e 675f 7472 656e 6428 0d0a 2020 2020  ing_trend(..    
+00011860: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011870: 2e70 7265 6469 6374 6564 5f74 7265 6e64  .predicted_trend
+00011880: 2c20 6e70 2e61 7272 6179 2873 656c 662e  , np.array(self.
+00011890: 745f 7072 6564 6963 7429 0d0a 2020 2020  t_predict)..    
+000118a0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+000118b0: 2020 2020 2020 2028 0d0a 2020 2020 2020         (..      
+000118c0: 2020 2020 2020 2020 2020 7365 6c66 2e7a            self.z
+000118d0: 6572 6f5f 6372 6f73 7369 6e67 732c 0d0a  ero_crossings,..
+000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118f0: 7365 6c66 2e63 6861 6e67 6570 6f69 6e74  self.changepoint
+00011900: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00011910: 2020 2020 7365 6c66 2e73 6c6f 7065 5f73      self.slope_s
+00011920: 6967 6e2c 0d0a 2020 2020 2020 2020 2020  ign,..          
+00011930: 2020 2020 2020 7365 6c66 2e61 6363 656c        self.accel
+00011940: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
+00011950: 203d 2073 656c 662e 616e 616c 797a 655f   = self.analyze_
+00011960: 7472 656e 6428 7365 6c66 2e73 6c6f 7065  trend(self.slope
+00011970: 2c20 696e 6465 783d 7365 6c66 2e70 7265  , index=self.pre
+00011980: 6469 6374 6564 5f74 7265 6e64 2e69 6e64  dicted_trend.ind
+00011990: 6578 290d 0a0d 0a20 2020 2020 2020 2023  ex)....        #
+000119a0: 2064 6f6e 2774 2066 6f72 6765 7420 746f   don't forget to
+000119b0: 2061 6464 2069 6e20 7061 7374 5f69 6d70   add in past_imp
+000119c0: 6163 7473 2028 7573 6520 6675 7475 7265  acts (use future
+000119d0: 2069 6d70 6163 7473 2061 6761 696e 3f29   impacts again?)
+000119e0: 2041 4654 4552 2075 6e73 6361 6c69 6e67   AFTER unscaling
+000119f0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00011a00: 662e 7061 7374 5f69 6d70 6163 7473 5f69  f.past_impacts_i
+00011a10: 6e74 6572 7665 6e74 696f 6e20 213d 2022  ntervention != "
+00011a20: 7265 6772 6573 736f 7222 3a0d 0a20 2020  regressor":..   
+00011a30: 2020 2020 2020 2020 2069 6620 6675 7475           if futu
+00011a40: 7265 5f69 6d70 6163 7473 2069 7320 6e6f  re_impacts is no
+00011a50: 7420 4e6f 6e65 2061 6e64 2073 656c 662e  t None and self.
+00011a60: 7061 7374 5f69 6d70 6163 7473 2069 7320  past_impacts is 
+00011a70: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00011a80: 2020 2020 2020 2070 6173 745f 696d 7061         past_impa
+00011a90: 6374 7320 3d20 7064 2e44 6174 6146 7261  cts = pd.DataFra
+00011aa0: 6d65 280d 0a20 2020 2020 2020 2020 2020  me(..           
+00011ab0: 2020 2020 2020 2020 2030 2c20 696e 6465           0, inde
+00011ac0: 783d 7365 6c66 2e64 662e 696e 6465 782c  x=self.df.index,
+00011ad0: 2063 6f6c 756d 6e73 3d73 656c 662e 6466   columns=self.df
+00011ae0: 2e63 6f6c 756d 6e73 0d0a 2020 2020 2020  .columns..      
+00011af0: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00011b00: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00011b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b20: 7061 7374 5f69 6d70 6163 7473 203d 2073  past_impacts = s
+00011b30: 656c 662e 7061 7374 5f69 6d70 6163 7473  elf.past_impacts
+00011b40: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00011b50: 726f 6c6c 2066 6f72 7761 7264 2074 6169  roll forward tai
+00011b60: 6c20 6f66 2070 6173 7420 696d 7061 6374  l of past impact
+00011b70: 732c 2061 7373 756d 696e 6720 6974 2063  s, assuming it c
+00011b80: 6f6e 7469 6e75 6573 0d0a 2020 2020 2020  ontinues..      
+00011b90: 2020 2020 2020 6966 2073 656c 662e 7061        if self.pa
+00011ba0: 7374 5f69 6d70 6163 7473 2069 7320 6e6f  st_impacts is no
+00011bb0: 7420 4e6f 6e65 2061 6e64 2066 6f72 6563  t None and forec
+00011bc0: 6173 745f 6c65 6e67 7468 2069 7320 6e6f  ast_length is no
+00011bd0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00011be0: 2020 2020 2020 2020 2066 7574 7572 655f           future_
+00011bf0: 696d 7074 7320 3d20 7064 2e44 6174 6146  impts = pd.DataF
+00011c00: 7261 6d65 280d 0a20 2020 2020 2020 2020  rame(..         
+00011c10: 2020 2020 2020 2020 2020 206e 702e 7265             np.re
+00011c20: 7065 6174 280d 0a20 2020 2020 2020 2020  peat(..         
+00011c30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00011c40: 656c 662e 7061 7374 5f69 6d70 6163 7473  elf.past_impacts
+00011c50: 2e69 6c6f 635b 2d31 3a5d 2e74 6f5f 6e75  .iloc[-1:].to_nu
+00011c60: 6d70 7928 292c 2066 6f72 6563 6173 745f  mpy(), forecast_
+00011c70: 6c65 6e67 7468 2c20 6178 6973 3d30 0d0a  length, axis=0..
+00011c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c90: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
+00011ca0: 2020 2020 2020 2020 2020 2020 696e 6465              inde
+00011cb0: 783d 6466 5f66 6f72 6563 6173 742e 666f  x=df_forecast.fo
+00011cc0: 7265 6361 7374 2e69 6e64 6578 5b2d 666f  recast.index[-fo
+00011cd0: 7265 6361 7374 5f6c 656e 6774 683a 5d2c  recast_length:],
+00011ce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011cf0: 2020 2020 2020 636f 6c75 6d6e 733d 7365        columns=se
+00011d00: 6c66 2e70 6173 745f 696d 7061 6374 732e  lf.past_impacts.
+00011d10: 636f 6c75 6d6e 732c 0d0a 2020 2020 2020  columns,..      
+00011d20: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00011d30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00011d40: 6675 7475 7265 5f69 6d70 6163 7473 2069  future_impacts i
+00011d50: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00011d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d70: 2066 7574 7572 655f 696d 7074 7320 3d20   future_impts = 
+00011d80: 6675 7475 7265 5f69 6d70 7473 202b 2066  future_impts + f
+00011d90: 7574 7572 655f 696d 7061 6374 730d 0a20  uture_impacts.. 
+00011da0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00011db0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00011dc0: 2020 6675 7475 7265 5f69 6d70 7473 203d    future_impts =
+00011dd0: 2070 642e 4461 7461 4672 616d 6528 290d   pd.DataFrame().
+00011de0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011df0: 7365 6c66 2e70 6173 745f 696d 7061 6374  self.past_impact
+00011e00: 7320 6973 206e 6f74 204e 6f6e 6520 6f72  s is not None or
+00011e10: 2066 7574 7572 655f 696d 7061 6374 7320   future_impacts 
+00011e20: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00011e30: 2020 2020 2020 2020 2020 2020 2020 696d                im
+00011e40: 7074 7320 3d20 3120 2b20 7064 2e63 6f6e  pts = 1 + pd.con
+00011e50: 6361 7428 5b70 6173 745f 696d 7061 6374  cat([past_impact
+00011e60: 732c 2066 7574 7572 655f 696d 7074 735d  s, future_impts]
+00011e70: 2c20 6178 6973 3d30 292e 7265 696e 6465  , axis=0).reinde
+00011e80: 7828 0d0a 2020 2020 2020 2020 2020 2020  x(..            
+00011e90: 2020 2020 2020 2020 696e 6465 783d 6466          index=df
+00011ea0: 5f66 6f72 6563 6173 742e 666f 7265 6361  _forecast.foreca
+00011eb0: 7374 2e69 6e64 6578 2c0d 0a20 2020 2020  st.index,..     
+00011ec0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00011ed0: 6f6c 756d 6e73 3d64 665f 666f 7265 6361  olumns=df_foreca
+00011ee0: 7374 2e66 6f72 6563 6173 742e 636f 6c75  st.forecast.colu
+00011ef0: 6d6e 732c 0d0a 2020 2020 2020 2020 2020  mns,..          
+00011f00: 2020 2020 2020 2020 2020 6669 6c6c 5f76            fill_v
+00011f10: 616c 7565 3d31 2c0d 0a20 2020 2020 2020  alue=1,..       
+00011f20: 2020 2020 2020 2020 2029 2020 2320 6d69           )  # mi
+00011f30: 6e75 7320 6f72 2070 6c75 730d 0a20 2020  nus or plus..   
+00011f40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00011f50: 662e 696d 7061 6374 7320 3d20 696d 7074  f.impacts = impt
+00011f60: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+00011f70: 2020 2069 6620 696e 636c 7564 655f 6f72     if include_or
+00011f80: 6761 6e69 633a 0d0a 2020 2020 2020 2020  ganic:..        
+00011f90: 2020 2020 2020 2020 2020 2020 6466 5f66              df_f
+00011fa0: 6f72 6563 6173 742e 6f72 6761 6e69 635f  orecast.organic_
+00011fb0: 666f 7265 6361 7374 203d 2064 665f 666f  forecast = df_fo
+00011fc0: 7265 6361 7374 2e66 6f72 6563 6173 742e  recast.forecast.
+00011fd0: 636f 7079 2829 0d0a 2020 2020 2020 2020  copy()..        
+00011fe0: 2020 2020 2020 2020 6466 5f66 6f72 6563          df_forec
+00011ff0: 6173 742e 666f 7265 6361 7374 203d 2064  ast.forecast = d
+00012000: 665f 666f 7265 6361 7374 2e66 6f72 6563  f_forecast.forec
+00012010: 6173 7420 2a20 696d 7074 730d 0a20 2020  ast * impts..   
+00012020: 2020 2020 2020 2020 2020 2020 2064 665f               df_
+00012030: 666f 7265 6361 7374 2e6c 6f77 6572 5f66  forecast.lower_f
+00012040: 6f72 6563 6173 7420 3d20 6466 5f66 6f72  orecast = df_for
+00012050: 6563 6173 742e 6c6f 7765 725f 666f 7265  ecast.lower_fore
+00012060: 6361 7374 202a 2069 6d70 7473 0d0a 2020  cast * impts..  
+00012070: 2020 2020 2020 2020 2020 2020 2020 6466                df
+00012080: 5f66 6f72 6563 6173 742e 7570 7065 725f  _forecast.upper_
+00012090: 666f 7265 6361 7374 203d 2064 665f 666f  forecast = df_fo
+000120a0: 7265 6361 7374 2e75 7070 6572 5f66 6f72  recast.upper_for
+000120b0: 6563 6173 7420 2a20 696d 7074 730d 0a0d  ecast * impts...
+000120c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000120d0: 2e63 6f6e 7374 7261 696e 7420 6973 206e  .constraint is n
+000120e0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+000120f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00012100: 6e63 6528 7365 6c66 2e63 6f6e 7374 7261  nce(self.constra
+00012110: 696e 742c 2064 6963 7429 3a0d 0a20 2020  int, dict):..   
+00012120: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00012130: 7374 7261 696e 745f 6d65 7468 6f64 203d  straint_method =
+00012140: 2073 656c 662e 636f 6e73 7472 6169 6e74   self.constraint
+00012150: 2e67 6574 2822 636f 6e73 7472 6169 6e74  .get("constraint
+00012160: 5f6d 6574 686f 6422 2c20 2271 7561 6e74  _method", "quant
+00012170: 696c 6522 290d 0a20 2020 2020 2020 2020  ile")..         
+00012180: 2020 2020 2020 2063 6f6e 7374 7261 696e         constrain
+00012190: 745f 7265 6775 6c61 7269 7a61 7469 6f6e  t_regularization
+000121a0: 203d 2073 656c 662e 636f 6e73 7472 6169   = self.constrai
+000121b0: 6e74 2e67 6574 280d 0a20 2020 2020 2020  nt.get(..       
+000121c0: 2020 2020 2020 2020 2020 2020 2022 636f               "co
+000121d0: 6e73 7472 6169 6e74 5f72 6567 756c 6172  nstraint_regular
+000121e0: 697a 6174 696f 6e22 2c20 310d 0a20 2020  ization", 1..   
+000121f0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
+00012200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012210: 6c6f 7765 725f 636f 6e73 7472 6169 6e74  lower_constraint
+00012220: 203d 2073 656c 662e 636f 6e73 7472 6169   = self.constrai
+00012230: 6e74 2e67 6574 2822 6c6f 7765 725f 636f  nt.get("lower_co
+00012240: 6e73 7472 6169 6e74 222c 2030 290d 0a20  nstraint", 0).. 
+00012250: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00012260: 7070 6572 5f63 6f6e 7374 7261 696e 7420  pper_constraint 
+00012270: 3d20 7365 6c66 2e63 6f6e 7374 7261 696e  = self.constrain
+00012280: 742e 6765 7428 2275 7070 6572 5f63 6f6e  t.get("upper_con
+00012290: 7374 7261 696e 7422 2c20 3129 0d0a 2020  straint", 1)..  
+000122a0: 2020 2020 2020 2020 2020 2020 2020 626f                bo
+000122b0: 756e 6473 203d 2073 656c 662e 636f 6e73  unds = self.cons
+000122c0: 7472 6169 6e74 2e67 6574 2822 626f 756e  traint.get("boun
+000122d0: 6473 222c 2046 616c 7365 290d 0a20 2020  ds", False)..   
+000122e0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000122f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012300: 636f 6e73 7472 6169 6e74 5f6d 6574 686f  constraint_metho
+00012310: 6420 3d20 2273 7464 6576 5f6d 696e 220d  d = "stdev_min".
+00012320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012330: 206c 6f77 6572 5f63 6f6e 7374 7261 696e   lower_constrain
+00012340: 7420 3d20 666c 6f61 7428 7365 6c66 2e63  t = float(self.c
+00012350: 6f6e 7374 7261 696e 7429 0d0a 2020 2020  onstraint)..    
+00012360: 2020 2020 2020 2020 2020 2020 7570 7065              uppe
+00012370: 725f 636f 6e73 7472 6169 6e74 203d 2066  r_constraint = f
+00012380: 6c6f 6174 2873 656c 662e 636f 6e73 7472  loat(self.constr
+00012390: 6169 6e74 290d 0a20 2020 2020 2020 2020  aint)..         
+000123a0: 2020 2020 2020 2063 6f6e 7374 7261 696e         constrain
+000123b0: 745f 7265 6775 6c61 7269 7a61 7469 6f6e  t_regularization
+000123c0: 203d 2031 0d0a 2020 2020 2020 2020 2020   = 1..          
+000123d0: 2020 2020 2020 626f 756e 6473 203d 2046        bounds = F
+000123e0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+000123f0: 2020 6966 2073 656c 662e 7665 7262 6f73    if self.verbos
+00012400: 6520 3e3d 2033 3a0d 0a20 2020 2020 2020  e >= 3:..       
+00012410: 2020 2020 2020 2020 2070 7269 6e74 280d           print(.
+00012420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012430: 2020 2020 2066 2255 7369 6e67 2063 6f6e       f"Using con
+00012440: 7374 7261 696e 7420 7769 7468 206d 6574  straint with met
+00012450: 686f 643a 207b 636f 6e73 7472 6169 6e74  hod: {constraint
+00012460: 5f6d 6574 686f 647d 2c20 7b63 6f6e 7374  _method}, {const
+00012470: 7261 696e 745f 7265 6775 6c61 7269 7a61  raint_regulariza
+00012480: 7469 6f6e 7d2c 207b 6c6f 7765 725f 636f  tion}, {lower_co
+00012490: 6e73 7472 6169 6e74 7d2c 207b 7570 7065  nstraint}, {uppe
+000124a0: 725f 636f 6e73 7472 6169 6e74 7d2c 207b  r_constraint}, {
+000124b0: 626f 756e 6473 7d22 0d0a 2020 2020 2020  bounds}"..      
+000124c0: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
+000124d0: 2020 2020 2020 2020 2020 2064 665f 666f             df_fo
+000124e0: 7265 6361 7374 203d 2064 665f 666f 7265  recast = df_fore
+000124f0: 6361 7374 2e61 7070 6c79 5f63 6f6e 7374  cast.apply_const
+00012500: 7261 696e 7473 280d 0a20 2020 2020 2020  raints(..       
+00012510: 2020 2020 2020 2020 2063 6f6e 7374 7261           constra
+00012520: 696e 745f 6d65 7468 6f64 2c0d 0a20 2020  int_method,..   
+00012530: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00012540: 7374 7261 696e 745f 7265 6775 6c61 7269  straint_regulari
+00012550: 7a61 7469 6f6e 2c0d 0a20 2020 2020 2020  zation,..       
+00012560: 2020 2020 2020 2020 2075 7070 6572 5f63           upper_c
+00012570: 6f6e 7374 7261 696e 742c 0d0a 2020 2020  onstraint,..    
+00012580: 2020 2020 2020 2020 2020 2020 6c6f 7765              lowe
+00012590: 725f 636f 6e73 7472 6169 6e74 2c0d 0a20  r_constraint,.. 
+000125a0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+000125b0: 6f75 6e64 732c 0d0a 2020 2020 2020 2020  ounds,..        
+000125c0: 2020 2020 2020 2020 7365 6c66 2e64 665f          self.df_
+000125d0: 6f72 6967 696e 616c 2c0d 0a20 2020 2020  original,..     
+000125e0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000125f0: 2020 2320 5245 5455 524e 2043 4f4d 504f    # RETURN COMPO
+00012600: 4e45 4e54 5320 286c 6f6e 6720 7374 796c  NENTS (long styl
+00012610: 6529 206f 7074 696f 6e0d 0a20 2020 2020  e) option..     
+00012620: 2020 2064 665f 666f 7265 6361 7374 2e70     df_forecast.p
+00012630: 7265 6469 6374 5f72 756e 7469 6d65 203d  redict_runtime =
+00012640: 2073 656c 662e 7469 6d65 2829 202d 2070   self.time() - p
+00012650: 7265 6469 6374 5374 6172 7454 696d 650d  redictStartTime.
+00012660: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012670: 6466 5f66 6f72 6563 6173 740d 0a0d 0a20  df_forecast.... 
+00012680: 2020 2064 6566 2061 7574 6f5f 6669 7428     def auto_fit(
+00012690: 7365 6c66 2c20 6466 2c20 7661 6c69 6461  self, df, valida
+000126a0: 7469 6f6e 5f6d 6574 686f 6429 3a20 2023  tion_method):  #
+000126b0: 2061 6c73 6f20 6164 6420 7265 6772 6573   also add regres
+000126c0: 736f 7220 696e 7075 740d 0a20 2020 2020  sor input..     
+000126d0: 2020 2023 206f 7074 696f 6e20 746f 2063     # option to c
+000126e0: 6f6d 706c 6574 656c 7920 736b 6970 2073  ompletely skip s
+000126f0: 6f6d 6520 7468 696e 6773 2028 616e 6f6d  ome things (anom
+00012700: 616c 6965 732c 2068 6f6c 6964 6179 2064  alies, holiday d
+00012710: 6574 6563 746f 722c 2061 7220 6c61 6773  etector, ar lags
+00012720: 290d 0a20 2020 2020 2020 2023 2072 756e  )..        # run
+00012730: 2063 726f 7373 2076 616c 6964 6174 696f   cross validatio
+00012740: 6e20 746f 2063 686f 6f73 650d 0a20 2020  n to choose..   
+00012750: 2020 2020 2023 2072 6574 7572 6e20 6d65       # return me
+00012760: 7472 6963 7320 6f66 2062 6573 7420 6d6f  trics of best mo
+00012770: 6465 6c2c 2073 6574 2062 6173 6520 7061  del, set base pa
+00012780: 7261 6d73 0d0a 2020 2020 2020 2020 7365  rams..        se
+00012790: 6c66 2e73 7461 7274 696e 675f 7061 7261  lf.starting_para
+000127a0: 6d73 203d 2073 656c 662e 6765 745f 7061  ms = self.get_pa
+000127b0: 7261 6d73 2829 0d0a 2020 2020 2020 2020  rams()..        
+000127c0: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
+000127d0: 656e 7465 640d 0a0d 0a20 2020 2064 6566  ented....    def
+000127e0: 206e 6578 745f 6669 7428 7365 6c66 293a   next_fit(self):
+000127f0: 0d0a 2020 2020 2020 2020 2320 6f70 7469  ..        # opti
+00012800: 6f6e 2074 6f20 7072 696e 7420 6120 6772  on to print a gr
+00012810: 6170 6820 6f66 2065 6163 6820 7768 696c  aph of each whil
+00012820: 6520 676f 696e 6720 2872 756e 2061 6761  e going (run aga
+00012830: 696e 2075 6e74 696c 2079 6f75 2073 6565  in until you see
+00012840: 206f 6e65 2079 6f75 206c 696b 6529 0d0a   one you like)..
+00012850: 2020 2020 2020 2020 2320 6170 7065 6e64          # append
+00012860: 2074 6f20 616e 2069 6e74 6572 6e61 6c20   to an internal 
+00012870: 7265 636f 7264 2c20 7072 696e 7420 6e65  record, print ne
+00012880: 7720 7061 7261 6d73 0d0a 2020 2020 2020  w params..      
+00012890: 2020 2320 706c 6f74 3a20 3320 7374 6163    # plot: 3 stac
+000128a0: 6b65 642c 2069 6e20 7361 6d70 6c65 2c20  ked, in sample, 
+000128b0: 7468 656e 2065 6163 6820 7661 6c69 6461  then each valida
+000128c0: 7469 6f6e 0d0a 2020 2020 2020 2020 2320  tion..        # 
+000128d0: 6d61 7962 6520 7573 6520 6765 6e65 7469  maybe use geneti
+000128e0: 6320 6f70 7469 6d69 7a61 7469 6f6e 2069  c optimization i
+000128f0: 6620 7468 6973 2075 7365 6420 6166 7465  f this used afte
+00012900: 7220 6175 746f 5f66 6974 0d0a 2020 2020  r auto_fit..    
+00012910: 2020 2020 7265 7475 726e 204e 6f74 496d      return NotIm
+00012920: 706c 656d 656e 7465 640d 0a0d 0a20 2020  plemented....   
+00012930: 2064 6566 2063 726f 7373 5f76 616c 6964   def cross_valid
+00012940: 6174 6528 7365 6c66 2c20 6466 2c20 7661  ate(self, df, va
+00012950: 6c69 6461 7469 6f6e 5f6d 6574 686f 6429  lidation_method)
+00012960: 3a0d 0a20 2020 2020 2020 2023 2072 756e  :..        # run
+00012970: 206f 6e65 206d 6f64 656c 2061 6e64 2072   one model and r
+00012980: 6574 7572 6e20 7363 6f72 6573 0d0a 2020  eturn scores..  
+00012990: 2020 2020 2020 7265 7475 726e 204e 6f74        return Not
+000129a0: 496d 706c 656d 656e 7465 640d 0a0d 0a20  Implemented.... 
+000129b0: 2020 2064 6566 2074 7265 6174 6d65 6e74     def treatment
+000129c0: 5f63 6175 7361 6c5f 696d 7061 6374 280d  _causal_impact(.
+000129d0: 0a20 2020 2020 2020 2073 656c 662c 2064  .        self, d
+000129e0: 662c 2069 6e74 6572 7665 6e74 696f 6e5f  f, intervention_
+000129f0: 6461 7465 730d 0a20 2020 2029 3a20 2023  dates..    ):  #
+00012a00: 2061 6c73 6f20 6164 6420 7265 6772 6573   also add regres
+00012a10: 736f 7220 696e 7075 740d 0a20 2020 2020  sor input..     
+00012a20: 2020 2023 2072 6567 7265 7373 6f72 7320     # regressors 
+00012a30: 696d 706f 7274 616e 742c 2065 7374 696d  important, estim
+00012a40: 6174 696f 6e20 6279 206c 696e 6561 7220  ation by linear 
+00012a50: 666c 6167 2028 7265 7475 726e 2073 7461  flag (return sta
+00012a60: 7473 2920 6f72 2062 7920 2520 7673 2066  ts) or by % vs f
+00012a70: 6f72 6563 6173 7420 6672 6f6d 2063 7574  orecast from cut
+00012a80: 6f66 660d 0a20 2020 2020 2020 2023 2073  off..        # s
+00012a90: 7461 7274 2061 6e64 2065 6e64 2064 6174  tart and end dat
+00012aa0: 6573 2c20 6d75 6c74 6970 6c65 2074 7265  es, multiple tre
+00012ab0: 6174 6d65 6e74 732c 2076 6172 7920 6279  atments, vary by
+00012ac0: 2073 6572 6965 730d 0a20 2020 2020 2020   series..       
+00012ad0: 2023 206f 7220 6d61 7962 6520 696e 7374   # or maybe inst
+00012ae0: 6561 642c 206a 7573 7420 7265 7475 726e  ead, just return
+00012af0: 2074 6865 2073 7461 7473 2066 6f72 2061   the stats for a
+00012b00: 6c6c 2069 6e70 7574 2072 6567 7265 7373  ll input regress
+00012b10: 6f72 730d 0a20 2020 2020 2020 2023 2073  ors..        # s
+00012b20: 7469 6c6c 2077 6f72 6b69 6e67 206f 6e20  till working on 
+00012b30: 7468 6973 2c20 706f 7373 6962 6c79 206a  this, possibly j
+00012b40: 7573 7420 6874 7470 733a 2f2f 6d61 7468  ust https://math
+00012b50: 2e73 7461 636b 6578 6368 616e 6765 2e63  .stackexchange.c
+00012b60: 6f6d 2f71 7565 7374 696f 6e73 2f32 3131  om/questions/211
+00012b70: 3235 3533 2f73 7461 7469 7374 6963 616c  2553/statistical
+00012b80: 2d73 6967 6e69 6669 6361 6e63 652d 6f66  -significance-of
+00012b90: 2d6c 696e 6561 722d 6c65 6173 742d 7371  -linear-least-sq
+00012ba0: 7561 7265 730d 0a20 2020 2020 2020 2023  uares..        #
+00012bb0: 2061 6e64 206f 7468 6572 2066 6561 7475   and other featu
+00012bc0: 7265 7320 616c 6120 5374 6174 736d 6f64  res ala Statsmod
+00012bd0: 656c 7320 4f4c 532c 2056 6172 28ce b25e  els OLS, Var(..^
+00012be0: 293d cf83 3228 58e2 80b2 5829 e288 9231  )=..2(X...X)...1
+00012bf0: 2077 6865 7265 20cf 8332 3e30 2069 7320   where ..2>0 is 
+00012c00: 7468 6520 636f 6d6d 6f6e 2076 6172 6961  the common varia
+00012c10: 6e63 6520 6f66 2065 6163 6820 656c 656d  nce of each elem
+00012c20: 656e 7420 6f66 2074 6865 2065 7272 6f72  ent of the error
+00012c30: 2076 6563 746f 720d 0a20 2020 2020 2020   vector..       
+00012c40: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
+00012c50: 6d65 6e74 6564 0d0a 0d0a 2020 2020 6465  mented....    de
+00012c60: 6620 7072 6564 6963 745f 6e65 775f 7072  f predict_new_pr
+00012c70: 6f64 7563 7428 7365 6c66 293a 0d0a 2020  oduct(self):..  
+00012c80: 2020 2020 2020 2320 626f 7272 6f77 2074        # borrow t
+00012c90: 6865 206c 696e 6561 7220 636f 6d70 6f6e  he linear compon
+00012ca0: 656e 7473 2066 726f 6d20 6120 7265 6c61  ents from a rela
+00012cb0: 7465 6420 7072 6f64 7563 7420 286f 7220  ted product (or 
+00012cc0: 6176 672f 6d6f 6465 2069 6620 6e6f 7420  avg/mode if not 
+00012cd0: 6769 7665 6e29 0d0a 2020 2020 2020 2020  given)..        
+00012ce0: 2320 6861 7665 2074 6865 2074 7265 6e64  # have the trend
+00012cf0: 2073 7461 7274 2061 7420 7a65 726f 2074   start at zero t
+00012d00: 6865 6e20 7570 2c20 6c69 6b65 2072 6576  hen up, like rev
+00012d10: 6572 7365 2070 6869 0d0a 2020 2020 2020  erse phi..      
+00012d20: 2020 2320 706f 7373 6962 6c79 2062 6f72    # possibly bor
+00012d30: 726f 7720 7761 726d 7570 2066 726f 6d20  row warmup from 
+00012d40: 616e 7920 7365 7269 6573 2074 6861 7420  any series that 
+00012d50: 6861 7665 2061 206c 6f67 6973 7469 632d  have a logistic-
+00012d60: 6c69 6b65 2074 7265 6e64 0d0a 2020 2020  like trend..    
+00012d70: 2020 2020 2320 636c 7573 7465 7220 616e      # cluster an
+00012d80: 6420 6368 6f6f 7365 2074 6865 2062 6967  d choose the big
+00012d90: 6765 7374 2063 6c75 7374 6572 2028 6173  gest cluster (as
+00012da0: 2061 7667 2076 616c 7565 206e 6169 7665   avg value naive
+00012db0: 206d 6574 686f 642c 206d 6179 6265 2072   method, maybe r
+00012dc0: 6f75 6e64 206f 7220 6669 6c74 6572 2066  ound or filter f
+00012dd0: 6972 7374 290d 0a20 2020 2020 2020 2072  irst)..        r
+00012de0: 6574 7572 6e20 4e6f 7449 6d70 6c65 6d65  eturn NotImpleme
+00012df0: 6e74 6564 0d0a 0d0a 2020 2020 6465 6620  nted....    def 
+00012e00: 6665 6174 7572 655f 696d 706f 7274 616e  feature_importan
+00012e10: 6365 2873 656c 6629 3a0d 0a20 2020 2020  ce(self):..     
+00012e20: 2020 2023 2072 616e 6b20 636f 6566 6669     # rank coeffi
+00012e30: 6369 656e 7473 2062 7920 696d 706f 7274  cients by import
+00012e40: 616e 6365 0d0a 2020 2020 2020 2020 7265  ance..        re
+00012e50: 7475 726e 204e 6f74 496d 706c 656d 656e  turn NotImplemen
+00012e60: 7465 640d 0a0d 0a20 2020 2064 6566 2063  ted....    def c
+00012e70: 6f6d 7061 7265 5f61 6374 7561 6c5f 636f  ompare_actual_co
+00012e80: 6d70 6f6e 656e 7473 2873 656c 6629 3a0d  mponents(self):.
+00012e90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012ea0: 4e6f 7449 6d70 6c65 6d65 6e74 6564 0d0a  NotImplemented..
+00012eb0: 0d0a 2020 2020 6465 6620 6765 745f 6e65  ..    def get_ne
+00012ec0: 775f 7061 7261 6d73 2873 656c 662c 206d  w_params(self, m
+00012ed0: 6574 686f 643d 2766 6173 7427 293a 0d0a  ethod='fast'):..
+00012ee0: 2020 2020 2020 2020 2320 6861 7665 2066          # have f
+00012ef0: 6173 7420 6f70 7469 6f6e 2074 6861 7420  ast option that 
+00012f00: 6176 6f69 6473 2061 6e79 206f 6620 7468  avoids any of th
+00012f10: 6520 6c6f 6f70 2061 7070 726f 6163 6865  e loop approache
+00012f20: 730d 0a20 2020 2020 2020 2073 6361 6c69  s..        scali
+00012f30: 6e67 203d 2072 616e 646f 6d2e 6368 6f69  ng = random.choi
+00012f40: 6365 7328 5b27 4261 7365 5363 616c 6572  ces(['BaseScaler
+00012f50: 272c 2027 6f74 6865 7227 5d2c 205b 302e  ', 'other'], [0.
+00012f60: 382c 2030 2e32 5d29 5b30 5d0d 0a20 2020  8, 0.2])[0]..   
+00012f70: 2020 2020 2069 6620 7363 616c 696e 6720       if scaling 
+00012f80: 3d3d 2022 6f74 6865 7222 3a0d 0a20 2020  == "other":..   
+00012f90: 2020 2020 2020 2020 2073 6361 6c69 6e67           scaling
+00012fa0: 203d 2052 616e 646f 6d54 7261 6e73 666f   = RandomTransfo
+00012fb0: 726d 280d 0a20 2020 2020 2020 2020 2020  rm(..           
+00012fc0: 2020 2020 2074 7261 6e73 666f 726d 6572       transformer
+00012fd0: 5f6c 6973 743d 7363 616c 6572 732c 0d0a  _list=scalers,..
+00012fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ff0: 7472 616e 7366 6f72 6d65 725f 6d61 785f  transformer_max_
+00013000: 6465 7074 683d 312c 0d0a 2020 2020 2020  depth=1,..      
+00013010: 2020 2020 2020 2020 2020 616c 6c6f 775f            allow_
+00013020: 6e6f 6e65 3d46 616c 7365 2c0d 0a20 2020  none=False,..   
+00013030: 2020 2020 2020 2020 2020 2020 206e 6f5f               no_
+00013040: 6e61 6e5f 6669 6c6c 3d54 7275 652c 0d0a  nan_fill=True,..
+00013050: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+00013060: 2020 2020 2020 2068 6f6c 6964 6179 5f70         holiday_p
+00013070: 6172 616d 7320 3d20 7261 6e64 6f6d 2e63  arams = random.c
+00013080: 686f 6963 6573 285b 4e6f 6e65 2c20 2761  hoices([None, 'a
+00013090: 6e79 275d 2c20 5b30 2e35 2c20 302e 355d  ny'], [0.5, 0.5]
+000130a0: 295b 305d 0d0a 2020 2020 2020 2020 2320  )[0]..        # 
+000130b0: 686f 6c69 6461 795f 696e 7465 7276 656e  holiday_interven
+000130c0: 7469 6f6e 203d 204e 6f6e 650d 0a20 2020  tion = None..   
+000130d0: 2020 2020 2069 6620 686f 6c69 6461 795f       if holiday_
+000130e0: 7061 7261 6d73 2069 7320 6e6f 7420 4e6f  params is not No
+000130f0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00013100: 2023 2068 6f6c 6964 6179 5f69 6e74 6572   # holiday_inter
+00013110: 7665 6e74 696f 6e20 3d20 7261 6e64 6f6d  vention = random
+00013120: 2e63 686f 6963 6528 5b27 6372 6561 7465  .choice(['create
+00013130: 5f66 6561 7475 7265 272c 2027 7573 655f  _feature', 'use_
+00013140: 696d 7061 6374 275d 290d 0a20 2020 2020  impact'])..     
+00013150: 2020 2020 2020 2068 6f6c 6964 6179 5f70         holiday_p
+00013160: 6172 616d 7320 3d20 486f 6c69 6461 7954  arams = HolidayT
+00013170: 7261 6e73 666f 726d 6572 2e67 6574 5f6e  ransformer.get_n
+00013180: 6577 5f70 6172 616d 7328 6d65 7468 6f64  ew_params(method
+00013190: 3d6d 6574 686f 6429 0d0a 2020 2020 2020  =method)..      
+000131a0: 2020 2020 2020 686f 6c69 6461 795f 7061        holiday_pa
+000131b0: 7261 6d73 5b27 696d 7061 6374 275d 203d  rams['impact'] =
+000131c0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+000131d0: 2020 2068 6f6c 6964 6179 5f70 6172 616d     holiday_param
+000131e0: 735b 2772 6567 7265 7373 696f 6e5f 7061  s['regression_pa
+000131f0: 7261 6d73 275d 203d 204e 6f6e 650d 0a20  rams'] = None.. 
+00013200: 2020 2020 2020 2020 2020 2068 6f6c 6964             holid
+00013210: 6179 5f70 6172 616d 735b 2772 656d 6f76  ay_params['remov
+00013220: 655f 6578 6365 7373 5f61 6e6f 6d61 6c69  e_excess_anomali
+00013230: 6573 275d 203d 2072 616e 646f 6d2e 6368  es'] = random.ch
+00013240: 6f69 6365 7328 0d0a 2020 2020 2020 2020  oices(..        
+00013250: 2020 2020 2020 2020 5b54 7275 652c 2046          [True, F
+00013260: 616c 7365 5d2c 205b 302e 3035 2c20 302e  alse], [0.05, 0.
+00013270: 3935 5d0d 0a20 2020 2020 2020 2020 2020  95]..           
+00013280: 2029 5b30 5d0d 0a20 2020 2020 2020 2020   )[0]..         
+00013290: 2020 2068 6f6c 6964 6179 5f70 6172 616d     holiday_param
+000132a0: 735b 276f 7574 7075 7427 5d20 3d20 7261  s['output'] = ra
+000132b0: 6e64 6f6d 2e63 686f 6963 6573 280d 0a20  ndom.choices(.. 
+000132c0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+000132d0: 276d 756c 7469 7661 7269 6174 6527 2c20  'multivariate', 
+000132e0: 2775 6e69 7661 7269 6174 6527 5d2c 205b  'univariate'], [
+000132f0: 302e 392c 2030 2e31 5d0d 0a20 2020 2020  0.9, 0.1]..     
+00013300: 2020 2020 2020 2029 5b30 5d0d 0a20 2020         )[0]..   
+00013310: 2020 2020 2061 6e6f 6d61 6c79 5f69 6e74       anomaly_int
+00013320: 6572 7665 6e74 696f 6e20 3d20 7261 6e64  ervention = rand
+00013330: 6f6d 2e63 686f 6963 6573 280d 0a20 2020  om.choices(..   
+00013340: 2020 2020 2020 2020 205b 4e6f 6e65 2c20           [None, 
+00013350: 2772 656d 6f76 6527 2c20 2764 6574 6563  'remove', 'detec
+00013360: 745f 6f6e 6c79 272c 2027 6d6f 6465 6c27  t_only', 'model'
+00013370: 5d2c 205b 302e 392c 2030 2e33 2c20 302e  ], [0.9, 0.3, 0.
+00013380: 3035 2c20 302e 3035 5d0d 0a20 2020 2020  05, 0.05]..     
+00013390: 2020 2029 5b30 5d0d 0a20 2020 2020 2020     )[0]..       
+000133a0: 2069 6620 616e 6f6d 616c 795f 696e 7465   if anomaly_inte
+000133b0: 7276 656e 7469 6f6e 2069 7320 6e6f 7420  rvention is not 
+000133c0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000133d0: 2020 2061 6e6f 6d61 6c79 5f64 6574 6563     anomaly_detec
+000133e0: 746f 725f 7061 7261 6d73 203d 2041 6e6f  tor_params = Ano
+000133f0: 6d61 6c79 5265 6d6f 7661 6c2e 6765 745f  malyRemoval.get_
+00013400: 6e65 775f 7061 7261 6d73 286d 6574 686f  new_params(metho
+00013410: 643d 6d65 7468 6f64 290d 0a20 2020 2020  d=method)..     
+00013420: 2020 2020 2020 2069 6620 616e 6f6d 616c         if anomal
+00013430: 795f 696e 7465 7276 656e 7469 6f6e 203d  y_intervention =
+00013440: 3d20 226d 6f64 656c 223a 0d0a 2020 2020  = "model":..    
+00013450: 2020 2020 2020 2020 2020 2020 616e 6f6d              anom
+00013460: 616c 795f 696e 7465 7276 656e 7469 6f6e  aly_intervention
+00013470: 203d 2067 656e 6572 616c 5f74 656d 706c   = general_templ
+00013480: 6174 652e 7361 6d70 6c65 2831 292e 746f  ate.sample(1).to
+00013490: 5f64 6963 7428 2272 6563 6f72 6473 2229  _dict("records")
+000134a0: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
+000134b0: 2020 2020 2020 2030 0d0a 2020 2020 2020         0..      
+000134c0: 2020 2020 2020 2020 2020 5d20 2023 2070            ]  # p
+000134d0: 6c61 6365 686f 6c64 6572 2c20 7072 6f62  laceholder, prob
+000134e0: 6162 6c79 0d0a 2020 2020 2020 2020 656c  ably..        el
+000134f0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00013500: 2061 6e6f 6d61 6c79 5f64 6574 6563 746f   anomaly_detecto
+00013510: 725f 7061 7261 6d73 203d 204e 6f6e 650d  r_params = None.
+00013520: 0a0d 0a20 2020 2020 2020 2023 2072 616e  ...        # ran
+00013530: 646f 6d20 6f72 2070 7265 7465 7374 6564  dom or pretested
+00013540: 2064 6566 6175 6c74 730d 0a20 2020 2020   defaults..     
+00013550: 2020 2074 7265 6e64 5f62 6173 6520 3d20     trend_base = 
+00013560: 7261 6e64 6f6d 2e63 686f 6963 6573 280d  random.choices(.
+00013570: 0a20 2020 2020 2020 2020 2020 205b 2770  .            ['p
+00013580: 6231 272c 2027 7062 3227 2c20 2770 6233  b1', 'pb2', 'pb3
+00013590: 272c 2027 7261 6e64 6f6d 275d 2c20 5b30  ', 'random'], [0
+000135a0: 2e31 2c20 302e 312c 2030 2e30 2c20 302e  .1, 0.1, 0.0, 0.
+000135b0: 385d 0d0a 2020 2020 2020 2020 295b 305d  8]..        )[0]
+000135c0: 0d0a 2020 2020 2020 2020 6966 2074 7265  ..        if tre
+000135d0: 6e64 5f62 6173 6520 3d3d 2022 7261 6e64  nd_base == "rand
+000135e0: 6f6d 223a 0d0a 2020 2020 2020 2020 2020  om":..          
+000135f0: 2020 6d6f 6465 6c5f 7374 7220 3d20 7261    model_str = ra
+00013600: 6e64 6f6d 2e63 686f 6963 6573 280d 0a20  ndom.choices(.. 
+00013610: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00013620: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013630: 2020 2020 2020 2741 7665 7261 6765 5661        'AverageVa
+00013640: 6c75 654e 6169 7665 272c 0d0a 2020 2020  lueNaive',..    
+00013650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013660: 274d 6574 7269 634d 6f74 6966 272c 0d0a  'MetricMotif',..
+00013670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013680: 2020 2020 224c 6173 7456 616c 7565 4e61      "LastValueNa
+00013690: 6976 6522 2c0d 0a20 2020 2020 2020 2020  ive",..         
+000136a0: 2020 2020 2020 2020 2020 2027 5365 6173             'Seas
+000136b0: 6f6e 616c 6974 794d 6f74 6966 272c 0d0a  onalityMotif',..
+000136c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136d0: 2020 2020 2757 696e 646f 7752 6567 7265      'WindowRegre
+000136e0: 7373 696f 6e27 2c0d 0a20 2020 2020 2020  ssion',..       
+000136f0: 2020 2020 2020 2020 2020 2020 2027 4152               'AR
+00013700: 444c 272c 0d0a 2020 2020 2020 2020 2020  DL',..          
+00013710: 2020 2020 2020 2020 2020 2756 4152 272c            'VAR',
 00013720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013730: 2020 2020 2020 224b 616c 6d61 6e53 7461        "KalmanSta
-00013740: 7465 5370 6163 6522 2c0d 0a20 2020 2020  teSpace",..     
-00013750: 2020 2020 2020 2020 2020 205d 2c0d 0a20             ],.. 
-00013760: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00013770: 302e 3035 2c20 302e 3035 2c20 302e 312c  0.05, 0.05, 0.1,
-00013780: 2030 2e30 352c 2030 2e30 352c 2030 2e31   0.05, 0.05, 0.1
-00013790: 352c 2030 2e30 352c 2030 2e30 352c 2030  5, 0.05, 0.05, 0
-000137a0: 2e30 352c 2030 2e30 355d 2c0d 0a20 2020  .05, 0.05],..   
-000137b0: 2020 2020 2020 2020 2020 2020 206b 3d31               k=1
-000137c0: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
-000137d0: 5b30 5d0d 0a20 2020 2020 2020 2020 2020  [0]..           
-000137e0: 2074 7265 6e64 5f6d 6f64 656c 203d 207b   trend_model = {
-000137f0: 274d 6f64 656c 273a 206d 6f64 656c 5f73  'Model': model_s
-00013800: 7472 7d0d 0a20 2020 2020 2020 2020 2020  tr}..           
-00013810: 2074 7265 6e64 5f6d 6f64 656c 5b27 4d6f   trend_model['Mo
-00013820: 6465 6c50 6172 616d 6574 6572 7327 5d20  delParameters'] 
-00013830: 3d20 4d6f 6465 6c4d 6f6e 7374 6572 286d  = ModelMonster(m
-00013840: 6f64 656c 5f73 7472 292e 6765 745f 6e65  odel_str).get_ne
-00013850: 775f 7061 7261 6d73 280d 0a20 2020 2020  w_params(..     
-00013860: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-00013870: 643d 6d65 7468 6f64 0d0a 2020 2020 2020  d=method..      
-00013880: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
-00013890: 2020 2020 2074 7265 6e64 5f74 7261 6e73       trend_trans
-000138a0: 666f 726d 6174 696f 6e20 3d20 5261 6e64  formation = Rand
-000138b0: 6f6d 5472 616e 7366 6f72 6d28 0d0a 2020  omTransform(..  
-000138c0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-000138d0: 616e 7366 6f72 6d65 725f 6c69 7374 3d22  ansformer_list="
-000138e0: 6661 7374 222c 0d0a 2020 2020 2020 2020  fast",..        
-000138f0: 2020 2020 2020 2020 7472 616e 7366 6f72          transfor
-00013900: 6d65 725f 6d61 785f 6465 7074 683d 332c  mer_max_depth=3,
-00013910: 2020 2320 7072 6f62 6162 6c79 2077 616e    # probably wan
-00013920: 7420 736f 6d65 206d 6f72 6520 7573 6162  t some more usab
-00013930: 6c65 2064 6566 6175 6c74 7320 6669 7273  le defaults firs
-00013940: 7420 6173 206d 616e 7920 7261 6e64 6f6d  t as many random
-00013950: 2061 7265 2073 656e 7365 6c65 7373 0d0a   are senseless..
-00013960: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00013970: 2020 2020 2020 2065 6c69 6620 7472 656e         elif tren
-00013980: 645f 6261 7365 203d 3d20 2770 6231 273a  d_base == 'pb1':
-00013990: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-000139a0: 656e 645f 6d6f 6465 6c20 3d20 7b27 4d6f  end_model = {'Mo
-000139b0: 6465 6c27 3a20 2741 5244 4c27 7d0d 0a20  del': 'ARDL'}.. 
-000139c0: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
-000139d0: 5f6d 6f64 656c 5b27 4d6f 6465 6c50 6172  _model['ModelPar
-000139e0: 616d 6574 6572 7327 5d20 3d20 7b0d 0a20  ameters'] = {.. 
-000139f0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00013a00: 6c61 6773 223a 2031 2c0d 0a20 2020 2020  lags": 1,..     
-00013a10: 2020 2020 2020 2020 2020 2022 7472 656e             "tren
-00013a20: 6422 3a20 226e 222c 0d0a 2020 2020 2020  d": "n",..      
-00013a30: 2020 2020 2020 2020 2020 226f 7264 6572            "order
-00013a40: 223a 2030 2c0d 0a20 2020 2020 2020 2020  ": 0,..         
-00013a50: 2020 2020 2020 2022 6361 7573 616c 223a         "causal":
-00013a60: 2046 616c 7365 2c0d 0a20 2020 2020 2020   False,..       
-00013a70: 2020 2020 2020 2020 2022 7265 6772 6573           "regres
-00013a80: 7369 6f6e 5f74 7970 6522 3a20 2273 696d  sion_type": "sim
-00013a90: 706c 6522 2c0d 0a20 2020 2020 2020 2020  ple",..         
-00013aa0: 2020 207d 0d0a 2020 2020 2020 2020 2020     }..          
-00013ab0: 2020 7472 656e 645f 7472 616e 7366 6f72    trend_transfor
-00013ac0: 6d61 7469 6f6e 203d 207b 0d0a 2020 2020  mation = {..    
-00013ad0: 2020 2020 2020 2020 2020 2020 2266 696c              "fil
-00013ae0: 6c6e 6122 3a20 226e 6561 7265 7374 222c  lna": "nearest",
-00013af0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013b00: 2020 2274 7261 6e73 666f 726d 6174 696f    "transformatio
-00013b10: 6e73 223a 207b 2230 223a 2022 5374 616e  ns": {"0": "Stan
-00013b20: 6461 7264 5363 616c 6572 222c 2022 3122  dardScaler", "1"
-00013b30: 3a20 2241 6e6f 6d61 6c79 5265 6d6f 7661  : "AnomalyRemova
-00013b40: 6c22 7d2c 0d0a 2020 2020 2020 2020 2020  l"},..          
-00013b50: 2020 2020 2020 2274 7261 6e73 666f 726d        "transform
-00013b60: 6174 696f 6e5f 7061 7261 6d73 223a 207b  ation_params": {
-00013b70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013b80: 2020 2020 2020 2230 223a 207b 7d2c 0d0a        "0": {},..
-00013b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ba0: 2020 2020 2231 223a 207b 0d0a 2020 2020      "1": {..    
-00013bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013bc0: 2020 2020 226d 6574 686f 6422 3a20 2249      "method": "I
-00013bd0: 5152 222c 0d0a 2020 2020 2020 2020 2020  QR",..          
-00013be0: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-00013bf0: 7261 6e73 666f 726d 5f64 6963 7422 3a20  ransform_dict": 
-00013c00: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
-00013c10: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00013c20: 6669 6c6c 6e61 223a 204e 6f6e 652c 0d0a  fillna": None,..
-00013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c40: 2020 2020 2020 2020 2020 2020 2274 7261              "tra
-00013c50: 6e73 666f 726d 6174 696f 6e73 223a 207b  nsformations": {
-00013c60: 2230 223a 2022 436c 6970 4f75 746c 6965  "0": "ClipOutlie
-00013c70: 7273 227d 2c0d 0a20 2020 2020 2020 2020  rs"},..         
+00013730: 2020 2020 2020 2755 6e69 7661 7269 6174        'Univariat
+00013740: 654d 6f74 6966 272c 0d0a 2020 2020 2020  eMotif',..      
+00013750: 2020 2020 2020 2020 2020 2020 2020 2755                'U
+00013760: 6e6f 6273 6572 7665 6443 6f6d 706f 6e65  nobservedCompone
+00013770: 6e74 7327 2c0d 0a20 2020 2020 2020 2020  nts',..         
+00013780: 2020 2020 2020 2020 2020 2022 4b61 6c6d             "Kalm
+00013790: 616e 5374 6174 6553 7061 6365 222c 0d0a  anStateSpace",..
+000137a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137b0: 2020 2020 2752 5256 4152 272c 0d0a 2020      'RRVAR',..  
+000137c0: 2020 2020 2020 2020 2020 2020 2020 5d2c                ],
+000137d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000137e0: 2020 5b30 2e30 352c 2030 2e30 352c 2030    [0.05, 0.05, 0
+000137f0: 2e31 2c20 302e 3035 2c20 302e 3035 2c20  .1, 0.05, 0.05, 
+00013800: 302e 3135 2c20 302e 3035 2c20 302e 3035  0.15, 0.05, 0.05
+00013810: 2c20 302e 3035 2c20 302e 3035 2c20 302e  , 0.05, 0.05, 0.
+00013820: 3035 5d2c 0d0a 2020 2020 2020 2020 2020  05],..          
+00013830: 2020 2020 2020 6b3d 312c 0d0a 2020 2020        k=1,..    
+00013840: 2020 2020 2020 2020 295b 305d 0d0a 2020          )[0]..  
+00013850: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
+00013860: 6d6f 6465 6c20 3d20 7b27 4d6f 6465 6c27  model = {'Model'
+00013870: 3a20 6d6f 6465 6c5f 7374 727d 0d0a 2020  : model_str}..  
+00013880: 2020 2020 2020 2020 2020 7472 656e 645f            trend_
+00013890: 6d6f 6465 6c5b 274d 6f64 656c 5061 7261  model['ModelPara
+000138a0: 6d65 7465 7273 275d 203d 204d 6f64 656c  meters'] = Model
+000138b0: 4d6f 6e73 7465 7228 6d6f 6465 6c5f 7374  Monster(model_st
+000138c0: 7229 2e67 6574 5f6e 6577 5f70 6172 616d  r).get_new_param
+000138d0: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
+000138e0: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
+000138f0: 640d 0a20 2020 2020 2020 2020 2020 2029  d..            )
+00013900: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+00013910: 656e 645f 7472 616e 7366 6f72 6d61 7469  end_transformati
+00013920: 6f6e 203d 2052 616e 646f 6d54 7261 6e73  on = RandomTrans
+00013930: 666f 726d 280d 0a20 2020 2020 2020 2020  form(..         
+00013940: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
+00013950: 6572 5f6c 6973 743d 2266 6173 7422 2c0d  er_list="fast",.
+00013960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013970: 2074 7261 6e73 666f 726d 6572 5f6d 6178   transformer_max
+00013980: 5f64 6570 7468 3d33 2c20 2023 2070 726f  _depth=3,  # pro
+00013990: 6261 626c 7920 7761 6e74 2073 6f6d 6520  bably want some 
+000139a0: 6d6f 7265 2075 7361 626c 6520 6465 6661  more usable defa
+000139b0: 756c 7473 2066 6972 7374 2061 7320 6d61  ults first as ma
+000139c0: 6e79 2072 616e 646f 6d20 6172 6520 7365  ny random are se
+000139d0: 6e73 656c 6573 730d 0a20 2020 2020 2020  nseless..       
+000139e0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+000139f0: 656c 6966 2074 7265 6e64 5f62 6173 6520  elif trend_base 
+00013a00: 3d3d 2027 7062 3127 3a0d 0a20 2020 2020  == 'pb1':..     
+00013a10: 2020 2020 2020 2074 7265 6e64 5f6d 6f64         trend_mod
+00013a20: 656c 203d 207b 274d 6f64 656c 273a 2027  el = {'Model': '
+00013a30: 4152 444c 277d 0d0a 2020 2020 2020 2020  ARDL'}..        
+00013a40: 2020 2020 7472 656e 645f 6d6f 6465 6c5b      trend_model[
+00013a50: 274d 6f64 656c 5061 7261 6d65 7465 7273  'ModelParameters
+00013a60: 275d 203d 207b 0d0a 2020 2020 2020 2020  '] = {..        
+00013a70: 2020 2020 2020 2020 226c 6167 7322 3a20          "lags": 
+00013a80: 312c 0d0a 2020 2020 2020 2020 2020 2020  1,..            
+00013a90: 2020 2020 2274 7265 6e64 223a 2022 6e22      "trend": "n"
+00013aa0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00013ab0: 2020 2022 6f72 6465 7222 3a20 302c 0d0a     "order": 0,..
+00013ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ad0: 2263 6175 7361 6c22 3a20 4661 6c73 652c  "causal": False,
+00013ae0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013af0: 2020 2272 6567 7265 7373 696f 6e5f 7479    "regression_ty
+00013b00: 7065 223a 2022 7369 6d70 6c65 222c 0d0a  pe": "simple",..
+00013b10: 2020 2020 2020 2020 2020 2020 7d0d 0a20              }.. 
+00013b20: 2020 2020 2020 2020 2020 2074 7265 6e64             trend
+00013b30: 5f74 7261 6e73 666f 726d 6174 696f 6e20  _transformation 
+00013b40: 3d20 7b0d 0a20 2020 2020 2020 2020 2020  = {..           
+00013b50: 2020 2020 2022 6669 6c6c 6e61 223a 2022       "fillna": "
+00013b60: 6e65 6172 6573 7422 2c0d 0a20 2020 2020  nearest",..     
+00013b70: 2020 2020 2020 2020 2020 2022 7472 616e             "tran
+00013b80: 7366 6f72 6d61 7469 6f6e 7322 3a20 7b22  sformations": {"
+00013b90: 3022 3a20 2253 7461 6e64 6172 6453 6361  0": "StandardSca
+00013ba0: 6c65 7222 2c20 2231 223a 2022 416e 6f6d  ler", "1": "Anom
+00013bb0: 616c 7952 656d 6f76 616c 227d 2c0d 0a20  alyRemoval"},.. 
+00013bc0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013bd0: 7472 616e 7366 6f72 6d61 7469 6f6e 5f70  transformation_p
+00013be0: 6172 616d 7322 3a20 7b0d 0a20 2020 2020  arams": {..     
+00013bf0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013c00: 3022 3a20 7b7d 2c0d 0a20 2020 2020 2020  0": {},..       
+00013c10: 2020 2020 2020 2020 2020 2020 2022 3122               "1"
+00013c20: 3a20 7b0d 0a20 2020 2020 2020 2020 2020  : {..           
+00013c30: 2020 2020 2020 2020 2020 2020 2022 6d65               "me
+00013c40: 7468 6f64 223a 2022 4951 5222 2c0d 0a20  thod": "IQR",.. 
+00013c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c60: 2020 2020 2020 2022 7472 616e 7366 6f72         "transfor
+00013c70: 6d5f 6469 6374 223a 207b 0d0a 2020 2020  m_dict": {..    
 00013c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c90: 2020 2022 7472 616e 7366 6f72 6d61 7469     "transformati
-00013ca0: 6f6e 5f70 6172 616d 7322 3a20 7b0d 0a20  on_params": {.. 
+00013c90: 2020 2020 2020 2020 2266 696c 6c6e 6122          "fillna"
+00013ca0: 3a20 4e6f 6e65 2c0d 0a20 2020 2020 2020  : None,..       
 00013cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cc0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00013cd0: 3022 3a20 7b22 6d65 7468 6f64 223a 2022  0": {"method": "
-00013ce0: 636c 6970 222c 2022 7374 645f 7468 7265  clip", "std_thre
-00013cf0: 7368 6f6c 6422 3a20 367d 0d0a 2020 2020  shold": 6}..    
-00013d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d10: 2020 2020 2020 2020 7d2c 0d0a 2020 2020          },..    
-00013d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d30: 2020 2020 7d2c 0d0a 2020 2020 2020 2020      },..        
-00013d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d50: 226d 6574 686f 645f 7061 7261 6d73 223a  "method_params":
-00013d60: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
-00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d80: 2269 7172 5f74 6872 6573 686f 6c64 223a  "iqr_threshold":
-00013d90: 2032 2e35 2c0d 0a20 2020 2020 2020 2020   2.5,..         
-00013da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013db0: 2020 2022 6971 725f 7175 616e 7469 6c65     "iqr_quantile
-00013dc0: 7322 3a20 5b30 2e32 352c 2030 2e37 355d  s": [0.25, 0.75]
-00013dd0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00013de0: 2020 2020 2020 2020 2020 207d 2c0d 0a20             },.. 
-00013df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013e00: 2020 2020 2020 2022 6669 6c6c 6e61 223a         "fillna":
-00013e10: 2022 6666 696c 6c22 2c0d 0a20 2020 2020   "ffill",..     
-00013e20: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00013e30: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00013e40: 2020 207d 2c0d 0a20 2020 2020 2020 2020     },..         
-00013e50: 2020 207d 0d0a 2020 2020 2020 2020 656c     }..        el
-00013e60: 6966 2074 7265 6e64 5f62 6173 6520 3d3d  if trend_base ==
-00013e70: 2027 7062 3227 3a0d 0a20 2020 2020 2020   'pb2':..       
-00013e80: 2020 2020 2074 7265 6e64 5f6d 6f64 656c       trend_model
-00013e90: 203d 207b 274d 6f64 656c 273a 2027 5769   = {'Model': 'Wi
-00013ea0: 6e64 6f77 5265 6772 6573 7369 6f6e 277d  ndowRegression'}
-00013eb0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00013ec0: 656e 645f 6d6f 6465 6c5b 274d 6f64 656c  end_model['Model
-00013ed0: 5061 7261 6d65 7465 7273 275d 203d 207b  Parameters'] = {
-00013ee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013ef0: 2020 2277 696e 646f 775f 7369 7a65 223a    "window_size":
-00013f00: 2031 322c 0d0a 2020 2020 2020 2020 2020   12,..          
-00013f10: 2020 2020 2020 2269 6e70 7574 5f64 696d        "input_dim
-00013f20: 223a 2022 756e 6976 6172 6961 7465 222c  ": "univariate",
-00013f30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013f40: 2020 226f 7574 7075 745f 6469 6d22 3a20    "output_dim": 
-00013f50: 2231 7374 6570 222c 0d0a 2020 2020 2020  "1step",..      
-00013f60: 2020 2020 2020 2020 2020 226e 6f72 6d61            "norma
-00013f70: 6c69 7a65 5f77 696e 646f 7722 3a20 4661  lize_window": Fa
-00013f80: 6c73 652c 0d0a 2020 2020 2020 2020 2020  lse,..          
-00013f90: 2020 2020 2020 226d 6178 5f77 696e 646f        "max_windo
-00013fa0: 7773 223a 2038 3030 302c 0d0a 2020 2020  ws": 8000,..    
-00013fb0: 2020 2020 2020 2020 2020 2020 2272 6567              "reg
-00013fc0: 7265 7373 696f 6e5f 7479 7065 223a 204e  ression_type": N
-00013fd0: 6f6e 652c 0d0a 2020 2020 2020 2020 2020  one,..          
-00013fe0: 2020 2020 2020 2272 6567 7265 7373 696f        "regressio
-00013ff0: 6e5f 6d6f 6465 6c22 3a20 7b0d 0a20 2020  n_model": {..   
-00014000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014010: 2022 6d6f 6465 6c22 3a20 2245 7874 7261   "model": "Extra
-00014020: 5472 6565 7322 2c0d 0a20 2020 2020 2020  Trees",..       
-00014030: 2020 2020 2020 2020 2020 2020 2022 6d6f               "mo
-00014040: 6465 6c5f 7061 7261 6d73 223a 207b 0d0a  del_params": {..
-00014050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014060: 2020 2020 2020 2020 226e 5f65 7374 696d          "n_estim
-00014070: 6174 6f72 7322 3a20 3130 302c 0d0a 2020  ators": 100,..  
-00014080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014090: 2020 2020 2020 226d 696e 5f73 616d 706c        "min_sampl
-000140a0: 6573 5f6c 6561 6622 3a20 312c 0d0a 2020  es_leaf": 1,..  
-000140b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000140c0: 2020 2020 2020 226d 6178 5f64 6570 7468        "max_depth
-000140d0: 223a 2032 302c 0d0a 2020 2020 2020 2020  ": 20,..        
-000140e0: 2020 2020 2020 2020 2020 2020 7d2c 0d0a              },..
-000140f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014100: 7d2c 0d0a 2020 2020 2020 2020 2020 2020  },..            
-00014110: 7d0d 0a20 2020 2020 2020 2020 2020 2074  }..            t
-00014120: 7265 6e64 5f74 7261 6e73 666f 726d 6174  rend_transformat
-00014130: 696f 6e20 3d20 7b0d 0a20 2020 2020 2020  ion = {..       
-00014140: 2020 2020 2020 2020 2022 6669 6c6c 6e61           "fillna
-00014150: 223a 2022 6666 696c 6c22 2c0d 0a20 2020  ": "ffill",..   
-00014160: 2020 2020 2020 2020 2020 2020 2022 7472               "tr
-00014170: 616e 7366 6f72 6d61 7469 6f6e 7322 3a20  ansformations": 
-00014180: 7b22 3022 3a20 2241 6e6f 6d61 6c79 5265  {"0": "AnomalyRe
-00014190: 6d6f 7661 6c22 2c20 2231 223a 2022 526f  moval", "1": "Ro
-000141a0: 6275 7374 5363 616c 6572 227d 2c0d 0a20  bustScaler"},.. 
-000141b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000141c0: 7472 616e 7366 6f72 6d61 7469 6f6e 5f70  transformation_p
-000141d0: 6172 616d 7322 3a20 7b0d 0a20 2020 2020  arams": {..     
-000141e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000141f0: 3022 3a20 7b0d 0a20 2020 2020 2020 2020  0": {..         
-00014200: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00014210: 6d65 7468 6f64 223a 2022 4951 5222 2c0d  method": "IQR",.
-00014220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014230: 2020 2020 2020 2020 2022 7472 616e 7366           "transf
-00014240: 6f72 6d5f 6469 6374 223a 207b 0d0a 2020  orm_dict": {..  
-00014250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014260: 2020 2020 2020 2020 2020 2266 696c 6c6e            "filln
-00014270: 6122 3a20 4e6f 6e65 2c0d 0a20 2020 2020  a": None,..     
-00014280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014290: 2020 2020 2020 2022 7472 616e 7366 6f72         "transfor
-000142a0: 6d61 7469 6f6e 7322 3a20 7b22 3022 3a20  mations": {"0": 
-000142b0: 2243 6c69 704f 7574 6c69 6572 7322 7d2c  "ClipOutliers"},
-000142c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000142d0: 2020 2020 2020 2020 2020 2020 2020 2274                "t
-000142e0: 7261 6e73 666f 726d 6174 696f 6e5f 7061  ransformation_pa
-000142f0: 7261 6d73 223a 207b 0d0a 2020 2020 2020  rams": {..      
+00013cc0: 2020 2020 2022 7472 616e 7366 6f72 6d61       "transforma
+00013cd0: 7469 6f6e 7322 3a20 7b22 3022 3a20 2243  tions": {"0": "C
+00013ce0: 6c69 704f 7574 6c69 6572 7322 7d2c 0d0a  lipOutliers"},..
+00013cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d00: 2020 2020 2020 2020 2020 2020 2274 7261              "tra
+00013d10: 6e73 666f 726d 6174 696f 6e5f 7061 7261  nsformation_para
+00013d20: 6d73 223a 207b 0d0a 2020 2020 2020 2020  ms": {..        
+00013d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d40: 2020 2020 2020 2020 2230 223a 207b 226d          "0": {"m
+00013d50: 6574 686f 6422 3a20 2263 6c69 7022 2c20  ethod": "clip", 
+00013d60: 2273 7464 5f74 6872 6573 686f 6c64 223a  "std_threshold":
+00013d70: 2036 7d0d 0a20 2020 2020 2020 2020 2020   6}..           
+00013d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d90: 207d 2c0d 0a20 2020 2020 2020 2020 2020   },..           
+00013da0: 2020 2020 2020 2020 2020 2020 207d 2c0d               },.
+00013db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013dc0: 2020 2020 2020 2020 2022 6d65 7468 6f64           "method
+00013dd0: 5f70 6172 616d 7322 3a20 7b0d 0a20 2020  _params": {..   
+00013de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013df0: 2020 2020 2020 2020 2022 6971 725f 7468           "iqr_th
+00013e00: 7265 7368 6f6c 6422 3a20 322e 352c 0d0a  reshold": 2.5,..
+00013e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e20: 2020 2020 2020 2020 2020 2020 2269 7172              "iqr
+00013e30: 5f71 7561 6e74 696c 6573 223a 205b 302e  _quantiles": [0.
+00013e40: 3235 2c20 302e 3735 5d2c 0d0a 2020 2020  25, 0.75],..    
+00013e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e60: 2020 2020 7d2c 0d0a 2020 2020 2020 2020      },..        
+00013e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e80: 2266 696c 6c6e 6122 3a20 2266 6669 6c6c  "fillna": "ffill
+00013e90: 222c 0d0a 2020 2020 2020 2020 2020 2020  ",..            
+00013ea0: 2020 2020 2020 2020 7d2c 0d0a 2020 2020          },..    
+00013eb0: 2020 2020 2020 2020 2020 2020 7d2c 0d0a              },..
+00013ec0: 2020 2020 2020 2020 2020 2020 7d0d 0a20              }.. 
+00013ed0: 2020 2020 2020 2065 6c69 6620 7472 656e         elif tren
+00013ee0: 645f 6261 7365 203d 3d20 2770 6232 273a  d_base == 'pb2':
+00013ef0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+00013f00: 656e 645f 6d6f 6465 6c20 3d20 7b27 4d6f  end_model = {'Mo
+00013f10: 6465 6c27 3a20 2757 696e 646f 7752 6567  del': 'WindowReg
+00013f20: 7265 7373 696f 6e27 7d0d 0a20 2020 2020  ression'}..     
+00013f30: 2020 2020 2020 2074 7265 6e64 5f6d 6f64         trend_mod
+00013f40: 656c 5b27 4d6f 6465 6c50 6172 616d 6574  el['ModelParamet
+00013f50: 6572 7327 5d20 3d20 7b0d 0a20 2020 2020  ers'] = {..     
+00013f60: 2020 2020 2020 2020 2020 2022 7769 6e64             "wind
+00013f70: 6f77 5f73 697a 6522 3a20 3132 2c0d 0a20  ow_size": 12,.. 
+00013f80: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00013f90: 696e 7075 745f 6469 6d22 3a20 2275 6e69  input_dim": "uni
+00013fa0: 7661 7269 6174 6522 2c0d 0a20 2020 2020  variate",..     
+00013fb0: 2020 2020 2020 2020 2020 2022 6f75 7470             "outp
+00013fc0: 7574 5f64 696d 223a 2022 3173 7465 7022  ut_dim": "1step"
+00013fd0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00013fe0: 2020 2022 6e6f 726d 616c 697a 655f 7769     "normalize_wi
+00013ff0: 6e64 6f77 223a 2046 616c 7365 2c0d 0a20  ndow": False,.. 
+00014000: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00014010: 6d61 785f 7769 6e64 6f77 7322 3a20 3830  max_windows": 80
+00014020: 3030 2c0d 0a20 2020 2020 2020 2020 2020  00,..           
+00014030: 2020 2020 2022 7265 6772 6573 7369 6f6e       "regression
+00014040: 5f74 7970 6522 3a20 4e6f 6e65 2c0d 0a20  _type": None,.. 
+00014050: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00014060: 7265 6772 6573 7369 6f6e 5f6d 6f64 656c  regression_model
+00014070: 223a 207b 0d0a 2020 2020 2020 2020 2020  ": {..          
+00014080: 2020 2020 2020 2020 2020 226d 6f64 656c            "model
+00014090: 223a 2022 4578 7472 6154 7265 6573 222c  ": "ExtraTrees",
+000140a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000140b0: 2020 2020 2020 226d 6f64 656c 5f70 6172        "model_par
+000140c0: 616d 7322 3a20 7b0d 0a20 2020 2020 2020  ams": {..       
+000140d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000140e0: 2022 6e5f 6573 7469 6d61 746f 7273 223a   "n_estimators":
+000140f0: 2031 3030 2c0d 0a20 2020 2020 2020 2020   100,..         
+00014100: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00014110: 6d69 6e5f 7361 6d70 6c65 735f 6c65 6166  min_samples_leaf
+00014120: 223a 2031 2c0d 0a20 2020 2020 2020 2020  ": 1,..         
+00014130: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00014140: 6d61 785f 6465 7074 6822 3a20 3230 2c0d  max_depth": 20,.
+00014150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014160: 2020 2020 207d 2c0d 0a20 2020 2020 2020       },..       
+00014170: 2020 2020 2020 2020 207d 2c0d 0a20 2020           },..   
+00014180: 2020 2020 2020 2020 207d 0d0a 2020 2020           }..    
+00014190: 2020 2020 2020 2020 7472 656e 645f 7472          trend_tr
+000141a0: 616e 7366 6f72 6d61 7469 6f6e 203d 207b  ansformation = {
+000141b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000141c0: 2020 2266 696c 6c6e 6122 3a20 2266 6669    "fillna": "ffi
+000141d0: 6c6c 222c 0d0a 2020 2020 2020 2020 2020  ll",..          
+000141e0: 2020 2020 2020 2274 7261 6e73 666f 726d        "transform
+000141f0: 6174 696f 6e73 223a 207b 2230 223a 2022  ations": {"0": "
+00014200: 416e 6f6d 616c 7952 656d 6f76 616c 222c  AnomalyRemoval",
+00014210: 2022 3122 3a20 2252 6f62 7573 7453 6361   "1": "RobustSca
+00014220: 6c65 7222 7d2c 0d0a 2020 2020 2020 2020  ler"},..        
+00014230: 2020 2020 2020 2020 2274 7261 6e73 666f          "transfo
+00014240: 726d 6174 696f 6e5f 7061 7261 6d73 223a  rmation_params":
+00014250: 207b 0d0a 2020 2020 2020 2020 2020 2020   {..            
+00014260: 2020 2020 2020 2020 2230 223a 207b 0d0a          "0": {..
+00014270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014280: 2020 2020 2020 2020 226d 6574 686f 6422          "method"
+00014290: 3a20 2249 5152 222c 0d0a 2020 2020 2020  : "IQR",..      
+000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142b0: 2020 2274 7261 6e73 666f 726d 5f64 6963    "transform_dic
+000142c0: 7422 3a20 7b0d 0a20 2020 2020 2020 2020  t": {..         
+000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142e0: 2020 2022 6669 6c6c 6e61 223a 204e 6f6e     "fillna": Non
+000142f0: 652c 0d0a 2020 2020 2020 2020 2020 2020  e,..            
 00014300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014310: 2020 2020 2020 2020 2020 2230 223a 207b            "0": {
-00014320: 226d 6574 686f 6422 3a20 2263 6c69 7022  "method": "clip"
-00014330: 2c20 2273 7464 5f74 6872 6573 686f 6c64  , "std_threshold
-00014340: 223a 2036 7d0d 0a20 2020 2020 2020 2020  ": 6}..         
-00014350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014360: 2020 207d 2c0d 0a20 2020 2020 2020 2020     },..         
-00014370: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00014380: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00014390: 2020 2020 2020 2020 2020 2022 6d65 7468             "meth
-000143a0: 6f64 5f70 6172 616d 7322 3a20 7b0d 0a20  od_params": {.. 
-000143b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000143c0: 2020 2020 2020 2020 2020 2022 6971 725f             "iqr_
-000143d0: 7468 7265 7368 6f6c 6422 3a20 322e 352c  threshold": 2.5,
-000143e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000143f0: 2020 2020 2020 2020 2020 2020 2020 2269                "i
-00014400: 7172 5f71 7561 6e74 696c 6573 223a 205b  qr_quantiles": [
-00014410: 302e 3235 2c20 302e 3735 5d2c 0d0a 2020  0.25, 0.75],..  
-00014420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014430: 2020 2020 2020 7d2c 0d0a 2020 2020 2020        },..      
-00014440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014450: 2020 2266 696c 6c6e 6122 3a20 2266 6669    "fillna": "ffi
-00014460: 6c6c 222c 0d0a 2020 2020 2020 2020 2020  ll",..          
-00014470: 2020 2020 2020 2020 2020 7d2c 0d0a 2020            },..  
-00014480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014490: 2020 2231 223a 207b 7d2c 0d0a 2020 2020    "1": {},..    
-000144a0: 2020 2020 2020 2020 2020 2020 7d2c 0d0a              },..
-000144b0: 2020 2020 2020 2020 2020 2020 7d0d 0a0d              }...
-000144c0: 0a20 2020 2020 2020 2074 7265 6e64 5f61  .        trend_a
-000144d0: 6e6f 6d61 6c79 5f69 6e74 6572 7665 6e74  nomaly_intervent
-000144e0: 696f 6e20 3d20 7261 6e64 6f6d 2e63 686f  ion = random.cho
-000144f0: 6963 6573 285b 4e6f 6e65 2c20 2764 6574  ices([None, 'det
-00014500: 6563 745f 6f6e 6c79 275d 2c20 5b30 2e35  ect_only'], [0.5
-00014510: 2c20 302e 355d 295b 0d0a 2020 2020 2020  , 0.5])[..      
-00014520: 2020 2020 2020 300d 0a20 2020 2020 2020        0..       
-00014530: 205d 0d0a 2020 2020 2020 2020 6966 2074   ]..        if t
-00014540: 7265 6e64 5f61 6e6f 6d61 6c79 5f69 6e74  rend_anomaly_int
-00014550: 6572 7665 6e74 696f 6e20 6973 206e 6f74  ervention is not
-00014560: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00014570: 2020 2020 7472 656e 645f 616e 6f6d 616c      trend_anomal
-00014580: 795f 6465 7465 6374 6f72 5f70 6172 616d  y_detector_param
-00014590: 7320 3d20 416e 6f6d 616c 7952 656d 6f76  s = AnomalyRemov
-000145a0: 616c 2e67 6574 5f6e 6577 5f70 6172 616d  al.get_new_param
-000145b0: 7328 6d65 7468 6f64 3d6d 6574 686f 6429  s(method=method)
-000145c0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-000145d0: 0a20 2020 2020 2020 2020 2020 2074 7265  .            tre
-000145e0: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
-000145f0: 746f 725f 7061 7261 6d73 203d 204e 6f6e  tor_params = Non
-00014600: 650d 0a20 2020 2020 2020 206c 696e 6561  e..        linea
-00014610: 725f 6d6f 6465 6c20 3d20 7261 6e64 6f6d  r_model = random
-00014620: 2e63 686f 6963 6573 280d 0a20 2020 2020  .choices(..     
-00014630: 2020 2020 2020 205b 0d0a 2020 2020 2020         [..      
-00014640: 2020 2020 2020 2020 2020 276c 7374 7371            'lstsq
-00014650: 272c 0d0a 2020 2020 2020 2020 2020 2020  ',..            
-00014660: 2020 2020 276c 696e 616c 675f 736f 6c76      'linalg_solv
-00014670: 6527 2c0d 0a20 2020 2020 2020 2020 2020  e',..           
-00014680: 2020 2020 2027 6c31 5f6e 6f72 6d27 2c0d       'l1_norm',.
-00014690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000146a0: 2027 6477 6165 5f6e 6f72 6d27 2c0d 0a20   'dwae_norm',.. 
-000146b0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-000146c0: 7175 616e 7469 6c65 5f6e 6f72 6d27 2c0d  quantile_norm',.
-000146d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000146e0: 2027 6c31 5f70 6f73 6974 6976 6527 2c0d   'l1_positive',.
-000146f0: 0a20 2020 2020 2020 2020 2020 205d 2c0d  .            ],.
-00014700: 0a20 2020 2020 2020 2020 2020 205b 302e  .            [0.
-00014710: 362c 2030 2e32 2c20 302e 312c 2030 2e30  6, 0.2, 0.1, 0.0
-00014720: 352c 2030 2e30 322c 2030 2e30 335d 2c0d  5, 0.02, 0.03],.
-00014730: 0a20 2020 2020 2020 2029 5b30 5d0d 0a20  .        )[0].. 
-00014740: 2020 2020 2020 2072 6563 656e 6379 5f77         recency_w
-00014750: 6569 6768 7469 6e67 203d 2072 616e 646f  eighting = rando
-00014760: 6d2e 6368 6f69 6365 7328 0d0a 2020 2020  m.choices(..    
-00014770: 2020 2020 2020 2020 5b4e 6f6e 652c 2030          [None, 0
-00014780: 2e30 352c 2030 2e31 2c20 302e 3235 5d2c  .05, 0.1, 0.25],
-00014790: 205b 302e 372c 2030 2e31 2c20 302e 312c   [0.7, 0.1, 0.1,
-000147a0: 2030 2e31 5d0d 0a20 2020 2020 2020 2029   0.1]..        )
-000147b0: 5b30 5d0d 0a20 2020 2020 2020 2069 6620  [0]..        if 
-000147c0: 6c69 6e65 6172 5f6d 6f64 656c 2069 6e20  linear_model in 
-000147d0: 5b27 6c73 7473 7127 5d3a 0d0a 2020 2020  ['lstsq']:..    
-000147e0: 2020 2020 2020 2020 6c69 6e65 6172 5f6d          linear_m
-000147f0: 6f64 656c 203d 207b 0d0a 2020 2020 2020  odel = {..      
-00014800: 2020 2020 2020 2020 2020 276d 6f64 656c            'model
-00014810: 273a 206c 696e 6561 725f 6d6f 6465 6c2c  ': linear_model,
-00014820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00014830: 2020 276c 616d 6264 6127 3a20 7261 6e64    'lambda': rand
-00014840: 6f6d 2e63 686f 6963 6573 280d 0a20 2020  om.choices(..   
-00014850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014860: 205b 4e6f 6e65 2c20 302e 312c 2031 2c20   [None, 0.1, 1, 
-00014870: 3130 2c20 3130 305d 2c20 5b30 2e37 2c20  10, 100], [0.7, 
-00014880: 302e 312c 2030 2e31 2c20 302e 312c 2030  0.1, 0.1, 0.1, 0
-00014890: 2e30 355d 0d0a 2020 2020 2020 2020 2020  .05]..          
-000148a0: 2020 2020 2020 295b 305d 2c0d 0a20 2020        )[0],..   
-000148b0: 2020 2020 2020 2020 2020 2020 2027 7265               're
-000148c0: 6365 6e63 795f 7765 6967 6874 696e 6727  cency_weighting'
-000148d0: 3a20 7265 6365 6e63 795f 7765 6967 6874  : recency_weight
-000148e0: 696e 672c 0d0a 2020 2020 2020 2020 2020  ing,..          
-000148f0: 2020 7d0d 0a20 2020 2020 2020 2069 6620    }..        if 
-00014900: 6c69 6e65 6172 5f6d 6f64 656c 2069 6e20  linear_model in 
-00014910: 5b27 6c69 6e61 6c67 5f73 6f6c 7665 275d  ['linalg_solve']
-00014920: 3a0d 0a20 2020 2020 2020 2020 2020 206c  :..            l
-00014930: 696e 6561 725f 6d6f 6465 6c20 3d20 7b0d  inear_model = {.
-00014940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014950: 2027 6d6f 6465 6c27 3a20 6c69 6e65 6172   'model': linear
-00014960: 5f6d 6f64 656c 2c0d 0a20 2020 2020 2020  _model,..       
-00014970: 2020 2020 2020 2020 2027 6c61 6d62 6461           'lambda
-00014980: 273a 2072 616e 646f 6d2e 6368 6f69 6365  ': random.choice
-00014990: 7328 5b30 2c20 302e 312c 2031 2c20 3130  s([0, 0.1, 1, 10
-000149a0: 5d2c 205b 302e 342c 2030 2e32 2c20 302e  ], [0.4, 0.2, 0.
-000149b0: 322c 2030 2e32 5d29 5b30 5d2c 0d0a 2020  2, 0.2])[0],..  
-000149c0: 2020 2020 2020 2020 2020 2020 2020 2772                'r
-000149d0: 6563 656e 6379 5f77 6569 6768 7469 6e67  ecency_weighting
-000149e0: 273a 2072 6563 656e 6379 5f77 6569 6768  ': recency_weigh
-000149f0: 7469 6e67 2c0d 0a20 2020 2020 2020 2020  ting,..         
-00014a00: 2020 207d 0d0a 2020 2020 2020 2020 656c     }..        el
-00014a10: 6966 206c 696e 6561 725f 6d6f 6465 6c20  if linear_model 
-00014a20: 696e 205b 276c 315f 6e6f 726d 272c 2027  in ['l1_norm', '
-00014a30: 6477 6165 5f6e 6f72 6d27 2c20 2771 7561  dwae_norm', 'qua
-00014a40: 6e74 696c 655f 6e6f 726d 272c 2027 6c31  ntile_norm', 'l1
-00014a50: 5f70 6f73 6974 6976 6527 5d3a 0d0a 2020  _positive']:..  
-00014a60: 2020 2020 2020 2020 2020 6c69 6e65 6172            linear
-00014a70: 5f6d 6f64 656c 203d 207b 0d0a 2020 2020  _model = {..    
-00014a80: 2020 2020 2020 2020 2020 2020 276d 6f64              'mod
-00014a90: 656c 273a 206c 696e 6561 725f 6d6f 6465  el': linear_mode
-00014aa0: 6c2c 0d0a 2020 2020 2020 2020 2020 2020  l,..            
-00014ab0: 2020 2020 2772 6563 656e 6379 5f77 6569      'recency_wei
-00014ac0: 6768 7469 6e67 273a 2072 6563 656e 6379  ghting': recency
-00014ad0: 5f77 6569 6768 7469 6e67 2c0d 0a20 2020  _weighting,..   
-00014ae0: 2020 2020 2020 2020 2020 2020 2027 6d61               'ma
-00014af0: 7869 7465 7227 3a20 7261 6e64 6f6d 2e63  xiter': random.c
-00014b00: 686f 6963 6573 285b 3235 302c 2031 3530  hoices([250, 150
-00014b10: 3030 2c20 3235 3030 305d 2c20 5b30 2e32  00, 25000], [0.2
-00014b20: 2c20 302e 362c 2030 2e32 5d29 5b30 5d2c  , 0.6, 0.2])[0],
-00014b30: 0d0a 2020 2020 2020 2020 2020 2020 7d0d  ..            }.
-00014b40: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
-00014b50: 6f64 203d 3d20 2272 6567 7265 7373 6f72  od == "regressor
-00014b60: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
-00014b70: 7265 6772 6573 736f 7273 5f75 7365 6420  regressors_used 
-00014b80: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00014b90: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00014ba0: 2020 2072 6567 7265 7373 6f72 735f 7573     regressors_us
-00014bb0: 6564 203d 2072 616e 646f 6d2e 6368 6f69  ed = random.choi
-00014bc0: 6365 7328 5b54 7275 652c 2046 616c 7365  ces([True, False
-00014bd0: 5d2c 205b 302e 352c 2030 2e35 5d29 5b30  ], [0.5, 0.5])[0
-00014be0: 5d0d 0a20 2020 2020 2020 2061 725f 6c61  ]..        ar_la
-00014bf0: 6773 203d 2072 616e 646f 6d2e 6368 6f69  gs = random.choi
-00014c00: 6365 7328 0d0a 2020 2020 2020 2020 2020  ces(..          
-00014c10: 2020 5b4e 6f6e 652c 205b 315d 2c20 5b31    [None, [1], [1
-00014c20: 2c20 375d 2c20 5b37 5d2c 205b 7365 6173  , 7], [7], [seas
-00014c30: 6f6e 616c 5f69 6e74 2873 6d61 6c6c 3d54  onal_int(small=T
-00014c40: 7275 6529 5d5d 2c0d 0a20 2020 2020 2020  rue)]],..       
-00014c50: 2020 2020 205b 302e 392c 2030 2e30 3235       [0.9, 0.025
-00014c60: 2c20 302e 3032 352c 2030 2e30 352c 2030  , 0.025, 0.05, 0
-00014c70: 2e30 355d 2c0d 0a20 2020 2020 2020 2029  .05],..        )
-00014c80: 5b30 5d0d 0a20 2020 2020 2020 2061 725f  [0]..        ar_
-00014c90: 696e 7465 7261 6374 696f 6e5f 7365 6173  interaction_seas
-00014ca0: 6f6e 616c 6974 7920 3d20 4e6f 6e65 0d0a  onality = None..
-00014cb0: 2020 2020 2020 2020 6966 2061 725f 6c61          if ar_la
-00014cc0: 6773 2069 7320 6e6f 7420 4e6f 6e65 3a0d  gs is not None:.
-00014cd0: 0a20 2020 2020 2020 2020 2020 2061 725f  .            ar_
-00014ce0: 696e 7465 7261 6374 696f 6e5f 7365 6173  interaction_seas
-00014cf0: 6f6e 616c 6974 7920 3d20 7261 6e64 6f6d  onality = random
-00014d00: 2e63 686f 6963 6573 280d 0a20 2020 2020  .choices(..     
-00014d10: 2020 2020 2020 2020 2020 205b 4e6f 6e65             [None
-00014d20: 2c20 372c 2027 6461 796f 6677 6565 6b27  , 7, 'dayofweek'
-00014d30: 2c20 2763 6f6d 6d6f 6e5f 666f 7572 6965  , 'common_fourie
-00014d40: 7227 5d2c 205b 302e 342c 2030 2e32 2c20  r'], [0.4, 0.2, 
-00014d50: 302e 322c 2030 2e32 5d0d 0a20 2020 2020  0.2, 0.2]..     
-00014d60: 2020 2020 2020 2029 5b30 5d0d 0a20 2020         )[0]..   
-00014d70: 2020 2020 2072 6574 7572 6e20 7b0d 0a20       return {.. 
-00014d80: 2020 2020 2020 2020 2020 2022 7072 6570             "prep
-00014d90: 726f 6365 7373 696e 675f 7472 616e 7366  rocessing_transf
-00014da0: 6f72 6d61 7469 6f6e 223a 2052 616e 646f  ormation": Rando
-00014db0: 6d54 7261 6e73 666f 726d 280d 0a20 2020  mTransform(..   
-00014dc0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
-00014dd0: 6e73 666f 726d 6572 5f6c 6973 743d 6669  nsformer_list=fi
-00014de0: 6c74 6572 732c 2074 7261 6e73 666f 726d  lters, transform
-00014df0: 6572 5f6d 6178 5f64 6570 7468 3d32 2c20  er_max_depth=2, 
-00014e00: 616c 6c6f 775f 6e6f 6e65 3d54 7275 650d  allow_none=True.
-00014e10: 0a20 2020 2020 2020 2020 2020 2029 2c0d  .            ),.
-00014e20: 0a20 2020 2020 2020 2020 2020 2022 7363  .            "sc
-00014e30: 616c 696e 6722 3a20 7363 616c 696e 672c  aling": scaling,
-00014e40: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00014e50: 2270 6173 745f 696d 7061 6374 735f 696e  "past_impacts_in
-00014e60: 7465 7276 656e 7469 6f6e 223a 2073 656c  tervention": sel
-00014e70: 662e 7061 7374 5f69 6d70 6163 7473 5f69  f.past_impacts_i
-00014e80: 6e74 6572 7665 6e74 696f 6e2c 0d0a 2020  ntervention,..  
-00014e90: 2020 2020 2020 2020 2020 2273 6561 736f            "seaso
-00014ea0: 6e61 6c69 7469 6573 223a 2072 616e 646f  nalities": rando
-00014eb0: 6d2e 6368 6f69 6365 7328 0d0a 2020 2020  m.choices(..    
-00014ec0: 2020 2020 2020 2020 2020 2020 5b0d 0a20              [.. 
-00014ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ee0: 2020 205b 372c 2033 3635 2e32 355d 2c0d     [7, 365.25],.
-00014ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014f00: 2020 2020 205b 2264 6179 6f66 7765 656b       ["dayofweek
-00014f10: 222c 2033 3635 2e32 355d 2c0d 0a20 2020  ", 365.25],..   
-00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f30: 205b 226d 6f6e 7468 222c 2022 6461 796f   ["month", "dayo
-00014f40: 6677 6565 6b22 2c20 2277 6565 6b64 6179  fweek", "weekday
-00014f50: 6f66 6d6f 6e74 6822 5d2c 0d0a 2020 2020  ofmonth"],..    
-00014f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f70: 5b27 7765 656b 6461 796f 666d 6f6e 7468  ['weekdayofmonth
-00014f80: 272c 2027 636f 6d6d 6f6e 5f66 6f75 7269  ', 'common_fouri
-00014f90: 6572 275d 2c0d 0a20 2020 2020 2020 2020  er'],..         
-00014fa0: 2020 2020 2020 205d 2c0d 0a20 2020 2020         ],..     
-00014fb0: 2020 2020 2020 2020 2020 205b 302e 312c             [0.1,
-00014fc0: 2030 2e31 2c20 302e 312c 2030 2e30 355d   0.1, 0.1, 0.05]
-00014fd0: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
-00014fe0: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
-00014ff0: 2020 2261 725f 6c61 6773 223a 2061 725f    "ar_lags": ar_
-00015000: 6c61 6773 2c0d 0a20 2020 2020 2020 2020  lags,..         
-00015010: 2020 2022 6172 5f69 6e74 6572 6163 7469     "ar_interacti
-00015020: 6f6e 5f73 6561 736f 6e61 6c69 7479 223a  on_seasonality":
-00015030: 2061 725f 696e 7465 7261 6374 696f 6e5f   ar_interaction_
-00015040: 7365 6173 6f6e 616c 6974 792c 0d0a 2020  seasonality,..  
-00015050: 2020 2020 2020 2020 2020 2261 6e6f 6d61            "anoma
-00015060: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
-00015070: 6d73 223a 2061 6e6f 6d61 6c79 5f64 6574  ms": anomaly_det
-00015080: 6563 746f 725f 7061 7261 6d73 2c0d 0a20  ector_params,.. 
-00015090: 2020 2020 2020 2020 2020 2022 616e 6f6d             "anom
-000150a0: 616c 795f 696e 7465 7276 656e 7469 6f6e  aly_intervention
-000150b0: 223a 2061 6e6f 6d61 6c79 5f69 6e74 6572  ": anomaly_inter
-000150c0: 7665 6e74 696f 6e2c 0d0a 2020 2020 2020  vention,..      
-000150d0: 2020 2020 2020 2268 6f6c 6964 6179 5f64        "holiday_d
-000150e0: 6574 6563 746f 725f 7061 7261 6d73 223a  etector_params":
-000150f0: 2068 6f6c 6964 6179 5f70 6172 616d 732c   holiday_params,
-00015100: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00015110: 2268 6f6c 6964 6179 5f63 6f75 6e74 7269  "holiday_countri
-00015120: 6573 223a 2073 656c 662e 686f 6c69 6461  es": self.holida
-00015130: 795f 636f 756e 7472 6965 732c 0d0a 2020  y_countries,..  
-00015140: 2020 2020 2020 2020 2020 2268 6f6c 6964            "holid
-00015150: 6179 5f63 6f75 6e74 7269 6573 5f75 7365  ay_countries_use
-00015160: 6422 3a20 7261 6e64 6f6d 2e63 686f 6963  d": random.choic
-00015170: 6573 285b 5472 7565 2c20 4661 6c73 655d  es([True, False]
-00015180: 2c20 5b30 2e35 2c20 302e 355d 295b 305d  , [0.5, 0.5])[0]
-00015190: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-000151a0: 6d75 6c74 6976 6172 6961 7465 5f66 6561  multivariate_fea
-000151b0: 7475 7265 223a 2072 616e 646f 6d2e 6368  ture": random.ch
-000151c0: 6f69 6365 7328 0d0a 2020 2020 2020 2020  oices(..        
-000151d0: 2020 2020 2020 2020 5b4e 6f6e 652c 2022          [None, "
-000151e0: 6665 6174 7572 655f 6167 676c 6f6d 6572  feature_agglomer
-000151f0: 6174 696f 6e22 2c20 2767 726f 7570 5f61  ation", 'group_a
-00015200: 7665 7261 6765 272c 2027 6f73 6369 6c6c  verage', 'oscill
-00015210: 6174 6f72 275d 2c0d 0a20 2020 2020 2020  ator'],..       
-00015220: 2020 2020 2020 2020 205b 302e 392c 2030           [0.9, 0
-00015230: 2e31 2c20 302e 312c 2030 2e30 5d2c 0d0a  .1, 0.1, 0.0],..
-00015240: 2020 2020 2020 2020 2020 2020 295b 305d              )[0]
-00015250: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00015260: 6d75 6c74 6976 6172 6961 7465 5f74 7261  multivariate_tra
-00015270: 6e73 666f 726d 6174 696f 6e22 3a20 5261  nsformation": Ra
-00015280: 6e64 6f6d 5472 616e 7366 6f72 6d28 0d0a  ndomTransform(..
-00015290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152a0: 7472 616e 7366 6f72 6d65 725f 6c69 7374  transformer_list
-000152b0: 3d22 6661 7374 222c 0d0a 2020 2020 2020  ="fast",..      
-000152c0: 2020 2020 2020 2020 2020 7472 616e 7366            transf
-000152d0: 6f72 6d65 725f 6d61 785f 6465 7074 683d  ormer_max_depth=
-000152e0: 332c 2020 2320 7072 6f62 6162 6c79 2077  3,  # probably w
-000152f0: 616e 7420 736f 6d65 206d 6f72 6520 7573  ant some more us
-00015300: 6162 6c65 2064 6566 6175 6c74 7320 6669  able defaults fi
-00015310: 7273 7420 6173 206d 616e 7920 7261 6e64  rst as many rand
-00015320: 6f6d 2061 7265 2073 656e 7365 6c65 7373  om are senseless
-00015330: 0d0a 2020 2020 2020 2020 2020 2020 292c  ..            ),
-00015340: 0d0a 2020 2020 2020 2020 2020 2020 2272  ..            "r
-00015350: 6567 7265 7373 6f72 5f74 7261 6e73 666f  egressor_transfo
-00015360: 726d 6174 696f 6e22 3a20 5261 6e64 6f6d  rmation": Random
-00015370: 5472 616e 7366 6f72 6d28 0d0a 2020 2020  Transform(..    
-00015380: 2020 2020 2020 2020 2020 2020 7472 616e              tran
-00015390: 7366 6f72 6d65 725f 6c69 7374 3d7b 2a2a  sformer_list={**
-000153a0: 7363 616c 6572 732c 202a 2a64 6563 6f6d  scalers, **decom
-000153b0: 706f 7369 7469 6f6e 737d 2c0d 0a20 2020  positions},..   
-000153c0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
-000153d0: 6e73 666f 726d 6572 5f6d 6178 5f64 6570  nsformer_max_dep
-000153e0: 7468 3d31 2c0d 0a20 2020 2020 2020 2020  th=1,..         
-000153f0: 2020 2020 2020 2061 6c6c 6f77 5f6e 6f6e         allow_non
-00015400: 653d 4661 6c73 652c 0d0a 2020 2020 2020  e=False,..      
-00015410: 2020 2020 2020 2020 2020 6e6f 5f6e 616e            no_nan
-00015420: 5f66 696c 6c3d 4661 6c73 652c 2020 2320  _fill=False,  # 
-00015430: 7072 6f62 6162 6c79 2077 616e 7420 736f  probably want so
-00015440: 6d65 206d 6f72 6520 7573 6162 6c65 2064  me more usable d
-00015450: 6566 6175 6c74 7320 6669 7273 7420 6173  efaults first as
-00015460: 206d 616e 7920 7261 6e64 6f6d 2061 7265   many random are
-00015470: 2073 656e 7365 6c65 7373 0d0a 2020 2020   senseless..    
-00015480: 2020 2020 2020 2020 292c 0d0a 2020 2020          ),..    
-00015490: 2020 2020 2020 2020 2272 6567 7265 7373          "regress
-000154a0: 6f72 735f 7573 6564 223a 2072 6567 7265  ors_used": regre
-000154b0: 7373 6f72 735f 7573 6564 2c0d 0a20 2020  ssors_used,..   
-000154c0: 2020 2020 2020 2020 2022 6c69 6e65 6172           "linear
-000154d0: 5f6d 6f64 656c 223a 206c 696e 6561 725f  _model": linear_
-000154e0: 6d6f 6465 6c2c 0d0a 2020 2020 2020 2020  model,..        
-000154f0: 2020 2020 2272 616e 646f 6d77 616c 6b5f      "randomwalk_
-00015500: 6e22 3a20 7261 6e64 6f6d 2e63 686f 6963  n": random.choic
-00015510: 6573 285b 4e6f 6e65 2c20 3130 5d2c 205b  es([None, 10], [
-00015520: 302e 352c 2030 2e35 5d29 5b30 5d2c 0d0a  0.5, 0.5])[0],..
-00015530: 2020 2020 2020 2020 2020 2020 2274 7265              "tre
-00015540: 6e64 5f77 696e 646f 7722 3a20 7261 6e64  nd_window": rand
-00015550: 6f6d 2e63 686f 6963 6573 285b 332c 2031  om.choices([3, 1
-00015560: 352c 2039 302c 2033 3635 5d2c 205b 302e  5, 90, 365], [0.
-00015570: 322c 2030 2e32 2c20 302e 322c 2030 2e32  2, 0.2, 0.2, 0.2
-00015580: 5d29 5b30 5d2c 0d0a 2020 2020 2020 2020  ])[0],..        
-00015590: 2020 2020 2274 7265 6e64 5f73 7461 6e64      "trend_stand
-000155a0: 696e 223a 2072 616e 646f 6d2e 6368 6f69  in": random.choi
-000155b0: 6365 7328 0d0a 2020 2020 2020 2020 2020  ces(..          
-000155c0: 2020 2020 2020 5b4e 6f6e 652c 2027 7261        [None, 'ra
-000155d0: 6e64 6f6d 5f6e 6f72 6d61 6c27 2c20 2772  ndom_normal', 'r
-000155e0: 6f6c 6c69 6e67 5f74 7265 6e64 275d 2c0d  olling_trend'],.
-000155f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015600: 205b 302e 352c 2030 2e34 2c20 302e 315d   [0.5, 0.4, 0.1]
-00015610: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
-00015620: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
-00015630: 2020 2274 7265 6e64 5f61 6e6f 6d61 6c79    "trend_anomaly
-00015640: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
-00015650: 223a 2074 7265 6e64 5f61 6e6f 6d61 6c79  ": trend_anomaly
-00015660: 5f64 6574 6563 746f 725f 7061 7261 6d73  _detector_params
-00015670: 2c0d 0a20 2020 2020 2020 2020 2020 2023  ,..            #
-00015680: 2022 7472 656e 645f 616e 6f6d 616c 795f   "trend_anomaly_
-00015690: 696e 7465 7276 656e 7469 6f6e 223a 2074  intervention": t
-000156a0: 7265 6e64 5f61 6e6f 6d61 6c79 5f69 6e74  rend_anomaly_int
-000156b0: 6572 7665 6e74 696f 6e2c 0d0a 2020 2020  ervention,..    
-000156c0: 2020 2020 2020 2020 2274 7265 6e64 5f74          "trend_t
-000156d0: 7261 6e73 666f 726d 6174 696f 6e22 3a20  ransformation": 
-000156e0: 7472 656e 645f 7472 616e 7366 6f72 6d61  trend_transforma
-000156f0: 7469 6f6e 2c0d 0a20 2020 2020 2020 2020  tion,..         
-00015700: 2020 2022 7472 656e 645f 6d6f 6465 6c22     "trend_model"
-00015710: 3a20 7472 656e 645f 6d6f 6465 6c2c 0d0a  : trend_model,..
-00015720: 2020 2020 2020 2020 2020 2020 2274 7265              "tre
-00015730: 6e64 5f70 6869 223a 2072 616e 646f 6d2e  nd_phi": random.
-00015740: 6368 6f69 6365 7328 5b4e 6f6e 652c 2030  choices([None, 0
-00015750: 2e39 385d 2c20 5b30 2e39 2c20 302e 315d  .98], [0.9, 0.1]
-00015760: 295b 305d 2c0d 0a20 2020 2020 2020 207d  )[0],..        }
-00015770: 0d0a 0d0a 2020 2020 6465 6620 6765 745f  ....    def get_
-00015780: 7061 7261 6d73 2873 656c 6629 3a0d 0a20  params(self):.. 
-00015790: 2020 2020 2020 2072 6574 7572 6e20 7b0d         return {.
-000157a0: 0a20 2020 2020 2020 2020 2020 2022 7072  .            "pr
-000157b0: 6570 726f 6365 7373 696e 675f 7472 616e  eprocessing_tran
-000157c0: 7366 6f72 6d61 7469 6f6e 223a 2073 656c  sformation": sel
-000157d0: 662e 7072 6570 726f 6365 7373 696e 675f  f.preprocessing_
-000157e0: 7472 616e 7366 6f72 6d61 7469 6f6e 2c0d  transformation,.
-000157f0: 0a20 2020 2020 2020 2020 2020 2022 7363  .            "sc
-00015800: 616c 696e 6722 3a20 7365 6c66 2e73 6361  aling": self.sca
-00015810: 6c69 6e67 2c0d 0a20 2020 2020 2020 2020  ling,..         
-00015820: 2020 2022 7061 7374 5f69 6d70 6163 7473     "past_impacts
-00015830: 5f69 6e74 6572 7665 6e74 696f 6e22 3a20  _intervention": 
-00015840: 7365 6c66 2e70 6173 745f 696d 7061 6374  self.past_impact
-00015850: 735f 696e 7465 7276 656e 7469 6f6e 2c20  s_intervention, 
-00015860: 2023 206e 6f74 2069 6e20 6e65 770d 0a20   # not in new.. 
-00015870: 2020 2020 2020 2020 2020 2022 7365 6173             "seas
-00015880: 6f6e 616c 6974 6965 7322 3a20 7365 6c66  onalities": self
-00015890: 2e73 6561 736f 6e61 6c69 7469 6573 2c0d  .seasonalities,.
-000158a0: 0a20 2020 2020 2020 2020 2020 2022 6172  .            "ar
-000158b0: 5f6c 6167 7322 3a20 7365 6c66 2e61 725f  _lags": self.ar_
-000158c0: 6c61 6773 2c0d 0a20 2020 2020 2020 2020  lags,..         
-000158d0: 2020 2022 6172 5f69 6e74 6572 6163 7469     "ar_interacti
-000158e0: 6f6e 5f73 6561 736f 6e61 6c69 7479 223a  on_seasonality":
-000158f0: 2073 656c 662e 6172 5f69 6e74 6572 6163   self.ar_interac
-00015900: 7469 6f6e 5f73 6561 736f 6e61 6c69 7479  tion_seasonality
-00015910: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00015920: 2073 656c 662e 6172 5f6c 6167 7320 6973   self.ar_lags is
-00015930: 206e 6f74 204e 6f6e 650d 0a20 2020 2020   not None..     
-00015940: 2020 2020 2020 2065 6c73 6520 4e6f 6e65         else None
-00015950: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
-00015960: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00015970: 5f70 6172 616d 7322 3a20 7365 6c66 2e61  _params": self.a
-00015980: 6e6f 6d61 6c79 5f64 6574 6563 746f 725f  nomaly_detector_
-00015990: 7061 7261 6d73 2c0d 0a20 2020 2020 2020  params,..       
-000159a0: 2020 2020 2022 616e 6f6d 616c 795f 696e       "anomaly_in
-000159b0: 7465 7276 656e 7469 6f6e 223a 2073 656c  tervention": sel
-000159c0: 662e 616e 6f6d 616c 795f 696e 7465 7276  f.anomaly_interv
-000159d0: 656e 7469 6f6e 2c0d 0a20 2020 2020 2020  ention,..       
-000159e0: 2020 2020 2022 686f 6c69 6461 795f 6465       "holiday_de
-000159f0: 7465 6374 6f72 5f70 6172 616d 7322 3a20  tector_params": 
-00015a00: 7365 6c66 2e68 6f6c 6964 6179 5f64 6574  self.holiday_det
-00015a10: 6563 746f 725f 7061 7261 6d73 2c0d 0a20  ector_params,.. 
-00015a20: 2020 2020 2020 2020 2020 2023 2022 686f             # "ho
-00015a30: 6c69 6461 795f 696e 7465 7276 656e 7469  liday_interventi
-00015a40: 6f6e 223a 2073 656c 662e 686f 6c69 6461  on": self.holida
-00015a50: 795f 696e 7465 7276 656e 7469 6f6e 2c0d  y_intervention,.
-00015a60: 0a20 2020 2020 2020 2020 2020 2023 2022  .            # "
-00015a70: 686f 6c69 6461 795f 636f 756e 7472 6965  holiday_countrie
-00015a80: 7322 3a20 7365 6c66 2e68 6f6c 6964 6179  s": self.holiday
-00015a90: 5f63 6f75 6e74 7269 6573 2c0d 0a20 2020  _countries,..   
-00015aa0: 2020 2020 2020 2020 2022 686f 6c69 6461           "holida
-00015ab0: 795f 636f 756e 7472 6965 735f 7573 6564  y_countries_used
-00015ac0: 223a 2073 656c 662e 686f 6c69 6461 795f  ": self.holiday_
-00015ad0: 636f 756e 7472 6965 735f 7573 6564 2c0d  countries_used,.
-00015ae0: 0a20 2020 2020 2020 2020 2020 2022 6d75  .            "mu
-00015af0: 6c74 6976 6172 6961 7465 5f66 6561 7475  ltivariate_featu
-00015b00: 7265 223a 2073 656c 662e 6d75 6c74 6976  re": self.multiv
-00015b10: 6172 6961 7465 5f66 6561 7475 7265 2c0d  ariate_feature,.
-00015b20: 0a20 2020 2020 2020 2020 2020 2022 6d75  .            "mu
-00015b30: 6c74 6976 6172 6961 7465 5f74 7261 6e73  ltivariate_trans
-00015b40: 666f 726d 6174 696f 6e22 3a20 7365 6c66  formation": self
-00015b50: 2e6d 756c 7469 7661 7269 6174 655f 7472  .multivariate_tr
-00015b60: 616e 7366 6f72 6d61 7469 6f6e 0d0a 2020  ansformation..  
-00015b70: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-00015b80: 662e 6d75 6c74 6976 6172 6961 7465 5f66  f.multivariate_f
-00015b90: 6561 7475 7265 2069 7320 6e6f 7420 4e6f  eature is not No
-00015ba0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00015bb0: 656c 7365 204e 6f6e 652c 0d0a 2020 2020  else None,..    
-00015bc0: 2020 2020 2020 2020 2272 6567 7265 7373          "regress
-00015bd0: 6f72 5f74 7261 6e73 666f 726d 6174 696f  or_transformatio
-00015be0: 6e22 3a20 7365 6c66 2e72 6567 7265 7373  n": self.regress
-00015bf0: 6f72 5f74 7261 6e73 666f 726d 6174 696f  or_transformatio
-00015c00: 6e0d 0a20 2020 2020 2020 2020 2020 2069  n..            i
-00015c10: 6620 7365 6c66 2e72 6567 7265 7373 6f72  f self.regressor
-00015c20: 735f 7573 6564 0d0a 2020 2020 2020 2020  s_used..        
-00015c30: 2020 2020 656c 7365 204e 6f6e 652c 0d0a      else None,..
-00015c40: 2020 2020 2020 2020 2020 2020 2272 6567              "reg
-00015c50: 7265 7373 6f72 735f 7573 6564 223a 2073  ressors_used": s
-00015c60: 656c 662e 7265 6772 6573 736f 7273 5f75  elf.regressors_u
-00015c70: 7365 642c 0d0a 2020 2020 2020 2020 2020  sed,..          
-00015c80: 2020 226c 696e 6561 725f 6d6f 6465 6c22    "linear_model"
-00015c90: 3a20 7365 6c66 2e6c 696e 6561 725f 6d6f  : self.linear_mo
-00015ca0: 6465 6c2c 0d0a 2020 2020 2020 2020 2020  del,..          
-00015cb0: 2020 2272 616e 646f 6d77 616c 6b5f 6e22    "randomwalk_n"
-00015cc0: 3a20 7365 6c66 2e72 616e 646f 6d77 616c  : self.randomwal
-00015cd0: 6b5f 6e2c 0d0a 2020 2020 2020 2020 2020  k_n,..          
-00015ce0: 2020 2274 7265 6e64 5f77 696e 646f 7722    "trend_window"
-00015cf0: 3a20 7365 6c66 2e74 7265 6e64 5f77 696e  : self.trend_win
-00015d00: 646f 772c 0d0a 2020 2020 2020 2020 2020  dow,..          
-00015d10: 2020 2274 7265 6e64 5f73 7461 6e64 696e    "trend_standin
-00015d20: 223a 2073 656c 662e 7472 656e 645f 7374  ": self.trend_st
-00015d30: 616e 6469 6e2c 0d0a 2020 2020 2020 2020  andin,..        
-00015d40: 2020 2020 2274 7265 6e64 5f61 6e6f 6d61      "trend_anoma
-00015d50: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
-00015d60: 6d73 223a 2073 656c 662e 7472 656e 645f  ms": self.trend_
-00015d70: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-00015d80: 5f70 6172 616d 732c 0d0a 2020 2020 2020  _params,..      
-00015d90: 2020 2020 2020 2320 2274 7265 6e64 5f61        # "trend_a
-00015da0: 6e6f 6d61 6c79 5f69 6e74 6572 7665 6e74  nomaly_intervent
-00015db0: 696f 6e22 3a20 7365 6c66 2e74 7265 6e64  ion": self.trend
-00015dc0: 5f61 6e6f 6d61 6c79 5f69 6e74 6572 7665  _anomaly_interve
-00015dd0: 6e74 696f 6e2c 0d0a 2020 2020 2020 2020  ntion,..        
-00015de0: 2020 2020 2274 7265 6e64 5f74 7261 6e73      "trend_trans
-00015df0: 666f 726d 6174 696f 6e22 3a20 7365 6c66  formation": self
-00015e00: 2e74 7265 6e64 5f74 7261 6e73 666f 726d  .trend_transform
-00015e10: 6174 696f 6e2c 0d0a 2020 2020 2020 2020  ation,..        
-00015e20: 2020 2020 2274 7265 6e64 5f6d 6f64 656c      "trend_model
-00015e30: 223a 2073 656c 662e 7472 656e 645f 6d6f  ": self.trend_mo
-00015e40: 6465 6c2c 0d0a 2020 2020 2020 2020 2020  del,..          
-00015e50: 2020 2274 7265 6e64 5f70 6869 223a 2073    "trend_phi": s
-00015e60: 656c 662e 7472 656e 645f 7068 692c 0d0a  elf.trend_phi,..
-00015e70: 2020 2020 2020 2020 2020 2020 2320 2263              # "c
-00015e80: 6f6e 7374 7261 696e 7422 3a20 7365 6c66  onstraint": self
-00015e90: 2e63 6f6e 7374 7261 696e 742c 0d0a 2020  .constraint,..  
-00015ea0: 2020 2020 2020 7d0d 0a0d 0a20 2020 2064        }....    d
-00015eb0: 6566 2070 6c6f 745f 636f 6d70 6f6e 656e  ef plot_componen
-00015ec0: 7473 280d 0a20 2020 2020 2020 2073 656c  ts(..        sel
-00015ed0: 662c 0d0a 2020 2020 2020 2020 7072 6564  f,..        pred
-00015ee0: 6963 7469 6f6e 3d4e 6f6e 652c 0d0a 2020  iction=None,..  
-00015ef0: 2020 2020 2020 7365 7269 6573 3d4e 6f6e        series=Non
-00015f00: 652c 0d0a 2020 2020 2020 2020 6669 6773  e,..        figs
-00015f10: 697a 653d 2831 362c 2039 292c 0d0a 2020  ize=(16, 9),..  
-00015f20: 2020 2020 2020 746f 5f6f 7269 6769 6e5f        to_origin_
-00015f30: 7370 6163 653d 5472 7565 2c0d 0a20 2020  space=True,..   
-00015f40: 2020 2020 2074 6974 6c65 3d4e 6f6e 652c       title=None,
-00015f50: 0d0a 2020 2020 2020 2020 7374 6172 745f  ..        start_
-00015f60: 6461 7465 3d4e 6f6e 652c 0d0a 2020 2020  date=None,..    
-00015f70: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
-00015f80: 6572 6965 7320 6973 204e 6f6e 653a 0d0a  eries is None:..
-00015f90: 2020 2020 2020 2020 2020 2020 7365 7269              seri
-00015fa0: 6573 203d 2072 616e 646f 6d2e 6368 6f69  es = random.choi
-00015fb0: 6365 2873 656c 662e 636f 6c75 6d6e 5f6e  ce(self.column_n
-00015fc0: 616d 6573 290d 0a20 2020 2020 2020 2069  ames)..        i
-00015fd0: 6620 7469 746c 6520 6973 204e 6f6e 653a  f title is None:
-00015fe0: 0d0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
-00015ff0: 746c 6520 3d20 6622 4d6f 6465 6c20 436f  tle = f"Model Co
-00016000: 6d70 6f6e 656e 7473 2066 6f72 207b 7365  mponents for {se
-00016010: 7269 6573 7d22 0d0a 2020 2020 2020 2020  ries}"..        
-00016020: 706c 6f74 5f6c 6973 7420 3d20 5b5d 0d0a  plot_list = []..
-00016030: 2020 2020 2020 2020 6966 2070 7265 6469          if predi
-00016040: 6374 696f 6e20 6973 206e 6f74 204e 6f6e  ction is not Non
-00016050: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00016060: 706c 6f74 5f6c 6973 742e 6170 7065 6e64  plot_list.append
-00016070: 2870 7265 6469 6374 696f 6e2e 666f 7265  (prediction.fore
-00016080: 6361 7374 5b73 6572 6965 735d 2e72 656e  cast[series].ren
-00016090: 616d 6528 2266 6f72 6563 6173 7422 2929  ame("forecast"))
-000160a0: 0d0a 2020 2020 2020 2020 2020 2020 706c  ..            pl
-000160b0: 745f 6964 7820 3d20 7072 6564 6963 7469  t_idx = predicti
-000160c0: 6f6e 2e66 6f72 6563 6173 742e 696e 6465  on.forecast.inde
-000160d0: 780d 0a20 2020 2020 2020 2065 6c73 653a  x..        else:
-000160e0: 0d0a 2020 2020 2020 2020 2020 2020 706c  ..            pl
-000160f0: 745f 6964 7820 3d20 4e6f 6e65 0d0a 2020  t_idx = None..  
-00016100: 2020 2020 2020 706c 6f74 5f6c 6973 742e        plot_list.
-00016110: 6170 7065 6e64 2873 656c 662e 7072 6564  append(self.pred
-00016120: 6963 7465 645f 7472 656e 645b 7365 7269  icted_trend[seri
-00016130: 6573 5d2e 7265 6e61 6d65 2822 7472 656e  es].rename("tren
-00016140: 6422 2929 0d0a 2020 2020 2020 2020 6966  d"))..        if
-00016150: 2073 656c 662e 696d 7061 6374 7320 6973   self.impacts is
-00016160: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00016170: 2020 2020 2020 2020 706c 6f74 5f6c 6973          plot_lis
-00016180: 742e 6170 7065 6e64 2828 7365 6c66 2e69  t.append((self.i
-00016190: 6d70 6163 7473 5b73 6572 6965 735d 2e72  mpacts[series].r
-000161a0: 656e 616d 6528 2269 6d70 6163 7420 2522  ename("impact %"
-000161b0: 2920 2d20 312e 3029 202a 2031 3030 290d  ) - 1.0) * 100).
-000161c0: 0a20 2020 2020 2020 2069 6620 706c 745f  .        if plt_
-000161d0: 6964 7820 6973 204e 6f6e 653a 0d0a 2020  idx is None:..  
-000161e0: 2020 2020 2020 2020 2020 706c 6f74 5f6c            plot_l
-000161f0: 6973 742e 6170 7065 6e64 280d 0a20 2020  ist.append(..   
-00016200: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00016210: 662e 7072 6f63 6573 735f 636f 6d70 6f6e  f.process_compon
-00016220: 656e 7473 2874 6f5f 6f72 6967 696e 5f73  ents(to_origin_s
-00016230: 7061 6365 3d74 6f5f 6f72 6967 696e 5f73  pace=to_origin_s
-00016240: 7061 6365 295b 7365 7269 6573 5d0d 0a20  pace)[series].. 
-00016250: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00016260: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00016270: 2020 2020 2020 2020 2070 6c6f 745f 6c69           plot_li
-00016280: 7374 2e61 7070 656e 6428 0d0a 2020 2020  st.append(..    
-00016290: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000162a0: 2e70 726f 6365 7373 5f63 6f6d 706f 6e65  .process_compone
-000162b0: 6e74 7328 746f 5f6f 7269 6769 6e5f 7370  nts(to_origin_sp
-000162c0: 6163 653d 746f 5f6f 7269 6769 6e5f 7370  ace=to_origin_sp
-000162d0: 6163 6529 5b73 6572 6965 735d 2e6c 6f63  ace)[series].loc
-000162e0: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-000162f0: 2020 2020 2020 2070 6c74 5f69 6478 0d0a         plt_idx..
-00016300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016310: 5d0d 0a20 2020 2020 2020 2020 2020 2029  ]..            )
-00016320: 0d0a 2020 2020 2020 2020 706c 6f74 5f64  ..        plot_d
-00016330: 6620 3d20 7064 2e63 6f6e 6361 7428 706c  f = pd.concat(pl
-00016340: 6f74 5f6c 6973 742c 2061 7869 733d 3129  ot_list, axis=1)
-00016350: 0d0a 2020 2020 2020 2020 6966 2073 7461  ..        if sta
-00016360: 7274 5f64 6174 6520 6973 206e 6f74 204e  rt_date is not N
-00016370: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00016380: 2020 706c 6f74 5f64 6620 3d20 706c 6f74    plot_df = plot
-00016390: 5f64 665b 706c 6f74 5f64 662e 696e 6465  _df[plot_df.inde
-000163a0: 7820 3e3d 2073 7461 7274 5f64 6174 655d  x >= start_date]
-000163b0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000163c0: 2070 6c6f 745f 6466 2e70 6c6f 7428 7375   plot_df.plot(su
-000163d0: 6270 6c6f 7473 3d54 7275 652c 2066 6967  bplots=True, fig
-000163e0: 7369 7a65 3d66 6967 7369 7a65 2c20 7469  size=figsize, ti
-000163f0: 746c 653d 7469 746c 6529 0d0a 0d0a 2020  tle=title)....  
-00016400: 2020 6465 6620 7265 7475 726e 5f63 6f6d    def return_com
-00016410: 706f 6e65 6e74 7328 7365 6c66 2c20 746f  ponents(self, to
-00016420: 5f6f 7269 6769 6e5f 7370 6163 653d 5472  _origin_space=Tr
-00016430: 7565 2c20 696e 636c 7564 655f 696d 7061  ue, include_impa
-00016440: 6374 733d 4661 6c73 6529 3a0d 0a20 2020  cts=False):..   
-00016450: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
-00016460: 6464 6974 6976 6520 656c 656d 656e 7473  dditive elements
-00016470: 206f 6620 666f 7265 6361 7374 2c20 6c69   of forecast, li
-00016480: 6e65 6172 2061 6e64 2074 7265 6e64 2e20  near and trend. 
-00016490: 4966 2069 6d70 6163 7473 2069 6e63 6c75  If impacts inclu
-000164a0: 6465 642c 2069 7420 6973 2061 206d 756c  ded, it is a mul
-000164b0: 7469 706c 6963 6174 6976 6520 7465 726d  tiplicative term
-000164c0: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
-000164d0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-000164e0: 746f 5f6f 7269 6769 6e5f 7370 6163 6520  to_origin_space 
-000164f0: 2862 6f6f 6c29 2069 6620 4661 6c73 652c  (bool) if False,
-00016500: 2077 696c 6c20 6e6f 7420 7265 7665 7273   will not revers
-00016510: 6520 7472 616e 7366 6f72 6d20 6c69 6e65  e transform line
-00016520: 6172 2063 6f6d 706f 6e65 6e74 730d 0a20  ar components.. 
-00016530: 2020 2020 2020 2020 2020 2069 6e63 6c75             inclu
-00016540: 6465 5f69 6d70 6163 7473 2028 626f 6f6c  de_impacts (bool
-00016550: 2920 6966 2054 7275 652c 2069 6d70 6163  ) if True, impac
-00016560: 7473 2061 7265 2069 6e63 6c75 6465 6420  ts are included 
-00016570: 696e 2074 6865 2072 6574 7572 6e65 6420  in the returned 
-00016580: 6461 7461 6672 616d 650d 0a20 2020 2020  dataframe..     
-00016590: 2020 2022 2222 0d0a 2020 2020 2020 2020     """..        
-000165a0: 706c 6f74 5f6c 6973 7420 3d20 5b5d 0d0a  plot_list = []..
-000165b0: 2020 2020 2020 2020 706c 6f74 5f6c 6973          plot_lis
-000165c0: 742e 6170 7065 6e64 2873 656c 662e 7072  t.append(self.pr
-000165d0: 6f63 6573 735f 636f 6d70 6f6e 656e 7473  ocess_components
-000165e0: 2874 6f5f 6f72 6967 696e 5f73 7061 6365  (to_origin_space
-000165f0: 3d74 6f5f 6f72 6967 696e 5f73 7061 6365  =to_origin_space
-00016600: 2929 0d0a 2020 2020 2020 2020 7472 656e  ))..        tren
-00016610: 6420 3d20 7365 6c66 2e70 7265 6469 6374  d = self.predict
-00016620: 6564 5f74 7265 6e64 2e63 6f70 7928 290d  ed_trend.copy().
-00016630: 0a20 2020 2020 2020 2074 7265 6e64 2e63  .        trend.c
-00016640: 6f6c 756d 6e73 203d 2070 642e 4d75 6c74  olumns = pd.Mult
-00016650: 6949 6e64 6578 2e66 726f 6d5f 6172 7261  iIndex.from_arra
-00016660: 7973 280d 0a20 2020 2020 2020 2020 2020  ys(..           
-00016670: 205b 7472 656e 642e 636f 6c75 6d6e 732c   [trend.columns,
-00016680: 205b 2774 7265 6e64 275d 202a 206c 656e   ['trend'] * len
-00016690: 2874 7265 6e64 2e63 6f6c 756d 6e73 295d  (trend.columns)]
-000166a0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
-000166b0: 2020 2020 2070 6c6f 745f 6c69 7374 2e61       plot_list.a
-000166c0: 7070 656e 6428 7472 656e 6429 0d0a 2020  ppend(trend)..  
-000166d0: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-000166e0: 7061 6374 7320 6973 206e 6f74 204e 6f6e  pacts is not Non
-000166f0: 6520 616e 6420 696e 636c 7564 655f 696d  e and include_im
-00016700: 7061 6374 733a 0d0a 2020 2020 2020 2020  pacts:..        
-00016710: 2020 2020 696d 7061 6374 7320 3d20 7365      impacts = se
-00016720: 6c66 2e69 6d70 6163 7473 2e63 6f70 7928  lf.impacts.copy(
-00016730: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00016740: 6d70 6163 7473 2e63 6f6c 756d 6e73 203d  mpacts.columns =
-00016750: 2070 642e 4d75 6c74 6949 6e64 6578 2e66   pd.MultiIndex.f
-00016760: 726f 6d5f 6172 7261 7973 280d 0a20 2020  rom_arrays(..   
-00016770: 2020 2020 2020 2020 2020 2020 205b 696d               [im
-00016780: 7061 6374 732e 636f 6c75 6d6e 732c 205b  pacts.columns, [
-00016790: 2769 6d70 6163 7473 275d 202a 206c 656e  'impacts'] * len
-000167a0: 2869 6d70 6163 7473 2e63 6f6c 756d 6e73  (impacts.columns
-000167b0: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
-000167c0: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
-000167d0: 6c6f 745f 6c69 7374 2e61 7070 656e 6428  lot_list.append(
-000167e0: 696d 7061 6374 7329 0d0a 2020 2020 2020  impacts)..      
-000167f0: 2020 7265 7475 726e 2070 642e 636f 6e63    return pd.conc
-00016800: 6174 2870 6c6f 745f 6c69 7374 2c20 6178  at(plot_list, ax
-00016810: 6973 3d31 290d 0a0d 0a20 2020 2064 6566  is=1)....    def
-00016820: 2070 6c6f 745f 7472 656e 6428 0d0a 2020   plot_trend(..  
-00016830: 2020 2020 2020 7365 6c66 2c0d 0a20 2020        self,..   
-00016840: 2020 2020 2073 6572 6965 733d 4e6f 6e65       series=None
-00016850: 2c0d 0a20 2020 2020 2020 2076 6c69 6e65  ,..        vline
-00016860: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
-00016870: 636f 6c6f 7273 3d5b 2223 6434 6637 3466  colors=["#d4f74f
-00016880: 222c 2022 2338 3261 6235 6122 2c20 2223  ", "#82ab5a", "#
-00016890: 6666 3663 3035 222c 2022 2363 3132 3630  ff6c05", "#c1260
-000168a0: 3022 5d2c 0d0a 2020 2020 2020 2020 7469  0"],..        ti
-000168b0: 746c 653d 4e6f 6e65 2c0d 0a20 2020 2020  tle=None,..     
-000168c0: 2020 2073 7461 7274 5f64 6174 653d 4e6f     start_date=No
-000168d0: 6e65 2c0d 0a20 2020 2020 2020 202a 2a6b  ne,..        **k
-000168e0: 7761 7267 732c 0d0a 2020 2020 293a 0d0a  wargs,..    ):..
-000168f0: 2020 2020 2020 2020 2320 594d 4158 2066          # YMAX f
-00016900: 726f 6d20 504c 4f54 204f 4e4c 590d 0a20  rom PLOT ONLY.. 
-00016910: 2020 2020 2020 2069 6620 7365 7269 6573         if series
-00016920: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00016930: 2020 2020 2020 2073 6572 6965 7320 3d20         series = 
-00016940: 7261 6e64 6f6d 2e63 686f 6963 6528 7365  random.choice(se
-00016950: 6c66 2e63 6f6c 756d 6e5f 6e61 6d65 7329  lf.column_names)
-00016960: 0d0a 2020 2020 2020 2020 6966 2074 6974  ..        if tit
-00016970: 6c65 2069 7320 4e6f 6e65 3a0d 0a20 2020  le is None:..   
-00016980: 2020 2020 2020 2020 2074 6974 6c65 203d           title =
-00016990: 2066 2254 7265 6e64 2042 7265 616b 646f   f"Trend Breakdo
-000169a0: 776e 2066 6f72 207b 7365 7269 6573 7d22  wn for {series}"
-000169b0: 0d0a 2020 2020 2020 2020 705f 696e 6478  ..        p_indx
-000169c0: 203d 2073 656c 662e 636f 6c75 6d6e 5f6e   = self.column_n
-000169d0: 616d 6573 2e67 6574 5f6c 6f63 2873 6572  ames.get_loc(ser
-000169e0: 6965 7329 0d0a 2020 2020 2020 2020 6375  ies)..        cu
-000169f0: 725f 7472 656e 6420 3d20 7365 6c66 2e70  r_trend = self.p
-00016a00: 7265 6469 6374 6564 5f74 7265 6e64 5b73  redicted_trend[s
-00016a10: 6572 6965 735d 2e63 6f70 7928 290d 0a20  eries].copy().. 
-00016a20: 2020 2020 2020 2074 6c73 203d 206c 656e         tls = len
-00016a30: 2863 7572 5f74 7265 6e64 290d 0a20 2020  (cur_trend)..   
-00016a40: 2020 2020 2070 6c6f 745f 6466 203d 2070       plot_df = p
-00016a50: 642e 4461 7461 4672 616d 6528 0d0a 2020  d.DataFrame(..  
-00016a60: 2020 2020 2020 2020 2020 7b0d 0a20 2020            {..   
-00016a70: 2020 2020 2020 2020 2020 2020 2027 6465               'de
-00016a80: 636c 696e 655f 6163 6365 6c65 7261 7469  cline_accelerati
-00016a90: 6e67 273a 2063 7572 5f74 7265 6e64 5b0d  ng': cur_trend[.
-00016aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ab0: 2020 2020 2028 0d0a 2020 2020 2020 2020       (..        
-00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ad0: 6e70 2e68 7374 6163 6b28 286e 702e 7369  np.hstack((np.si
-00016ae0: 676e 6269 7428 7365 6c66 2e61 6363 656c  gnbit(self.accel
-00016af0: 5b3a 2c20 705f 696e 6478 5d29 2c20 4661  [:, p_indx]), Fa
-00016b00: 6c73 6529 290d 0a20 2020 2020 2020 2020  lse))..         
-00016b10: 2020 2020 2020 2020 2020 2020 2020 2026                 &
-00016b20: 2073 656c 662e 736c 6f70 655f 7369 676e   self.slope_sign
-00016b30: 5b3a 2c20 705f 696e 6478 5d0d 0a20 2020  [:, p_indx]..   
-00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b50: 2029 5b2d 746c 733a 5d0d 0a20 2020 2020   )[-tls:]..     
-00016b60: 2020 2020 2020 2020 2020 205d 2c0d 0a20             ],.. 
-00016b70: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00016b80: 6465 636c 696e 655f 6465 6365 6c65 7261  decline_decelera
-00016b90: 7469 6e67 273a 2063 7572 5f74 7265 6e64  ting': cur_trend
-00016ba0: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
-00016bb0: 2020 2020 2020 2028 0d0a 2020 2020 2020         (..      
-00016bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016bd0: 2020 287e 6e70 2e68 7374 6163 6b28 286e    (~np.hstack((n
-00016be0: 702e 7369 676e 6269 7428 7365 6c66 2e61  p.signbit(self.a
-00016bf0: 6363 656c 5b3a 2c20 705f 696e 6478 5d29  ccel[:, p_indx])
-00016c00: 2c20 4661 6c73 6529 2929 0d0a 2020 2020  , False)))..    
-00016c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c20: 2020 2020 2620 7365 6c66 2e73 6c6f 7065      & self.slope
-00016c30: 5f73 6967 6e5b 3a2c 2070 5f69 6e64 785d  _sign[:, p_indx]
-00016c40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016c50: 2020 2020 2020 295b 2d74 6c73 3a5d 0d0a        )[-tls:]..
-00016c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c70: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00016c80: 2020 2020 2767 726f 7774 685f 6465 6365      'growth_dece
-00016c90: 6c65 7261 7469 6e67 273a 2063 7572 5f74  lerating': cur_t
-00016ca0: 7265 6e64 5b0d 0a20 2020 2020 2020 2020  rend[..         
-00016cb0: 2020 2020 2020 2020 2020 2028 0d0a 2020             (..  
-00016cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016cd0: 2020 2020 2020 6e70 2e68 7374 6163 6b28        np.hstack(
-00016ce0: 286e 702e 7369 676e 6269 7428 7365 6c66  (np.signbit(self
-00016cf0: 2e61 6363 656c 5b3a 2c20 705f 696e 6478  .accel[:, p_indx
-00016d00: 5d29 2c20 4661 6c73 6529 290d 0a20 2020  ]), False))..   
-00016d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016d20: 2020 2020 2026 2028 7e73 656c 662e 736c       & (~self.sl
-00016d30: 6f70 655f 7369 676e 5b3a 2c20 705f 696e  ope_sign[:, p_in
-00016d40: 6478 5d29 0d0a 2020 2020 2020 2020 2020  dx])..          
-00016d50: 2020 2020 2020 2020 2020 295b 2d74 6c73            )[-tls
-00016d60: 3a5d 0d0a 2020 2020 2020 2020 2020 2020  :]..            
-00016d70: 2020 2020 5d2c 0d0a 2020 2020 2020 2020      ],..        
-00016d80: 2020 2020 2020 2020 2767 726f 7774 685f          'growth_
-00016d90: 6163 6365 6c65 7261 7469 6e67 273a 2063  accelerating': c
-00016da0: 7572 5f74 7265 6e64 5b0d 0a20 2020 2020  ur_trend[..     
-00016db0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00016dc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00016dd0: 2020 2020 2020 2020 2020 287e 6e70 2e68            (~np.h
-00016de0: 7374 6163 6b28 286e 702e 7369 676e 6269  stack((np.signbi
-00016df0: 7428 7365 6c66 2e61 6363 656c 5b3a 2c20  t(self.accel[:, 
-00016e00: 705f 696e 6478 5d29 2c20 4661 6c73 6529  p_indx]), False)
-00016e10: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00016e20: 2020 2020 2020 2020 2020 2020 2620 287e              & (~
-00016e30: 7365 6c66 2e73 6c6f 7065 5f73 6967 6e5b  self.slope_sign[
-00016e40: 3a2c 2070 5f69 6e64 785d 290d 0a20 2020  :, p_indx])..   
+00014310: 2274 7261 6e73 666f 726d 6174 696f 6e73  "transformations
+00014320: 223a 207b 2230 223a 2022 436c 6970 4f75  ": {"0": "ClipOu
+00014330: 746c 6965 7273 227d 2c0d 0a20 2020 2020  tliers"},..     
+00014340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014350: 2020 2020 2020 2022 7472 616e 7366 6f72         "transfor
+00014360: 6d61 7469 6f6e 5f70 6172 616d 7322 3a20  mation_params": 
+00014370: 7b0d 0a20 2020 2020 2020 2020 2020 2020  {..             
+00014380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014390: 2020 2022 3022 3a20 7b22 6d65 7468 6f64     "0": {"method
+000143a0: 223a 2022 636c 6970 222c 2022 7374 645f  ": "clip", "std_
+000143b0: 7468 7265 7368 6f6c 6422 3a20 367d 0d0a  threshold": 6}..
+000143c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143d0: 2020 2020 2020 2020 2020 2020 7d2c 0d0a              },..
+000143e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000143f0: 2020 2020 2020 2020 7d2c 0d0a 2020 2020          },..    
+00014400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014410: 2020 2020 226d 6574 686f 645f 7061 7261      "method_para
+00014420: 6d73 223a 207b 0d0a 2020 2020 2020 2020  ms": {..        
+00014430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014440: 2020 2020 2269 7172 5f74 6872 6573 686f      "iqr_thresho
+00014450: 6c64 223a 2032 2e35 2c0d 0a20 2020 2020  ld": 2.5,..     
+00014460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014470: 2020 2020 2020 2022 6971 725f 7175 616e         "iqr_quan
+00014480: 7469 6c65 7322 3a20 5b30 2e32 352c 2030  tiles": [0.25, 0
+00014490: 2e37 355d 2c0d 0a20 2020 2020 2020 2020  .75],..         
+000144a0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+000144b0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+000144c0: 2020 2020 2020 2020 2020 2022 6669 6c6c             "fill
+000144d0: 6e61 223a 2022 6666 696c 6c22 2c0d 0a20  na": "ffill",.. 
+000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144f0: 2020 207d 2c0d 0a20 2020 2020 2020 2020     },..         
+00014500: 2020 2020 2020 2020 2020 2022 3122 3a20             "1": 
+00014510: 7b7d 2c0d 0a20 2020 2020 2020 2020 2020  {},..           
+00014520: 2020 2020 207d 2c0d 0a20 2020 2020 2020       },..       
+00014530: 2020 2020 207d 0d0a 0d0a 2020 2020 2020       }....      
+00014540: 2020 7472 656e 645f 616e 6f6d 616c 795f    trend_anomaly_
+00014550: 696e 7465 7276 656e 7469 6f6e 203d 2072  intervention = r
+00014560: 616e 646f 6d2e 6368 6f69 6365 7328 5b4e  andom.choices([N
+00014570: 6f6e 652c 2027 6465 7465 6374 5f6f 6e6c  one, 'detect_onl
+00014580: 7927 5d2c 205b 302e 352c 2030 2e35 5d29  y'], [0.5, 0.5])
+00014590: 5b0d 0a20 2020 2020 2020 2020 2020 2030  [..            0
+000145a0: 0d0a 2020 2020 2020 2020 5d0d 0a20 2020  ..        ]..   
+000145b0: 2020 2020 2069 6620 7472 656e 645f 616e       if trend_an
+000145c0: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
+000145d0: 6f6e 2069 7320 6e6f 7420 4e6f 6e65 3a0d  on is not None:.
+000145e0: 0a20 2020 2020 2020 2020 2020 2074 7265  .            tre
+000145f0: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
+00014600: 746f 725f 7061 7261 6d73 203d 2041 6e6f  tor_params = Ano
+00014610: 6d61 6c79 5265 6d6f 7661 6c2e 6765 745f  malyRemoval.get_
+00014620: 6e65 775f 7061 7261 6d73 286d 6574 686f  new_params(metho
+00014630: 643d 6d65 7468 6f64 290d 0a20 2020 2020  d=method)..     
+00014640: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00014650: 2020 2020 2020 7472 656e 645f 616e 6f6d        trend_anom
+00014660: 616c 795f 6465 7465 6374 6f72 5f70 6172  aly_detector_par
+00014670: 616d 7320 3d20 4e6f 6e65 0d0a 2020 2020  ams = None..    
+00014680: 2020 2020 6c69 6e65 6172 5f6d 6f64 656c      linear_model
+00014690: 203d 2072 616e 646f 6d2e 6368 6f69 6365   = random.choice
+000146a0: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
+000146b0: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
+000146c0: 2020 2027 6c73 7473 7127 2c0d 0a20 2020     'lstsq',..   
+000146d0: 2020 2020 2020 2020 2020 2020 2027 6c69               'li
+000146e0: 6e61 6c67 5f73 6f6c 7665 272c 0d0a 2020  nalg_solve',..  
+000146f0: 2020 2020 2020 2020 2020 2020 2020 276c                'l
+00014700: 315f 6e6f 726d 272c 0d0a 2020 2020 2020  1_norm',..      
+00014710: 2020 2020 2020 2020 2020 2764 7761 655f            'dwae_
+00014720: 6e6f 726d 272c 0d0a 2020 2020 2020 2020  norm',..        
+00014730: 2020 2020 2020 2020 2771 7561 6e74 696c          'quantil
+00014740: 655f 6e6f 726d 272c 0d0a 2020 2020 2020  e_norm',..      
+00014750: 2020 2020 2020 2020 2020 276c 315f 706f            'l1_po
+00014760: 7369 7469 7665 272c 0d0a 2020 2020 2020  sitive',..      
+00014770: 2020 2020 2020 5d2c 0d0a 2020 2020 2020        ],..      
+00014780: 2020 2020 2020 5b30 2e36 2c20 302e 322c        [0.6, 0.2,
+00014790: 2030 2e31 2c20 302e 3035 2c20 302e 3032   0.1, 0.05, 0.02
+000147a0: 2c20 302e 3033 5d2c 0d0a 2020 2020 2020  , 0.03],..      
+000147b0: 2020 295b 305d 0d0a 2020 2020 2020 2020    )[0]..        
+000147c0: 7265 6365 6e63 795f 7765 6967 6874 696e  recency_weightin
+000147d0: 6720 3d20 7261 6e64 6f6d 2e63 686f 6963  g = random.choic
+000147e0: 6573 280d 0a20 2020 2020 2020 2020 2020  es(..           
+000147f0: 205b 4e6f 6e65 2c20 302e 3035 2c20 302e   [None, 0.05, 0.
+00014800: 312c 2030 2e32 352c 2030 2e35 5d2c 205b  1, 0.25, 0.5], [
+00014810: 302e 372c 2030 2e31 2c20 302e 312c 2030  0.7, 0.1, 0.1, 0
+00014820: 2e31 2c20 302e 3035 5d0d 0a20 2020 2020  .1, 0.05]..     
+00014830: 2020 2029 5b30 5d0d 0a20 2020 2020 2020     )[0]..       
+00014840: 2069 6620 6c69 6e65 6172 5f6d 6f64 656c   if linear_model
+00014850: 2069 6e20 5b27 6c73 7473 7127 5d3a 0d0a   in ['lstsq']:..
+00014860: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00014870: 6172 5f6d 6f64 656c 203d 207b 0d0a 2020  ar_model = {..  
+00014880: 2020 2020 2020 2020 2020 2020 2020 276d                'm
+00014890: 6f64 656c 273a 206c 696e 6561 725f 6d6f  odel': linear_mo
+000148a0: 6465 6c2c 0d0a 2020 2020 2020 2020 2020  del,..          
+000148b0: 2020 2020 2020 276c 616d 6264 6127 3a20        'lambda': 
+000148c0: 7261 6e64 6f6d 2e63 686f 6963 6573 280d  random.choices(.
+000148d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000148e0: 2020 2020 205b 4e6f 6e65 2c20 302e 312c       [None, 0.1,
+000148f0: 2031 2c20 3130 2c20 3130 305d 2c20 5b30   1, 10, 100], [0
+00014900: 2e37 2c20 302e 312c 2030 2e31 2c20 302e  .7, 0.1, 0.1, 0.
+00014910: 312c 2030 2e30 355d 0d0a 2020 2020 2020  1, 0.05]..      
+00014920: 2020 2020 2020 2020 2020 295b 305d 2c0d            )[0],.
+00014930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014940: 2027 7265 6365 6e63 795f 7765 6967 6874   'recency_weight
+00014950: 696e 6727 3a20 7265 6365 6e63 795f 7765  ing': recency_we
+00014960: 6967 6874 696e 672c 0d0a 2020 2020 2020  ighting,..      
+00014970: 2020 2020 2020 7d0d 0a20 2020 2020 2020        }..       
+00014980: 2069 6620 6c69 6e65 6172 5f6d 6f64 656c   if linear_model
+00014990: 2069 6e20 5b27 6c69 6e61 6c67 5f73 6f6c   in ['linalg_sol
+000149a0: 7665 275d 3a0d 0a20 2020 2020 2020 2020  ve']:..         
+000149b0: 2020 206c 696e 6561 725f 6d6f 6465 6c20     linear_model 
+000149c0: 3d20 7b0d 0a20 2020 2020 2020 2020 2020  = {..           
+000149d0: 2020 2020 2027 6d6f 6465 6c27 3a20 6c69       'model': li
+000149e0: 6e65 6172 5f6d 6f64 656c 2c0d 0a20 2020  near_model,..   
+000149f0: 2020 2020 2020 2020 2020 2020 2027 6c61               'la
+00014a00: 6d62 6461 273a 2072 616e 646f 6d2e 6368  mbda': random.ch
+00014a10: 6f69 6365 7328 5b30 2c20 302e 312c 2031  oices([0, 0.1, 1
+00014a20: 2c20 3130 5d2c 205b 302e 342c 2030 2e32  , 10], [0.4, 0.2
+00014a30: 2c20 302e 322c 2030 2e32 5d29 5b30 5d2c  , 0.2, 0.2])[0],
+00014a40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014a50: 2020 2772 6563 656e 6379 5f77 6569 6768    'recency_weigh
+00014a60: 7469 6e67 273a 2072 6563 656e 6379 5f77  ting': recency_w
+00014a70: 6569 6768 7469 6e67 2c0d 0a20 2020 2020  eighting,..     
+00014a80: 2020 2020 2020 207d 0d0a 2020 2020 2020         }..      
+00014a90: 2020 656c 6966 206c 696e 6561 725f 6d6f    elif linear_mo
+00014aa0: 6465 6c20 696e 205b 276c 315f 6e6f 726d  del in ['l1_norm
+00014ab0: 272c 2027 6477 6165 5f6e 6f72 6d27 2c20  ', 'dwae_norm', 
+00014ac0: 2771 7561 6e74 696c 655f 6e6f 726d 272c  'quantile_norm',
+00014ad0: 2027 6c31 5f70 6f73 6974 6976 6527 5d3a   'l1_positive']:
+00014ae0: 0d0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
+00014af0: 6e65 6172 5f6d 6f64 656c 203d 207b 0d0a  near_model = {..
+00014b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b10: 276d 6f64 656c 273a 206c 696e 6561 725f  'model': linear_
+00014b20: 6d6f 6465 6c2c 0d0a 2020 2020 2020 2020  model,..        
+00014b30: 2020 2020 2020 2020 2772 6563 656e 6379          'recency
+00014b40: 5f77 6569 6768 7469 6e67 273a 2072 6563  _weighting': rec
+00014b50: 656e 6379 5f77 6569 6768 7469 6e67 2c0d  ency_weighting,.
+00014b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014b70: 2027 6d61 7869 7465 7227 3a20 7261 6e64   'maxiter': rand
+00014b80: 6f6d 2e63 686f 6963 6573 285b 3235 302c  om.choices([250,
+00014b90: 2031 3530 3030 2c20 3235 3030 305d 2c20   15000, 25000], 
+00014ba0: 5b30 2e32 2c20 302e 362c 2030 2e32 5d29  [0.2, 0.6, 0.2])
+00014bb0: 5b30 5d2c 0d0a 2020 2020 2020 2020 2020  [0],..          
+00014bc0: 2020 7d0d 0a20 2020 2020 2020 2069 6620    }..        if 
+00014bd0: 6d65 7468 6f64 203d 3d20 2272 6567 7265  method == "regre
+00014be0: 7373 6f72 223a 0d0a 2020 2020 2020 2020  ssor":..        
+00014bf0: 2020 2020 7265 6772 6573 736f 7273 5f75      regressors_u
+00014c00: 7365 6420 3d20 5472 7565 0d0a 2020 2020  sed = True..    
+00014c10: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00014c20: 2020 2020 2020 2072 6567 7265 7373 6f72         regressor
+00014c30: 735f 7573 6564 203d 2072 616e 646f 6d2e  s_used = random.
+00014c40: 6368 6f69 6365 7328 5b54 7275 652c 2046  choices([True, F
+00014c50: 616c 7365 5d2c 205b 302e 352c 2030 2e35  alse], [0.5, 0.5
+00014c60: 5d29 5b30 5d0d 0a20 2020 2020 2020 2061  ])[0]..        a
+00014c70: 725f 6c61 6773 203d 2072 616e 646f 6d2e  r_lags = random.
+00014c80: 6368 6f69 6365 7328 0d0a 2020 2020 2020  choices(..      
+00014c90: 2020 2020 2020 5b4e 6f6e 652c 205b 315d        [None, [1]
+00014ca0: 2c20 5b31 2c20 375d 2c20 5b37 5d2c 205b  , [1, 7], [7], [
+00014cb0: 7365 6173 6f6e 616c 5f69 6e74 2873 6d61  seasonal_int(sma
+00014cc0: 6c6c 3d54 7275 6529 5d5d 2c0d 0a20 2020  ll=True)]],..   
+00014cd0: 2020 2020 2020 2020 205b 302e 392c 2030           [0.9, 0
+00014ce0: 2e30 3235 2c20 302e 3032 352c 2030 2e30  .025, 0.025, 0.0
+00014cf0: 352c 2030 2e30 355d 2c0d 0a20 2020 2020  5, 0.05],..     
+00014d00: 2020 2029 5b30 5d0d 0a20 2020 2020 2020     )[0]..       
+00014d10: 2061 725f 696e 7465 7261 6374 696f 6e5f   ar_interaction_
+00014d20: 7365 6173 6f6e 616c 6974 7920 3d20 4e6f  seasonality = No
+00014d30: 6e65 0d0a 2020 2020 2020 2020 6966 2061  ne..        if a
+00014d40: 725f 6c61 6773 2069 7320 6e6f 7420 4e6f  r_lags is not No
+00014d50: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00014d60: 2061 725f 696e 7465 7261 6374 696f 6e5f   ar_interaction_
+00014d70: 7365 6173 6f6e 616c 6974 7920 3d20 7261  seasonality = ra
+00014d80: 6e64 6f6d 2e63 686f 6963 6573 280d 0a20  ndom.choices(.. 
+00014d90: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00014da0: 4e6f 6e65 2c20 372c 2027 6461 796f 6677  None, 7, 'dayofw
+00014db0: 6565 6b27 2c20 2763 6f6d 6d6f 6e5f 666f  eek', 'common_fo
+00014dc0: 7572 6965 7227 5d2c 205b 302e 342c 2030  urier'], [0.4, 0
+00014dd0: 2e32 2c20 302e 322c 2030 2e32 5d0d 0a20  .2, 0.2, 0.2].. 
+00014de0: 2020 2020 2020 2020 2020 2029 5b30 5d0d             )[0].
+00014df0: 0a20 2020 2020 2020 2073 6561 736f 6e61  .        seasona
+00014e00: 6c69 7469 6573 203d 2072 616e 646f 6d2e  lities = random.
+00014e10: 6368 6f69 6365 7328 0d0a 2020 2020 2020  choices(..      
+00014e20: 2020 2020 2020 5b0d 0a20 2020 2020 2020        [..       
+00014e30: 2020 2020 2020 2020 205b 372c 2033 3635           [7, 365
+00014e40: 2e32 355d 2c0d 0a20 2020 2020 2020 2020  .25],..         
+00014e50: 2020 2020 2020 205b 2264 6179 6f66 7765         ["dayofwe
+00014e60: 656b 222c 2033 3635 2e32 355d 2c0d 0a20  ek", 365.25],.. 
+00014e70: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+00014e80: 226d 6f6e 7468 222c 2022 6461 796f 6677  "month", "dayofw
+00014e90: 6565 6b22 2c20 2277 6565 6b64 6179 6f66  eek", "weekdayof
+00014ea0: 6d6f 6e74 6822 5d2c 0d0a 2020 2020 2020  month"],..      
+00014eb0: 2020 2020 2020 2020 2020 5b27 7765 656b            ['week
+00014ec0: 6461 796f 666d 6f6e 7468 272c 2027 636f  dayofmonth', 'co
+00014ed0: 6d6d 6f6e 5f66 6f75 7269 6572 275d 2c0d  mmon_fourier'],.
+00014ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014ef0: 2022 6f74 6865 7222 2c0d 0a20 2020 2020   "other",..     
+00014f00: 2020 2020 2020 205d 2c0d 0a20 2020 2020         ],..     
+00014f10: 2020 2020 2020 205b 302e 312c 2030 2e31         [0.1, 0.1
+00014f20: 2c20 302e 312c 2030 2e30 352c 2030 2e31  , 0.1, 0.05, 0.1
+00014f30: 5d2c 0d0a 2020 2020 2020 2020 295b 305d  ],..        )[0]
+00014f40: 0d0a 2020 2020 2020 2020 6966 2073 6561  ..        if sea
+00014f50: 736f 6e61 6c69 7469 6573 203d 3d20 226f  sonalities == "o
+00014f60: 7468 6572 223a 0d0a 2020 2020 2020 2020  ther":..        
+00014f70: 2020 2020 7072 6564 6566 696e 6564 203d      predefined =
+00014f80: 2072 616e 646f 6d2e 6368 6f69 6365 7328   random.choices(
+00014f90: 5b54 7275 652c 2046 616c 7365 5d2c 205b  [True, False], [
+00014fa0: 302e 352c 2030 2e35 5d29 5b30 5d0d 0a20  0.5, 0.5])[0].. 
+00014fb0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
+00014fc0: 6564 6566 696e 6564 3a0d 0a20 2020 2020  edefined:..     
+00014fd0: 2020 2020 2020 2020 2020 2073 6561 736f             seaso
+00014fe0: 6e61 6c69 7469 6573 203d 2072 616e 646f  nalities = rando
+00014ff0: 6d2e 6368 6f69 6365 2864 6174 655f 7061  m.choice(date_pa
+00015000: 7274 5f6d 6574 686f 6473 290d 0a20 2020  rt_methods)..   
+00015010: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00015020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015030: 636f 6d70 5f6f 7074 7320 3d20 6461 7465  comp_opts = date
+00015040: 7061 7274 5f63 6f6d 706f 6e65 6e74 7320  part_components 
+00015050: 2b20 5b37 2c20 3336 352e 3235 2c20 3132  + [7, 365.25, 12
+00015060: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00015070: 2020 2073 6561 736f 6e61 6c69 7469 6573     seasonalities
+00015080: 203d 2072 616e 646f 6d2e 6368 6f69 6365   = random.choice
+00015090: 7328 636f 6d70 5f6f 7074 732c 206b 3d32  s(comp_opts, k=2
+000150a0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000150b0: 6e20 7b0d 0a20 2020 2020 2020 2020 2020  n {..           
+000150c0: 2022 7072 6570 726f 6365 7373 696e 675f   "preprocessing_
+000150d0: 7472 616e 7366 6f72 6d61 7469 6f6e 223a  transformation":
+000150e0: 2052 616e 646f 6d54 7261 6e73 666f 726d   RandomTransform
+000150f0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00015100: 2020 2074 7261 6e73 666f 726d 6572 5f6c     transformer_l
+00015110: 6973 743d 6669 6c74 6572 732c 2074 7261  ist=filters, tra
+00015120: 6e73 666f 726d 6572 5f6d 6178 5f64 6570  nsformer_max_dep
+00015130: 7468 3d32 2c20 616c 6c6f 775f 6e6f 6e65  th=2, allow_none
+00015140: 3d54 7275 650d 0a20 2020 2020 2020 2020  =True..         
+00015150: 2020 2029 2c0d 0a20 2020 2020 2020 2020     ),..         
+00015160: 2020 2022 7363 616c 696e 6722 3a20 7363     "scaling": sc
+00015170: 616c 696e 672c 0d0a 2020 2020 2020 2020  aling,..        
+00015180: 2020 2020 2320 2270 6173 745f 696d 7061      # "past_impa
+00015190: 6374 735f 696e 7465 7276 656e 7469 6f6e  cts_intervention
+000151a0: 223a 2073 656c 662e 7061 7374 5f69 6d70  ": self.past_imp
+000151b0: 6163 7473 5f69 6e74 6572 7665 6e74 696f  acts_interventio
+000151c0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+000151d0: 2273 6561 736f 6e61 6c69 7469 6573 223a  "seasonalities":
+000151e0: 2073 6561 736f 6e61 6c69 7469 6573 2c0d   seasonalities,.
+000151f0: 0a20 2020 2020 2020 2020 2020 2022 6172  .            "ar
+00015200: 5f6c 6167 7322 3a20 6172 5f6c 6167 732c  _lags": ar_lags,
+00015210: 0d0a 2020 2020 2020 2020 2020 2020 2261  ..            "a
+00015220: 725f 696e 7465 7261 6374 696f 6e5f 7365  r_interaction_se
+00015230: 6173 6f6e 616c 6974 7922 3a20 6172 5f69  asonality": ar_i
+00015240: 6e74 6572 6163 7469 6f6e 5f73 6561 736f  nteraction_seaso
+00015250: 6e61 6c69 7479 2c0d 0a20 2020 2020 2020  nality,..       
+00015260: 2020 2020 2022 616e 6f6d 616c 795f 6465       "anomaly_de
+00015270: 7465 6374 6f72 5f70 6172 616d 7322 3a20  tector_params": 
+00015280: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+00015290: 5f70 6172 616d 732c 0d0a 2020 2020 2020  _params,..      
+000152a0: 2020 2020 2020 2261 6e6f 6d61 6c79 5f69        "anomaly_i
+000152b0: 6e74 6572 7665 6e74 696f 6e22 3a20 616e  ntervention": an
+000152c0: 6f6d 616c 795f 696e 7465 7276 656e 7469  omaly_interventi
+000152d0: 6f6e 2c0d 0a20 2020 2020 2020 2020 2020  on,..           
+000152e0: 2022 686f 6c69 6461 795f 6465 7465 6374   "holiday_detect
+000152f0: 6f72 5f70 6172 616d 7322 3a20 686f 6c69  or_params": holi
+00015300: 6461 795f 7061 7261 6d73 2c0d 0a20 2020  day_params,..   
+00015310: 2020 2020 2020 2020 2023 2022 686f 6c69           # "holi
+00015320: 6461 795f 636f 756e 7472 6965 7322 3a20  day_countries": 
+00015330: 7365 6c66 2e68 6f6c 6964 6179 5f63 6f75  self.holiday_cou
+00015340: 6e74 7269 6573 2c0d 0a20 2020 2020 2020  ntries,..       
+00015350: 2020 2020 2022 686f 6c69 6461 795f 636f       "holiday_co
+00015360: 756e 7472 6965 735f 7573 6564 223a 2072  untries_used": r
+00015370: 616e 646f 6d2e 6368 6f69 6365 7328 5b54  andom.choices([T
+00015380: 7275 652c 2046 616c 7365 5d2c 205b 302e  rue, False], [0.
+00015390: 352c 2030 2e35 5d29 5b30 5d2c 0d0a 2020  5, 0.5])[0],..  
+000153a0: 2020 2020 2020 2020 2020 226d 756c 7469            "multi
+000153b0: 7661 7269 6174 655f 6665 6174 7572 6522  variate_feature"
+000153c0: 3a20 7261 6e64 6f6d 2e63 686f 6963 6573  : random.choices
+000153d0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000153e0: 2020 205b 4e6f 6e65 2c20 2266 6561 7475     [None, "featu
+000153f0: 7265 5f61 6767 6c6f 6d65 7261 7469 6f6e  re_agglomeration
+00015400: 222c 2027 6772 6f75 705f 6176 6572 6167  ", 'group_averag
+00015410: 6527 2c20 276f 7363 696c 6c61 746f 7227  e', 'oscillator'
+00015420: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
+00015430: 2020 2020 5b30 2e39 2c20 302e 312c 2030      [0.9, 0.1, 0
+00015440: 2e31 2c20 302e 305d 2c0d 0a20 2020 2020  .1, 0.0],..     
+00015450: 2020 2020 2020 2029 5b30 5d2c 0d0a 2020         )[0],..  
+00015460: 2020 2020 2020 2020 2020 226d 756c 7469            "multi
+00015470: 7661 7269 6174 655f 7472 616e 7366 6f72  variate_transfor
+00015480: 6d61 7469 6f6e 223a 2052 616e 646f 6d54  mation": RandomT
+00015490: 7261 6e73 666f 726d 280d 0a20 2020 2020  ransform(..     
+000154a0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
+000154b0: 666f 726d 6572 5f6c 6973 743d 2266 6173  former_list="fas
+000154c0: 7422 2c0d 0a20 2020 2020 2020 2020 2020  t",..           
+000154d0: 2020 2020 2074 7261 6e73 666f 726d 6572       transformer
+000154e0: 5f6d 6178 5f64 6570 7468 3d33 2c20 2023  _max_depth=3,  #
+000154f0: 2070 726f 6261 626c 7920 7761 6e74 2073   probably want s
+00015500: 6f6d 6520 6d6f 7265 2075 7361 626c 6520  ome more usable 
+00015510: 6465 6661 756c 7473 2066 6972 7374 2061  defaults first a
+00015520: 7320 6d61 6e79 2072 616e 646f 6d20 6172  s many random ar
+00015530: 6520 7365 6e73 656c 6573 730d 0a20 2020  e senseless..   
+00015540: 2020 2020 2020 2020 2029 2c0d 0a20 2020           ),..   
+00015550: 2020 2020 2020 2020 2022 7265 6772 6573           "regres
+00015560: 736f 725f 7472 616e 7366 6f72 6d61 7469  sor_transformati
+00015570: 6f6e 223a 2052 616e 646f 6d54 7261 6e73  on": RandomTrans
+00015580: 666f 726d 280d 0a20 2020 2020 2020 2020  form(..         
+00015590: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
+000155a0: 6572 5f6c 6973 743d 7b2a 2a73 6361 6c65  er_list={**scale
+000155b0: 7273 2c20 2a2a 6465 636f 6d70 6f73 6974  rs, **decomposit
+000155c0: 696f 6e73 7d2c 0d0a 2020 2020 2020 2020  ions},..        
+000155d0: 2020 2020 2020 2020 7472 616e 7366 6f72          transfor
+000155e0: 6d65 725f 6d61 785f 6465 7074 683d 312c  mer_max_depth=1,
+000155f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015600: 2020 616c 6c6f 775f 6e6f 6e65 3d46 616c    allow_none=Fal
+00015610: 7365 2c0d 0a20 2020 2020 2020 2020 2020  se,..           
+00015620: 2020 2020 206e 6f5f 6e61 6e5f 6669 6c6c       no_nan_fill
+00015630: 3d46 616c 7365 2c20 2023 2070 726f 6261  =False,  # proba
+00015640: 626c 7920 7761 6e74 2073 6f6d 6520 6d6f  bly want some mo
+00015650: 7265 2075 7361 626c 6520 6465 6661 756c  re usable defaul
+00015660: 7473 2066 6972 7374 2061 7320 6d61 6e79  ts first as many
+00015670: 2072 616e 646f 6d20 6172 6520 7365 6e73   random are sens
+00015680: 656c 6573 730d 0a20 2020 2020 2020 2020  eless..         
+00015690: 2020 2029 2c0d 0a20 2020 2020 2020 2020     ),..         
+000156a0: 2020 2022 7265 6772 6573 736f 7273 5f75     "regressors_u
+000156b0: 7365 6422 3a20 7265 6772 6573 736f 7273  sed": regressors
+000156c0: 5f75 7365 642c 0d0a 2020 2020 2020 2020  _used,..        
+000156d0: 2020 2020 226c 696e 6561 725f 6d6f 6465      "linear_mode
+000156e0: 6c22 3a20 6c69 6e65 6172 5f6d 6f64 656c  l": linear_model
+000156f0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00015700: 7261 6e64 6f6d 7761 6c6b 5f6e 223a 2072  randomwalk_n": r
+00015710: 616e 646f 6d2e 6368 6f69 6365 7328 5b4e  andom.choices([N
+00015720: 6f6e 652c 2031 305d 2c20 5b30 2e35 2c20  one, 10], [0.5, 
+00015730: 302e 355d 295b 305d 2c0d 0a20 2020 2020  0.5])[0],..     
+00015740: 2020 2020 2020 2022 7472 656e 645f 7769         "trend_wi
+00015750: 6e64 6f77 223a 2072 616e 646f 6d2e 6368  ndow": random.ch
+00015760: 6f69 6365 7328 5b33 2c20 3135 2c20 3930  oices([3, 15, 90
+00015770: 2c20 3336 355d 2c20 5b30 2e32 2c20 302e  , 365], [0.2, 0.
+00015780: 322c 2030 2e32 2c20 302e 325d 295b 305d  2, 0.2, 0.2])[0]
+00015790: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+000157a0: 7472 656e 645f 7374 616e 6469 6e22 3a20  trend_standin": 
+000157b0: 7261 6e64 6f6d 2e63 686f 6963 6573 280d  random.choices(.
+000157c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000157d0: 205b 4e6f 6e65 2c20 2772 616e 646f 6d5f   [None, 'random_
+000157e0: 6e6f 726d 616c 272c 2027 726f 6c6c 696e  normal', 'rollin
+000157f0: 675f 7472 656e 6427 5d2c 0d0a 2020 2020  g_trend'],..    
+00015800: 2020 2020 2020 2020 2020 2020 5b30 2e35              [0.5
+00015810: 2c20 302e 342c 2030 2e31 5d2c 0d0a 2020  , 0.4, 0.1],..  
+00015820: 2020 2020 2020 2020 2020 295b 305d 2c0d            )[0],.
+00015830: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+00015840: 656e 645f 616e 6f6d 616c 795f 6465 7465  end_anomaly_dete
+00015850: 6374 6f72 5f70 6172 616d 7322 3a20 7472  ctor_params": tr
+00015860: 656e 645f 616e 6f6d 616c 795f 6465 7465  end_anomaly_dete
+00015870: 6374 6f72 5f70 6172 616d 732c 0d0a 2020  ctor_params,..  
+00015880: 2020 2020 2020 2020 2020 2320 2274 7265            # "tre
+00015890: 6e64 5f61 6e6f 6d61 6c79 5f69 6e74 6572  nd_anomaly_inter
+000158a0: 7665 6e74 696f 6e22 3a20 7472 656e 645f  vention": trend_
+000158b0: 616e 6f6d 616c 795f 696e 7465 7276 656e  anomaly_interven
+000158c0: 7469 6f6e 2c0d 0a20 2020 2020 2020 2020  tion,..         
+000158d0: 2020 2022 7472 656e 645f 7472 616e 7366     "trend_transf
+000158e0: 6f72 6d61 7469 6f6e 223a 2074 7265 6e64  ormation": trend
+000158f0: 5f74 7261 6e73 666f 726d 6174 696f 6e2c  _transformation,
+00015900: 0d0a 2020 2020 2020 2020 2020 2020 2274  ..            "t
+00015910: 7265 6e64 5f6d 6f64 656c 223a 2074 7265  rend_model": tre
+00015920: 6e64 5f6d 6f64 656c 2c0d 0a20 2020 2020  nd_model,..     
+00015930: 2020 2020 2020 2022 7472 656e 645f 7068         "trend_ph
+00015940: 6922 3a20 7261 6e64 6f6d 2e63 686f 6963  i": random.choic
+00015950: 6573 285b 4e6f 6e65 2c20 302e 3938 5d2c  es([None, 0.98],
+00015960: 205b 302e 392c 2030 2e31 5d29 5b30 5d2c   [0.9, 0.1])[0],
+00015970: 0d0a 2020 2020 2020 2020 7d0d 0a0d 0a20  ..        }.... 
+00015980: 2020 2064 6566 2067 6574 5f70 6172 616d     def get_param
+00015990: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+000159a0: 2020 7265 7475 726e 207b 0d0a 2020 2020    return {..    
+000159b0: 2020 2020 2020 2020 2270 7265 7072 6f63          "preproc
+000159c0: 6573 7369 6e67 5f74 7261 6e73 666f 726d  essing_transform
+000159d0: 6174 696f 6e22 3a20 7365 6c66 2e70 7265  ation": self.pre
+000159e0: 7072 6f63 6573 7369 6e67 5f74 7261 6e73  processing_trans
+000159f0: 666f 726d 6174 696f 6e2c 0d0a 2020 2020  formation,..    
+00015a00: 2020 2020 2020 2020 2273 6361 6c69 6e67          "scaling
+00015a10: 223a 2073 656c 662e 7363 616c 696e 672c  ": self.scaling,
+00015a20: 0d0a 2020 2020 2020 2020 2020 2020 2270  ..            "p
+00015a30: 6173 745f 696d 7061 6374 735f 696e 7465  ast_impacts_inte
+00015a40: 7276 656e 7469 6f6e 223a 2073 656c 662e  rvention": self.
+00015a50: 7061 7374 5f69 6d70 6163 7473 5f69 6e74  past_impacts_int
+00015a60: 6572 7665 6e74 696f 6e2c 2020 2320 6e6f  ervention,  # no
+00015a70: 7420 696e 206e 6577 0d0a 2020 2020 2020  t in new..      
+00015a80: 2020 2020 2020 2273 6561 736f 6e61 6c69        "seasonali
+00015a90: 7469 6573 223a 2073 656c 662e 7365 6173  ties": self.seas
+00015aa0: 6f6e 616c 6974 6965 732c 0d0a 2020 2020  onalities,..    
+00015ab0: 2020 2020 2020 2020 2261 725f 6c61 6773          "ar_lags
+00015ac0: 223a 2073 656c 662e 6172 5f6c 6167 732c  ": self.ar_lags,
+00015ad0: 0d0a 2020 2020 2020 2020 2020 2020 2261  ..            "a
+00015ae0: 725f 696e 7465 7261 6374 696f 6e5f 7365  r_interaction_se
+00015af0: 6173 6f6e 616c 6974 7922 3a20 7365 6c66  asonality": self
+00015b00: 2e61 725f 696e 7465 7261 6374 696f 6e5f  .ar_interaction_
+00015b10: 7365 6173 6f6e 616c 6974 790d 0a20 2020  seasonality..   
+00015b20: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00015b30: 2e61 725f 6c61 6773 2069 7320 6e6f 7420  .ar_lags is not 
+00015b40: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00015b50: 2020 656c 7365 204e 6f6e 652c 0d0a 2020    else None,..  
+00015b60: 2020 2020 2020 2020 2020 2261 6e6f 6d61            "anoma
+00015b70: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
+00015b80: 6d73 223a 2073 656c 662e 616e 6f6d 616c  ms": self.anomal
+00015b90: 795f 6465 7465 6374 6f72 5f70 6172 616d  y_detector_param
+00015ba0: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+00015bb0: 2261 6e6f 6d61 6c79 5f69 6e74 6572 7665  "anomaly_interve
+00015bc0: 6e74 696f 6e22 3a20 7365 6c66 2e61 6e6f  ntion": self.ano
+00015bd0: 6d61 6c79 5f69 6e74 6572 7665 6e74 696f  maly_interventio
+00015be0: 6e2c 0d0a 2020 2020 2020 2020 2020 2020  n,..            
+00015bf0: 2268 6f6c 6964 6179 5f64 6574 6563 746f  "holiday_detecto
+00015c00: 725f 7061 7261 6d73 223a 2073 656c 662e  r_params": self.
+00015c10: 686f 6c69 6461 795f 6465 7465 6374 6f72  holiday_detector
+00015c20: 5f70 6172 616d 732c 0d0a 2020 2020 2020  _params,..      
+00015c30: 2020 2020 2020 2320 2268 6f6c 6964 6179        # "holiday
+00015c40: 5f69 6e74 6572 7665 6e74 696f 6e22 3a20  _intervention": 
+00015c50: 7365 6c66 2e68 6f6c 6964 6179 5f69 6e74  self.holiday_int
+00015c60: 6572 7665 6e74 696f 6e2c 0d0a 2020 2020  ervention,..    
+00015c70: 2020 2020 2020 2020 2320 2268 6f6c 6964          # "holid
+00015c80: 6179 5f63 6f75 6e74 7269 6573 223a 2073  ay_countries": s
+00015c90: 656c 662e 686f 6c69 6461 795f 636f 756e  elf.holiday_coun
+00015ca0: 7472 6965 732c 0d0a 2020 2020 2020 2020  tries,..        
+00015cb0: 2020 2020 2268 6f6c 6964 6179 5f63 6f75      "holiday_cou
+00015cc0: 6e74 7269 6573 5f75 7365 6422 3a20 7365  ntries_used": se
+00015cd0: 6c66 2e68 6f6c 6964 6179 5f63 6f75 6e74  lf.holiday_count
+00015ce0: 7269 6573 5f75 7365 642c 0d0a 2020 2020  ries_used,..    
+00015cf0: 2020 2020 2020 2020 226d 756c 7469 7661          "multiva
+00015d00: 7269 6174 655f 6665 6174 7572 6522 3a20  riate_feature": 
+00015d10: 7365 6c66 2e6d 756c 7469 7661 7269 6174  self.multivariat
+00015d20: 655f 6665 6174 7572 652c 0d0a 2020 2020  e_feature,..    
+00015d30: 2020 2020 2020 2020 226d 756c 7469 7661          "multiva
+00015d40: 7269 6174 655f 7472 616e 7366 6f72 6d61  riate_transforma
+00015d50: 7469 6f6e 223a 2073 656c 662e 6d75 6c74  tion": self.mult
+00015d60: 6976 6172 6961 7465 5f74 7261 6e73 666f  ivariate_transfo
+00015d70: 726d 6174 696f 6e0d 0a20 2020 2020 2020  rmation..       
+00015d80: 2020 2020 2069 6620 7365 6c66 2e6d 756c       if self.mul
+00015d90: 7469 7661 7269 6174 655f 6665 6174 7572  tivariate_featur
+00015da0: 6520 6973 206e 6f74 204e 6f6e 650d 0a20  e is not None.. 
+00015db0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+00015dc0: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2020  None,..         
+00015dd0: 2020 2022 7265 6772 6573 736f 725f 7472     "regressor_tr
+00015de0: 616e 7366 6f72 6d61 7469 6f6e 223a 2073  ansformation": s
+00015df0: 656c 662e 7265 6772 6573 736f 725f 7472  elf.regressor_tr
+00015e00: 616e 7366 6f72 6d61 7469 6f6e 0d0a 2020  ansformation..  
+00015e10: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00015e20: 662e 7265 6772 6573 736f 7273 5f75 7365  f.regressors_use
+00015e30: 640d 0a20 2020 2020 2020 2020 2020 2065  d..            e
+00015e40: 6c73 6520 4e6f 6e65 2c0d 0a20 2020 2020  lse None,..     
+00015e50: 2020 2020 2020 2022 7265 6772 6573 736f         "regresso
+00015e60: 7273 5f75 7365 6422 3a20 7365 6c66 2e72  rs_used": self.r
+00015e70: 6567 7265 7373 6f72 735f 7573 6564 2c0d  egressors_used,.
+00015e80: 0a20 2020 2020 2020 2020 2020 2022 6c69  .            "li
+00015e90: 6e65 6172 5f6d 6f64 656c 223a 2073 656c  near_model": sel
+00015ea0: 662e 6c69 6e65 6172 5f6d 6f64 656c 2c0d  f.linear_model,.
+00015eb0: 0a20 2020 2020 2020 2020 2020 2022 7261  .            "ra
+00015ec0: 6e64 6f6d 7761 6c6b 5f6e 223a 2073 656c  ndomwalk_n": sel
+00015ed0: 662e 7261 6e64 6f6d 7761 6c6b 5f6e 2c0d  f.randomwalk_n,.
+00015ee0: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+00015ef0: 656e 645f 7769 6e64 6f77 223a 2073 656c  end_window": sel
+00015f00: 662e 7472 656e 645f 7769 6e64 6f77 2c0d  f.trend_window,.
+00015f10: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+00015f20: 656e 645f 7374 616e 6469 6e22 3a20 7365  end_standin": se
+00015f30: 6c66 2e74 7265 6e64 5f73 7461 6e64 696e  lf.trend_standin
+00015f40: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00015f50: 7472 656e 645f 616e 6f6d 616c 795f 6465  trend_anomaly_de
+00015f60: 7465 6374 6f72 5f70 6172 616d 7322 3a20  tector_params": 
+00015f70: 7365 6c66 2e74 7265 6e64 5f61 6e6f 6d61  self.trend_anoma
+00015f80: 6c79 5f64 6574 6563 746f 725f 7061 7261  ly_detector_para
+00015f90: 6d73 2c0d 0a20 2020 2020 2020 2020 2020  ms,..           
+00015fa0: 2023 2022 7472 656e 645f 616e 6f6d 616c   # "trend_anomal
+00015fb0: 795f 696e 7465 7276 656e 7469 6f6e 223a  y_intervention":
+00015fc0: 2073 656c 662e 7472 656e 645f 616e 6f6d   self.trend_anom
+00015fd0: 616c 795f 696e 7465 7276 656e 7469 6f6e  aly_intervention
+00015fe0: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00015ff0: 7472 656e 645f 7472 616e 7366 6f72 6d61  trend_transforma
+00016000: 7469 6f6e 223a 2073 656c 662e 7472 656e  tion": self.tren
+00016010: 645f 7472 616e 7366 6f72 6d61 7469 6f6e  d_transformation
+00016020: 2c0d 0a20 2020 2020 2020 2020 2020 2022  ,..            "
+00016030: 7472 656e 645f 6d6f 6465 6c22 3a20 7365  trend_model": se
+00016040: 6c66 2e74 7265 6e64 5f6d 6f64 656c 2c0d  lf.trend_model,.
+00016050: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+00016060: 656e 645f 7068 6922 3a20 7365 6c66 2e74  end_phi": self.t
+00016070: 7265 6e64 5f70 6869 2c0d 0a20 2020 2020  rend_phi,..     
+00016080: 2020 2020 2020 2023 2022 636f 6e73 7472         # "constr
+00016090: 6169 6e74 223a 2073 656c 662e 636f 6e73  aint": self.cons
+000160a0: 7472 6169 6e74 2c0d 0a20 2020 2020 2020  traint,..       
+000160b0: 207d 0d0a 0d0a 2020 2020 6465 6620 706c   }....    def pl
+000160c0: 6f74 5f63 6f6d 706f 6e65 6e74 7328 0d0a  ot_components(..
+000160d0: 2020 2020 2020 2020 7365 6c66 2c0d 0a20          self,.. 
+000160e0: 2020 2020 2020 2070 7265 6469 6374 696f         predictio
+000160f0: 6e3d 4e6f 6e65 2c0d 0a20 2020 2020 2020  n=None,..       
+00016100: 2073 6572 6965 733d 4e6f 6e65 2c0d 0a20   series=None,.. 
+00016110: 2020 2020 2020 2066 6967 7369 7a65 3d28         figsize=(
+00016120: 3136 2c20 3929 2c0d 0a20 2020 2020 2020  16, 9),..       
+00016130: 2074 6f5f 6f72 6967 696e 5f73 7061 6365   to_origin_space
+00016140: 3d54 7275 652c 0d0a 2020 2020 2020 2020  =True,..        
+00016150: 7469 746c 653d 4e6f 6e65 2c0d 0a20 2020  title=None,..   
+00016160: 2020 2020 2073 7461 7274 5f64 6174 653d       start_date=
+00016170: 4e6f 6e65 2c0d 0a20 2020 2029 3a0d 0a20  None,..    ):.. 
+00016180: 2020 2020 2020 2069 6620 7365 7269 6573         if series
+00016190: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+000161a0: 2020 2020 2020 2073 6572 6965 7320 3d20         series = 
+000161b0: 7261 6e64 6f6d 2e63 686f 6963 6528 7365  random.choice(se
+000161c0: 6c66 2e63 6f6c 756d 6e5f 6e61 6d65 7329  lf.column_names)
+000161d0: 0d0a 2020 2020 2020 2020 6966 2074 6974  ..        if tit
+000161e0: 6c65 2069 7320 4e6f 6e65 3a0d 0a20 2020  le is None:..   
+000161f0: 2020 2020 2020 2020 2074 6974 6c65 203d           title =
+00016200: 2066 224d 6f64 656c 2043 6f6d 706f 6e65   f"Model Compone
+00016210: 6e74 7320 666f 7220 7b73 6572 6965 737d  nts for {series}
+00016220: 220d 0a20 2020 2020 2020 2070 6c6f 745f  "..        plot_
+00016230: 6c69 7374 203d 205b 5d0d 0a20 2020 2020  list = []..     
+00016240: 2020 2069 6620 7072 6564 6963 7469 6f6e     if prediction
+00016250: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00016260: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
+00016270: 6c69 7374 2e61 7070 656e 6428 7072 6564  list.append(pred
+00016280: 6963 7469 6f6e 2e66 6f72 6563 6173 745b  iction.forecast[
+00016290: 7365 7269 6573 5d2e 7265 6e61 6d65 2822  series].rename("
+000162a0: 666f 7265 6361 7374 2229 290d 0a20 2020  forecast"))..   
+000162b0: 2020 2020 2020 2020 2070 6c74 5f69 6478           plt_idx
+000162c0: 203d 2070 7265 6469 6374 696f 6e2e 666f   = prediction.fo
+000162d0: 7265 6361 7374 2e69 6e64 6578 0d0a 2020  recast.index..  
+000162e0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000162f0: 2020 2020 2020 2020 2070 6c74 5f69 6478           plt_idx
+00016300: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+00016310: 2070 6c6f 745f 6c69 7374 2e61 7070 656e   plot_list.appen
+00016320: 6428 7365 6c66 2e70 7265 6469 6374 6564  d(self.predicted
+00016330: 5f74 7265 6e64 5b73 6572 6965 735d 2e72  _trend[series].r
+00016340: 656e 616d 6528 2274 7265 6e64 2229 290d  ename("trend")).
+00016350: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00016360: 2e69 6d70 6163 7473 2069 7320 6e6f 7420  .impacts is not 
+00016370: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00016380: 2020 2070 6c6f 745f 6c69 7374 2e61 7070     plot_list.app
+00016390: 656e 6428 2873 656c 662e 696d 7061 6374  end((self.impact
+000163a0: 735b 7365 7269 6573 5d2e 7265 6e61 6d65  s[series].rename
+000163b0: 2822 696d 7061 6374 2025 2229 202d 2031  ("impact %") - 1
+000163c0: 2e30 2920 2a20 3130 3029 0d0a 2020 2020  .0) * 100)..    
+000163d0: 2020 2020 6966 2070 6c74 5f69 6478 2069      if plt_idx i
+000163e0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+000163f0: 2020 2020 2070 6c6f 745f 6c69 7374 2e61       plot_list.a
+00016400: 7070 656e 6428 0d0a 2020 2020 2020 2020  ppend(..        
+00016410: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00016420: 6365 7373 5f63 6f6d 706f 6e65 6e74 7328  cess_components(
+00016430: 746f 5f6f 7269 6769 6e5f 7370 6163 653d  to_origin_space=
+00016440: 746f 5f6f 7269 6769 6e5f 7370 6163 6529  to_origin_space)
+00016450: 5b73 6572 6965 735d 0d0a 2020 2020 2020  [series]..      
+00016460: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00016470: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00016480: 2020 2020 706c 6f74 5f6c 6973 742e 6170      plot_list.ap
+00016490: 7065 6e64 280d 0a20 2020 2020 2020 2020  pend(..         
+000164a0: 2020 2020 2020 2073 656c 662e 7072 6f63         self.proc
+000164b0: 6573 735f 636f 6d70 6f6e 656e 7473 2874  ess_components(t
+000164c0: 6f5f 6f72 6967 696e 5f73 7061 6365 3d74  o_origin_space=t
+000164d0: 6f5f 6f72 6967 696e 5f73 7061 6365 295b  o_origin_space)[
+000164e0: 7365 7269 6573 5d2e 6c6f 635b 0d0a 2020  series].loc[..  
+000164f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016500: 2020 706c 745f 6964 780d 0a20 2020 2020    plt_idx..     
+00016510: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
+00016520: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
+00016530: 2020 2020 2070 6c6f 745f 6466 203d 2070       plot_df = p
+00016540: 642e 636f 6e63 6174 2870 6c6f 745f 6c69  d.concat(plot_li
+00016550: 7374 2c20 6178 6973 3d31 290d 0a20 2020  st, axis=1)..   
+00016560: 2020 2020 2069 6620 7374 6172 745f 6461       if start_da
+00016570: 7465 2069 7320 6e6f 7420 4e6f 6e65 3a0d  te is not None:.
+00016580: 0a20 2020 2020 2020 2020 2020 2070 6c6f  .            plo
+00016590: 745f 6466 203d 2070 6c6f 745f 6466 5b70  t_df = plot_df[p
+000165a0: 6c6f 745f 6466 2e69 6e64 6578 203e 3d20  lot_df.index >= 
+000165b0: 7374 6172 745f 6461 7465 5d0d 0a20 2020  start_date]..   
+000165c0: 2020 2020 2072 6574 7572 6e20 706c 6f74       return plot
+000165d0: 5f64 662e 706c 6f74 2873 7562 706c 6f74  _df.plot(subplot
+000165e0: 733d 5472 7565 2c20 6669 6773 697a 653d  s=True, figsize=
+000165f0: 6669 6773 697a 652c 2074 6974 6c65 3d74  figsize, title=t
+00016600: 6974 6c65 290d 0a0d 0a20 2020 2064 6566  itle)....    def
+00016610: 2072 6574 7572 6e5f 636f 6d70 6f6e 656e   return_componen
+00016620: 7473 2873 656c 662c 2074 6f5f 6f72 6967  ts(self, to_orig
+00016630: 696e 5f73 7061 6365 3d54 7275 652c 2069  in_space=True, i
+00016640: 6e63 6c75 6465 5f69 6d70 6163 7473 3d46  nclude_impacts=F
+00016650: 616c 7365 293a 0d0a 2020 2020 2020 2020  alse):..        
+00016660: 2222 2252 6574 7572 6e20 6164 6469 7469  """Return additi
+00016670: 7665 2065 6c65 6d65 6e74 7320 6f66 2066  ve elements of f
+00016680: 6f72 6563 6173 742c 206c 696e 6561 7220  orecast, linear 
+00016690: 616e 6420 7472 656e 642e 2049 6620 696d  and trend. If im
+000166a0: 7061 6374 7320 696e 636c 7564 6564 2c20  pacts included, 
+000166b0: 6974 2069 7320 6120 6d75 6c74 6970 6c69  it is a multipli
+000166c0: 6361 7469 7665 2074 6572 6d2e 0d0a 0d0a  cative term.....
+000166d0: 2020 2020 2020 2020 4172 6773 3a0d 0a20          Args:.. 
+000166e0: 2020 2020 2020 2020 2020 2074 6f5f 6f72             to_or
+000166f0: 6967 696e 5f73 7061 6365 2028 626f 6f6c  igin_space (bool
+00016700: 2920 6966 2046 616c 7365 2c20 7769 6c6c  ) if False, will
+00016710: 206e 6f74 2072 6576 6572 7365 2074 7261   not reverse tra
+00016720: 6e73 666f 726d 206c 696e 6561 7220 636f  nsform linear co
+00016730: 6d70 6f6e 656e 7473 0d0a 2020 2020 2020  mponents..      
+00016740: 2020 2020 2020 696e 636c 7564 655f 696d        include_im
+00016750: 7061 6374 7320 2862 6f6f 6c29 2069 6620  pacts (bool) if 
+00016760: 5472 7565 2c20 696d 7061 6374 7320 6172  True, impacts ar
+00016770: 6520 696e 636c 7564 6564 2069 6e20 7468  e included in th
+00016780: 6520 7265 7475 726e 6564 2064 6174 6166  e returned dataf
+00016790: 7261 6d65 0d0a 2020 2020 2020 2020 2222  rame..        ""
+000167a0: 220d 0a20 2020 2020 2020 2070 6c6f 745f  "..        plot_
+000167b0: 6c69 7374 203d 205b 5d0d 0a20 2020 2020  list = []..     
+000167c0: 2020 2070 6c6f 745f 6c69 7374 2e61 7070     plot_list.app
+000167d0: 656e 6428 7365 6c66 2e70 726f 6365 7373  end(self.process
+000167e0: 5f63 6f6d 706f 6e65 6e74 7328 746f 5f6f  _components(to_o
+000167f0: 7269 6769 6e5f 7370 6163 653d 746f 5f6f  rigin_space=to_o
+00016800: 7269 6769 6e5f 7370 6163 6529 290d 0a20  rigin_space)).. 
+00016810: 2020 2020 2020 2074 7265 6e64 203d 2073         trend = s
+00016820: 656c 662e 7072 6564 6963 7465 645f 7472  elf.predicted_tr
+00016830: 656e 642e 636f 7079 2829 0d0a 2020 2020  end.copy()..    
+00016840: 2020 2020 7472 656e 642e 636f 6c75 6d6e      trend.column
+00016850: 7320 3d20 7064 2e4d 756c 7469 496e 6465  s = pd.MultiInde
+00016860: 782e 6672 6f6d 5f61 7272 6179 7328 0d0a  x.from_arrays(..
+00016870: 2020 2020 2020 2020 2020 2020 5b74 7265              [tre
+00016880: 6e64 2e63 6f6c 756d 6e73 2c20 5b27 7472  nd.columns, ['tr
+00016890: 656e 6427 5d20 2a20 6c65 6e28 7472 656e  end'] * len(tren
+000168a0: 642e 636f 6c75 6d6e 7329 5d0d 0a20 2020  d.columns)]..   
+000168b0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+000168c0: 706c 6f74 5f6c 6973 742e 6170 7065 6e64  plot_list.append
+000168d0: 2874 7265 6e64 290d 0a20 2020 2020 2020  (trend)..       
+000168e0: 2069 6620 7365 6c66 2e69 6d70 6163 7473   if self.impacts
+000168f0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00016900: 2069 6e63 6c75 6465 5f69 6d70 6163 7473   include_impacts
+00016910: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00016920: 6d70 6163 7473 203d 2073 656c 662e 696d  mpacts = self.im
+00016930: 7061 6374 732e 636f 7079 2829 0d0a 2020  pacts.copy()..  
+00016940: 2020 2020 2020 2020 2020 696d 7061 6374            impact
+00016950: 732e 636f 6c75 6d6e 7320 3d20 7064 2e4d  s.columns = pd.M
+00016960: 756c 7469 496e 6465 782e 6672 6f6d 5f61  ultiIndex.from_a
+00016970: 7272 6179 7328 0d0a 2020 2020 2020 2020  rrays(..        
+00016980: 2020 2020 2020 2020 5b69 6d70 6163 7473          [impacts
+00016990: 2e63 6f6c 756d 6e73 2c20 5b27 696d 7061  .columns, ['impa
+000169a0: 6374 7327 5d20 2a20 6c65 6e28 696d 7061  cts'] * len(impa
+000169b0: 6374 732e 636f 6c75 6d6e 7329 5d0d 0a20  cts.columns)].. 
+000169c0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+000169d0: 2020 2020 2020 2020 2020 706c 6f74 5f6c            plot_l
+000169e0: 6973 742e 6170 7065 6e64 2869 6d70 6163  ist.append(impac
+000169f0: 7473 290d 0a20 2020 2020 2020 2072 6574  ts)..        ret
+00016a00: 7572 6e20 7064 2e63 6f6e 6361 7428 706c  urn pd.concat(pl
+00016a10: 6f74 5f6c 6973 742c 2061 7869 733d 3129  ot_list, axis=1)
+00016a20: 0d0a 0d0a 2020 2020 6465 6620 706c 6f74  ....    def plot
+00016a30: 5f74 7265 6e64 280d 0a20 2020 2020 2020  _trend(..       
+00016a40: 2073 656c 662c 0d0a 2020 2020 2020 2020   self,..        
+00016a50: 7365 7269 6573 3d4e 6f6e 652c 0d0a 2020  series=None,..  
+00016a60: 2020 2020 2020 766c 696e 653d 4e6f 6e65        vline=None
+00016a70: 2c0d 0a20 2020 2020 2020 2063 6f6c 6f72  ,..        color
+00016a80: 733d 5b22 2364 3466 3734 6622 2c20 2223  s=["#d4f74f", "#
+00016a90: 3832 6162 3561 222c 2022 2366 6636 6330  82ab5a", "#ff6c0
+00016aa0: 3522 2c20 2223 6331 3236 3030 225d 2c0d  5", "#c12600"],.
+00016ab0: 0a20 2020 2020 2020 2074 6974 6c65 3d4e  .        title=N
+00016ac0: 6f6e 652c 0d0a 2020 2020 2020 2020 7374  one,..        st
+00016ad0: 6172 745f 6461 7465 3d4e 6f6e 652c 0d0a  art_date=None,..
+00016ae0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+00016af0: 2c0d 0a20 2020 2029 3a0d 0a20 2020 2020  ,..    ):..     
+00016b00: 2020 2023 2059 4d41 5820 6672 6f6d 2050     # YMAX from P
+00016b10: 4c4f 5420 4f4e 4c59 0d0a 2020 2020 2020  LOT ONLY..      
+00016b20: 2020 6966 2073 6572 6965 7320 6973 204e    if series is N
+00016b30: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00016b40: 2020 7365 7269 6573 203d 2072 616e 646f    series = rando
+00016b50: 6d2e 6368 6f69 6365 2873 656c 662e 636f  m.choice(self.co
+00016b60: 6c75 6d6e 5f6e 616d 6573 290d 0a20 2020  lumn_names)..   
+00016b70: 2020 2020 2069 6620 7469 746c 6520 6973       if title is
+00016b80: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00016b90: 2020 2020 7469 746c 6520 3d20 6622 5472      title = f"Tr
+00016ba0: 656e 6420 4272 6561 6b64 6f77 6e20 666f  end Breakdown fo
+00016bb0: 7220 7b73 6572 6965 737d 220d 0a20 2020  r {series}"..   
+00016bc0: 2020 2020 2070 5f69 6e64 7820 3d20 7365       p_indx = se
+00016bd0: 6c66 2e63 6f6c 756d 6e5f 6e61 6d65 732e  lf.column_names.
+00016be0: 6765 745f 6c6f 6328 7365 7269 6573 290d  get_loc(series).
+00016bf0: 0a20 2020 2020 2020 2063 7572 5f74 7265  .        cur_tre
+00016c00: 6e64 203d 2073 656c 662e 7072 6564 6963  nd = self.predic
+00016c10: 7465 645f 7472 656e 645b 7365 7269 6573  ted_trend[series
+00016c20: 5d2e 636f 7079 2829 0d0a 2020 2020 2020  ].copy()..      
+00016c30: 2020 746c 7320 3d20 6c65 6e28 6375 725f    tls = len(cur_
+00016c40: 7472 656e 6429 0d0a 2020 2020 2020 2020  trend)..        
+00016c50: 706c 6f74 5f64 6620 3d20 7064 2e44 6174  plot_df = pd.Dat
+00016c60: 6146 7261 6d65 280d 0a20 2020 2020 2020  aFrame(..       
+00016c70: 2020 2020 207b 0d0a 2020 2020 2020 2020       {..        
+00016c80: 2020 2020 2020 2020 2764 6563 6c69 6e65          'decline
+00016c90: 5f61 6363 656c 6572 6174 696e 6727 3a20  _accelerating': 
+00016ca0: 6375 725f 7472 656e 645b 0d0a 2020 2020  cur_trend[..    
+00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cc0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00016cd0: 2020 2020 2020 2020 2020 206e 702e 6873             np.hs
+00016ce0: 7461 636b 2828 6e70 2e73 6967 6e62 6974  tack((np.signbit
+00016cf0: 2873 656c 662e 6163 6365 6c5b 3a2c 2070  (self.accel[:, p
+00016d00: 5f69 6e64 785d 292c 2046 616c 7365 2929  _indx]), False))
+00016d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016d20: 2020 2020 2020 2020 2020 2620 7365 6c66            & self
+00016d30: 2e73 6c6f 7065 5f73 6967 6e5b 3a2c 2070  .slope_sign[:, p
+00016d40: 5f69 6e64 785d 0d0a 2020 2020 2020 2020  _indx]..        
+00016d50: 2020 2020 2020 2020 2020 2020 295b 2d74              )[-t
+00016d60: 6c73 3a5d 0d0a 2020 2020 2020 2020 2020  ls:]..          
+00016d70: 2020 2020 2020 5d2c 0d0a 2020 2020 2020        ],..      
+00016d80: 2020 2020 2020 2020 2020 2764 6563 6c69            'decli
+00016d90: 6e65 5f64 6563 656c 6572 6174 696e 6727  ne_decelerating'
+00016da0: 3a20 6375 725f 7472 656e 645b 0d0a 2020  : cur_trend[..  
+00016db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016dc0: 2020 280d 0a20 2020 2020 2020 2020 2020    (..           
+00016dd0: 2020 2020 2020 2020 2020 2020 2028 7e6e               (~n
+00016de0: 702e 6873 7461 636b 2828 6e70 2e73 6967  p.hstack((np.sig
+00016df0: 6e62 6974 2873 656c 662e 6163 6365 6c5b  nbit(self.accel[
+00016e00: 3a2c 2070 5f69 6e64 785d 292c 2046 616c  :, p_indx]), Fal
+00016e10: 7365 2929 290d 0a20 2020 2020 2020 2020  se)))..         
+00016e20: 2020 2020 2020 2020 2020 2020 2020 2026                 &
+00016e30: 2073 656c 662e 736c 6f70 655f 7369 676e   self.slope_sign
+00016e40: 5b3a 2c20 705f 696e 6478 5d0d 0a20 2020  [:, p_indx]..   
 00016e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00016e60: 2029 5b2d 746c 733a 5d0d 0a20 2020 2020   )[-tls:]..     
 00016e70: 2020 2020 2020 2020 2020 205d 2c0d 0a20             ],.. 
-00016e80: 2020 2020 2020 2020 2020 207d 2c0d 0a20             },.. 
-00016e90: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-00016ea0: 3d63 7572 5f74 7265 6e64 2e69 6e64 6578  =cur_trend.index
-00016eb0: 2c0d 0a20 2020 2020 2020 2029 0d0a 2020  ,..        )..  
-00016ec0: 2020 2020 2020 6966 2073 7461 7274 5f64        if start_d
-00016ed0: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
-00016ee0: 0d0a 2020 2020 2020 2020 2020 2020 706c  ..            pl
-00016ef0: 6f74 5f64 6620 3d20 706c 6f74 5f64 665b  ot_df = plot_df[
-00016f00: 706c 6f74 5f64 662e 696e 6465 7820 3e3d  plot_df.index >=
-00016f10: 2073 7461 7274 5f64 6174 655d 0d0a 2020   start_date]..  
-00016f20: 2020 2020 2020 6178 203d 2070 6c6f 745f        ax = plot_
-00016f30: 6466 2e70 6c6f 7428 7469 746c 653d 7469  df.plot(title=ti
-00016f40: 746c 652c 2063 6f6c 6f72 3d63 6f6c 6f72  tle, color=color
-00016f50: 732c 202a 2a6b 7761 7267 7329 0d0a 2020  s, **kwargs)..  
-00016f60: 2020 2020 2020 6861 6e64 6c65 732c 206c        handles, l
-00016f70: 6162 656c 7320 3d20 6178 2e67 6574 5f6c  abels = ax.get_l
-00016f80: 6567 656e 645f 6861 6e64 6c65 735f 6c61  egend_handles_la
-00016f90: 6265 6c73 2829 0d0a 2020 2020 2020 2020  bels()..        
-00016fa0: 2320 6178 2e73 6361 7474 6572 2863 7572  # ax.scatter(cur
-00016fb0: 5f74 7265 6e64 2e69 6e64 6578 5b73 656c  _trend.index[sel
-00016fc0: 662e 6368 616e 6765 706f 696e 7473 5b3a  f.changepoints[:
-00016fd0: 2c20 705f 696e 6478 5d5d 2c20 6375 725f  , p_indx]], cur_
-00016fe0: 7472 656e 645b 7365 6c66 2e63 6861 6e67  trend[self.chang
-00016ff0: 6570 6f69 6e74 735b 3a2c 2070 5f69 6e64  epoints[:, p_ind
-00017000: 785d 5d2c 2063 3d27 2366 6463 6330 3927  x]], c='#fdcc09'
-00017010: 2c20 733d 342e 3029 0d0a 2020 2020 2020  , s=4.0)..      
-00017020: 2020 2320 6178 2e73 6361 7474 6572 2863    # ax.scatter(c
-00017030: 7572 5f74 7265 6e64 2e69 6e64 6578 5b73  ur_trend.index[s
-00017040: 656c 662e 7a65 726f 5f63 726f 7373 696e  elf.zero_crossin
-00017050: 6773 5b3a 2c20 705f 696e 6478 5d5d 2c20  gs[:, p_indx]], 
-00017060: 6375 725f 7472 656e 645b 7365 6c66 2e7a  cur_trend[self.z
-00017070: 6572 6f5f 6372 6f73 7369 6e67 735b 3a2c  ero_crossings[:,
-00017080: 2070 5f69 6e64 785d 5d2c 2063 3d27 2335   p_indx]], c='#5
-00017090: 3132 6637 3427 2c20 733d 342e 3029 0d0a  12f74', s=4.0)..
-000170a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000170b0: 7472 656e 645f 616e 6f6d 616c 795f 6465  trend_anomaly_de
-000170c0: 7465 6374 6f72 2069 7320 6e6f 7420 4e6f  tector is not No
-000170d0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000170e0: 2069 6620 7365 6c66 2e74 7265 6e64 5f61   if self.trend_a
-000170f0: 6e6f 6d61 6c79 5f64 6574 6563 746f 722e  nomaly_detector.
-00017100: 6f75 7470 7574 203d 3d20 2275 6e69 7661  output == "univa
-00017110: 7269 6174 6522 3a0d 0a20 2020 2020 2020  riate":..       
-00017120: 2020 2020 2020 2020 2069 5f61 6e6f 6d20           i_anom 
-00017130: 3d20 7365 6c66 2e74 7265 6e64 5f61 6e6f  = self.trend_ano
-00017140: 6d61 6c79 5f64 6574 6563 746f 722e 616e  maly_detector.an
-00017150: 6f6d 616c 6965 732e 696e 6465 785b 0d0a  omalies.index[..
-00017160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017170: 2020 2020 7365 6c66 2e61 6e6f 6d61 6c79      self.anomaly
-00017180: 5f64 6574 6563 746f 722e 616e 6f6d 616c  _detector.anomal
-00017190: 6965 732e 696c 6f63 5b3a 2c20 305d 203d  ies.iloc[:, 0] =
-000171a0: 3d20 2d31 0d0a 2020 2020 2020 2020 2020  = -1..          
-000171b0: 2020 2020 2020 5d0d 0a20 2020 2020 2020        ]..       
-000171c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000171d0: 2020 2020 2020 2020 2020 2020 7365 7269              seri
-000171e0: 6573 5f61 6e6f 6d20 3d20 7365 6c66 2e74  es_anom = self.t
-000171f0: 7265 6e64 5f61 6e6f 6d61 6c79 5f64 6574  rend_anomaly_det
-00017200: 6563 746f 722e 616e 6f6d 616c 6965 735b  ector.anomalies[
-00017210: 7365 7269 6573 5d0d 0a20 2020 2020 2020  series]..       
-00017220: 2020 2020 2020 2020 2069 5f61 6e6f 6d20           i_anom 
-00017230: 3d20 7365 7269 6573 5f61 6e6f 6d5b 7365  = series_anom[se
-00017240: 7269 6573 5f61 6e6f 6d20 3d3d 202d 315d  ries_anom == -1]
-00017250: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
-00017260: 2020 2020 6966 2073 7461 7274 5f64 6174      if start_dat
-00017270: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-00017280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017290: 695f 616e 6f6d 203d 2069 5f61 6e6f 6d5b  i_anom = i_anom[
-000172a0: 695f 616e 6f6d 203e 3d20 7374 6172 745f  i_anom >= start_
-000172b0: 6461 7465 5d0d 0a20 2020 2020 2020 2020  date]..         
-000172c0: 2020 2069 5f61 6e6f 6d20 3d20 695f 616e     i_anom = i_an
-000172d0: 6f6d 5b69 5f61 6e6f 6d20 3e3d 2063 7572  om[i_anom >= cur
-000172e0: 5f74 7265 6e64 2e69 6e64 6578 5b30 5d5d  _trend.index[0]]
-000172f0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00017300: 6f6e 6c79 2070 6c6f 7420 6966 2073 6f6d  only plot if som
-00017310: 6520 616e 6f6d 616c 6965 732c 2061 6e64  e anomalies, and
-00017320: 206e 6f74 2077 6179 2074 6f6f 206d 616e   not way too man
-00017330: 7920 616e 6f6d 616c 6965 730d 0a20 2020  y anomalies..   
-00017340: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00017350: 695f 616e 6f6d 2920 3e20 3020 616e 6420  i_anom) > 0 and 
-00017360: 6c65 6e28 695f 616e 6f6d 2920 3c20 6c65  len(i_anom) < le
-00017370: 6e28 706c 6f74 5f64 6629 202a 2030 2e35  n(plot_df) * 0.5
-00017380: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00017390: 2020 2073 6361 7431 203d 2061 782e 7363     scat1 = ax.sc
-000173a0: 6174 7465 7228 0d0a 2020 2020 2020 2020  atter(..        
-000173b0: 2020 2020 2020 2020 2020 2020 695f 616e              i_an
-000173c0: 6f6d 2e74 6f6c 6973 7428 292c 2063 7572  om.tolist(), cur
-000173d0: 5f74 7265 6e64 2e6c 6f63 5b69 5f61 6e6f  _trend.loc[i_ano
-000173e0: 6d5d 2c20 633d 2272 6564 222c 2073 3d31  m], c="red", s=1
-000173f0: 362e 300d 0a20 2020 2020 2020 2020 2020  6.0..           
-00017400: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
-00017410: 2020 2020 2020 2020 6861 6e64 6c65 7320          handles 
-00017420: 2b3d 205b 7363 6174 315d 0d0a 2020 2020  += [scat1]..    
-00017430: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
-00017440: 6c73 202b 3d20 5b27 7472 656e 6420 616e  ls += ['trend an
-00017450: 6f6d 616c 6965 7327 5d0d 0a20 2020 2020  omalies']..     
-00017460: 2020 2069 6620 766c 696e 6520 6973 206e     if vline is n
-00017470: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00017480: 2020 2020 2020 6178 2e76 6c69 6e65 7328        ax.vlines(
-00017490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000174a0: 2020 783d 766c 696e 652c 0d0a 2020 2020    x=vline,..    
-000174b0: 2020 2020 2020 2020 2020 2020 6c73 3d27              ls='
-000174c0: 2d2d 272c 0d0a 2020 2020 2020 2020 2020  --',..          
-000174d0: 2020 2020 2020 6c77 3d31 2c0d 0a20 2020        lw=1,..   
-000174e0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-000174f0: 6f72 733d 2764 6172 6b72 6564 272c 0d0a  ors='darkred',..
-00017500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017510: 796d 696e 3d63 7572 5f74 7265 6e64 5b63  ymin=cur_trend[c
-00017520: 7572 5f74 7265 6e64 2e69 6e64 6578 203e  ur_trend.index >
-00017530: 3d20 7374 6172 745f 6461 7465 5d2e 6d69  = start_date].mi
-00017540: 6e28 292c 0d0a 2020 2020 2020 2020 2020  n(),..          
-00017550: 2020 2020 2020 796d 6178 3d63 7572 5f74        ymax=cur_t
-00017560: 7265 6e64 5b63 7572 5f74 7265 6e64 2e69  rend[cur_trend.i
-00017570: 6e64 6578 203e 3d20 7374 6172 745f 6461  ndex >= start_da
-00017580: 7465 5d2e 6d61 7828 292c 0d0a 2020 2020  te].max(),..    
-00017590: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
-000175a0: 2020 2061 782e 6c65 6765 6e64 2868 616e     ax.legend(han
-000175b0: 646c 6573 2c20 6c61 6265 6c73 290d 0a20  dles, labels).. 
-000175c0: 2020 2020 2020 2072 6574 7572 6e20 6178         return ax
-000175d0: 0d0a 0d0a 2020 2020 6465 6620 706c 6f74  ....    def plot
-000175e0: 5f66 6f72 6563 6173 7428 0d0a 2020 2020  _forecast(..    
-000175f0: 2020 2020 7365 6c66 2c0d 0a20 2020 2020      self,..     
-00017600: 2020 2070 7265 6469 6374 696f 6e2c 0d0a     prediction,..
-00017610: 2020 2020 2020 2020 6163 7475 616c 733d          actuals=
-00017620: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2073  None,..        s
-00017630: 6572 6965 733d 4e6f 6e65 2c0d 0a20 2020  eries=None,..   
-00017640: 2020 2020 2073 7461 7274 5f64 6174 653d       start_date=
-00017650: 4e6f 6e65 2c0d 0a20 2020 2020 2020 2061  None,..        a
-00017660: 6e6f 6d61 6c79 5f63 6f6c 6f72 3d22 6461  nomaly_color="da
-00017670: 726b 736c 6174 6562 6c75 6522 2c0d 0a20  rkslateblue",.. 
-00017680: 2020 2020 2020 2068 6f6c 6964 6179 5f63         holiday_c
-00017690: 6f6c 6f72 3d22 6461 726b 6772 6565 6e22  olor="darkgreen"
-000176a0: 2c0d 0a20 2020 2020 2020 2074 7265 6e64  ,..        trend
-000176b0: 5f61 6e6f 6d61 6c79 5f63 6f6c 6f72 3d27  _anomaly_color='
-000176c0: 736c 6174 6567 7261 7927 2c0d 0a20 2020  slategray',..   
-000176d0: 2020 2020 2070 6f69 6e74 5f73 697a 653d       point_size=
-000176e0: 3132 2e30 2c0d 0a20 2020 2029 3a0d 0a20  12.0,..    ):.. 
-000176f0: 2020 2020 2020 2022 2222 506c 6f74 2061         """Plot a
-00017700: 2066 6f72 6563 6173 7420 7469 6d65 2073   forecast time s
-00017710: 6572 6965 732e 0d0a 0d0a 2020 2020 2020  eries.....      
-00017720: 2020 4172 6773 3a0d 0a20 2020 2020 2020    Args:..       
-00017730: 2020 2020 2070 7265 6469 6374 696f 6e20       prediction 
-00017740: 286d 6f64 656c 2070 7265 6469 6374 696f  (model predictio
-00017750: 6e20 6f62 6a65 6374 2c20 7265 7175 6972  n object, requir
-00017760: 6564 290d 0a20 2020 2020 2020 2020 2020  ed)..           
-00017770: 2061 6374 7561 6c73 2028 7064 2e44 6174   actuals (pd.Dat
-00017780: 6146 7261 6d65 293a 2077 6964 6520 7374  aFrame): wide st
-00017790: 796c 6520 6466 2c20 6f66 206b 6e6f 7720  yle df, of know 
-000177a0: 6461 7461 2069 6620 6176 6169 6c61 626c  data if availabl
-000177b0: 650d 0a20 2020 2020 2020 2020 2020 2073  e..            s
-000177c0: 6572 6965 7320 2873 7472 293a 206e 616d  eries (str): nam
-000177d0: 6520 6f66 2074 696d 6520 7365 7269 6573  e of time series
-000177e0: 2063 6f6c 756d 6e20 746f 2070 6c6f 740d   column to plot.
-000177f0: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00017800: 7274 5f64 6174 6520 2873 7472 206f 7220  rt_date (str or 
-00017810: 5469 6d65 7374 616d 7029 3a20 706f 696e  Timestamp): poin
-00017820: 7420 6174 2077 6869 6368 2074 6f20 6265  t at which to be
-00017830: 6769 6e20 5820 6178 6973 0d0a 2020 2020  gin X axis..    
-00017840: 2020 2020 2020 2020 616e 6f6d 616c 795f          anomaly_
-00017850: 636f 6c6f 7220 2873 7472 293a 206e 616d  color (str): nam
-00017860: 6520 6f66 2061 6e6f 6d61 6c79 2070 6f69  e of anomaly poi
-00017870: 6e74 2063 6f6c 6f72 0d0a 2020 2020 2020  nt color..      
-00017880: 2020 2020 2020 686f 6c69 6461 795f 636f        holiday_co
-00017890: 6c6f 7220 2873 7472 293a 206e 616d 6520  lor (str): name 
-000178a0: 6f66 2068 6f6c 6964 6179 2070 6f69 6e74  of holiday point
-000178b0: 2063 6f6c 6f72 0d0a 2020 2020 2020 2020   color..        
-000178c0: 2020 2020 7472 656e 645f 616e 6f6d 616c      trend_anomal
-000178d0: 795f 636f 6c6f 7220 2873 7472 293a 206e  y_color (str): n
-000178e0: 616d 6520 6f66 2074 7265 6e64 2061 6e6f  ame of trend ano
-000178f0: 6d61 6c79 2070 6f69 6e74 2063 6f6c 6f72  maly point color
-00017900: 0d0a 2020 2020 2020 2020 2020 2020 706f  ..            po
-00017910: 696e 745f 7369 7a65 2028 7374 7229 3a20  int_size (str): 
-00017920: 706f 696e 7420 7369 7a65 2066 6f72 2061  point size for a
-00017930: 6c6c 2061 6e6f 6d61 6c69 6573 0d0a 2020  ll anomalies..  
-00017940: 2020 2020 2020 2222 220d 0a20 2020 2020        """..     
-00017950: 2020 2069 6620 7365 7269 6573 2069 7320     if series is 
-00017960: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00017970: 2020 2073 6572 6965 7320 3d20 7261 6e64     series = rand
-00017980: 6f6d 2e63 686f 6963 6528 7365 6c66 2e63  om.choice(self.c
-00017990: 6f6c 756d 6e5f 6e61 6d65 7329 0d0a 2020  olumn_names)..  
-000179a0: 2020 2020 2020 6966 2061 6374 7561 6c73        if actuals
-000179b0: 2069 7320 4e6f 6e65 206f 7220 6e6f 7420   is None or not 
-000179c0: 6973 696e 7374 616e 6365 280d 0a20 2020  isinstance(..   
-000179d0: 2020 2020 2020 2020 2061 6374 7561 6c73           actuals
-000179e0: 2c20 2870 642e 4461 7461 4672 616d 652c  , (pd.DataFrame,
-000179f0: 206e 702e 6172 7261 792c 2070 642e 5365   np.array, pd.Se
-00017a00: 7269 6573 290d 0a20 2020 2020 2020 2029  ries)..        )
-00017a10: 3a0d 0a20 2020 2020 2020 2020 2020 2061  :..            a
-00017a20: 6374 7561 6c73 5f75 7365 6420 3d20 7072  ctuals_used = pr
-00017a30: 6564 6963 7469 6f6e 2e66 6f72 6563 6173  ediction.forecas
-00017a40: 740d 0a20 2020 2020 2020 2020 2020 2061  t..            a
-00017a50: 6374 7561 6c73 5f66 6c61 6720 3d20 4661  ctuals_flag = Fa
-00017a60: 6c73 650d 0a20 2020 2020 2020 2065 6c73  lse..        els
-00017a70: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00017a80: 6163 7475 616c 735f 666c 6167 203d 2054  actuals_flag = T
-00017a90: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00017aa0: 2061 6374 7561 6c73 5f75 7365 6420 3d20   actuals_used = 
-00017ab0: 6163 7475 616c 732e 7265 696e 6465 7828  actuals.reindex(
-00017ac0: 7072 6564 6963 7469 6f6e 2e66 6f72 6563  prediction.forec
-00017ad0: 6173 742e 696e 6465 7829 0d0a 2020 2020  ast.index)..    
-00017ae0: 2020 2020 766c 696e 6520 3d20 280d 0a20      vline = (.. 
-00017af0: 2020 2020 2020 2020 2020 204e 6f6e 650d             None.
-00017b00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00017b10: 7365 6c66 2e66 6f72 6563 6173 745f 6c65  self.forecast_le
-00017b20: 6e67 7468 2069 7320 4e6f 6e65 0d0a 2020  ngth is None..  
-00017b30: 2020 2020 2020 2020 2020 656c 7365 2070            else p
-00017b40: 7265 6469 6374 696f 6e2e 666f 7265 6361  rediction.foreca
-00017b50: 7374 2e69 6e64 6578 5b2d 7365 6c66 2e66  st.index[-self.f
-00017b60: 6f72 6563 6173 745f 6c65 6e67 7468 5d0d  orecast_length].
-00017b70: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
-00017b80: 2020 2020 6178 203d 2070 7265 6469 6374      ax = predict
-00017b90: 696f 6e2e 706c 6f74 280d 0a20 2020 2020  ion.plot(..     
-00017ba0: 2020 2020 2020 2061 6374 7561 6c73 5f75         actuals_u
-00017bb0: 7365 642e 6c6f 635b 7072 6564 6963 7469  sed.loc[predicti
-00017bc0: 6f6e 2e66 6f72 6563 6173 742e 696e 6465  on.forecast.inde
-00017bd0: 785d 0d0a 2020 2020 2020 2020 2020 2020  x]..            
-00017be0: 6966 2061 6374 7561 6c73 5f66 6c61 6720  if actuals_flag 
-00017bf0: 6973 206e 6f74 204e 6f6e 650d 0a20 2020  is not None..   
-00017c00: 2020 2020 2020 2020 2065 6c73 6520 4e6f           else No
-00017c10: 6e65 2c0d 0a20 2020 2020 2020 2020 2020  ne,..           
-00017c20: 2073 6572 6965 733d 7365 7269 6573 2c0d   series=series,.
-00017c30: 0a20 2020 2020 2020 2020 2020 2076 6c69  .            vli
-00017c40: 6e65 3d76 6c69 6e65 2c0d 0a20 2020 2020  ne=vline,..     
-00017c50: 2020 2020 2020 2073 7461 7274 5f64 6174         start_dat
-00017c60: 653d 7374 6172 745f 6461 7465 2c0d 0a20  e=start_date,.. 
-00017c70: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-00017c80: 2020 6861 6e64 6c65 732c 206c 6162 656c    handles, label
-00017c90: 7320 3d20 6178 2e67 6574 5f6c 6567 656e  s = ax.get_legen
-00017ca0: 645f 6861 6e64 6c65 735f 6c61 6265 6c73  d_handles_labels
-00017cb0: 2829 0d0a 2020 2020 2020 2020 6966 2073  ()..        if s
-00017cc0: 656c 662e 616e 6f6d 616c 795f 6465 7465  elf.anomaly_dete
-00017cd0: 6374 6f72 3a0d 0a20 2020 2020 2020 2020  ctor:..         
-00017ce0: 2020 2069 6620 7365 6c66 2e61 6e6f 6d61     if self.anoma
-00017cf0: 6c79 5f64 6574 6563 746f 722e 6f75 7470  ly_detector.outp
-00017d00: 7574 203d 3d20 2275 6e69 7661 7269 6174  ut == "univariat
-00017d10: 6522 3a0d 0a20 2020 2020 2020 2020 2020  e":..           
-00017d20: 2020 2020 2069 5f61 6e6f 6d20 3d20 7365       i_anom = se
-00017d30: 6c66 2e61 6e6f 6d61 6c79 5f64 6574 6563  lf.anomaly_detec
-00017d40: 746f 722e 616e 6f6d 616c 6965 732e 696e  tor.anomalies.in
-00017d50: 6465 785b 0d0a 2020 2020 2020 2020 2020  dex[..          
-00017d60: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00017d70: 6e6f 6d61 6c79 5f64 6574 6563 746f 722e  nomaly_detector.
-00017d80: 616e 6f6d 616c 6965 732e 696c 6f63 5b3a  anomalies.iloc[:
-00017d90: 2c20 305d 203d 3d20 2d31 0d0a 2020 2020  , 0] == -1..    
-00017da0: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
-00017db0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00017dc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017dd0: 2020 7365 7269 6573 5f61 6e6f 6d20 3d20    series_anom = 
-00017de0: 7365 6c66 2e61 6e6f 6d61 6c79 5f64 6574  self.anomaly_det
-00017df0: 6563 746f 722e 616e 6f6d 616c 6965 735b  ector.anomalies[
-00017e00: 7365 7269 6573 5d0d 0a20 2020 2020 2020  series]..       
-00017e10: 2020 2020 2020 2020 2069 5f61 6e6f 6d20           i_anom 
-00017e20: 3d20 7365 7269 6573 5f61 6e6f 6d5b 7365  = series_anom[se
-00017e30: 7269 6573 5f61 6e6f 6d20 3d3d 202d 315d  ries_anom == -1]
-00017e40: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
-00017e50: 2020 2020 6966 2073 7461 7274 5f64 6174      if start_dat
-00017e60: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-00017e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e80: 695f 616e 6f6d 203d 2069 5f61 6e6f 6d5b  i_anom = i_anom[
-00017e90: 695f 616e 6f6d 203e 3d20 7374 6172 745f  i_anom >= start_
-00017ea0: 6461 7465 5d0d 0a20 2020 2020 2020 2020  date]..         
-00017eb0: 2020 2069 6620 6163 7475 616c 735f 666c     if actuals_fl
-00017ec0: 6167 3a0d 0a20 2020 2020 2020 2020 2020  ag:..           
-00017ed0: 2020 2020 2069 5f61 6e6f 6d20 3d20 695f       i_anom = i_
-00017ee0: 616e 6f6d 5b69 5f61 6e6f 6d20 3e3d 2061  anom[i_anom >= a
-00017ef0: 6374 7561 6c73 2e69 6e64 6578 5b30 5d5d  ctuals.index[0]]
-00017f00: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00017f10: 206c 656e 2869 5f61 6e6f 6d29 203e 2030   len(i_anom) > 0
-00017f20: 2061 6e64 2028 0d0a 2020 2020 2020 2020   and (..        
-00017f30: 2020 2020 2020 2020 6e6f 7420 6163 7475          not actu
-00017f40: 616c 735f 666c 6167 206f 7220 6c65 6e28  als_flag or len(
-00017f50: 695f 616e 6f6d 2920 3c20 6c65 6e28 6163  i_anom) < len(ac
-00017f60: 7475 616c 7329 202a 2030 2e35 0d0a 2020  tuals) * 0.5..  
-00017f70: 2020 2020 2020 2020 2020 293a 0d0a 2020            ):..  
-00017f80: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-00017f90: 6174 3120 3d20 6178 2e73 6361 7474 6572  at1 = ax.scatter
-00017fa0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
-00017fb0: 2020 2020 2020 2069 5f61 6e6f 6d2e 746f         i_anom.to
-00017fc0: 6c69 7374 2829 2c0d 0a20 2020 2020 2020  list(),..       
-00017fd0: 2020 2020 2020 2020 2020 2020 2061 6374               act
-00017fe0: 7561 6c73 5f75 7365 642e 7265 696e 6465  uals_used.reinde
-00017ff0: 7828 695f 616e 6f6d 295b 7365 7269 6573  x(i_anom)[series
-00018000: 5d2c 0d0a 2020 2020 2020 2020 2020 2020  ],..            
-00018010: 2020 2020 2020 2020 633d 616e 6f6d 616c          c=anomal
-00018020: 795f 636f 6c6f 722c 0d0a 2020 2020 2020  y_color,..      
-00018030: 2020 2020 2020 2020 2020 2020 2020 733d                s=
-00018040: 706f 696e 745f 7369 7a65 2c0d 0a20 2020  point_size,..   
-00018050: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00018060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018070: 6861 6e64 6c65 7320 2b3d 205b 7363 6174  handles += [scat
-00018080: 315d 0d0a 2020 2020 2020 2020 2020 2020  1]..            
-00018090: 2020 2020 6c61 6265 6c73 202b 3d20 5b22      labels += ["
-000180a0: 616e 6f6d 616c 6965 7322 5d0d 0a20 2020  anomalies"]..   
-000180b0: 2020 2020 2069 6620 7365 6c66 2e68 6f6c       if self.hol
-000180c0: 6964 6179 5f64 6574 6563 746f 723a 0d0a  iday_detector:..
-000180d0: 2020 2020 2020 2020 2020 2020 695f 616e              i_an
-000180e0: 6f6d 203d 2073 656c 662e 686f 6c69 6461  om = self.holida
-000180f0: 795f 6465 7465 6374 6f72 2e64 6174 6573  y_detector.dates
-00018100: 5f74 6f5f 686f 6c69 6461 7973 280d 0a20  _to_holidays(.. 
-00018110: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00018120: 656c 662e 6466 2e69 6e64 6578 2c20 7374  elf.df.index, st
-00018130: 796c 653d 2273 6572 6965 735f 666c 6167  yle="series_flag
-00018140: 220d 0a20 2020 2020 2020 2020 2020 2029  "..            )
-00018150: 5b73 6572 6965 735d 0d0a 2020 2020 2020  [series]..      
-00018160: 2020 2020 2020 695f 616e 6f6d 203d 2069        i_anom = i
-00018170: 5f61 6e6f 6d2e 696e 6465 785b 695f 616e  _anom.index[i_an
-00018180: 6f6d 203d 3d20 315d 0d0a 2020 2020 2020  om == 1]..      
-00018190: 2020 2020 2020 6966 2061 6374 7561 6c73        if actuals
-000181a0: 5f66 6c61 673a 0d0a 2020 2020 2020 2020  _flag:..        
-000181b0: 2020 2020 2020 2020 695f 616e 6f6d 203d          i_anom =
-000181c0: 2069 5f61 6e6f 6d5b 695f 616e 6f6d 203e   i_anom[i_anom >
-000181d0: 3d20 6163 7475 616c 732e 696e 6465 785b  = actuals.index[
-000181e0: 305d 5d0d 0a20 2020 2020 2020 2020 2020  0]]..           
-000181f0: 2069 6620 6c65 6e28 695f 616e 6f6d 2920   if len(i_anom) 
-00018200: 3e20 3020 616e 6420 280d 0a20 2020 2020  > 0 and (..     
-00018210: 2020 2020 2020 2020 2020 206e 6f74 2061             not a
-00018220: 6374 7561 6c73 5f66 6c61 6720 6f72 206c  ctuals_flag or l
-00018230: 656e 2869 5f61 6e6f 6d29 203c 206c 656e  en(i_anom) < len
-00018240: 2861 6374 7561 6c73 2920 2a20 302e 350d  (actuals) * 0.5.
-00018250: 0a20 2020 2020 2020 2020 2020 2029 3a0d  .            ):.
-00018260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018270: 2073 6361 7432 203d 2061 782e 7363 6174   scat2 = ax.scat
-00018280: 7465 7228 0d0a 2020 2020 2020 2020 2020  ter(..          
-00018290: 2020 2020 2020 2020 2020 695f 616e 6f6d            i_anom
-000182a0: 2e74 6f6c 6973 7428 292c 0d0a 2020 2020  .tolist(),..    
-000182b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182c0: 6163 7475 616c 735f 7573 6564 2e72 6569  actuals_used.rei
-000182d0: 6e64 6578 2869 5f61 6e6f 6d29 5b73 6572  ndex(i_anom)[ser
-000182e0: 6965 735d 2c0d 0a20 2020 2020 2020 2020  ies],..         
-000182f0: 2020 2020 2020 2020 2020 2063 3d68 6f6c             c=hol
-00018300: 6964 6179 5f63 6f6c 6f72 2c0d 0a20 2020  iday_color,..   
-00018310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018320: 2073 3d70 6f69 6e74 5f73 697a 652c 0d0a   s=point_size,..
-00018330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018340: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00018350: 2020 2068 616e 646c 6573 202b 3d20 5b73     handles += [s
-00018360: 6361 7432 5d0d 0a20 2020 2020 2020 2020  cat2]..         
-00018370: 2020 2020 2020 206c 6162 656c 7320 2b3d         labels +=
-00018380: 205b 2264 6574 6563 7465 6420 686f 6c69   ["detected holi
-00018390: 6461 7973 225d 0d0a 2020 2020 2020 2020  days"]..        
-000183a0: 6966 2073 656c 662e 7472 656e 645f 616e  if self.trend_an
-000183b0: 6f6d 616c 795f 6465 7465 6374 6f72 2069  omaly_detector i
-000183c0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-000183d0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000183e0: 2e74 7265 6e64 5f61 6e6f 6d61 6c79 5f64  .trend_anomaly_d
-000183f0: 6574 6563 746f 722e 6f75 7470 7574 203d  etector.output =
-00018400: 3d20 2275 6e69 7661 7269 6174 6522 3a0d  = "univariate":.
-00018410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018420: 2069 5f61 6e6f 6d20 3d20 7365 6c66 2e74   i_anom = self.t
-00018430: 7265 6e64 5f61 6e6f 6d61 6c79 5f64 6574  rend_anomaly_det
-00018440: 6563 746f 722e 616e 6f6d 616c 6965 732e  ector.anomalies.
-00018450: 696e 6465 785b 0d0a 2020 2020 2020 2020  index[..        
-00018460: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018470: 2e61 6e6f 6d61 6c79 5f64 6574 6563 746f  .anomaly_detecto
-00018480: 722e 616e 6f6d 616c 6965 732e 696c 6f63  r.anomalies.iloc
-00018490: 5b3a 2c20 305d 203d 3d20 2d31 0d0a 2020  [:, 0] == -1..  
-000184a0: 2020 2020 2020 2020 2020 2020 2020 5d0d                ].
-000184b0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000184c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000184d0: 2020 2020 7365 7269 6573 5f61 6e6f 6d20      series_anom 
-000184e0: 3d20 7365 6c66 2e74 7265 6e64 5f61 6e6f  = self.trend_ano
-000184f0: 6d61 6c79 5f64 6574 6563 746f 722e 616e  maly_detector.an
-00018500: 6f6d 616c 6965 735b 7365 7269 6573 5d0d  omalies[series].
-00018510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018520: 2069 5f61 6e6f 6d20 3d20 7365 7269 6573   i_anom = series
-00018530: 5f61 6e6f 6d5b 7365 7269 6573 5f61 6e6f  _anom[series_ano
-00018540: 6d20 3d3d 202d 315d 2e69 6e64 6578 0d0a  m == -1].index..
-00018550: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00018560: 7461 7274 5f64 6174 6520 6973 206e 6f74  tart_date is not
-00018570: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00018580: 2020 2020 2020 2020 695f 616e 6f6d 203d          i_anom =
-00018590: 2069 5f61 6e6f 6d5b 695f 616e 6f6d 203e   i_anom[i_anom >
-000185a0: 3d20 7374 6172 745f 6461 7465 5d0d 0a20  = start_date].. 
-000185b0: 2020 2020 2020 2020 2020 2069 6620 6163             if ac
-000185c0: 7475 616c 735f 666c 6167 3a0d 0a20 2020  tuals_flag:..   
-000185d0: 2020 2020 2020 2020 2020 2020 2069 5f61               i_a
-000185e0: 6e6f 6d20 3d20 695f 616e 6f6d 5b69 5f61  nom = i_anom[i_a
-000185f0: 6e6f 6d20 3e3d 2061 6374 7561 6c73 2e69  nom >= actuals.i
-00018600: 6e64 6578 5b30 5d5d 0d0a 2020 2020 2020  ndex[0]]..      
-00018610: 2020 2020 2020 6966 206c 656e 2869 5f61        if len(i_a
-00018620: 6e6f 6d29 203e 2030 2061 6e64 2028 0d0a  nom) > 0 and (..
-00018630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018640: 6e6f 7420 6163 7475 616c 735f 666c 6167  not actuals_flag
-00018650: 206f 7220 6c65 6e28 695f 616e 6f6d 2920   or len(i_anom) 
-00018660: 3c20 6c65 6e28 6163 7475 616c 7329 202a  < len(actuals) *
-00018670: 2030 2e35 0d0a 2020 2020 2020 2020 2020   0.5..          
-00018680: 2020 293a 0d0a 2020 2020 2020 2020 2020    ):..          
-00018690: 2020 2020 2020 7363 6174 3320 3d20 6178        scat3 = ax
-000186a0: 2e73 6361 7474 6572 280d 0a20 2020 2020  .scatter(..     
-000186b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000186c0: 5f61 6e6f 6d2e 746f 6c69 7374 2829 2c0d  _anom.tolist(),.
-000186d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000186e0: 2020 2020 2061 6374 7561 6c73 5f75 7365       actuals_use
-000186f0: 642e 7265 696e 6465 7828 695f 616e 6f6d  d.reindex(i_anom
-00018700: 295b 7365 7269 6573 5d2c 0d0a 2020 2020  )[series],..    
-00018710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018720: 633d 7472 656e 645f 616e 6f6d 616c 795f  c=trend_anomaly_
-00018730: 636f 6c6f 722c 0d0a 2020 2020 2020 2020  color,..        
-00018740: 2020 2020 2020 2020 2020 2020 733d 706f              s=po
-00018750: 696e 745f 7369 7a65 2c0d 0a20 2020 2020  int_size,..     
-00018760: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-00018770: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00018780: 6e64 6c65 7320 2b3d 205b 7363 6174 335d  ndles += [scat3]
-00018790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000187a0: 2020 6c61 6265 6c73 202b 3d20 5b22 7472    labels += ["tr
-000187b0: 656e 6420 616e 6f6d 616c 6965 7322 5d0d  end anomalies"].
-000187c0: 0a20 2020 2020 2020 2061 782e 6c65 6765  .        ax.lege
-000187d0: 6e64 2868 616e 646c 6573 2c20 6c61 6265  nd(handles, labe
-000187e0: 6c73 290d 0a20 2020 2020 2020 2072 6574  ls)..        ret
-000187f0: 7572 6e20 6178 0d0a 0d0a 2020 2020 6465  urn ax....    de
-00018800: 6620 706c 6f74 5f74 6869 6e67 7328 293a  f plot_things():
-00018810: 2020 2320 706c 6163 6568 6f6c 6465 7220    # placeholder 
-00018820: 666f 7220 6c61 7465 7220 706c 6f74 7469  for later plotti
-00018830: 6e67 2066 756e 6374 696f 6e73 0d0a 2020  ng functions..  
-00018840: 2020 2020 2020 2320 706c 6f74 2063 6f6d        # plot com
-00018850: 706f 6e65 6e74 730d 0a20 2020 2020 2020  ponents..       
-00018860: 2023 2070 6c6f 7420 7472 616e 7366 6f72   # plot transfor
-00018870: 6d65 6420 6466 2069 6620 7072 6570 726f  med df if prepro
-00018880: 6365 7373 206f 7220 616e 6f6d 616c 7920  cess or anomaly 
-00018890: 7265 6d6f 7661 6c0d 0a20 2020 2020 2020  removal..       
-000188a0: 2023 2070 6c6f 7420 7061 7374 2069 6d70   # plot past imp
-000188b0: 6163 7473 0d0a 2020 2020 2020 2020 2320  acts..        # 
-000188c0: 706c 6f74 2025 2063 6f6e 7472 6962 7574  plot % contribut
-000188d0: 696f 6e20 6f66 2063 6f6d 706f 6e65 6e74  ion of component
-000188e0: 730d 0a20 2020 2020 2020 2023 2070 6c6f  s..        # plo
-000188f0: 7420 6576 616c 2028 7368 6f77 2061 6374  t eval (show act
-00018900: 7561 6c73 2c20 616c 6f6e 6773 6964 6520  uals, alongside 
-00018910: 6675 6c6c 2061 6e64 2063 6f6d 706f 6e65  full and compone
-00018920: 6e74 7320 746f 2064 6961 676e 6f73 6529  nts to diagnose)
-00018930: 0d0a 2020 2020 2020 2020 2320 706c 6f74  ..        # plot
-00018940: 2072 6573 6964 7561 6c20 6469 7374 7269   residual distri
-00018950: 6275 7469 6f6e 2f50 4143 460d 0a20 2020  bution/PACF..   
-00018960: 2020 2020 2023 2070 6c6f 7420 696e 666c       # plot infl
-00018970: 6563 7469 6f6e 2070 6f69 6e74 7320 2866  ection points (f
-00018980: 696c 7465 7269 6e67 206f 7220 736d 6f6f  iltering or smoo
-00018990: 7468 696e 6720 6669 7273 7429 0d0a 2020  thing first)..  
-000189a0: 2020 2020 2020 2320 706c 6f74 2068 6967        # plot hig
-000189b0: 6865 7374 2065 7272 6f72 2073 6572 6965  hest error serie
-000189c0: 732c 2070 6c6f 7420 6869 6768 6573 742f  s, plot highest/
-000189d0: 6c6f 7765 7374 2067 726f 7774 680d 0a20  lowest growth.. 
-000189e0: 2020 2020 2020 2023 2074 7265 6e64 3a20         # trend: 
-000189f0: 6f6e 6520 636f 6c6f 7220 666f 7220 6772  one color for gr
-00018a00: 6f77 7468 2c20 616e 6f74 6865 7220 666f  owth, another fo
-00018a10: 7220 6465 636c 696e 6520 2864 6172 6b65  r decline (darke
-00018a20: 7220 6173 2061 6363 656c 6572 6174 696e  r as acceleratin
-00018a30: 672c 206c 6967 6865 7220 6173 2073 6c6f  g, ligher as slo
-00018a40: 7769 6e67 290d 0a20 2020 2020 2020 2072  wing)..        r
-00018a50: 6574 7572 6e20 4e6f 7449 6d70 6c65 6d65  eturn NotImpleme
-00018a60: 6e74 6564 0d0a 0d0a 0d0a 6465 6620 636c  nted......def cl
-00018a70: 6561 6e5f 7265 6772 6573 736f 7228 696e  ean_regressor(in
-00018a80: 5f64 2c20 7072 6566 6978 3d22 7265 6772  _d, prefix="regr
-00018a90: 5f22 293a 0d0a 2020 2020 6966 206e 6f74  _"):..    if not
-00018aa0: 2069 7369 6e73 7461 6e63 6528 696e 5f64   isinstance(in_d
-00018ab0: 2c20 7064 2e44 6174 6146 7261 6d65 293a  , pd.DataFrame):
-00018ac0: 0d0a 2020 2020 2020 2020 6466 203d 2070  ..        df = p
-00018ad0: 642e 4461 7461 4672 616d 6528 696e 5f64  d.DataFrame(in_d
-00018ae0: 290d 0a20 2020 2065 6c73 653a 0d0a 2020  )..    else:..  
-00018af0: 2020 2020 2020 6466 203d 2069 6e5f 642e        df = in_d.
-00018b00: 636f 7079 2829 0d0a 2020 2020 6466 2e63  copy()..    df.c
-00018b10: 6f6c 756d 6e73 203d 205b 7072 6566 6978  olumns = [prefix
-00018b20: 202b 2063 6f6c 2066 6f72 2063 6f6c 2069   + col for col i
-00018b30: 6e20 6466 2e63 6f6c 756d 6e73 5d0d 0a20  n df.columns].. 
-00018b40: 2020 2072 6574 7572 6e20 6466 0d0a 0d0a     return df....
-00018b50: 0d0a 6465 6620 6372 6561 7465 5f74 2864  ..def create_t(d
-00018b60: 7329 3a0d 0a20 2020 2072 6574 7572 6e20  s):..    return 
-00018b70: 2864 7320 2d20 6473 2e6d 696e 2829 2920  (ds - ds.min()) 
-00018b80: 2f20 2864 732e 6d61 7828 2920 2d20 6473  / (ds.max() - ds
-00018b90: 2e6d 696e 2829 290d 0a0d 0a0d 0a23 2323  .min())......###
-00018ba0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018bb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00018bc0: 2323 0d0a 2320 4a55 5354 204c 4541 5354  ##..# JUST LEAST
-00018bd0: 2053 5155 4152 4553 2055 4e49 5641 5249   SQUARES UNIVARI
-00018be0: 4154 450d 0a23 2068 7474 7073 3a2f 2f73  ATE..# https://s
-00018bf0: 7461 636b 6f76 6572 666c 6f77 2e63 6f6d  tackoverflow.com
-00018c00: 2f71 7565 7374 696f 6e73 2f31 3736 3739  /questions/17679
-00018c10: 3134 302f 6d75 6c74 6970 6c65 2d6c 696e  140/multiple-lin
-00018c20: 6561 722d 7265 6772 6573 7369 6f6e 2d77  ear-regression-w
-00018c30: 6974 682d 7079 7468 6f6e 0d0a 0d0a 0d0a  ith-python......
-00018c40: 6465 6620 6c73 7473 715f 736f 6c76 6528  def lstsq_solve(
-00018c50: 582c 2079 2c20 6c61 6d62 3d31 2c20 6964  X, y, lamb=1, id
-00018c60: 656e 7469 7479 5f6d 6174 7269 783d 4e6f  entity_matrix=No
-00018c70: 6e65 293a 0d0a 2020 2020 6966 2069 6465  ne):..    if ide
-00018c80: 6e74 6974 795f 6d61 7472 6978 2069 7320  ntity_matrix is 
-00018c90: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2069  None:..        i
-00018ca0: 6465 6e74 6974 795f 6d61 7472 6978 203d  dentity_matrix =
-00018cb0: 206e 702e 7a65 726f 7328 2858 2e73 6861   np.zeros((X.sha
-00018cc0: 7065 5b31 5d2c 2058 2e73 6861 7065 5b31  pe[1], X.shape[1
-00018cd0: 5d29 290d 0a20 2020 2020 2020 206e 702e  ]))..        np.
-00018ce0: 6669 6c6c 5f64 6961 676f 6e61 6c28 6964  fill_diagonal(id
-00018cf0: 656e 7469 7479 5f6d 6174 7269 782c 2031  entity_matrix, 1
-00018d00: 290d 0a20 2020 2020 2020 2069 6465 6e74  )..        ident
-00018d10: 6974 795f 6d61 7472 6978 5b30 2c20 305d  ity_matrix[0, 0]
-00018d20: 203d 2030 0d0a 2020 2020 5874 585f 6c61   = 0..    XtX_la
-00018d30: 6d62 203d 2058 2e54 2e64 6f74 2858 2920  mb = X.T.dot(X) 
-00018d40: 2b20 6c61 6d62 202a 2069 6465 6e74 6974  + lamb * identit
-00018d50: 795f 6d61 7472 6978 0d0a 2020 2020 5874  y_matrix..    Xt
-00018d60: 5920 3d20 582e 542e 646f 7428 7929 0d0a  Y = X.T.dot(y)..
-00018d70: 2020 2020 7265 7475 726e 206e 702e 6c69      return np.li
-00018d80: 6e61 6c67 2e73 6f6c 7665 2858 7458 5f6c  nalg.solve(XtX_l
-00018d90: 616d 622c 2058 7459 290d 0a0d 0a0d 0a64  amb, XtY)......d
-00018da0: 6566 2063 6f73 745f 6675 6e63 7469 6f6e  ef cost_function
-00018db0: 5f6c 3128 7061 7261 6d73 2c20 582c 2079  _l1(params, X, y
-00018dc0: 293a 0d0a 2020 2020 7265 7475 726e 206e  ):..    return n
-00018dd0: 702e 7375 6d28 6e70 2e61 6273 2879 202d  p.sum(np.abs(y -
-00018de0: 206e 702e 646f 7428 582c 2070 6172 616d   np.dot(X, param
-00018df0: 732e 7265 7368 6170 6528 582e 7368 6170  s.reshape(X.shap
-00018e00: 655b 315d 2c20 792e 7368 6170 655b 315d  e[1], y.shape[1]
-00018e10: 2929 2929 0d0a 0d0a 0d0a 6465 6620 636f  ))))......def co
-00018e20: 7374 5f66 756e 6374 696f 6e5f 6c31 5f70  st_function_l1_p
-00018e30: 6f73 6974 6976 6528 7061 7261 6d73 2c20  ositive(params, 
-00018e40: 582c 2079 293a 0d0a 2020 2020 7265 7475  X, y):..    retu
-00018e50: 726e 206e 702e 7375 6d28 0d0a 2020 2020  rn np.sum(..    
-00018e60: 2020 2020 6e70 2e61 6273 280d 0a20 2020      np.abs(..   
-00018e70: 2020 2020 2020 2020 2079 0d0a 2020 2020           y..    
-00018e80: 2020 2020 2020 2020 2d20 6e70 2e64 6f74          - np.dot
-00018e90: 2858 2c20 6e70 2e77 6865 7265 2870 6172  (X, np.where(par
-00018ea0: 616d 7320 3c20 302c 2030 2c20 7061 7261  ams < 0, 0, para
-00018eb0: 6d73 292e 7265 7368 6170 6528 582e 7368  ms).reshape(X.sh
-00018ec0: 6170 655b 315d 2c20 792e 7368 6170 655b  ape[1], y.shape[
-00018ed0: 315d 2929 0d0a 2020 2020 2020 2020 290d  1]))..        ).
-00018ee0: 0a20 2020 2029 0d0a 0d0a 0d0a 2320 6163  .    )......# ac
-00018ef0: 7475 616c 6c79 2074 6869 7320 6973 206d  tually this is m
-00018f00: 6f72 6520 6c69 6b65 204d 4144 450d 0a64  ore like MADE..d
-00018f10: 6566 2063 6f73 745f 6675 6e63 7469 6f6e  ef cost_function
-00018f20: 5f64 7761 6528 7061 7261 6d73 2c20 582c  _dwae(params, X,
-00018f30: 2079 293a 0d0a 2020 2020 4120 3d20 790d   y):..    A = y.
-00018f40: 0a20 2020 2046 203d 206e 702e 646f 7428  .    F = np.dot(
-00018f50: 582c 2070 6172 616d 732e 7265 7368 6170  X, params.reshap
-00018f60: 6528 582e 7368 6170 655b 315d 2c20 792e  e(X.shape[1], y.
-00018f70: 7368 6170 655b 315d 2929 0d0a 2020 2020  shape[1]))..    
-00018f80: 6c61 7374 5f6f 665f 6172 7261 7920 3d20  last_of_array = 
-00018f90: 795b 5b30 5d20 2b20 6c69 7374 2872 616e  y[[0] + list(ran
-00018fa0: 6765 286c 656e 2879 2920 2d20 3129 295d  ge(len(y) - 1))]
-00018fb0: 0d0a 2020 2020 7265 7475 726e 206e 702e  ..    return np.
-00018fc0: 7375 6d28 0d0a 2020 2020 2020 2020 6e70  sum(..        np
-00018fd0: 2e6e 616e 6d65 616e 280d 0a20 2020 2020  .nanmean(..     
-00018fe0: 2020 2020 2020 206e 702e 7768 6572 6528         np.where(
-00018ff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019000: 2020 6e70 2e73 6967 6e28 4620 2d20 6c61    np.sign(F - la
-00019010: 7374 5f6f 665f 6172 7261 7929 203d 3d20  st_of_array) == 
-00019020: 6e70 2e73 6967 6e28 4120 2d20 6c61 7374  np.sign(A - last
-00019030: 5f6f 665f 6172 7261 7929 2c0d 0a20 2020  _of_array),..   
-00019040: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-00019050: 6162 7328 4120 2d20 4629 2c0d 0a20 2020  abs(A - F),..   
-00019060: 2020 2020 2020 2020 2020 2020 2028 6e70               (np
-00019070: 2e61 6273 2841 202d 2046 2920 2b20 3129  .abs(A - F) + 1)
-00019080: 202a 2a20 322c 0d0a 2020 2020 2020 2020   ** 2,..        
-00019090: 2020 2020 292c 0d0a 2020 2020 2020 2020      ),..        
-000190a0: 2020 2020 6178 6973 3d30 2c0d 0a20 2020      axis=0,..   
-000190b0: 2020 2020 2029 0d0a 2020 2020 290d 0a0d       )..    )...
-000190c0: 0a0d 0a64 6566 2063 6f73 745f 6675 6e63  ...def cost_func
-000190d0: 7469 6f6e 5f71 7561 6e74 696c 6528 7061  tion_quantile(pa
-000190e0: 7261 6d73 2c20 582c 2079 2c20 713d 302e  rams, X, y, q=0.
-000190f0: 3929 3a0d 0a20 2020 2063 7574 203d 2069  9):..    cut = i
-00019100: 6e74 2879 2e73 6861 7065 5b30 5d20 2a20  nt(y.shape[0] * 
-00019110: 7129 0d0a 2020 2020 7265 7475 726e 206e  q)..    return n
-00019120: 702e 7375 6d28 0d0a 2020 2020 2020 2020  p.sum(..        
-00019130: 6e70 2e70 6172 7469 7469 6f6e 280d 0a20  np.partition(.. 
-00019140: 2020 2020 2020 2020 2020 206e 702e 6162             np.ab
-00019150: 7328 7920 2d20 6e70 2e64 6f74 2858 2c20  s(y - np.dot(X, 
-00019160: 7061 7261 6d73 2e72 6573 6861 7065 2858  params.reshape(X
-00019170: 2e73 6861 7065 5b31 5d2c 2079 2e73 6861  .shape[1], y.sha
-00019180: 7065 5b31 5d29 2929 2c20 6375 742c 2061  pe[1]))), cut, a
-00019190: 7869 733d 300d 0a20 2020 2020 2020 2029  xis=0..        )
-000191a0: 5b30 3a63 7574 5d0d 0a20 2020 2029 0d0a  [0:cut]..    )..
-000191b0: 0d0a 0d0a 6465 6620 636f 7374 5f66 756e  ....def cost_fun
-000191c0: 6374 696f 6e5f 6c32 2870 6172 616d 732c  ction_l2(params,
-000191d0: 2058 2c20 7929 3a0d 0a20 2020 2072 6574   X, y):..    ret
-000191e0: 7572 6e20 6e70 2e6c 696e 616c 672e 6e6f  urn np.linalg.no
-000191f0: 726d 2879 202d 206e 702e 646f 7428 582c  rm(y - np.dot(X,
-00019200: 2070 6172 616d 732e 7265 7368 6170 6528   params.reshape(
-00019210: 582e 7368 6170 655b 315d 2c20 792e 7368  X.shape[1], y.sh
-00019220: 6170 655b 315d 2929 290d 0a0d 0a0d 0a23  ape[1])))......#
-00019230: 2063 6f75 6c64 2064 6f20 7061 7274 6961   could do partia
-00019240: 6c20 706f 6f6c 696e 6720 6279 206d 696e  l pooling by min
-00019250: 696d 697a 696e 6720 6120 6675 6e63 7469  imizing a functi
-00019260: 6f6e 2074 6861 7420 6d69 7865 7320 7368  on that mixes sh
-00019270: 6172 6564 2061 6e64 2075 6e73 6861 7265  ared and unshare
-00019280: 6420 636f 6566 6669 6369 656e 7473 2028  d coefficients (
-00019290: 6d75 6c74 6970 6c69 6361 7469 7665 290d  multiplicative).
-000192a0: 0a64 6566 206c 7374 7371 5f6d 696e 696d  .def lstsq_minim
-000192b0: 697a 6528 582c 2079 2c20 6d61 7869 7465  ize(X, y, maxite
-000192c0: 723d 3135 3030 302c 2063 6f73 745f 6675  r=15000, cost_fu
-000192d0: 6e63 7469 6f6e 3d22 6c31 2229 3a0d 0a20  nction="l1"):.. 
-000192e0: 2020 2022 2222 416e 7920 636f 7374 2066     """Any cost f
-000192f0: 756e 6374 696f 6e20 7665 7273 696f 6e20  unction version 
-00019300: 6f66 206c 696e 2072 6567 2e22 2222 0d0a  of lin reg."""..
-00019310: 2020 2020 2320 7374 6172 7420 7769 7468      # start with
-00019320: 206c 7374 7371 2066 6974 2061 7320 6573   lstsq fit as es
-00019330: 7469 6d61 7465 6420 706f 696e 740d 0a20  timated point.. 
-00019340: 2020 2078 3020 3d20 6c73 7473 715f 736f     x0 = lstsq_so
-00019350: 6c76 6528 582c 2079 292e 666c 6174 7465  lve(X, y).flatte
-00019360: 6e28 290d 0a20 2020 2023 2061 7373 756d  n()..    # assum
-00019370: 696e 6720 7363 616c 6564 2c20 7468 6573  ing scaled, thes
-00019380: 6520 7368 6f75 6c64 2062 6520 7265 6173  e should be reas
-00019390: 6f6e 6162 6c65 2062 6f75 6e64 730d 0a20  onable bounds.. 
-000193a0: 2020 2062 6f75 6e64 7320 3d20 5b28 2d31     bounds = [(-1
-000193b0: 302c 2031 3029 2066 6f72 2078 2069 6e20  0, 10) for x in 
-000193c0: 7830 5d0d 0a20 2020 2069 6620 636f 7374  x0]..    if cost
-000193d0: 5f66 756e 6374 696f 6e20 3d3d 2022 6477  _function == "dw
-000193e0: 6165 223a 0d0a 2020 2020 2020 2020 626f  ae":..        bo
-000193f0: 756e 6473 203d 205b 282d 302e 352c 2031  unds = [(-0.5, 1
-00019400: 3029 2066 6f72 2078 2069 6e20 7830 5d0d  0) for x in x0].
-00019410: 0a20 2020 2020 2020 2063 6f73 745f 6675  .        cost_fu
-00019420: 6e63 203d 2063 6f73 745f 6675 6e63 7469  nc = cost_functi
-00019430: 6f6e 5f64 7761 650d 0a20 2020 2065 6c69  on_dwae..    eli
-00019440: 6620 636f 7374 5f66 756e 6374 696f 6e20  f cost_function 
-00019450: 3d3d 2022 7175 616e 7469 6c65 223a 0d0a  == "quantile":..
-00019460: 2020 2020 2020 2020 636f 7374 5f66 756e          cost_fun
-00019470: 6320 3d20 636f 7374 5f66 756e 6374 696f  c = cost_functio
-00019480: 6e5f 7175 616e 7469 6c65 0d0a 2020 2020  n_quantile..    
-00019490: 656c 6966 2063 6f73 745f 6675 6e63 7469  elif cost_functi
-000194a0: 6f6e 203d 3d20 226c 315f 706f 7369 7469  on == "l1_positi
-000194b0: 7665 223a 0d0a 2020 2020 2020 2020 626f  ve":..        bo
-000194c0: 756e 6473 203d 205b 2830 2c20 3130 2920  unds = [(0, 10) 
-000194d0: 666f 7220 7820 696e 2078 305d 0d0a 2020  for x in x0]..  
-000194e0: 2020 2020 2020 636f 7374 5f66 756e 6320        cost_func 
-000194f0: 3d20 636f 7374 5f66 756e 6374 696f 6e5f  = cost_function_
-00019500: 6c31 0d0a 2020 2020 656c 7365 3a0d 0a20  l1..    else:.. 
-00019510: 2020 2020 2020 2063 6f73 745f 6675 6e63         cost_func
-00019520: 203d 2063 6f73 745f 6675 6e63 7469 6f6e   = cost_function
-00019530: 5f6c 310d 0a20 2020 2072 6574 7572 6e20  _l1..    return 
-00019540: 6d69 6e69 6d69 7a65 280d 0a20 2020 2020  minimize(..     
-00019550: 2020 2063 6f73 745f 6675 6e63 2c20 7830     cost_func, x0
-00019560: 2c20 6172 6773 3d28 582c 2079 292c 2062  , args=(X, y), b
-00019570: 6f75 6e64 733d 626f 756e 6473 2c20 6f70  ounds=bounds, op
-00019580: 7469 6f6e 733d 7b27 6d61 7869 7465 7227  tions={'maxiter'
-00019590: 3a20 6d61 7869 7465 727d 0d0a 2020 2020  : maxiter}..    
-000195a0: 292e 782e 7265 7368 6170 6528 582e 7368  ).x.reshape(X.sh
-000195b0: 6170 655b 315d 2c20 792e 7368 6170 655b  ape[1], y.shape[
-000195c0: 315d 290d 0a0d 0a0d 0a64 6566 206c 696e  1])......def lin
-000195d0: 6561 725f 6d6f 6465 6c28 782c 2079 2c20  ear_model(x, y, 
-000195e0: 7061 7261 6d73 293a 0d0a 2020 2020 6d6f  params):..    mo
-000195f0: 6465 6c5f 7479 7065 203d 2070 6172 616d  del_type = param
-00019600: 732e 6765 7428 226d 6f64 656c 222c 2022  s.get("model", "
-00019610: 6c73 7473 7122 290d 0a20 2020 206c 616d  lstsq")..    lam
-00019620: 6264 203d 2070 6172 616d 732e 6765 7428  bd = params.get(
-00019630: 226c 616d 6264 6122 2c20 4e6f 6e65 290d  "lambda", None).
-00019640: 0a20 2020 2072 6563 203d 2070 6172 616d  .    rec = param
-00019650: 732e 6765 7428 2272 6563 656e 6379 5f77  s.get("recency_w
-00019660: 6569 6768 7469 6e67 222c 204e 6f6e 6529  eighting", None)
-00019670: 0d0a 2020 2020 6966 206c 616d 6264 2069  ..    if lambd i
-00019680: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00019690: 2020 2020 2069 645f 6d61 7420 3d20 6e70       id_mat = np
-000196a0: 2e7a 6572 6f73 2828 782e 7368 6170 655b  .zeros((x.shape[
-000196b0: 315d 2c20 782e 7368 6170 655b 315d 2929  1], x.shape[1]))
-000196c0: 0d0a 2020 2020 2020 2020 6e70 2e66 696c  ..        np.fil
-000196d0: 6c5f 6469 6167 6f6e 616c 2869 645f 6d61  l_diagonal(id_ma
-000196e0: 742c 2031 290d 0a20 2020 2020 2020 2069  t, 1)..        i
-000196f0: 645f 6d61 745b 302c 2030 5d20 3d20 300d  d_mat[0, 0] = 0.
-00019700: 0a20 2020 2069 6620 7265 6320 6973 206e  .    if rec is n
-00019710: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00019720: 2020 7765 6967 6874 7320 3d20 286e 702e    weights = (np.
-00019730: 6172 616e 6765 286c 656e 2878 2929 202b  arange(len(x)) +
-00019740: 2031 2920 2a2a 2072 6563 2020 2320 302e   1) ** rec  # 0.
-00019750: 3035 202d 2030 2e32 350d 0a20 2020 2020  05 - 0.25..     
-00019760: 2020 2078 203d 2078 202a 2077 6569 6768     x = x * weigh
-00019770: 7473 5b2e 2e2e 2c20 4e6f 6e65 5d0d 0a20  ts[..., None].. 
-00019780: 2020 2020 2020 2079 203d 206e 702e 6173         y = np.as
-00019790: 6172 7261 7928 7929 202a 2077 6569 6768  array(y) * weigh
-000197a0: 7473 5b2e 2e2e 2c20 4e6f 6e65 5d0d 0a20  ts[..., None].. 
-000197b0: 2020 2069 6620 6d6f 6465 6c5f 7479 7065     if model_type
-000197c0: 203d 3d20 226c 7374 7371 223a 0d0a 2020   == "lstsq":..  
-000197d0: 2020 2020 2020 6966 206c 616d 6264 2069        if lambd i
-000197e0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-000197f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00019800: 6e70 2e6c 696e 616c 672e 6c73 7473 7128  np.linalg.lstsq(
-00019810: 782e 542e 646f 7428 7829 202b 206c 616d  x.T.dot(x) + lam
-00019820: 6264 202a 2069 645f 6d61 742c 2078 2e54  bd * id_mat, x.T
-00019830: 2e64 6f74 2879 292c 2072 636f 6e64 3d4e  .dot(y), rcond=N
-00019840: 6f6e 6529 5b0d 0a20 2020 2020 2020 2020  one)[..         
-00019850: 2020 2020 2020 2030 0d0a 2020 2020 2020         0..      
-00019860: 2020 2020 2020 5d0d 0a20 2020 2020 2020        ]..       
-00019870: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00019880: 2020 2020 7265 7475 726e 206e 702e 6c69      return np.li
-00019890: 6e61 6c67 2e6c 7374 7371 2878 2c20 792c  nalg.lstsq(x, y,
-000198a0: 2072 636f 6e64 3d4e 6f6e 6529 5b30 5d0d   rcond=None)[0].
-000198b0: 0a20 2020 2065 6c69 6620 6d6f 6465 6c5f  .    elif model_
-000198c0: 7479 7065 203d 3d20 226c 696e 616c 675f  type == "linalg_
-000198d0: 736f 6c76 6522 3a0d 0a20 2020 2020 2020  solve":..       
-000198e0: 2072 6574 7572 6e20 6c73 7473 715f 736f   return lstsq_so
-000198f0: 6c76 6528 782c 2079 2c20 6c61 6d62 3d6c  lve(x, y, lamb=l
-00019900: 616d 6264 2c20 6964 656e 7469 7479 5f6d  ambd, identity_m
-00019910: 6174 7269 783d 6964 5f6d 6174 290d 0a20  atrix=id_mat).. 
-00019920: 2020 2065 6c69 6620 6d6f 6465 6c5f 7479     elif model_ty
-00019930: 7065 203d 3d20 226c 315f 6e6f 726d 223a  pe == "l1_norm":
-00019940: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00019950: 206c 7374 7371 5f6d 696e 696d 697a 6528   lstsq_minimize(
-00019960: 0d0a 2020 2020 2020 2020 2020 2020 6e70  ..            np
-00019970: 2e61 7361 7272 6179 2878 292c 0d0a 2020  .asarray(x),..  
-00019980: 2020 2020 2020 2020 2020 6e70 2e61 7361            np.asa
-00019990: 7272 6179 2879 292c 0d0a 2020 2020 2020  rray(y),..      
-000199a0: 2020 2020 2020 6d61 7869 7465 723d 7061        maxiter=pa
-000199b0: 7261 6d73 2e67 6574 2822 6d61 7869 7465  rams.get("maxite
-000199c0: 7222 2c20 3135 3030 3029 2c0d 0a20 2020  r", 15000),..   
-000199d0: 2020 2020 2020 2020 2063 6f73 745f 6675           cost_fu
-000199e0: 6e63 7469 6f6e 3d22 6c31 222c 0d0a 2020  nction="l1",..  
-000199f0: 2020 2020 2020 290d 0a20 2020 2065 6c69        )..    eli
-00019a00: 6620 6d6f 6465 6c5f 7479 7065 203d 3d20  f model_type == 
-00019a10: 2271 7561 6e74 696c 655f 6e6f 726d 223a  "quantile_norm":
-00019a20: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00019a30: 206c 7374 7371 5f6d 696e 696d 697a 6528   lstsq_minimize(
-00019a40: 0d0a 2020 2020 2020 2020 2020 2020 6e70  ..            np
-00019a50: 2e61 7361 7272 6179 2878 292c 0d0a 2020  .asarray(x),..  
-00019a60: 2020 2020 2020 2020 2020 6e70 2e61 7361            np.asa
-00019a70: 7272 6179 2879 292c 0d0a 2020 2020 2020  rray(y),..      
-00019a80: 2020 2020 2020 6d61 7869 7465 723d 7061        maxiter=pa
-00019a90: 7261 6d73 2e67 6574 2822 6d61 7869 7465  rams.get("maxite
-00019aa0: 7222 2c20 3135 3030 3029 2c0d 0a20 2020  r", 15000),..   
-00019ab0: 2020 2020 2020 2020 2063 6f73 745f 6675           cost_fu
-00019ac0: 6e63 7469 6f6e 3d22 7175 616e 7469 6c65  nction="quantile
-00019ad0: 222c 0d0a 2020 2020 2020 2020 290d 0a20  ",..        ).. 
-00019ae0: 2020 2065 6c69 6620 6d6f 6465 6c5f 7479     elif model_ty
-00019af0: 7065 203d 3d20 2264 7761 655f 6e6f 726d  pe == "dwae_norm
-00019b00: 223a 0d0a 2020 2020 2020 2020 7265 7475  ":..        retu
-00019b10: 726e 206c 7374 7371 5f6d 696e 696d 697a  rn lstsq_minimiz
-00019b20: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-00019b30: 6e70 2e61 7361 7272 6179 2878 292c 0d0a  np.asarray(x),..
-00019b40: 2020 2020 2020 2020 2020 2020 6e70 2e61              np.a
-00019b50: 7361 7272 6179 2879 292c 0d0a 2020 2020  sarray(y),..    
-00019b60: 2020 2020 2020 2020 6d61 7869 7465 723d          maxiter=
-00019b70: 7061 7261 6d73 2e67 6574 2822 6d61 7869  params.get("maxi
-00019b80: 7465 7222 2c20 3135 3030 3029 2c0d 0a20  ter", 15000),.. 
-00019b90: 2020 2020 2020 2020 2020 2063 6f73 745f             cost_
-00019ba0: 6675 6e63 7469 6f6e 3d22 6477 6165 222c  function="dwae",
-00019bb0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
-00019bc0: 2065 6c69 6620 6d6f 6465 6c5f 7479 7065   elif model_type
-00019bd0: 203d 3d20 226c 315f 706f 7369 7469 7665   == "l1_positive
-00019be0: 223a 0d0a 2020 2020 2020 2020 7265 7475  ":..        retu
-00019bf0: 726e 206c 7374 7371 5f6d 696e 696d 697a  rn lstsq_minimiz
-00019c00: 6528 0d0a 2020 2020 2020 2020 2020 2020  e(..            
-00019c10: 6e70 2e61 7361 7272 6179 2878 292c 0d0a  np.asarray(x),..
-00019c20: 2020 2020 2020 2020 2020 2020 6e70 2e61              np.a
-00019c30: 7361 7272 6179 2879 292c 0d0a 2020 2020  sarray(y),..    
-00019c40: 2020 2020 2020 2020 6d61 7869 7465 723d          maxiter=
-00019c50: 7061 7261 6d73 2e67 6574 2822 6d61 7869  params.get("maxi
-00019c60: 7465 7222 2c20 3135 3030 3029 2c0d 0a20  ter", 15000),.. 
-00019c70: 2020 2020 2020 2020 2020 2063 6f73 745f             cost_
-00019c80: 6675 6e63 7469 6f6e 3d22 6c31 5f70 6f73  function="l1_pos
-00019c90: 6974 6976 6522 2c0d 0a20 2020 2020 2020  itive",..       
-00019ca0: 2029 0d0a 2020 2020 656c 7365 3a0d 0a20   )..    else:.. 
-00019cb0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00019cc0: 7565 4572 726f 7228 226c 696e 6561 7220  ueError("linear 
-00019cd0: 6d6f 6465 6c20 6e6f 7420 7265 636f 676e  model not recogn
-00019ce0: 697a 6564 2229 0d0a 0d0a 0d0a 2320 5365  ized")......# Se
-00019cf0: 6173 6f6e 616c 6974 6965 730d 0a23 2069  asonalities..# i
-00019d00: 6e74 6572 6163 7469 6f6e 2065 6666 6563  nteraction effec
-00019d10: 7420 6f6e 6c79 206f 6e20 6669 7273 7420  t only on first 
-00019d20: 7477 6f20 7365 6173 6f6e 616c 6974 6965  two seasonalitie
-00019d30: 7320 6966 206f 7264 6572 206d 6174 6368  s if order match
-00019d40: 6573 0d0a 0d0a 2320 4361 7465 676f 7269  es....# Categori
-00019d50: 6361 6c20 4665 6174 7572 6573 0d0a 2320  cal Features..# 
-00019d60: 286d 756c 7469 7661 7269 6174 6520 7375  (multivariate su
-00019d70: 6d6d 6172 6965 7320 6279 2067 726f 7570  mmaries by group
-00019d80: 290d 0a0d 0a23 2070 6173 7420 696d 7061  )....# past impa
-00019d90: 6374 7320 286f 7074 696f 6e20 746f 206e  cts (option to n
-00019da0: 6f74 2065 6e66 6f72 6365 2c20 6f6e 6c79  ot enforce, only
-00019db0: 2073 686f 7729 0d0a 0d0a 2320 7768 6174   show)....# what
-00019dc0: 2069 7320 7374 696c 6c20 6e65 6564 6564   is still needed
-00019dd0: 3a0d 0a23 2062 6179 6573 6961 6e20 6c69  :..# bayesian li
-00019de0: 6e65 6172 206d 6f64 656c 206f 7074 696f  near model optio
-00019df0: 6e73 0d0a 2320 6d6f 7265 206d 756c 7469  ns..# more multi
-00019e00: 7661 7269 6174 6520 7375 6d6d 6172 6965  variate summarie
-00019e10: 730d 0a23 2061 6464 2061 6e6f 6d61 6c79  s..# add anomaly
-00019e20: 2063 6c61 7373 6966 6965 7220 746f 2066   classifier to f
-00019e30: 6f72 6563 6173 740d 0a23 2072 6566 696e  orecast..# refin
-00019e40: 6520 7472 616e 7366 6f72 6d61 7469 6f6e  e transformation
-00019e50: 7320 616e 6420 6d6f 6465 6c73 2067 656e  s and models gen
-00019e60: 6572 6174 6564 2062 7920 6765 745f 6e65  erated by get_ne
-00019e70: 775f 7061 7261 6d73 0d0a 2320 7265 7765  w_params..# rewe
-00019e80: 6967 6874 2073 6f20 6c6f 6f70 2069 7320  ight so loop is 
-00019e90: 6e6f 7420 7265 7175 6972 6564 2073 6f20  not required so 
-00019ea0: 6f66 7465 6e0d 0a23 2074 6573 7420 616e  often..# test an
-00019eb0: 6420 6275 6720 6669 7820 6576 6572 7974  d bug fix everyt
-00019ec0: 6869 6e67 0d0a 2320 6c31 5f6e 6f72 6d20  hing..# l1_norm 
-00019ed0: 6973 6e27 7420 776f 726b 696e 670d 0a23  isn't working..#
-00019ee0: 2075 6e69 7474 6573 7473 0d0a 0d0a 2320   unittests....# 
-00019ef0: 5445 5354 0d0a 2320 6e65 775f 6466 0d0a  TEST..# new_df..
-00019f00: 0d0a 2320 636f 756c 6420 646f 2070 6172  ..# could do par
-00019f10: 7469 616c 2070 6f6f 6c69 6e67 2062 7920  tial pooling by 
-00019f20: 6d69 6e69 6d69 7a69 6e67 2061 2066 756e  minimizing a fun
-00019f30: 6374 696f 6e20 7468 6174 206d 6978 6573  ction that mixes
-00019f40: 2073 6861 7265 6420 616e 6420 756e 7368   shared and unsh
-00019f50: 6172 6564 2063 6f65 6666 6963 6965 6e74  ared coefficient
-00019f60: 7320 286d 756c 7469 706c 6963 6174 6976  s (multiplicativ
-00019f70: 6529 0d0a 0d0a 2320 7365 6172 6368 2073  e)....# search s
-00019f80: 7061 6365 3a0d 0a23 2066 6173 7420 6f6e  pace:..# fast on
-00019f90: 206c 7374 7371 7320 6d6f 6465 6c0d 0a23   lstsqs model..#
-00019fa0: 2066 756c 6c20 7365 6172 6368 206f 6620   full search of 
-00019fb0: 7072 6564 6566 696e 6564 206f 7074 696f  predefined optio
-00019fc0: 6e73 0d0a 2320 7363 6970 7920 6d69 6e69  ns..# scipy mini
-00019fd0: 6d69 7a65 2066 6f72 2063 6f6e 7469 6e75  mize for continu
-00019fe0: 6f75 7320 7061 7261 6d73 2c20 6f72 206d  ous params, or m
-00019ff0: 6179 6265 2069 6e74 2870 6172 616d 2920  aybe int(param) 
-0001a000: 666f 7220 6469 7363 7265 7465 2074 6f6f  for discrete too
-0001a010: 0d0a 2320 6d69 6e69 6d69 7a65 2077 6f72  ..# minimize wor
-0001a020: 6b69 6e67 2066 6f72 2072 6f6c 6c69 6e67  king for rolling
-0001a030: 2077 696e 646f 7720 7369 7a65 2062 7574   window size but
-0001a040: 206e 6f74 2066 6f72 2073 6561 736f 6e61   not for seasona
-0001a050: 6c69 7479 2028 6163 7475 616c 6c79 2070  lity (actually p
-0001a060: 726f 6261 626c 7920 7769 6e64 6f77 2069  robably window i
-0001a070: 7320 6f76 6572 6669 7429 0d0a 2320 646f  s overfit)..# do
-0001a080: 2069 7420 7374 6570 7769 7365 3a0d 0a23   it stepwise:..#
-0001a090: 2066 6972 7374 2066 6974 2073 6561 736f   first fit seaso
-0001a0a0: 6e61 6c69 7479 2028 7769 7468 2066 6c61  nality (with fla
-0001a0b0: 6720 7265 6772 6573 736f 7273 2062 7574  g regressors but
-0001a0c0: 206e 6f74 206f 7468 6572 7329 0d0a 2320   not others)..# 
-0001a0d0: 7365 636f 6e64 6c79 2073 6361 6c65 7273  secondly scalers
-0001a0e0: 2061 6e64 2070 7265 7072 6f63 6573 7369   and preprocessi
-0001a0f0: 6e67 2041 4e44 2061 6e6f 6d61 6c79 2064  ng AND anomaly d
-0001a100: 6574 6563 7469 6f6e 2041 4e44 2068 6f6c  etection AND hol
-0001a110: 6964 6179 2064 6574 6563 7469 6f6e 0d0a  iday detection..
-0001a120: 2320 706f 7373 6962 6c79 2061 6464 2033  # possibly add 3
-0001a130: 7264 2073 6561 736f 6e61 6c69 7479 2061  rd seasonality a
-0001a140: 6674 6572 2070 7265 7072 6f63 6573 7369  fter preprocessi
-0001a150: 6e67 0d0a 2320 7468 6972 646c 7920 726f  ng..# thirdly ro
-0001a160: 6c6c 696e 6720 7769 6e64 6f77 2073 697a  lling window siz
-0001a170: 6520 2869 6e63 6c75 6465 2072 6f6c 6c69  e (include rolli
-0001a180: 6e67 2077 696e 646f 7720 696e 2069 6e69  ng window in ini
-0001a190: 7469 616c 2058 2061 6674 6572 2074 6869  tial X after thi
-0001a1a0: 7329 0d0a 2320 7468 656e 2074 6573 7420  s)..# then test 
-0001a1b0: 7573 6572 2072 6567 7265 7373 6f72 2061  user regressor a
-0001a1c0: 6e64 2070 7265 7072 6f63 6573 7369 6e67  nd preprocessing
-0001a1d0: 0d0a 2320 7468 656e 2074 6573 7420 4152  ..# then test AR
-0001a1e0: 206c 6167 7320 2864 6f6e 2774 2075 7365   lags (don't use
-0001a1f0: 2069 6620 2520 6761 696e 2069 7320 3c20   if % gain is < 
-0001a200: 7820 2529 0d0a 2320 6f72 206d 6179 6265  x %)..# or maybe
-0001a210: 2075 7365 2061 2072 756e 7469 6d65 2077   use a runtime w
-0001a220: 6569 6768 7469 6e67 0d0a 2320 7468 656e  eighting..# then
-0001a230: 206d 756c 7469 7661 7269 6174 6520 7375   multivariate su
-0001a240: 6d6d 6172 6965 730d 0a23 2046 494e 414c  mmaries..# FINAL
-0001a250: 4c59 2063 6f76 6172 6961 7465 206c 6167  LY covariate lag
-0001a260: 7320 2866 6561 7475 7265 2073 656c 6563  s (feature selec
-0001a270: 7469 6f6e 2064 6566 696e 6974 656c 7920  tion definitely 
-0001a280: 6e65 6564 6564 290d 0a0d 0a0d 0a69 6620  needed)......if 
-0001a290: 4661 6c73 653a 0d0a 2020 2020 2320 7465  False:..    # te
-0001a2a0: 7374 2068 6f6c 6964 6179 2063 6f75 6e74  st holiday count
-0001a2b0: 7269 6573 2c20 7265 6772 6573 736f 7273  ries, regressors
-0001a2c0: 2c20 696d 7061 6374 730d 0a20 2020 2066  , impacts..    f
-0001a2d0: 726f 6d20 6175 746f 7473 2069 6d70 6f72  rom autots impor
-0001a2e0: 7420 6c6f 6164 5f64 6169 6c79 0d0a 2020  t load_daily..  
-0001a2f0: 2020 696d 706f 7274 206d 6174 706c 6f74    import matplot
-0001a300: 6c69 622e 7079 706c 6f74 2061 7320 706c  lib.pyplot as pl
-0001a310: 740d 0a0d 0a20 2020 2063 6174 6567 6f72  t....    categor
-0001a320: 6963 616c 5f67 726f 7570 7320 3d20 7b0d  ical_groups = {.
-0001a330: 0a20 2020 2020 2020 2022 7769 6b69 5f55  .        "wiki_U
-0001a340: 6e69 7465 645f 5374 6174 6573 223a 2027  nited_States": '
-0001a350: 636f 756e 7472 7927 2c0d 0a20 2020 2020  country',..     
-0001a360: 2020 2022 7769 6b69 5f47 6572 6d61 6e79     "wiki_Germany
-0001a370: 223a 2027 636f 756e 7472 7927 2c0d 0a20  ": 'country',.. 
-0001a380: 2020 2020 2020 2022 7769 6b69 5f4a 6573         "wiki_Jes
-0001a390: 7573 223a 2027 686f 6c69 6461 7927 2c0d  us": 'holiday',.
-0001a3a0: 0a20 2020 2020 2020 2022 7769 6b69 5f4d  .        "wiki_M
-0001a3b0: 6963 6861 656c 5f4a 6163 6b73 6f6e 223a  ichael_Jackson":
-0001a3c0: 2027 7065 7273 6f6e 272c 0d0a 2020 2020   'person',..    
-0001a3d0: 2020 2020 2277 696b 695f 4561 7374 6572      "wiki_Easter
-0001a3e0: 223a 2027 686f 6c69 6461 7927 2c0d 0a20  ": 'holiday',.. 
-0001a3f0: 2020 2020 2020 2022 7769 6b69 5f43 6872         "wiki_Chr
-0001a400: 6973 746d 6173 223a 2027 686f 6c69 6461  istmas": 'holida
-0001a410: 7927 2c0d 0a20 2020 2020 2020 2022 7769  y',..        "wi
-0001a420: 6b69 5f43 6869 6e65 7365 5f4e 6577 5f59  ki_Chinese_New_Y
-0001a430: 6561 7222 3a20 2768 6f6c 6964 6179 272c  ear": 'holiday',
-0001a440: 0d0a 2020 2020 2020 2020 2277 696b 695f  ..        "wiki_
-0001a450: 5468 616e 6b73 6769 7669 6e67 223a 2027  Thanksgiving": '
-0001a460: 686f 6c69 6461 7927 2c0d 0a20 2020 2020  holiday',..     
-0001a470: 2020 2022 7769 6b69 5f45 6c69 7a61 6265     "wiki_Elizabe
-0001a480: 7468 5f49 4922 3a20 2770 6572 736f 6e27  th_II": 'person'
-0001a490: 2c0d 0a20 2020 2020 2020 2022 7769 6b69  ,..        "wiki
-0001a4a0: 5f57 696c 6c69 616d 5f53 6861 6b65 7370  _William_Shakesp
-0001a4b0: 6561 7265 223a 2027 7065 7273 6f6e 272c  eare": 'person',
-0001a4c0: 0d0a 2020 2020 2020 2020 2277 696b 695f  ..        "wiki_
-0001a4d0: 4765 6f72 6765 5f57 6173 6869 6e67 746f  George_Washingto
-0001a4e0: 6e22 3a20 2770 6572 736f 6e27 2c0d 0a20  n": 'person',.. 
-0001a4f0: 2020 2020 2020 2022 7769 6b69 5f43 6c65         "wiki_Cle
-0001a500: 6f70 6174 7261 223a 2027 7065 7273 6f6e  opatra": 'person
-0001a510: 272c 0d0a 2020 2020 7d0d 0a20 2020 2068  ',..    }..    h
-0001a520: 6f6c 6964 6179 5f63 6f75 6e74 7269 6573  oliday_countries
-0001a530: 203d 207b 0d0a 2020 2020 2020 2020 2777   = {..        'w
-0001a540: 696b 695f 456c 697a 6162 6574 685f 4949  iki_Elizabeth_II
-0001a550: 273a 2027 756b 272c 0d0a 2020 2020 2020  ': 'uk',..      
-0001a560: 2020 2777 696b 695f 556e 6974 6564 5f53    'wiki_United_S
-0001a570: 7461 7465 7327 3a20 2775 7327 2c0d 0a20  tates': 'us',.. 
-0001a580: 2020 2020 2020 2027 7769 6b69 5f47 6572         'wiki_Ger
-0001a590: 6d61 6e79 273a 2027 6465 272c 0d0a 2020  many': 'de',..  
-0001a5a0: 2020 7d0d 0a20 2020 2064 665f 6461 696c    }..    df_dail
-0001a5b0: 7920 3d20 6c6f 6164 5f64 6169 6c79 286c  y = load_daily(l
-0001a5c0: 6f6e 673d 4661 6c73 6529 0d0a 2020 2020  ong=False)..    
-0001a5d0: 2320 6164 6420 6e61 6e0d 0a20 2020 2064  # add nan..    d
-0001a5e0: 665f 6461 696c 792e 696c 6f63 5b31 3030  f_daily.iloc[100
-0001a5f0: 2c20 3a5d 203d 206e 702e 6e61 6e0d 0a20  , :] = np.nan.. 
-0001a600: 2020 2066 6f72 6563 6173 745f 6c65 6e67     forecast_leng
-0001a610: 7468 203d 2031 3830 0d0a 2020 2020 696e  th = 180..    in
-0001a620: 636c 7564 655f 6869 7374 6f72 7920 3d20  clude_history = 
-0001a630: 5472 7565 0d0a 2020 2020 6466 5f74 7261  True..    df_tra
-0001a640: 696e 203d 2064 665f 6461 696c 795b 3a2d  in = df_daily[:-
-0001a650: 666f 7265 6361 7374 5f6c 656e 6774 685d  forecast_length]
-0001a660: 2e69 6c6f 635b 3a2c 2031 3a5d 0d0a 2020  .iloc[:, 1:]..  
-0001a670: 2020 6466 5f74 6573 7420 3d20 6466 5f64    df_test = df_d
-0001a680: 6169 6c79 5b2d 666f 7265 6361 7374 5f6c  aily[-forecast_l
-0001a690: 656e 6774 683a 5d2e 696c 6f63 5b3a 2c20  ength:].iloc[:, 
-0001a6a0: 313a 5d0d 0a20 2020 2066 616b 655f 7265  1:]..    fake_re
-0001a6b0: 6772 203d 2064 665f 6461 696c 795b 3a2d  gr = df_daily[:-
-0001a6c0: 666f 7265 6361 7374 5f6c 656e 6774 685d  forecast_length]
-0001a6d0: 2e69 6c6f 635b 3a2c 2030 3a31 5d0d 0a20  .iloc[:, 0:1].. 
-0001a6e0: 2020 2066 616b 655f 7265 6772 5f66 6373     fake_regr_fcs
-0001a6f0: 7420 3d20 280d 0a20 2020 2020 2020 2064  t = (..        d
-0001a700: 665f 6461 696c 792e 696c 6f63 5b3a 2c20  f_daily.iloc[:, 
-0001a710: 303a 315d 0d0a 2020 2020 2020 2020 6966  0:1]..        if
-0001a720: 2069 6e63 6c75 6465 5f68 6973 746f 7279   include_history
-0001a730: 0d0a 2020 2020 2020 2020 656c 7365 2064  ..        else d
-0001a740: 665f 6461 696c 795b 2d66 6f72 6563 6173  f_daily[-forecas
-0001a750: 745f 6c65 6e67 7468 3a5d 2e69 6c6f 635b  t_length:].iloc[
-0001a760: 3a2c 2030 3a31 5d0d 0a20 2020 2029 0d0a  :, 0:1]..    )..
-0001a770: 2020 2020 666c 6167 5f72 6567 7265 7373      flag_regress
-0001a780: 6f72 203d 2070 642e 4461 7461 4672 616d  or = pd.DataFram
-0001a790: 6528 312c 2069 6e64 6578 3d66 616b 655f  e(1, index=fake_
-0001a7a0: 7265 6772 2e69 6e64 6578 2c20 636f 6c75  regr.index, colu
-0001a7b0: 6d6e 733d 5b22 666c 6167 5f74 6573 7422  mns=["flag_test"
-0001a7c0: 5d29 0d0a 2020 2020 666c 6167 5f72 6567  ])..    flag_reg
-0001a7d0: 7265 7373 6f72 5f66 6373 7420 3d20 7064  ressor_fcst = pd
-0001a7e0: 2e44 6174 6146 7261 6d65 280d 0a20 2020  .DataFrame(..   
-0001a7f0: 2020 2020 2031 2c20 696e 6465 783d 6661       1, index=fa
-0001a800: 6b65 5f72 6567 725f 6663 7374 2e69 6e64  ke_regr_fcst.ind
-0001a810: 6578 2c20 636f 6c75 6d6e 733d 5b22 666c  ex, columns=["fl
-0001a820: 6167 5f74 6573 7422 5d0d 0a20 2020 2029  ag_test"]..    )
-0001a830: 0d0a 2020 2020 7265 6772 5f70 6572 5f73  ..    regr_per_s
-0001a840: 6572 6965 7320 3d20 7b0d 0a20 2020 2020  eries = {..     
-0001a850: 2020 2073 7472 2864 665f 7472 6169 6e2e     str(df_train.
-0001a860: 636f 6c75 6d6e 735b 305d 293a 2070 642e  columns[0]): pd.
-0001a870: 4461 7461 4672 616d 6528 0d0a 2020 2020  DataFrame(..    
-0001a880: 2020 2020 2020 2020 6e70 2e72 616e 646f          np.rando
-0001a890: 6d2e 6e6f 726d 616c 2873 697a 653d 286c  m.normal(size=(l
-0001a8a0: 656e 2864 665f 7472 6169 6e29 2c20 3129  en(df_train), 1)
-0001a8b0: 292c 2069 6e64 6578 3d64 665f 7472 6169  ), index=df_trai
-0001a8c0: 6e2e 696e 6465 780d 0a20 2020 2020 2020  n.index..       
-0001a8d0: 2029 0d0a 2020 2020 7d0d 0a20 2020 2072   )..    }..    r
-0001a8e0: 6567 725f 7065 725f 7365 7269 6573 5f66  egr_per_series_f
-0001a8f0: 6373 7420 3d20 7b0d 0a20 2020 2020 2020  cst = {..       
-0001a900: 2073 7472 2864 665f 7472 6169 6e2e 636f   str(df_train.co
-0001a910: 6c75 6d6e 735b 305d 293a 2070 642e 4461  lumns[0]): pd.Da
-0001a920: 7461 4672 616d 6528 0d0a 2020 2020 2020  taFrame(..      
-0001a930: 2020 2020 2020 6e70 2e72 616e 646f 6d2e        np.random.
-0001a940: 6e6f 726d 616c 2873 697a 653d 2866 6f72  normal(size=(for
-0001a950: 6563 6173 745f 6c65 6e67 7468 2c20 3129  ecast_length, 1)
-0001a960: 292c 2069 6e64 6578 3d64 665f 7465 7374  ), index=df_test
-0001a970: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
-0001a980: 290d 0a20 2020 207d 0d0a 2020 2020 636f  )..    }..    co
-0001a990: 6e73 7472 6169 6e74 203d 207b 0d0a 2020  nstraint = {..  
-0001a9a0: 2020 2020 2020 2763 6f6e 7374 7261 696e        'constrain
-0001a9b0: 745f 6d65 7468 6f64 273a 2027 7175 616e  t_method': 'quan
-0001a9c0: 7469 6c65 272c 0d0a 2020 2020 2020 2020  tile',..        
-0001a9d0: 276c 6f77 6572 5f63 6f6e 7374 7261 696e  'lower_constrain
-0001a9e0: 7427 3a20 302c 0d0a 2020 2020 2020 2020  t': 0,..        
-0001a9f0: 2775 7070 6572 5f63 6f6e 7374 7261 696e  'upper_constrain
-0001aa00: 7427 3a20 4e6f 6e65 2c0d 0a20 2020 2020  t': None,..     
-0001aa10: 2020 2022 626f 756e 6473 223a 2054 7275     "bounds": Tru
-0001aa20: 652c 0d0a 2020 2020 7d0d 0a20 2020 2070  e,..    }..    p
-0001aa30: 6173 745f 696d 7061 6374 7320 3d20 7064  ast_impacts = pd
-0001aa40: 2e44 6174 6146 7261 6d65 2830 2c20 696e  .DataFrame(0, in
-0001aa50: 6465 783d 6466 5f74 7261 696e 2e69 6e64  dex=df_train.ind
-0001aa60: 6578 2c20 636f 6c75 6d6e 733d 6466 5f74  ex, columns=df_t
-0001aa70: 7261 696e 2e63 6f6c 756d 6e73 290d 0a20  rain.columns).. 
-0001aa80: 2020 2070 6173 745f 696d 7061 6374 732e     past_impacts.
-0001aa90: 696c 6f63 5b2d 3130 3a2c 2030 5d20 3d20  iloc[-10:, 0] = 
-0001aaa0: 6e70 2e67 656f 6d73 7061 6365 2831 2c20  np.geomspace(1, 
-0001aab0: 3130 295b 303a 3130 5d20 2f20 3130 300d  10)[0:10] / 100.
-0001aac0: 0a20 2020 2070 6173 745f 696d 7061 6374  .    past_impact
-0001aad0: 732e 696c 6f63 5b2d 3330 3a2c 202d 315d  s.iloc[-30:, -1]
-0001aae0: 203d 206e 702e 6c69 6e73 7061 6365 2831   = np.linspace(1
-0001aaf0: 2c20 3130 295b 303a 3330 5d20 2f20 2d31  , 10)[0:30] / -1
-0001ab00: 3030 0d0a 2020 2020 6675 7475 7265 5f69  00..    future_i
-0001ab10: 6d70 6163 7473 203d 2070 642e 4461 7461  mpacts = pd.Data
-0001ab20: 4672 616d 6528 302c 2069 6e64 6578 3d64  Frame(0, index=d
-0001ab30: 665f 7465 7374 2e69 6e64 6578 2c20 636f  f_test.index, co
-0001ab40: 6c75 6d6e 733d 6466 5f74 6573 742e 636f  lumns=df_test.co
-0001ab50: 6c75 6d6e 7329 0d0a 2020 2020 6675 7475  lumns)..    futu
-0001ab60: 7265 5f69 6d70 6163 7473 2e69 6c6f 635b  re_impacts.iloc[
-0001ab70: 303a 3130 2c20 305d 203d 2028 6e70 2e6c  0:10, 0] = (np.l
-0001ab80: 696e 7370 6163 6528 312c 2031 3029 5b30  inspace(1, 10)[0
-0001ab90: 3a31 305d 202b 2031 3029 202f 2031 3030  :10] + 10) / 100
-0001aba0: 0d0a 0d0a 2020 2020 635f 7061 7261 6d73  ....    c_params
-0001abb0: 203d 2043 6173 7361 6e64 7261 2829 2e67   = Cassandra().g
-0001abc0: 6574 5f6e 6577 5f70 6172 616d 7328 290d  et_new_params().
-0001abd0: 0a0d 0a20 2020 206d 6f64 203d 2043 6173  ...    mod = Cas
-0001abe0: 7361 6e64 7261 280d 0a20 2020 2020 2020  sandra(..       
-0001abf0: 206e 5f6a 6f62 733d 312c 0d0a 2020 2020   n_jobs=1,..    
-0001ac00: 2020 2020 2a2a 635f 7061 7261 6d73 2c0d      **c_params,.
-0001ac10: 0a20 2020 2020 2020 2063 6f6e 7374 7261  .        constra
-0001ac20: 696e 743d 636f 6e73 7472 6169 6e74 2c0d  int=constraint,.
-0001ac30: 0a20 2020 2020 2020 2068 6f6c 6964 6179  .        holiday
-0001ac40: 5f63 6f75 6e74 7269 6573 3d68 6f6c 6964  _countries=holid
-0001ac50: 6179 5f63 6f75 6e74 7269 6573 2c0d 0a20  ay_countries,.. 
-0001ac60: 2020 2020 2020 206d 6178 5f6d 756c 7469         max_multi
-0001ac70: 636f 6c69 6e65 6172 6974 793d 302e 3030  colinearity=0.00
-0001ac80: 3031 2c0d 0a20 2020 2029 0d0a 2020 2020  01,..    )..    
-0001ac90: 6d6f 642e 6669 7428 0d0a 2020 2020 2020  mod.fit(..      
-0001aca0: 2020 6466 5f74 7261 696e 2c0d 0a20 2020    df_train,..   
-0001acb0: 2020 2020 2063 6174 6567 6f72 6963 616c       categorical
-0001acc0: 5f67 726f 7570 733d 6361 7465 676f 7269  _groups=categori
-0001acd0: 6361 6c5f 6772 6f75 7073 2c0d 0a20 2020  cal_groups,..   
-0001ace0: 2020 2020 2066 7574 7572 655f 7265 6772       future_regr
-0001acf0: 6573 736f 723d 6661 6b65 5f72 6567 722c  essor=fake_regr,
-0001ad00: 0d0a 2020 2020 2020 2020 7265 6772 6573  ..        regres
-0001ad10: 736f 725f 7065 725f 7365 7269 6573 3d72  sor_per_series=r
-0001ad20: 6567 725f 7065 725f 7365 7269 6573 2c0d  egr_per_series,.
-0001ad30: 0a20 2020 2020 2020 2070 6173 745f 696d  .        past_im
-0001ad40: 7061 6374 733d 7061 7374 5f69 6d70 6163  pacts=past_impac
-0001ad50: 7473 2c0d 0a20 2020 2020 2020 2066 6c61  ts,..        fla
-0001ad60: 675f 7265 6772 6573 736f 7273 3d66 6c61  g_regressors=fla
-0001ad70: 675f 7265 6772 6573 736f 722c 0d0a 2020  g_regressor,..  
-0001ad80: 2020 290d 0a20 2020 2070 7265 6420 3d20    )..    pred = 
-0001ad90: 6d6f 642e 7072 6564 6963 7428 0d0a 2020  mod.predict(..  
-0001ada0: 2020 2020 2020 666f 7265 6361 7374 5f6c        forecast_l
-0001adb0: 656e 6774 683d 666f 7265 6361 7374 5f6c  ength=forecast_l
-0001adc0: 656e 6774 682c 0d0a 2020 2020 2020 2020  ength,..        
-0001add0: 696e 636c 7564 655f 6869 7374 6f72 793d  include_history=
-0001ade0: 696e 636c 7564 655f 6869 7374 6f72 792c  include_history,
-0001adf0: 0d0a 2020 2020 2020 2020 6675 7475 7265  ..        future
-0001ae00: 5f72 6567 7265 7373 6f72 3d66 616b 655f  _regressor=fake_
-0001ae10: 7265 6772 5f66 6373 742c 0d0a 2020 2020  regr_fcst,..    
-0001ae20: 2020 2020 7265 6772 6573 736f 725f 7065      regressor_pe
-0001ae30: 725f 7365 7269 6573 3d72 6567 725f 7065  r_series=regr_pe
-0001ae40: 725f 7365 7269 6573 5f66 6373 742c 0d0a  r_series_fcst,..
-0001ae50: 2020 2020 2020 2020 6675 7475 7265 5f69          future_i
-0001ae60: 6d70 6163 7473 3d66 7574 7572 655f 696d  mpacts=future_im
-0001ae70: 7061 6374 732c 0d0a 2020 2020 2020 2020  pacts,..        
-0001ae80: 666c 6167 5f72 6567 7265 7373 6f72 733d  flag_regressors=
-0001ae90: 666c 6167 5f72 6567 7265 7373 6f72 5f66  flag_regressor_f
-0001aea0: 6373 742c 0d0a 2020 2020 2020 2020 696e  cst,..        in
-0001aeb0: 636c 7564 655f 6f72 6761 6e69 633d 5472  clude_organic=Tr
-0001aec0: 7565 2c0d 0a20 2020 2029 0d0a 2020 2020  ue,..    )..    
-0001aed0: 7265 7375 6c74 203d 2070 7265 642e 666f  result = pred.fo
-0001aee0: 7265 6361 7374 0d0a 2020 2020 7365 7269  recast..    seri
-0001aef0: 6573 203d 2072 616e 646f 6d2e 6368 6f69  es = random.choi
-0001af00: 6365 286d 6f64 2e63 6f6c 756d 6e5f 6e61  ce(mod.column_na
-0001af10: 6d65 7329 0d0a 2020 2020 2320 7365 7269  mes)..    # seri
-0001af20: 6573 203d 2022 7769 6b69 5f50 6572 696f  es = "wiki_Perio
-0001af30: 6469 635f 7461 626c 6522 0d0a 2020 2020  dic_table"..    
-0001af40: 7365 7269 6573 203d 2027 7769 6b69 5f61  series = 'wiki_a
-0001af50: 6c6c 270d 0a20 2020 206d 6f64 2e72 6567  ll'..    mod.reg
-0001af60: 7265 7373 6f72 735f 7573 6564 0d0a 2020  ressors_used..  
-0001af70: 2020 6d6f 642e 686f 6c69 6461 795f 636f    mod.holiday_co
-0001af80: 756e 7472 6965 735f 7573 6564 0d0a 2020  untries_used..  
-0001af90: 2020 7769 7468 2070 6c74 2e73 7479 6c65    with plt.style
-0001afa0: 2e63 6f6e 7465 7874 2822 7365 6162 6f72  .context("seabor
-0001afb0: 6e2d 7768 6974 6522 293a 0d0a 2020 2020  n-white"):..    
-0001afc0: 2020 2020 7374 6172 745f 6461 7465 203d      start_date =
-0001afd0: 2022 3230 3139 2d30 372d 3031 220d 0a20   "2019-07-01".. 
-0001afe0: 2020 2020 2020 206d 6f64 2e70 6c6f 745f         mod.plot_
-0001aff0: 666f 7265 6361 7374 280d 0a20 2020 2020  forecast(..     
-0001b000: 2020 2020 2020 2070 7265 642c 0d0a 2020         pred,..  
-0001b010: 2020 2020 2020 2020 2020 6163 7475 616c            actual
-0001b020: 733d 6466 5f64 6169 6c79 2069 6620 696e  s=df_daily if in
-0001b030: 636c 7564 655f 6869 7374 6f72 7920 656c  clude_history el
-0001b040: 7365 2064 665f 7465 7374 2c0d 0a20 2020  se df_test,..   
-0001b050: 2020 2020 2020 2020 2073 6572 6965 733d           series=
-0001b060: 7365 7269 6573 2c0d 0a20 2020 2020 2020  series,..       
-0001b070: 2020 2020 2073 7461 7274 5f64 6174 653d       start_date=
-0001b080: 7374 6172 745f 6461 7465 2c0d 0a20 2020  start_date,..   
-0001b090: 2020 2020 2029 0d0a 0d0a 2020 2020 2020       )....      
-0001b0a0: 2020 2320 706c 742e 7368 6f77 2829 0d0a    # plt.show()..
-0001b0b0: 2020 2020 2020 2020 2320 706c 742e 7361          # plt.sa
-0001b0c0: 7665 6669 6728 2243 6173 7361 6e64 7261  vefig("Cassandra
-0001b0d0: 5f66 6f72 6563 6173 742e 706e 6722 2c20  _forecast.png", 
-0001b0e0: 6470 693d 3330 3029 0d0a 2020 2020 2020  dpi=300)..      
-0001b0f0: 2020 2320 6d6f 642e 706c 6f74 5f63 6f6d    # mod.plot_com
-0001b100: 706f 6e65 6e74 7328 7072 6564 2c20 7365  ponents(pred, se
-0001b110: 7269 6573 3d73 6572 6965 732c 2074 6f5f  ries=series, to_
-0001b120: 6f72 6967 696e 5f73 7061 6365 3d46 616c  origin_space=Fal
-0001b130: 7365 290d 0a20 2020 2020 2020 2023 2070  se)..        # p
-0001b140: 6c74 2e73 686f 7728 290d 0a20 2020 2020  lt.show()..     
-0001b150: 2020 206d 6f64 2e70 6c6f 745f 636f 6d70     mod.plot_comp
-0001b160: 6f6e 656e 7473 280d 0a20 2020 2020 2020  onents(..       
-0001b170: 2020 2020 2070 7265 642c 2073 6572 6965       pred, serie
-0001b180: 733d 7365 7269 6573 2c20 746f 5f6f 7269  s=series, to_ori
-0001b190: 6769 6e5f 7370 6163 653d 5472 7565 2c20  gin_space=True, 
-0001b1a0: 7374 6172 745f 6461 7465 3d73 7461 7274  start_date=start
-0001b1b0: 5f64 6174 650d 0a20 2020 2020 2020 2029  _date..        )
-0001b1c0: 0d0a 2020 2020 2020 2020 2320 706c 742e  ..        # plt.
-0001b1d0: 7361 7665 6669 6728 2243 6173 7361 6e64  savefig("Cassand
-0001b1e0: 7261 5f63 6f6d 706f 6e65 6e74 7333 2e70  ra_components3.p
-0001b1f0: 6e67 222c 2064 7069 3d33 3030 2c20 6262  ng", dpi=300, bb
-0001b200: 6f78 5f69 6e63 6865 733d 2274 6967 6874  ox_inches="tight
-0001b210: 2229 0d0a 2020 2020 2020 2020 706c 742e  ")..        plt.
-0001b220: 7368 6f77 2829 0d0a 2020 2020 2020 2020  show()..        
-0001b230: 6d6f 642e 706c 6f74 5f74 7265 6e64 280d  mod.plot_trend(.
-0001b240: 0a20 2020 2020 2020 2020 2020 2073 6572  .            ser
-0001b250: 6965 733d 7365 7269 6573 2c20 766c 696e  ies=series, vlin
-0001b260: 653d 7265 7375 6c74 2e69 6e64 6578 5b2d  e=result.index[-
-0001b270: 666f 7265 6361 7374 5f6c 656e 6774 685d  forecast_length]
-0001b280: 2c20 7374 6172 745f 6461 7465 3d73 7461  , start_date=sta
-0001b290: 7274 5f64 6174 650d 0a20 2020 2020 2020  rt_date..       
-0001b2a0: 2029 0d0a 2020 2020 2020 2020 2320 706c   )..        # pl
-0001b2b0: 742e 7361 7665 6669 6728 2243 6173 7361  t.savefig("Cassa
-0001b2c0: 6e64 7261 5f74 7265 6e64 2e70 6e67 222c  ndra_trend.png",
-0001b2d0: 2064 7069 3d33 3030 2c20 6262 6f78 5f69   dpi=300, bbox_i
-0001b2e0: 6e63 6865 733d 2274 6967 6874 2229 0d0a  nches="tight")..
-0001b2f0: 2020 2020 7072 6564 2e65 7661 6c75 6174      pred.evaluat
-0001b300: 6528 0d0a 2020 2020 2020 2020 6466 5f64  e(..        df_d
-0001b310: 6169 6c79 2e72 6569 6e64 6578 2872 6573  aily.reindex(res
-0001b320: 756c 742e 696e 6465 7829 5b64 665f 7472  ult.index)[df_tr
-0001b330: 6169 6e2e 636f 6c75 6d6e 735d 0d0a 2020  ain.columns]..  
-0001b340: 2020 2020 2020 6966 2069 6e63 6c75 6465        if include
-0001b350: 5f68 6973 746f 7279 0d0a 2020 2020 2020  _history..      
-0001b360: 2020 656c 7365 2064 665f 7465 7374 5b64    else df_test[d
-0001b370: 665f 7472 6169 6e2e 636f 6c75 6d6e 735d  f_train.columns]
-0001b380: 0d0a 2020 2020 290d 0a20 2020 2070 7269  ..    )..    pri
-0001b390: 6e74 2870 7265 642e 6176 675f 6d65 7472  nt(pred.avg_metr
-0001b3a0: 6963 732e 726f 756e 6428 3129 290d 0a0d  ics.round(1))...
-0001b3b0: 0a20 2020 2023 2069 6620 6e6f 7420 6d6f  .    # if not mo
-0001b3c0: 642e 7265 6772 6573 736f 7273 5f75 7365  d.regressors_use
-0001b3d0: 643a 0d0a 2020 2020 6461 7465 7320 3d20  d:..    dates = 
-0001b3e0: 6466 5f64 6169 6c79 2e69 6e64 6578 2e75  df_daily.index.u
-0001b3f0: 6e69 6f6e 280d 0a20 2020 2020 2020 206d  nion(..        m
-0001b400: 6f64 2e63 7265 6174 655f 666f 7265 6361  od.create_foreca
-0001b410: 7374 5f69 6e64 6578 2866 6f72 6563 6173  st_index(forecas
-0001b420: 745f 6c65 6e67 7468 2c20 6c61 7374 5f64  t_length, last_d
-0001b430: 6174 653d 6466 5f64 6169 6c79 2e69 6e64  ate=df_daily.ind
-0001b440: 6578 5b2d 315d 290d 0a20 2020 2029 0d0a  ex[-1])..    )..
-0001b450: 2020 2020 7265 6772 5f70 7320 3d20 7b0d      regr_ps = {.
-0001b460: 0a20 2020 2020 2020 2027 7769 6b69 5f47  .        'wiki_G
-0001b470: 6572 6d61 6e79 273a 2072 6567 725f 7065  ermany': regr_pe
-0001b480: 725f 7365 7269 6573 5f66 6373 745b 2777  r_series_fcst['w
-0001b490: 696b 695f 4765 726d 616e 7927 5d2e 7265  iki_Germany'].re
-0001b4a0: 696e 6465 7828 0d0a 2020 2020 2020 2020  index(..        
-0001b4b0: 2020 2020 6461 7465 732c 2066 696c 6c5f      dates, fill_
-0001b4c0: 7661 6c75 653d 300d 0a20 2020 2020 2020  value=0..       
-0001b4d0: 2029 0d0a 2020 2020 7d0d 0a20 2020 2070   )..    }..    p
-0001b4e0: 7265 6432 203d 206d 6f64 2e70 7265 6469  red2 = mod.predi
-0001b4f0: 6374 280d 0a20 2020 2020 2020 2066 6f72  ct(..        for
-0001b500: 6563 6173 745f 6c65 6e67 7468 3d66 6f72  ecast_length=for
-0001b510: 6563 6173 745f 6c65 6e67 7468 2c0d 0a20  ecast_length,.. 
-0001b520: 2020 2020 2020 2069 6e63 6c75 6465 5f68         include_h
-0001b530: 6973 746f 7279 3d54 7275 652c 0d0a 2020  istory=True,..  
-0001b540: 2020 2020 2020 6e65 775f 6466 3d64 665f        new_df=df_
-0001b550: 6461 696c 795b 6466 5f74 7261 696e 2e63  daily[df_train.c
-0001b560: 6f6c 756d 6e73 5d2c 0d0a 2020 2020 2020  olumns],..      
-0001b570: 2020 666c 6167 5f72 6567 7265 7373 6f72    flag_regressor
-0001b580: 733d 666c 6167 5f72 6567 7265 7373 6f72  s=flag_regressor
-0001b590: 5f66 6373 742e 7265 696e 6465 7828 6461  _fcst.reindex(da
-0001b5a0: 7465 732c 2066 696c 6c5f 7661 6c75 653d  tes, fill_value=
-0001b5b0: 3029 2c0d 0a20 2020 2020 2020 2066 7574  0),..        fut
-0001b5c0: 7572 655f 7265 6772 6573 736f 723d 6661  ure_regressor=fa
-0001b5d0: 6b65 5f72 6567 725f 6663 7374 2e72 6569  ke_regr_fcst.rei
-0001b5e0: 6e64 6578 2864 6174 6573 2c20 6669 6c6c  ndex(dates, fill
-0001b5f0: 5f76 616c 7565 3d30 292c 0d0a 2020 2020  _value=0),..    
-0001b600: 2020 2020 7265 6772 6573 736f 725f 7065      regressor_pe
-0001b610: 725f 7365 7269 6573 3d72 6567 725f 7073  r_series=regr_ps
-0001b620: 2c0d 0a20 2020 2029 0d0a 2020 2020 6d6f  ,..    )..    mo
-0001b630: 642e 706c 6f74 5f66 6f72 6563 6173 7428  d.plot_forecast(
-0001b640: 7072 6564 322c 2061 6374 7561 6c73 3d64  pred2, actuals=d
-0001b650: 665f 6461 696c 792c 2073 6572 6965 733d  f_daily, series=
-0001b660: 7365 7269 6573 2c20 7374 6172 745f 6461  series, start_da
-0001b670: 7465 3d73 7461 7274 5f64 6174 6529 0d0a  te=start_date)..
-0001b680: 2020 2020 6d6f 642e 7265 7475 726e 5f63      mod.return_c
-0001b690: 6f6d 706f 6e65 6e74 7328 290d 0a20 2020  omponents()..   
-0001b6a0: 2070 7269 6e74 2863 5f70 6172 616d 735b   print(c_params[
-0001b6b0: 2774 7265 6e64 5f6d 6f64 656c 275d 290d  'trend_model']).
-0001b6c0: 0a0d 0a23 204d 554c 5449 504c 4943 4154  ...# MULTIPLICAT
-0001b6d0: 4956 4520 5345 4153 4f4e 414c 4954 5920  IVE SEASONALITY 
-0001b6e0: 414e 4420 484f 4c49 4441 5953 0d0a 0d0a  AND HOLIDAYS....
-0001b6f0: 2320 6c6f 7720 6d65 6d6f 7279 206f 7074  # low memory opt
-0001b700: 696f 6e20 746f 2064 656c 6574 6520 7374  ion to delete st
-0001b710: 6f72 6564 2064 6673 2061 6e64 2061 7272  ored dfs and arr
-0001b720: 6179 7320 6173 2073 6f6f 6e20 6173 2070  ays as soon as p
-0001b730: 6f73 7369 626c 650d 0a0d 0a23 204d 616b  ossible....# Mak
-0001b740: 6520 7375 7265 2078 2066 6561 7475 7265  e sure x feature
-0001b750: 7320 6172 6520 616c 6c20 7363 616c 6564  s are all scaled
-0001b760: 0d0a 2320 5265 6d6f 7665 2073 6561 736f  ..# Remove seaso
-0001b770: 6e61 6c69 7479 2066 726f 6d20 7265 6772  nality from regr
-0001b780: 6573 736f 7273 0d0a 0d0a 2320 7472 616e  essors....# tran
-0001b790: 7366 6572 206c 6561 726e 696e 670d 0a23  sfer learning..#
-0001b7a0: 2067 7261 7068 6963 7320 2841 4d46 4d20   graphics (AMFM 
-0001b7b0: 7761 7465 726d 6172 6b29 0d0a 2320 636f  watermark)..# co
-0001b7c0: 6d70 6172 6520 6163 726f 7373 2070 6173  mpare across pas
-0001b7d0: 7420 666f 7265 6361 7374 730d 0a23 2073  t forecasts..# s
-0001b7e0: 7461 6269 6c69 7479 0d0a 2320 6d61 6b65  tability..# make
-0001b7f0: 2069 7420 6d6f 7265 206d 6f64 756c 6172   it more modular
-0001b800: 2028 7365 7061 7261 7465 2075 7361 626c   (separate usabl
-0001b810: 6520 6675 6e63 7469 6f6e 7329 0d0a 0d0a  e functions)....
-0001b820: 2320 4175 746f 6d61 7469 6f6e 0d0a 2320  # Automation..# 
-0001b830: 616c 6c6f 7720 736f 6d65 2063 6f6e 6669  allow some confi
-0001b840: 6720 696e 7075 7473 2c20 6f72 2061 7574  g inputs, or aut
-0001b850: 6f6d 6174 6564 2066 6974 0d0a 2320 6f75  omated fit..# ou
-0001b860: 7470 7574 2074 6f20 7461 626c 650d 0a23  tput to table..#
-0001b870: 2063 6f6d 7061 7265 2063 6f65 6666 6963   compare coeffic
-0001b880: 6965 6e74 7320 6368 616e 6765 206f 7665  ients change ove
-0001b890: 7220 7469 6d65 2c20 6163 6375 7261 6379  r time, accuracy
-0001b8a0: 206f 7665 7220 7469 6d65 0d0a 2320 636f   over time..# co
-0001b8b0: 6d70 6172 696e 6720 6469 6666 6572 656e  mparing differen
-0001b8c0: 7420 736f 7572 6365 733f 2061 6e64 2f6f  t sources? and/o
-0001b8d0: 7220 616c 6c6f 7769 6e67 206f 6e65 2066  r allowing one f
-0001b8e0: 6f72 6563 6173 7420 746f 2062 6520 7573  orecast to be us
-0001b8f0: 6564 2061 7320 6120 7265 6772 6573 736f  ed as a regresso
-0001b900: 7220 666f 7220 616e 6f74 6865 720d 0a23  r for another..#
-0001b910: 2077 6f75 6c64 2061 6c6c 6f77 2066 6f72   would allow for
-0001b920: 2065 6172 6c69 6572 2064 6574 6563 7469   earlier detecti
-0001b930: 6f6e 206f 6620 6272 6f6b 656e 2063 6f6e  on of broken con
-0001b940: 6e65 6374 696f 6e73 0d0a 0d0a 2222 220d  nections....""".
-0001b950: 0a61 7820 3d20 7072 6564 2e70 6c6f 7428  .ax = pred.plot(
-0001b960: 6466 5f64 6169 6c79 2069 6620 696e 636c  df_daily if incl
-0001b970: 7564 655f 6869 7374 6f72 7920 656c 7365  ude_history else
-0001b980: 2064 665f 7465 7374 2c20 7365 7269 6573   df_test, series
-0001b990: 3d73 6572 6965 732c 2076 6c69 6e65 3d64  =series, vline=d
-0001b9a0: 665f 7465 7374 2e69 6e64 6578 5b30 5d2c  f_test.index[0],
-0001b9b0: 2073 7461 7274 5f64 6174 653d 7374 6172   start_date=star
-0001b9c0: 745f 6461 7465 290d 0a68 616e 646c 6573  t_date)..handles
-0001b9d0: 2c20 6c61 6265 6c73 203d 2061 782e 6765  , labels = ax.ge
-0001b9e0: 745f 6c65 6765 6e64 5f68 616e 646c 6573  t_legend_handles
-0001b9f0: 5f6c 6162 656c 7328 290d 0a69 6620 6d6f  _labels()..if mo
-0001ba00: 642e 616e 6f6d 616c 795f 6465 7465 6374  d.anomaly_detect
-0001ba10: 6f72 3a0d 0a20 2020 2069 6620 6d6f 642e  or:..    if mod.
-0001ba20: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
-0001ba30: 2e6f 7574 7075 7420 3d3d 2022 756e 6976  .output == "univ
-0001ba40: 6172 6961 7465 223a 0d0a 2020 2020 2020  ariate":..      
-0001ba50: 2020 695f 616e 6f6d 203d 206d 6f64 2e61    i_anom = mod.a
-0001ba60: 6e6f 6d61 6c79 5f64 6574 6563 746f 722e  nomaly_detector.
-0001ba70: 616e 6f6d 616c 6965 732e 696e 6465 785b  anomalies.index[
-0001ba80: 6d6f 642e 616e 6f6d 616c 795f 6465 7465  mod.anomaly_dete
-0001ba90: 6374 6f72 2e61 6e6f 6d61 6c69 6573 2e69  ctor.anomalies.i
-0001baa0: 6c6f 635b 3a2c 2030 5d20 3d3d 202d 315d  loc[:, 0] == -1]
-0001bab0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-0001bac0: 2020 2020 2073 6572 6965 735f 616e 6f6d       series_anom
-0001bad0: 203d 206d 6f64 2e61 6e6f 6d61 6c79 5f64   = mod.anomaly_d
-0001bae0: 6574 6563 746f 722e 616e 6f6d 616c 6965  etector.anomalie
-0001baf0: 735b 7365 7269 6573 5d0d 0a20 2020 2020  s[series]..     
-0001bb00: 2020 2069 5f61 6e6f 6d20 3d20 7365 7269     i_anom = seri
-0001bb10: 6573 5f61 6e6f 6d5b 7365 7269 6573 5f61  es_anom[series_a
-0001bb20: 6e6f 6d20 3d3d 202d 315d 2e69 6e64 6578  nom == -1].index
-0001bb30: 0d0a 2020 2020 2020 2020 695f 616e 6f6d  ..        i_anom
-0001bb40: 203d 2069 5f61 6e6f 6d5b 695f 616e 6f6d   = i_anom[i_anom
-0001bb50: 203e 3d20 7374 6172 745f 6461 7465 5d0d   >= start_date].
-0001bb60: 0a20 2020 2069 6620 6c65 6e28 695f 616e  .    if len(i_an
-0001bb70: 6f6d 2920 3e20 3020 616e 6420 6c65 6e28  om) > 0 and len(
-0001bb80: 695f 616e 6f6d 2920 3c20 6c65 6e28 6466  i_anom) < len(df
-0001bb90: 5f64 6169 6c79 2920 2a20 302e 353a 0d0a  _daily) * 0.5:..
-0001bba0: 2020 2020 2020 2020 7363 6174 3120 3d20          scat1 = 
-0001bbb0: 6178 2e73 6361 7474 6572 2869 5f61 6e6f  ax.scatter(i_ano
-0001bbc0: 6d2e 746f 6c69 7374 2829 2c20 6466 5f64  m.tolist(), df_d
-0001bbd0: 6169 6c79 2e6c 6f63 5b69 5f61 6e6f 6d2c  aily.loc[i_anom,
-0001bbe0: 203a 5d5b 7365 7269 6573 5d2c 2063 3d22   :][series], c="
-0001bbf0: 6461 726b 736c 6174 6562 6c75 6522 2c20  darkslateblue", 
-0001bc00: 733d 3132 2e30 290d 0a20 2020 2020 2020  s=12.0)..       
-0001bc10: 2068 616e 646c 6573 202b 3d20 5b73 6361   handles += [sca
-0001bc20: 7431 5d0d 0a20 2020 2020 2020 206c 6162  t1]..        lab
-0001bc30: 656c 7320 2b3d 205b 2261 6e6f 6d61 6c69  els += ["anomali
-0001bc40: 6573 225d 0d0a 6966 206d 6f64 2e68 6f6c  es"]..if mod.hol
-0001bc50: 6964 6179 5f64 6574 6563 746f 723a 0d0a  iday_detector:..
-0001bc60: 2020 2020 695f 616e 6f6d 203d 206d 6f64      i_anom = mod
-0001bc70: 2e68 6f6c 6964 6179 5f64 6574 6563 746f  .holiday_detecto
-0001bc80: 722e 6461 7465 735f 746f 5f68 6f6c 6964  r.dates_to_holid
-0001bc90: 6179 7328 6d6f 642e 6466 2e69 6e64 6578  ays(mod.df.index
-0001bca0: 2c20 7374 796c 653d 2273 6572 6965 735f  , style="series_
-0001bcb0: 666c 6167 2229 5b73 6572 6965 735d 0d0a  flag")[series]..
-0001bcc0: 2020 2020 695f 616e 6f6d 203d 2069 5f61      i_anom = i_a
-0001bcd0: 6e6f 6d2e 696e 6465 785b 695f 616e 6f6d  nom.index[i_anom
-0001bce0: 203d 3d20 315d 0d0a 2020 2020 6966 206c   == 1]..    if l
-0001bcf0: 656e 2869 5f61 6e6f 6d29 203e 2030 2061  en(i_anom) > 0 a
-0001bd00: 6e64 206c 656e 2869 5f61 6e6f 6d29 203c  nd len(i_anom) <
-0001bd10: 206c 656e 2864 665f 6461 696c 7929 202a   len(df_daily) *
-0001bd20: 2030 2e35 3a0d 0a20 2020 2020 2020 2073   0.5:..        s
-0001bd30: 6361 7432 203d 2061 782e 7363 6174 7465  cat2 = ax.scatte
-0001bd40: 7228 695f 616e 6f6d 2e74 6f6c 6973 7428  r(i_anom.tolist(
-0001bd50: 292c 2064 665f 6461 696c 792e 6c6f 635b  ), df_daily.loc[
-0001bd60: 695f 616e 6f6d 2c20 3a5d 5b73 6572 6965  i_anom, :][serie
-0001bd70: 735d 2c20 633d 2264 6172 6b67 7265 656e  s], c="darkgreen
-0001bd80: 222c 2073 3d31 322e 3029 0d0a 2020 2020  ", s=12.0)..    
-0001bd90: 2020 2020 6861 6e64 6c65 7320 2b3d 205b      handles += [
-0001bda0: 7363 6174 325d 0d0a 2020 2020 2020 2020  scat2]..        
-0001bdb0: 6c61 6265 6c73 202b 3d20 5b22 6465 7465  labels += ["dete
-0001bdc0: 6374 6564 2068 6f6c 6964 6179 7322 5d0d  cted holidays"].
-0001bdd0: 0a69 6620 6d6f 642e 7472 656e 645f 616e  .if mod.trend_an
-0001bde0: 6f6d 616c 795f 6465 7465 6374 6f72 2069  omaly_detector i
-0001bdf0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0001be00: 2069 6620 6d6f 642e 7472 656e 645f 616e   if mod.trend_an
-0001be10: 6f6d 616c 795f 6465 7465 6374 6f72 2e6f  omaly_detector.o
-0001be20: 7574 7075 7420 3d3d 2022 756e 6976 6172  utput == "univar
-0001be30: 6961 7465 223a 0d0a 2020 2020 2020 2020  iate":..        
-0001be40: 695f 616e 6f6d 203d 206d 6f64 2e74 7265  i_anom = mod.tre
-0001be50: 6e64 5f61 6e6f 6d61 6c79 5f64 6574 6563  nd_anomaly_detec
-0001be60: 746f 722e 616e 6f6d 616c 6965 732e 696e  tor.anomalies.in
-0001be70: 6465 785b 6d6f 642e 616e 6f6d 616c 795f  dex[mod.anomaly_
-0001be80: 6465 7465 6374 6f72 2e61 6e6f 6d61 6c69  detector.anomali
-0001be90: 6573 2e69 6c6f 635b 3a2c 2030 5d20 3d3d  es.iloc[:, 0] ==
-0001bea0: 202d 315d 0d0a 2020 2020 656c 7365 3a0d   -1]..    else:.
-0001beb0: 0a20 2020 2020 2020 2073 6572 6965 735f  .        series_
-0001bec0: 616e 6f6d 203d 206d 6f64 2e74 7265 6e64  anom = mod.trend
-0001bed0: 5f61 6e6f 6d61 6c79 5f64 6574 6563 746f  _anomaly_detecto
-0001bee0: 722e 616e 6f6d 616c 6965 735b 7365 7269  r.anomalies[seri
-0001bef0: 6573 5d0d 0a20 2020 2020 2020 2069 5f61  es]..        i_a
-0001bf00: 6e6f 6d20 3d20 7365 7269 6573 5f61 6e6f  nom = series_ano
-0001bf10: 6d5b 7365 7269 6573 5f61 6e6f 6d20 3d3d  m[series_anom ==
-0001bf20: 202d 315d 2e69 6e64 6578 0d0a 2020 2020   -1].index..    
-0001bf30: 6966 2073 7461 7274 5f64 6174 6520 6973  if start_date is
-0001bf40: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0001bf50: 2020 2020 695f 616e 6f6d 203d 2069 5f61      i_anom = i_a
-0001bf60: 6e6f 6d5b 695f 616e 6f6d 203e 3d20 7374  nom[i_anom >= st
-0001bf70: 6172 745f 6461 7465 5d0d 0a20 2020 2069  art_date]..    i
-0001bf80: 6620 6c65 6e28 695f 616e 6f6d 2920 3e20  f len(i_anom) > 
-0001bf90: 3020 616e 6420 6c65 6e28 695f 616e 6f6d  0 and len(i_anom
-0001bfa0: 2920 3c20 6c65 6e28 6466 5f64 6169 6c79  ) < len(df_daily
-0001bfb0: 2920 2a20 302e 353a 0d0a 2020 2020 2020  ) * 0.5:..      
-0001bfc0: 2020 7363 6174 3320 3d20 6178 2e73 6361    scat3 = ax.sca
-0001bfd0: 7474 6572 2869 5f61 6e6f 6d2e 746f 6c69  tter(i_anom.toli
-0001bfe0: 7374 2829 2c20 6466 5f64 6169 6c79 2e6c  st(), df_daily.l
-0001bff0: 6f63 5b69 5f61 6e6f 6d5d 5b73 6572 6965  oc[i_anom][serie
-0001c000: 735d 2c20 633d 2273 6c61 7465 6772 6179  s], c="slategray
-0001c010: 222c 2073 3d31 322e 3029 0d0a 2020 2020  ", s=12.0)..    
-0001c020: 2020 2020 6861 6e64 6c65 7320 2b3d 205b      handles += [
-0001c030: 7363 6174 335d 0d0a 2020 2020 2020 2020  scat3]..        
-0001c040: 6c61 6265 6c73 202b 3d20 5b22 7472 656e  labels += ["tren
-0001c050: 6420 616e 6f6d 616c 6965 7322 5d0d 0a61  d anomalies"]..a
-0001c060: 782e 6c65 6765 6e64 2868 616e 646c 6573  x.legend(handles
-0001c070: 2c20 6c61 6265 6c73 290d 0a22 2222 0d0a  , labels).."""..
+00016e80: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00016e90: 6772 6f77 7468 5f64 6563 656c 6572 6174  growth_decelerat
+00016ea0: 696e 6727 3a20 6375 725f 7472 656e 645b  ing': cur_trend[
+00016eb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016ec0: 2020 2020 2020 280d 0a20 2020 2020 2020        (..       
+00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ee0: 206e 702e 6873 7461 636b 2828 6e70 2e73   np.hstack((np.s
+00016ef0: 6967 6e62 6974 2873 656c 662e 6163 6365  ignbit(self.acce
+00016f00: 6c5b 3a2c 2070 5f69 6e64 785d 292c 2046  l[:, p_indx]), F
+00016f10: 616c 7365 2929 0d0a 2020 2020 2020 2020  alse))..        
+00016f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f30: 2620 287e 7365 6c66 2e73 6c6f 7065 5f73  & (~self.slope_s
+00016f40: 6967 6e5b 3a2c 2070 5f69 6e64 785d 290d  ign[:, p_indx]).
+00016f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016f60: 2020 2020 2029 5b2d 746c 733a 5d0d 0a20       )[-tls:].. 
+00016f70: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00016f80: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00016f90: 2020 2027 6772 6f77 7468 5f61 6363 656c     'growth_accel
+00016fa0: 6572 6174 696e 6727 3a20 6375 725f 7472  erating': cur_tr
+00016fb0: 656e 645b 0d0a 2020 2020 2020 2020 2020  end[..          
+00016fc0: 2020 2020 2020 2020 2020 280d 0a20 2020            (..   
+00016fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fe0: 2020 2020 2028 7e6e 702e 6873 7461 636b       (~np.hstack
+00016ff0: 2828 6e70 2e73 6967 6e62 6974 2873 656c  ((np.signbit(sel
+00017000: 662e 6163 6365 6c5b 3a2c 2070 5f69 6e64  f.accel[:, p_ind
+00017010: 785d 292c 2046 616c 7365 2929 290d 0a20  x]), False))).. 
+00017020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017030: 2020 2020 2020 2026 2028 7e73 656c 662e         & (~self.
+00017040: 736c 6f70 655f 7369 676e 5b3a 2c20 705f  slope_sign[:, p_
+00017050: 696e 6478 5d29 0d0a 2020 2020 2020 2020  indx])..        
+00017060: 2020 2020 2020 2020 2020 2020 295b 2d74              )[-t
+00017070: 6c73 3a5d 0d0a 2020 2020 2020 2020 2020  ls:]..          
+00017080: 2020 2020 2020 5d2c 0d0a 2020 2020 2020        ],..      
+00017090: 2020 2020 2020 7d2c 0d0a 2020 2020 2020        },..      
+000170a0: 2020 2020 2020 696e 6465 783d 6375 725f        index=cur_
+000170b0: 7472 656e 642e 696e 6465 782c 0d0a 2020  trend.index,..  
+000170c0: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+000170d0: 2069 6620 7374 6172 745f 6461 7465 2069   if start_date i
+000170e0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+000170f0: 2020 2020 2020 2020 2070 6c6f 745f 6466           plot_df
+00017100: 203d 2070 6c6f 745f 6466 5b70 6c6f 745f   = plot_df[plot_
+00017110: 6466 2e69 6e64 6578 203e 3d20 7374 6172  df.index >= star
+00017120: 745f 6461 7465 5d0d 0a20 2020 2020 2020  t_date]..       
+00017130: 2061 7820 3d20 706c 6f74 5f64 662e 706c   ax = plot_df.pl
+00017140: 6f74 2874 6974 6c65 3d74 6974 6c65 2c20  ot(title=title, 
+00017150: 636f 6c6f 723d 636f 6c6f 7273 2c20 2a2a  color=colors, **
+00017160: 6b77 6172 6773 290d 0a20 2020 2020 2020  kwargs)..       
+00017170: 2068 616e 646c 6573 2c20 6c61 6265 6c73   handles, labels
+00017180: 203d 2061 782e 6765 745f 6c65 6765 6e64   = ax.get_legend
+00017190: 5f68 616e 646c 6573 5f6c 6162 656c 7328  _handles_labels(
+000171a0: 290d 0a20 2020 2020 2020 2023 2061 782e  )..        # ax.
+000171b0: 7363 6174 7465 7228 6375 725f 7472 656e  scatter(cur_tren
+000171c0: 642e 696e 6465 785b 7365 6c66 2e63 6861  d.index[self.cha
+000171d0: 6e67 6570 6f69 6e74 735b 3a2c 2070 5f69  ngepoints[:, p_i
+000171e0: 6e64 785d 5d2c 2063 7572 5f74 7265 6e64  ndx]], cur_trend
+000171f0: 5b73 656c 662e 6368 616e 6765 706f 696e  [self.changepoin
+00017200: 7473 5b3a 2c20 705f 696e 6478 5d5d 2c20  ts[:, p_indx]], 
+00017210: 633d 2723 6664 6363 3039 272c 2073 3d34  c='#fdcc09', s=4
+00017220: 2e30 290d 0a20 2020 2020 2020 2023 2061  .0)..        # a
+00017230: 782e 7363 6174 7465 7228 6375 725f 7472  x.scatter(cur_tr
+00017240: 656e 642e 696e 6465 785b 7365 6c66 2e7a  end.index[self.z
+00017250: 6572 6f5f 6372 6f73 7369 6e67 735b 3a2c  ero_crossings[:,
+00017260: 2070 5f69 6e64 785d 5d2c 2063 7572 5f74   p_indx]], cur_t
+00017270: 7265 6e64 5b73 656c 662e 7a65 726f 5f63  rend[self.zero_c
+00017280: 726f 7373 696e 6773 5b3a 2c20 705f 696e  rossings[:, p_in
+00017290: 6478 5d5d 2c20 633d 2723 3531 3266 3734  dx]], c='#512f74
+000172a0: 272c 2073 3d34 2e30 290d 0a20 2020 2020  ', s=4.0)..     
+000172b0: 2020 2069 6620 7365 6c66 2e74 7265 6e64     if self.trend
+000172c0: 5f61 6e6f 6d61 6c79 5f64 6574 6563 746f  _anomaly_detecto
+000172d0: 7220 6973 206e 6f74 204e 6f6e 653a 0d0a  r is not None:..
+000172e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000172f0: 656c 662e 7472 656e 645f 616e 6f6d 616c  elf.trend_anomal
+00017300: 795f 6465 7465 6374 6f72 2e6f 7574 7075  y_detector.outpu
+00017310: 7420 3d3d 2022 756e 6976 6172 6961 7465  t == "univariate
+00017320: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
+00017330: 2020 2020 695f 616e 6f6d 203d 2073 656c      i_anom = sel
+00017340: 662e 7472 656e 645f 616e 6f6d 616c 795f  f.trend_anomaly_
+00017350: 6465 7465 6374 6f72 2e61 6e6f 6d61 6c69  detector.anomali
+00017360: 6573 2e69 6e64 6578 5b0d 0a20 2020 2020  es.index[..     
+00017370: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00017380: 656c 662e 616e 6f6d 616c 795f 6465 7465  elf.anomaly_dete
+00017390: 6374 6f72 2e61 6e6f 6d61 6c69 6573 2e69  ctor.anomalies.i
+000173a0: 6c6f 635b 3a2c 2030 5d20 3d3d 202d 310d  loc[:, 0] == -1.
+000173b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000173c0: 205d 0d0a 2020 2020 2020 2020 2020 2020   ]..            
+000173d0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000173e0: 2020 2020 2020 2073 6572 6965 735f 616e         series_an
+000173f0: 6f6d 203d 2073 656c 662e 7472 656e 645f  om = self.trend_
+00017400: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+00017410: 2e61 6e6f 6d61 6c69 6573 5b73 6572 6965  .anomalies[serie
+00017420: 735d 0d0a 2020 2020 2020 2020 2020 2020  s]..            
+00017430: 2020 2020 695f 616e 6f6d 203d 2073 6572      i_anom = ser
+00017440: 6965 735f 616e 6f6d 5b73 6572 6965 735f  ies_anom[series_
+00017450: 616e 6f6d 203d 3d20 2d31 5d2e 696e 6465  anom == -1].inde
+00017460: 780d 0a20 2020 2020 2020 2020 2020 2069  x..            i
+00017470: 6620 7374 6172 745f 6461 7465 2069 7320  f start_date is 
+00017480: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00017490: 2020 2020 2020 2020 2020 2069 5f61 6e6f             i_ano
+000174a0: 6d20 3d20 695f 616e 6f6d 5b69 5f61 6e6f  m = i_anom[i_ano
+000174b0: 6d20 3e3d 2073 7461 7274 5f64 6174 655d  m >= start_date]
+000174c0: 0d0a 2020 2020 2020 2020 2020 2020 695f  ..            i_
+000174d0: 616e 6f6d 203d 2069 5f61 6e6f 6d5b 695f  anom = i_anom[i_
+000174e0: 616e 6f6d 203e 3d20 6375 725f 7472 656e  anom >= cur_tren
+000174f0: 642e 696e 6465 785b 305d 5d0d 0a20 2020  d.index[0]]..   
+00017500: 2020 2020 2020 2020 2023 206f 6e6c 7920           # only 
+00017510: 706c 6f74 2069 6620 736f 6d65 2061 6e6f  plot if some ano
+00017520: 6d61 6c69 6573 2c20 616e 6420 6e6f 7420  malies, and not 
+00017530: 7761 7920 746f 6f20 6d61 6e79 2061 6e6f  way too many ano
+00017540: 6d61 6c69 6573 0d0a 2020 2020 2020 2020  malies..        
+00017550: 2020 2020 6966 206c 656e 2869 5f61 6e6f      if len(i_ano
+00017560: 6d29 203e 2030 2061 6e64 206c 656e 2869  m) > 0 and len(i
+00017570: 5f61 6e6f 6d29 203c 206c 656e 2870 6c6f  _anom) < len(plo
+00017580: 745f 6466 2920 2a20 302e 353a 0d0a 2020  t_df) * 0.5:..  
+00017590: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+000175a0: 6174 3120 3d20 6178 2e73 6361 7474 6572  at1 = ax.scatter
+000175b0: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+000175c0: 2020 2020 2020 2069 5f61 6e6f 6d2e 746f         i_anom.to
+000175d0: 6c69 7374 2829 2c20 6375 725f 7472 656e  list(), cur_tren
+000175e0: 642e 6c6f 635b 695f 616e 6f6d 5d2c 2063  d.loc[i_anom], c
+000175f0: 3d22 7265 6422 2c20 733d 3136 2e30 0d0a  ="red", s=16.0..
+00017600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017610: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00017620: 2020 2068 616e 646c 6573 202b 3d20 5b73     handles += [s
+00017630: 6361 7431 5d0d 0a20 2020 2020 2020 2020  cat1]..         
+00017640: 2020 2020 2020 206c 6162 656c 7320 2b3d         labels +=
+00017650: 205b 2774 7265 6e64 2061 6e6f 6d61 6c69   ['trend anomali
+00017660: 6573 275d 0d0a 2020 2020 2020 2020 6966  es']..        if
+00017670: 2076 6c69 6e65 2069 7320 6e6f 7420 4e6f   vline is not No
+00017680: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00017690: 2061 782e 766c 696e 6573 280d 0a20 2020   ax.vlines(..   
+000176a0: 2020 2020 2020 2020 2020 2020 2078 3d76               x=v
+000176b0: 6c69 6e65 2c0d 0a20 2020 2020 2020 2020  line,..         
+000176c0: 2020 2020 2020 206c 733d 272d 2d27 2c0d         ls='--',.
+000176d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000176e0: 206c 773d 312c 0d0a 2020 2020 2020 2020   lw=1,..        
+000176f0: 2020 2020 2020 2020 636f 6c6f 7273 3d27          colors='
+00017700: 6461 726b 7265 6427 2c0d 0a20 2020 2020  darkred',..     
+00017710: 2020 2020 2020 2020 2020 2079 6d69 6e3d             ymin=
+00017720: 6375 725f 7472 656e 645b 6375 725f 7472  cur_trend[cur_tr
+00017730: 656e 642e 696e 6465 7820 3e3d 2073 7461  end.index >= sta
+00017740: 7274 5f64 6174 655d 2e6d 696e 2829 2c0d  rt_date].min(),.
+00017750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017760: 2079 6d61 783d 6375 725f 7472 656e 645b   ymax=cur_trend[
+00017770: 6375 725f 7472 656e 642e 696e 6465 7820  cur_trend.index 
+00017780: 3e3d 2073 7461 7274 5f64 6174 655d 2e6d  >= start_date].m
+00017790: 6178 2829 2c0d 0a20 2020 2020 2020 2020  ax(),..         
+000177a0: 2020 2029 0d0a 2020 2020 2020 2020 6178     )..        ax
+000177b0: 2e6c 6567 656e 6428 6861 6e64 6c65 732c  .legend(handles,
+000177c0: 206c 6162 656c 7329 0d0a 2020 2020 2020   labels)..      
+000177d0: 2020 7265 7475 726e 2061 780d 0a0d 0a20    return ax.... 
+000177e0: 2020 2064 6566 2070 6c6f 745f 666f 7265     def plot_fore
+000177f0: 6361 7374 280d 0a20 2020 2020 2020 2073  cast(..        s
+00017800: 656c 662c 0d0a 2020 2020 2020 2020 7072  elf,..        pr
+00017810: 6564 6963 7469 6f6e 2c0d 0a20 2020 2020  ediction,..     
+00017820: 2020 2061 6374 7561 6c73 3d4e 6f6e 652c     actuals=None,
+00017830: 0d0a 2020 2020 2020 2020 7365 7269 6573  ..        series
+00017840: 3d4e 6f6e 652c 0d0a 2020 2020 2020 2020  =None,..        
+00017850: 7374 6172 745f 6461 7465 3d4e 6f6e 652c  start_date=None,
+00017860: 0d0a 2020 2020 2020 2020 616e 6f6d 616c  ..        anomal
+00017870: 795f 636f 6c6f 723d 2264 6172 6b73 6c61  y_color="darksla
+00017880: 7465 626c 7565 222c 0d0a 2020 2020 2020  teblue",..      
+00017890: 2020 686f 6c69 6461 795f 636f 6c6f 723d    holiday_color=
+000178a0: 2264 6172 6b67 7265 656e 222c 0d0a 2020  "darkgreen",..  
+000178b0: 2020 2020 2020 7472 656e 645f 616e 6f6d        trend_anom
+000178c0: 616c 795f 636f 6c6f 723d 2773 6c61 7465  aly_color='slate
+000178d0: 6772 6179 272c 0d0a 2020 2020 2020 2020  gray',..        
+000178e0: 706f 696e 745f 7369 7a65 3d31 322e 302c  point_size=12.0,
+000178f0: 0d0a 2020 2020 293a 0d0a 2020 2020 2020  ..    ):..      
+00017900: 2020 2222 2250 6c6f 7420 6120 666f 7265    """Plot a fore
+00017910: 6361 7374 2074 696d 6520 7365 7269 6573  cast time series
+00017920: 2e0d 0a0d 0a20 2020 2020 2020 2041 7267  .....        Arg
+00017930: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00017940: 7072 6564 6963 7469 6f6e 2028 6d6f 6465  prediction (mode
+00017950: 6c20 7072 6564 6963 7469 6f6e 206f 626a  l prediction obj
+00017960: 6563 742c 2072 6571 7569 7265 6429 0d0a  ect, required)..
+00017970: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+00017980: 616c 7320 2870 642e 4461 7461 4672 616d  als (pd.DataFram
+00017990: 6529 3a20 7769 6465 2073 7479 6c65 2064  e): wide style d
+000179a0: 662c 206f 6620 6b6e 6f77 2064 6174 6120  f, of know data 
+000179b0: 6966 2061 7661 696c 6162 6c65 0d0a 2020  if available..  
+000179c0: 2020 2020 2020 2020 2020 7365 7269 6573            series
+000179d0: 2028 7374 7229 3a20 6e61 6d65 206f 6620   (str): name of 
+000179e0: 7469 6d65 2073 6572 6965 7320 636f 6c75  time series colu
+000179f0: 6d6e 2074 6f20 706c 6f74 0d0a 2020 2020  mn to plot..    
+00017a00: 2020 2020 2020 2020 7374 6172 745f 6461          start_da
+00017a10: 7465 2028 7374 7220 6f72 2054 696d 6573  te (str or Times
+00017a20: 7461 6d70 293a 2070 6f69 6e74 2061 7420  tamp): point at 
+00017a30: 7768 6963 6820 746f 2062 6567 696e 2058  which to begin X
+00017a40: 2061 7869 730d 0a20 2020 2020 2020 2020   axis..         
+00017a50: 2020 2061 6e6f 6d61 6c79 5f63 6f6c 6f72     anomaly_color
+00017a60: 2028 7374 7229 3a20 6e61 6d65 206f 6620   (str): name of 
+00017a70: 616e 6f6d 616c 7920 706f 696e 7420 636f  anomaly point co
+00017a80: 6c6f 720d 0a20 2020 2020 2020 2020 2020  lor..           
+00017a90: 2068 6f6c 6964 6179 5f63 6f6c 6f72 2028   holiday_color (
+00017aa0: 7374 7229 3a20 6e61 6d65 206f 6620 686f  str): name of ho
+00017ab0: 6c69 6461 7920 706f 696e 7420 636f 6c6f  liday point colo
+00017ac0: 720d 0a20 2020 2020 2020 2020 2020 2074  r..            t
+00017ad0: 7265 6e64 5f61 6e6f 6d61 6c79 5f63 6f6c  rend_anomaly_col
+00017ae0: 6f72 2028 7374 7229 3a20 6e61 6d65 206f  or (str): name o
+00017af0: 6620 7472 656e 6420 616e 6f6d 616c 7920  f trend anomaly 
+00017b00: 706f 696e 7420 636f 6c6f 720d 0a20 2020  point color..   
+00017b10: 2020 2020 2020 2020 2070 6f69 6e74 5f73           point_s
+00017b20: 697a 6520 2873 7472 293a 2070 6f69 6e74  ize (str): point
+00017b30: 2073 697a 6520 666f 7220 616c 6c20 616e   size for all an
+00017b40: 6f6d 616c 6965 730d 0a20 2020 2020 2020  omalies..       
+00017b50: 2022 2222 0d0a 2020 2020 2020 2020 6966   """..        if
+00017b60: 2073 6572 6965 7320 6973 204e 6f6e 653a   series is None:
+00017b70: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00017b80: 7269 6573 203d 2072 616e 646f 6d2e 6368  ries = random.ch
+00017b90: 6f69 6365 2873 656c 662e 636f 6c75 6d6e  oice(self.column
+00017ba0: 5f6e 616d 6573 290d 0a20 2020 2020 2020  _names)..       
+00017bb0: 2069 6620 6163 7475 616c 7320 6973 204e   if actuals is N
+00017bc0: 6f6e 6520 6f72 206e 6f74 2069 7369 6e73  one or not isins
+00017bd0: 7461 6e63 6528 0d0a 2020 2020 2020 2020  tance(..        
+00017be0: 2020 2020 6163 7475 616c 732c 2028 7064      actuals, (pd
+00017bf0: 2e44 6174 6146 7261 6d65 2c20 6e70 2e61  .DataFrame, np.a
+00017c00: 7272 6179 2c20 7064 2e53 6572 6965 7329  rray, pd.Series)
+00017c10: 0d0a 2020 2020 2020 2020 293a 0d0a 2020  ..        ):..  
+00017c20: 2020 2020 2020 2020 2020 6163 7475 616c            actual
+00017c30: 735f 7573 6564 203d 2070 7265 6469 6374  s_used = predict
+00017c40: 696f 6e2e 666f 7265 6361 7374 0d0a 2020  ion.forecast..  
+00017c50: 2020 2020 2020 2020 2020 6163 7475 616c            actual
+00017c60: 735f 666c 6167 203d 2046 616c 7365 0d0a  s_flag = False..
+00017c70: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00017c80: 2020 2020 2020 2020 2020 2061 6374 7561             actua
+00017c90: 6c73 5f66 6c61 6720 3d20 5472 7565 0d0a  ls_flag = True..
+00017ca0: 2020 2020 2020 2020 2020 2020 6163 7475              actu
+00017cb0: 616c 735f 7573 6564 203d 2061 6374 7561  als_used = actua
+00017cc0: 6c73 2e72 6569 6e64 6578 2870 7265 6469  ls.reindex(predi
+00017cd0: 6374 696f 6e2e 666f 7265 6361 7374 2e69  ction.forecast.i
+00017ce0: 6e64 6578 290d 0a20 2020 2020 2020 2076  ndex)..        v
+00017cf0: 6c69 6e65 203d 2028 0d0a 2020 2020 2020  line = (..      
+00017d00: 2020 2020 2020 4e6f 6e65 0d0a 2020 2020        None..    
+00017d10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00017d20: 666f 7265 6361 7374 5f6c 656e 6774 6820  forecast_length 
+00017d30: 6973 204e 6f6e 650d 0a20 2020 2020 2020  is None..       
+00017d40: 2020 2020 2065 6c73 6520 7072 6564 6963       else predic
+00017d50: 7469 6f6e 2e66 6f72 6563 6173 742e 696e  tion.forecast.in
+00017d60: 6465 785b 2d73 656c 662e 666f 7265 6361  dex[-self.foreca
+00017d70: 7374 5f6c 656e 6774 685d 0d0a 2020 2020  st_length]..    
+00017d80: 2020 2020 290d 0a20 2020 2020 2020 2061      )..        a
+00017d90: 7820 3d20 7072 6564 6963 7469 6f6e 2e70  x = prediction.p
+00017da0: 6c6f 7428 0d0a 2020 2020 2020 2020 2020  lot(..          
+00017db0: 2020 6163 7475 616c 735f 7573 6564 2e6c    actuals_used.l
+00017dc0: 6f63 5b70 7265 6469 6374 696f 6e2e 666f  oc[prediction.fo
+00017dd0: 7265 6361 7374 2e69 6e64 6578 5d0d 0a20  recast.index].. 
+00017de0: 2020 2020 2020 2020 2020 2069 6620 6163             if ac
+00017df0: 7475 616c 735f 666c 6167 2069 7320 6e6f  tuals_flag is no
+00017e00: 7420 4e6f 6e65 0d0a 2020 2020 2020 2020  t None..        
+00017e10: 2020 2020 656c 7365 204e 6f6e 652c 0d0a      else None,..
+00017e20: 2020 2020 2020 2020 2020 2020 7365 7269              seri
+00017e30: 6573 3d73 6572 6965 732c 0d0a 2020 2020  es=series,..    
+00017e40: 2020 2020 2020 2020 766c 696e 653d 766c          vline=vl
+00017e50: 696e 652c 0d0a 2020 2020 2020 2020 2020  ine,..          
+00017e60: 2020 7374 6172 745f 6461 7465 3d73 7461    start_date=sta
+00017e70: 7274 5f64 6174 652c 0d0a 2020 2020 2020  rt_date,..      
+00017e80: 2020 290d 0a20 2020 2020 2020 2068 616e    )..        han
+00017e90: 646c 6573 2c20 6c61 6265 6c73 203d 2061  dles, labels = a
+00017ea0: 782e 6765 745f 6c65 6765 6e64 5f68 616e  x.get_legend_han
+00017eb0: 646c 6573 5f6c 6162 656c 7328 290d 0a20  dles_labels().. 
+00017ec0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
+00017ed0: 6e6f 6d61 6c79 5f64 6574 6563 746f 723a  nomaly_detector:
+00017ee0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00017ef0: 2073 656c 662e 616e 6f6d 616c 795f 6465   self.anomaly_de
+00017f00: 7465 6374 6f72 2e6f 7574 7075 7420 3d3d  tector.output ==
+00017f10: 2022 756e 6976 6172 6961 7465 223a 0d0a   "univariate":..
+00017f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f30: 695f 616e 6f6d 203d 2073 656c 662e 616e  i_anom = self.an
+00017f40: 6f6d 616c 795f 6465 7465 6374 6f72 2e61  omaly_detector.a
+00017f50: 6e6f 6d61 6c69 6573 2e69 6e64 6578 5b0d  nomalies.index[.
+00017f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017f70: 2020 2020 2073 656c 662e 616e 6f6d 616c       self.anomal
+00017f80: 795f 6465 7465 6374 6f72 2e61 6e6f 6d61  y_detector.anoma
+00017f90: 6c69 6573 2e69 6c6f 635b 3a2c 2030 5d20  lies.iloc[:, 0] 
+00017fa0: 3d3d 202d 310d 0a20 2020 2020 2020 2020  == -1..         
+00017fb0: 2020 2020 2020 205d 0d0a 2020 2020 2020         ]..      
+00017fc0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00017fd0: 2020 2020 2020 2020 2020 2020 2073 6572               ser
+00017fe0: 6965 735f 616e 6f6d 203d 2073 656c 662e  ies_anom = self.
+00017ff0: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+00018000: 2e61 6e6f 6d61 6c69 6573 5b73 6572 6965  .anomalies[serie
+00018010: 735d 0d0a 2020 2020 2020 2020 2020 2020  s]..            
+00018020: 2020 2020 695f 616e 6f6d 203d 2073 6572      i_anom = ser
+00018030: 6965 735f 616e 6f6d 5b73 6572 6965 735f  ies_anom[series_
+00018040: 616e 6f6d 203d 3d20 2d31 5d2e 696e 6465  anom == -1].inde
+00018050: 780d 0a20 2020 2020 2020 2020 2020 2069  x..            i
+00018060: 6620 7374 6172 745f 6461 7465 2069 7320  f start_date is 
+00018070: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00018080: 2020 2020 2020 2020 2020 2069 5f61 6e6f             i_ano
+00018090: 6d20 3d20 695f 616e 6f6d 5b69 5f61 6e6f  m = i_anom[i_ano
+000180a0: 6d20 3e3d 2073 7461 7274 5f64 6174 655d  m >= start_date]
+000180b0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+000180c0: 2061 6374 7561 6c73 5f66 6c61 673a 0d0a   actuals_flag:..
+000180d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180e0: 695f 616e 6f6d 203d 2069 5f61 6e6f 6d5b  i_anom = i_anom[
+000180f0: 695f 616e 6f6d 203e 3d20 6163 7475 616c  i_anom >= actual
+00018100: 732e 696e 6465 785b 305d 5d0d 0a20 2020  s.index[0]]..   
+00018110: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00018120: 695f 616e 6f6d 2920 3e20 3020 616e 6420  i_anom) > 0 and 
+00018130: 280d 0a20 2020 2020 2020 2020 2020 2020  (..             
+00018140: 2020 206e 6f74 2061 6374 7561 6c73 5f66     not actuals_f
+00018150: 6c61 6720 6f72 206c 656e 2869 5f61 6e6f  lag or len(i_ano
+00018160: 6d29 203c 206c 656e 2861 6374 7561 6c73  m) < len(actuals
+00018170: 2920 2a20 302e 350d 0a20 2020 2020 2020  ) * 0.5..       
+00018180: 2020 2020 2029 3a0d 0a20 2020 2020 2020       ):..       
+00018190: 2020 2020 2020 2020 2073 6361 7431 203d           scat1 =
+000181a0: 2061 782e 7363 6174 7465 7228 0d0a 2020   ax.scatter(..  
+000181b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181c0: 2020 695f 616e 6f6d 2e74 6f6c 6973 7428    i_anom.tolist(
+000181d0: 292c 0d0a 2020 2020 2020 2020 2020 2020  ),..            
+000181e0: 2020 2020 2020 2020 6163 7475 616c 735f          actuals_
+000181f0: 7573 6564 2e72 6569 6e64 6578 2869 5f61  used.reindex(i_a
+00018200: 6e6f 6d29 5b73 6572 6965 735d 2c0d 0a20  nom)[series],.. 
+00018210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018220: 2020 2063 3d61 6e6f 6d61 6c79 5f63 6f6c     c=anomaly_col
+00018230: 6f72 2c0d 0a20 2020 2020 2020 2020 2020  or,..           
+00018240: 2020 2020 2020 2020 2073 3d70 6f69 6e74           s=point
+00018250: 5f73 697a 652c 0d0a 2020 2020 2020 2020  _size,..        
+00018260: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00018270: 2020 2020 2020 2020 2020 2068 616e 646c             handl
+00018280: 6573 202b 3d20 5b73 6361 7431 5d0d 0a20  es += [scat1].. 
+00018290: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000182a0: 6162 656c 7320 2b3d 205b 2261 6e6f 6d61  abels += ["anoma
+000182b0: 6c69 6573 225d 0d0a 2020 2020 2020 2020  lies"]..        
+000182c0: 6966 2073 656c 662e 686f 6c69 6461 795f  if self.holiday_
+000182d0: 6465 7465 6374 6f72 3a0d 0a20 2020 2020  detector:..     
+000182e0: 2020 2020 2020 2069 5f61 6e6f 6d20 3d20         i_anom = 
+000182f0: 7365 6c66 2e68 6f6c 6964 6179 5f64 6574  self.holiday_det
+00018300: 6563 746f 722e 6461 7465 735f 746f 5f68  ector.dates_to_h
+00018310: 6f6c 6964 6179 7328 0d0a 2020 2020 2020  olidays(..      
+00018320: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00018330: 662e 696e 6465 782c 2073 7479 6c65 3d22  f.index, style="
+00018340: 7365 7269 6573 5f66 6c61 6722 0d0a 2020  series_flag"..  
+00018350: 2020 2020 2020 2020 2020 295b 7365 7269            )[seri
+00018360: 6573 5d0d 0a20 2020 2020 2020 2020 2020  es]..           
+00018370: 2069 5f61 6e6f 6d20 3d20 695f 616e 6f6d   i_anom = i_anom
+00018380: 2e69 6e64 6578 5b69 5f61 6e6f 6d20 3d3d  .index[i_anom ==
+00018390: 2031 5d0d 0a20 2020 2020 2020 2020 2020   1]..           
+000183a0: 2069 6620 6163 7475 616c 735f 666c 6167   if actuals_flag
+000183b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000183c0: 2020 2069 5f61 6e6f 6d20 3d20 695f 616e     i_anom = i_an
+000183d0: 6f6d 5b69 5f61 6e6f 6d20 3e3d 2061 6374  om[i_anom >= act
+000183e0: 7561 6c73 2e69 6e64 6578 5b30 5d5d 0d0a  uals.index[0]]..
+000183f0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00018400: 656e 2869 5f61 6e6f 6d29 203e 2030 2061  en(i_anom) > 0 a
+00018410: 6e64 2028 0d0a 2020 2020 2020 2020 2020  nd (..          
+00018420: 2020 2020 2020 6e6f 7420 6163 7475 616c        not actual
+00018430: 735f 666c 6167 206f 7220 6c65 6e28 695f  s_flag or len(i_
+00018440: 616e 6f6d 2920 3c20 6c65 6e28 6163 7475  anom) < len(actu
+00018450: 616c 7329 202a 2030 2e35 0d0a 2020 2020  als) * 0.5..    
+00018460: 2020 2020 2020 2020 293a 0d0a 2020 2020          ):..    
+00018470: 2020 2020 2020 2020 2020 2020 7363 6174              scat
+00018480: 3220 3d20 6178 2e73 6361 7474 6572 280d  2 = ax.scatter(.
+00018490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000184a0: 2020 2020 2069 5f61 6e6f 6d2e 746f 6c69       i_anom.toli
+000184b0: 7374 2829 2c0d 0a20 2020 2020 2020 2020  st(),..         
+000184c0: 2020 2020 2020 2020 2020 2061 6374 7561             actua
+000184d0: 6c73 5f75 7365 642e 7265 696e 6465 7828  ls_used.reindex(
+000184e0: 695f 616e 6f6d 295b 7365 7269 6573 5d2c  i_anom)[series],
+000184f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018500: 2020 2020 2020 633d 686f 6c69 6461 795f        c=holiday_
+00018510: 636f 6c6f 722c 0d0a 2020 2020 2020 2020  color,..        
+00018520: 2020 2020 2020 2020 2020 2020 733d 706f              s=po
+00018530: 696e 745f 7369 7a65 2c0d 0a20 2020 2020  int_size,..     
+00018540: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
+00018550: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00018560: 6e64 6c65 7320 2b3d 205b 7363 6174 325d  ndles += [scat2]
+00018570: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018580: 2020 6c61 6265 6c73 202b 3d20 5b22 6465    labels += ["de
+00018590: 7465 6374 6564 2068 6f6c 6964 6179 7322  tected holidays"
+000185a0: 5d0d 0a20 2020 2020 2020 2069 6620 7365  ]..        if se
+000185b0: 6c66 2e74 7265 6e64 5f61 6e6f 6d61 6c79  lf.trend_anomaly
+000185c0: 5f64 6574 6563 746f 7220 6973 206e 6f74  _detector is not
+000185d0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000185e0: 2020 2020 6966 2073 656c 662e 7472 656e      if self.tren
+000185f0: 645f 616e 6f6d 616c 795f 6465 7465 6374  d_anomaly_detect
+00018600: 6f72 2e6f 7574 7075 7420 3d3d 2022 756e  or.output == "un
+00018610: 6976 6172 6961 7465 223a 0d0a 2020 2020  ivariate":..    
+00018620: 2020 2020 2020 2020 2020 2020 695f 616e              i_an
+00018630: 6f6d 203d 2073 656c 662e 7472 656e 645f  om = self.trend_
+00018640: 616e 6f6d 616c 795f 6465 7465 6374 6f72  anomaly_detector
+00018650: 2e61 6e6f 6d61 6c69 6573 2e69 6e64 6578  .anomalies.index
+00018660: 5b0d 0a20 2020 2020 2020 2020 2020 2020  [..             
+00018670: 2020 2020 2020 2073 656c 662e 616e 6f6d         self.anom
+00018680: 616c 795f 6465 7465 6374 6f72 2e61 6e6f  aly_detector.ano
+00018690: 6d61 6c69 6573 2e69 6c6f 635b 3a2c 2030  malies.iloc[:, 0
+000186a0: 5d20 3d3d 202d 310d 0a20 2020 2020 2020  ] == -1..       
+000186b0: 2020 2020 2020 2020 205d 0d0a 2020 2020           ]..    
+000186c0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000186d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000186e0: 6572 6965 735f 616e 6f6d 203d 2073 656c  eries_anom = sel
+000186f0: 662e 7472 656e 645f 616e 6f6d 616c 795f  f.trend_anomaly_
+00018700: 6465 7465 6374 6f72 2e61 6e6f 6d61 6c69  detector.anomali
+00018710: 6573 5b73 6572 6965 735d 0d0a 2020 2020  es[series]..    
+00018720: 2020 2020 2020 2020 2020 2020 695f 616e              i_an
+00018730: 6f6d 203d 2073 6572 6965 735f 616e 6f6d  om = series_anom
+00018740: 5b73 6572 6965 735f 616e 6f6d 203d 3d20  [series_anom == 
+00018750: 2d31 5d2e 696e 6465 780d 0a20 2020 2020  -1].index..     
+00018760: 2020 2020 2020 2069 6620 7374 6172 745f         if start_
+00018770: 6461 7465 2069 7320 6e6f 7420 4e6f 6e65  date is not None
+00018780: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00018790: 2020 2069 5f61 6e6f 6d20 3d20 695f 616e     i_anom = i_an
+000187a0: 6f6d 5b69 5f61 6e6f 6d20 3e3d 2073 7461  om[i_anom >= sta
+000187b0: 7274 5f64 6174 655d 0d0a 2020 2020 2020  rt_date]..      
+000187c0: 2020 2020 2020 6966 2061 6374 7561 6c73        if actuals
+000187d0: 5f66 6c61 673a 0d0a 2020 2020 2020 2020  _flag:..        
+000187e0: 2020 2020 2020 2020 695f 616e 6f6d 203d          i_anom =
+000187f0: 2069 5f61 6e6f 6d5b 695f 616e 6f6d 203e   i_anom[i_anom >
+00018800: 3d20 6163 7475 616c 732e 696e 6465 785b  = actuals.index[
+00018810: 305d 5d0d 0a20 2020 2020 2020 2020 2020  0]]..           
+00018820: 2069 6620 6c65 6e28 695f 616e 6f6d 2920   if len(i_anom) 
+00018830: 3e20 3020 616e 6420 280d 0a20 2020 2020  > 0 and (..     
+00018840: 2020 2020 2020 2020 2020 206e 6f74 2061             not a
+00018850: 6374 7561 6c73 5f66 6c61 6720 6f72 206c  ctuals_flag or l
+00018860: 656e 2869 5f61 6e6f 6d29 203c 206c 656e  en(i_anom) < len
+00018870: 2861 6374 7561 6c73 2920 2a20 302e 350d  (actuals) * 0.5.
+00018880: 0a20 2020 2020 2020 2020 2020 2029 3a0d  .            ):.
+00018890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000188a0: 2073 6361 7433 203d 2061 782e 7363 6174   scat3 = ax.scat
+000188b0: 7465 7228 0d0a 2020 2020 2020 2020 2020  ter(..          
+000188c0: 2020 2020 2020 2020 2020 695f 616e 6f6d            i_anom
+000188d0: 2e74 6f6c 6973 7428 292c 0d0a 2020 2020  .tolist(),..    
+000188e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188f0: 6163 7475 616c 735f 7573 6564 2e72 6569  actuals_used.rei
+00018900: 6e64 6578 2869 5f61 6e6f 6d29 5b73 6572  ndex(i_anom)[ser
+00018910: 6965 735d 2c0d 0a20 2020 2020 2020 2020  ies],..         
+00018920: 2020 2020 2020 2020 2020 2063 3d74 7265             c=tre
+00018930: 6e64 5f61 6e6f 6d61 6c79 5f63 6f6c 6f72  nd_anomaly_color
+00018940: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00018950: 2020 2020 2020 2073 3d70 6f69 6e74 5f73         s=point_s
+00018960: 697a 652c 0d0a 2020 2020 2020 2020 2020  ize,..          
+00018970: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00018980: 2020 2020 2020 2020 2068 616e 646c 6573           handles
+00018990: 202b 3d20 5b73 6361 7433 5d0d 0a20 2020   += [scat3]..   
+000189a0: 2020 2020 2020 2020 2020 2020 206c 6162               lab
+000189b0: 656c 7320 2b3d 205b 2274 7265 6e64 2061  els += ["trend a
+000189c0: 6e6f 6d61 6c69 6573 225d 0d0a 2020 2020  nomalies"]..    
+000189d0: 2020 2020 6178 2e6c 6567 656e 6428 6861      ax.legend(ha
+000189e0: 6e64 6c65 732c 206c 6162 656c 7329 0d0a  ndles, labels)..
+000189f0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00018a00: 780d 0a0d 0a20 2020 2064 6566 2070 6c6f  x....    def plo
+00018a10: 745f 7468 696e 6773 2829 3a20 2023 2070  t_things():  # p
+00018a20: 6c61 6365 686f 6c64 6572 2066 6f72 206c  laceholder for l
+00018a30: 6174 6572 2070 6c6f 7474 696e 6720 6675  ater plotting fu
+00018a40: 6e63 7469 6f6e 730d 0a20 2020 2020 2020  nctions..       
+00018a50: 2023 2070 6c6f 7420 636f 6d70 6f6e 656e   # plot componen
+00018a60: 7473 0d0a 2020 2020 2020 2020 2320 706c  ts..        # pl
+00018a70: 6f74 2074 7261 6e73 666f 726d 6564 2064  ot transformed d
+00018a80: 6620 6966 2070 7265 7072 6f63 6573 7320  f if preprocess 
+00018a90: 6f72 2061 6e6f 6d61 6c79 2072 656d 6f76  or anomaly remov
+00018aa0: 616c 0d0a 2020 2020 2020 2020 2320 706c  al..        # pl
+00018ab0: 6f74 2070 6173 7420 696d 7061 6374 730d  ot past impacts.
+00018ac0: 0a20 2020 2020 2020 2023 2070 6c6f 7420  .        # plot 
+00018ad0: 2520 636f 6e74 7269 6275 7469 6f6e 206f  % contribution o
+00018ae0: 6620 636f 6d70 6f6e 656e 7473 0d0a 2020  f components..  
+00018af0: 2020 2020 2020 2320 706c 6f74 2065 7661        # plot eva
+00018b00: 6c20 2873 686f 7720 6163 7475 616c 732c  l (show actuals,
+00018b10: 2061 6c6f 6e67 7369 6465 2066 756c 6c20   alongside full 
+00018b20: 616e 6420 636f 6d70 6f6e 656e 7473 2074  and components t
+00018b30: 6f20 6469 6167 6e6f 7365 290d 0a20 2020  o diagnose)..   
+00018b40: 2020 2020 2023 2070 6c6f 7420 7265 7369       # plot resi
+00018b50: 6475 616c 2064 6973 7472 6962 7574 696f  dual distributio
+00018b60: 6e2f 5041 4346 0d0a 2020 2020 2020 2020  n/PACF..        
+00018b70: 2320 706c 6f74 2069 6e66 6c65 6374 696f  # plot inflectio
+00018b80: 6e20 706f 696e 7473 2028 6669 6c74 6572  n points (filter
+00018b90: 696e 6720 6f72 2073 6d6f 6f74 6869 6e67  ing or smoothing
+00018ba0: 2066 6972 7374 290d 0a20 2020 2020 2020   first)..       
+00018bb0: 2023 2070 6c6f 7420 6869 6768 6573 7420   # plot highest 
+00018bc0: 6572 726f 7220 7365 7269 6573 2c20 706c  error series, pl
+00018bd0: 6f74 2068 6967 6865 7374 2f6c 6f77 6573  ot highest/lowes
+00018be0: 7420 6772 6f77 7468 0d0a 2020 2020 2020  t growth..      
+00018bf0: 2020 2320 7472 656e 643a 206f 6e65 2063    # trend: one c
+00018c00: 6f6c 6f72 2066 6f72 2067 726f 7774 682c  olor for growth,
+00018c10: 2061 6e6f 7468 6572 2066 6f72 2064 6563   another for dec
+00018c20: 6c69 6e65 2028 6461 726b 6572 2061 7320  line (darker as 
+00018c30: 6163 6365 6c65 7261 7469 6e67 2c20 6c69  accelerating, li
+00018c40: 6768 6572 2061 7320 736c 6f77 696e 6729  gher as slowing)
+00018c50: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00018c60: 204e 6f74 496d 706c 656d 656e 7465 640d   NotImplemented.
+00018c70: 0a0d 0a0d 0a64 6566 2063 6c65 616e 5f72  .....def clean_r
+00018c80: 6567 7265 7373 6f72 2869 6e5f 642c 2070  egressor(in_d, p
+00018c90: 7265 6669 783d 2272 6567 725f 2229 3a0d  refix="regr_"):.
+00018ca0: 0a20 2020 2069 6620 6e6f 7420 6973 696e  .    if not isin
+00018cb0: 7374 616e 6365 2869 6e5f 642c 2070 642e  stance(in_d, pd.
+00018cc0: 4461 7461 4672 616d 6529 3a0d 0a20 2020  DataFrame):..   
+00018cd0: 2020 2020 2064 6620 3d20 7064 2e44 6174       df = pd.Dat
+00018ce0: 6146 7261 6d65 2869 6e5f 6429 0d0a 2020  aFrame(in_d)..  
+00018cf0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00018d00: 2064 6620 3d20 696e 5f64 2e63 6f70 7928   df = in_d.copy(
+00018d10: 290d 0a20 2020 2064 662e 636f 6c75 6d6e  )..    df.column
+00018d20: 7320 3d20 5b70 7265 6669 7820 2b20 636f  s = [prefix + co
+00018d30: 6c20 666f 7220 636f 6c20 696e 2064 662e  l for col in df.
+00018d40: 636f 6c75 6d6e 735d 0d0a 2020 2020 7265  columns]..    re
+00018d50: 7475 726e 2064 660d 0a0d 0a0d 0a64 6566  turn df......def
+00018d60: 2063 7265 6174 655f 7428 6473 293a 0d0a   create_t(ds):..
+00018d70: 2020 2020 7265 7475 726e 2028 6473 202d      return (ds -
+00018d80: 2064 732e 6d69 6e28 2929 202f 2028 6473   ds.min()) / (ds
+00018d90: 2e6d 6178 2829 202d 2064 732e 6d69 6e28  .max() - ds.min(
+00018da0: 2929 0d0a 0d0a 0d0a 2323 2323 2323 2323  ))......########
+00018db0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00018dc0: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
+00018dd0: 204a 5553 5420 4c45 4153 5420 5351 5541   JUST LEAST SQUA
+00018de0: 5245 5320 554e 4956 4152 4941 5445 0d0a  RES UNIVARIATE..
+00018df0: 2320 6874 7470 733a 2f2f 7374 6163 6b6f  # https://stacko
+00018e00: 7665 7266 6c6f 772e 636f 6d2f 7175 6573  verflow.com/ques
+00018e10: 7469 6f6e 732f 3137 3637 3931 3430 2f6d  tions/17679140/m
+00018e20: 756c 7469 706c 652d 6c69 6e65 6172 2d72  ultiple-linear-r
+00018e30: 6567 7265 7373 696f 6e2d 7769 7468 2d70  egression-with-p
+00018e40: 7974 686f 6e0d 0a0d 0a0d 0a64 6566 206c  ython......def l
+00018e50: 7374 7371 5f73 6f6c 7665 2858 2c20 792c  stsq_solve(X, y,
+00018e60: 206c 616d 623d 312c 2069 6465 6e74 6974   lamb=1, identit
+00018e70: 795f 6d61 7472 6978 3d4e 6f6e 6529 3a0d  y_matrix=None):.
+00018e80: 0a20 2020 2069 6620 6964 656e 7469 7479  .    if identity
+00018e90: 5f6d 6174 7269 7820 6973 204e 6f6e 653a  _matrix is None:
+00018ea0: 0d0a 2020 2020 2020 2020 6964 656e 7469  ..        identi
+00018eb0: 7479 5f6d 6174 7269 7820 3d20 6e70 2e7a  ty_matrix = np.z
+00018ec0: 6572 6f73 2828 582e 7368 6170 655b 315d  eros((X.shape[1]
+00018ed0: 2c20 582e 7368 6170 655b 315d 2929 0d0a  , X.shape[1]))..
+00018ee0: 2020 2020 2020 2020 6e70 2e66 696c 6c5f          np.fill_
+00018ef0: 6469 6167 6f6e 616c 2869 6465 6e74 6974  diagonal(identit
+00018f00: 795f 6d61 7472 6978 2c20 3129 0d0a 2020  y_matrix, 1)..  
+00018f10: 2020 2020 2020 6964 656e 7469 7479 5f6d        identity_m
+00018f20: 6174 7269 785b 302c 2030 5d20 3d20 300d  atrix[0, 0] = 0.
+00018f30: 0a20 2020 2058 7458 5f6c 616d 6220 3d20  .    XtX_lamb = 
+00018f40: 582e 542e 646f 7428 5829 202b 206c 616d  X.T.dot(X) + lam
+00018f50: 6220 2a20 6964 656e 7469 7479 5f6d 6174  b * identity_mat
+00018f60: 7269 780d 0a20 2020 2058 7459 203d 2058  rix..    XtY = X
+00018f70: 2e54 2e64 6f74 2879 290d 0a20 2020 2072  .T.dot(y)..    r
+00018f80: 6574 7572 6e20 6e70 2e6c 696e 616c 672e  eturn np.linalg.
+00018f90: 736f 6c76 6528 5874 585f 6c61 6d62 2c20  solve(XtX_lamb, 
+00018fa0: 5874 5929 0d0a 0d0a 0d0a 6465 6620 636f  XtY)......def co
+00018fb0: 7374 5f66 756e 6374 696f 6e5f 6c31 2870  st_function_l1(p
+00018fc0: 6172 616d 732c 2058 2c20 7929 3a0d 0a20  arams, X, y):.. 
+00018fd0: 2020 2072 6574 7572 6e20 6e70 2e73 756d     return np.sum
+00018fe0: 286e 702e 6162 7328 7920 2d20 6e70 2e64  (np.abs(y - np.d
+00018ff0: 6f74 2858 2c20 7061 7261 6d73 2e72 6573  ot(X, params.res
+00019000: 6861 7065 2858 2e73 6861 7065 5b31 5d2c  hape(X.shape[1],
+00019010: 2079 2e73 6861 7065 5b31 5d29 2929 290d   y.shape[1])))).
+00019020: 0a0d 0a0d 0a64 6566 2063 6f73 745f 6675  .....def cost_fu
+00019030: 6e63 7469 6f6e 5f6c 315f 706f 7369 7469  nction_l1_positi
+00019040: 7665 2870 6172 616d 732c 2058 2c20 7929  ve(params, X, y)
+00019050: 3a0d 0a20 2020 2072 6574 7572 6e20 6e70  :..    return np
+00019060: 2e73 756d 280d 0a20 2020 2020 2020 206e  .sum(..        n
+00019070: 702e 6162 7328 0d0a 2020 2020 2020 2020  p.abs(..        
+00019080: 2020 2020 790d 0a20 2020 2020 2020 2020      y..         
+00019090: 2020 202d 206e 702e 646f 7428 582c 206e     - np.dot(X, n
+000190a0: 702e 7768 6572 6528 7061 7261 6d73 203c  p.where(params <
+000190b0: 2030 2c20 302c 2070 6172 616d 7329 2e72   0, 0, params).r
+000190c0: 6573 6861 7065 2858 2e73 6861 7065 5b31  eshape(X.shape[1
+000190d0: 5d2c 2079 2e73 6861 7065 5b31 5d29 290d  ], y.shape[1])).
+000190e0: 0a20 2020 2020 2020 2029 0d0a 2020 2020  .        )..    
+000190f0: 290d 0a0d 0a0d 0a23 2061 6374 7561 6c6c  )......# actuall
+00019100: 7920 7468 6973 2069 7320 6d6f 7265 206c  y this is more l
+00019110: 696b 6520 4d41 4445 0d0a 6465 6620 636f  ike MADE..def co
+00019120: 7374 5f66 756e 6374 696f 6e5f 6477 6165  st_function_dwae
+00019130: 2870 6172 616d 732c 2058 2c20 7929 3a0d  (params, X, y):.
+00019140: 0a20 2020 2041 203d 2079 0d0a 2020 2020  .    A = y..    
+00019150: 4620 3d20 6e70 2e64 6f74 2858 2c20 7061  F = np.dot(X, pa
+00019160: 7261 6d73 2e72 6573 6861 7065 2858 2e73  rams.reshape(X.s
+00019170: 6861 7065 5b31 5d2c 2079 2e73 6861 7065  hape[1], y.shape
+00019180: 5b31 5d29 290d 0a20 2020 206c 6173 745f  [1]))..    last_
+00019190: 6f66 5f61 7272 6179 203d 2079 5b5b 305d  of_array = y[[0]
+000191a0: 202b 206c 6973 7428 7261 6e67 6528 6c65   + list(range(le
+000191b0: 6e28 7929 202d 2031 2929 5d0d 0a20 2020  n(y) - 1))]..   
+000191c0: 2072 6574 7572 6e20 6e70 2e73 756d 280d   return np.sum(.
+000191d0: 0a20 2020 2020 2020 206e 702e 6e61 6e6d  .        np.nanm
+000191e0: 6561 6e28 0d0a 2020 2020 2020 2020 2020  ean(..          
+000191f0: 2020 6e70 2e77 6865 7265 280d 0a20 2020    np.where(..   
+00019200: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00019210: 7369 676e 2846 202d 206c 6173 745f 6f66  sign(F - last_of
+00019220: 5f61 7272 6179 2920 3d3d 206e 702e 7369  _array) == np.si
+00019230: 676e 2841 202d 206c 6173 745f 6f66 5f61  gn(A - last_of_a
+00019240: 7272 6179 292c 0d0a 2020 2020 2020 2020  rray),..        
+00019250: 2020 2020 2020 2020 6e70 2e61 6273 2841          np.abs(A
+00019260: 202d 2046 292c 0d0a 2020 2020 2020 2020   - F),..        
+00019270: 2020 2020 2020 2020 286e 702e 6162 7328          (np.abs(
+00019280: 4120 2d20 4629 202b 2031 2920 2a2a 2032  A - F) + 1) ** 2
+00019290: 2c0d 0a20 2020 2020 2020 2020 2020 2029  ,..            )
+000192a0: 2c0d 0a20 2020 2020 2020 2020 2020 2061  ,..            a
+000192b0: 7869 733d 302c 0d0a 2020 2020 2020 2020  xis=0,..        
+000192c0: 290d 0a20 2020 2029 0d0a 0d0a 0d0a 6465  )..    )......de
+000192d0: 6620 636f 7374 5f66 756e 6374 696f 6e5f  f cost_function_
+000192e0: 7175 616e 7469 6c65 2870 6172 616d 732c  quantile(params,
+000192f0: 2058 2c20 792c 2071 3d30 2e39 293a 0d0a   X, y, q=0.9):..
+00019300: 2020 2020 6375 7420 3d20 696e 7428 792e      cut = int(y.
+00019310: 7368 6170 655b 305d 202a 2071 290d 0a20  shape[0] * q).. 
+00019320: 2020 2072 6574 7572 6e20 6e70 2e73 756d     return np.sum
+00019330: 280d 0a20 2020 2020 2020 206e 702e 7061  (..        np.pa
+00019340: 7274 6974 696f 6e28 0d0a 2020 2020 2020  rtition(..      
+00019350: 2020 2020 2020 6e70 2e61 6273 2879 202d        np.abs(y -
+00019360: 206e 702e 646f 7428 582c 2070 6172 616d   np.dot(X, param
+00019370: 732e 7265 7368 6170 6528 582e 7368 6170  s.reshape(X.shap
+00019380: 655b 315d 2c20 792e 7368 6170 655b 315d  e[1], y.shape[1]
+00019390: 2929 292c 2063 7574 2c20 6178 6973 3d30  ))), cut, axis=0
+000193a0: 0d0a 2020 2020 2020 2020 295b 303a 6375  ..        )[0:cu
+000193b0: 745d 0d0a 2020 2020 290d 0a0d 0a0d 0a64  t]..    )......d
+000193c0: 6566 2063 6f73 745f 6675 6e63 7469 6f6e  ef cost_function
+000193d0: 5f6c 3228 7061 7261 6d73 2c20 582c 2079  _l2(params, X, y
+000193e0: 293a 0d0a 2020 2020 7265 7475 726e 206e  ):..    return n
+000193f0: 702e 6c69 6e61 6c67 2e6e 6f72 6d28 7920  p.linalg.norm(y 
+00019400: 2d20 6e70 2e64 6f74 2858 2c20 7061 7261  - np.dot(X, para
+00019410: 6d73 2e72 6573 6861 7065 2858 2e73 6861  ms.reshape(X.sha
+00019420: 7065 5b31 5d2c 2079 2e73 6861 7065 5b31  pe[1], y.shape[1
+00019430: 5d29 2929 0d0a 0d0a 0d0a 2320 636f 756c  ])))......# coul
+00019440: 6420 646f 2070 6172 7469 616c 2070 6f6f  d do partial poo
+00019450: 6c69 6e67 2062 7920 6d69 6e69 6d69 7a69  ling by minimizi
+00019460: 6e67 2061 2066 756e 6374 696f 6e20 7468  ng a function th
+00019470: 6174 206d 6978 6573 2073 6861 7265 6420  at mixes shared 
+00019480: 616e 6420 756e 7368 6172 6564 2063 6f65  and unshared coe
+00019490: 6666 6963 6965 6e74 7320 286d 756c 7469  fficients (multi
+000194a0: 706c 6963 6174 6976 6529 0d0a 6465 6620  plicative)..def 
+000194b0: 6c73 7473 715f 6d69 6e69 6d69 7a65 2858  lstsq_minimize(X
+000194c0: 2c20 792c 206d 6178 6974 6572 3d31 3530  , y, maxiter=150
+000194d0: 3030 2c20 636f 7374 5f66 756e 6374 696f  00, cost_functio
+000194e0: 6e3d 226c 3122 293a 0d0a 2020 2020 2222  n="l1"):..    ""
+000194f0: 2241 6e79 2063 6f73 7420 6675 6e63 7469  "Any cost functi
+00019500: 6f6e 2076 6572 7369 6f6e 206f 6620 6c69  on version of li
+00019510: 6e20 7265 672e 2222 220d 0a20 2020 2023  n reg."""..    #
+00019520: 2073 7461 7274 2077 6974 6820 6c73 7473   start with lsts
+00019530: 7120 6669 7420 6173 2065 7374 696d 6174  q fit as estimat
+00019540: 6564 2070 6f69 6e74 0d0a 2020 2020 7830  ed point..    x0
+00019550: 203d 206c 7374 7371 5f73 6f6c 7665 2858   = lstsq_solve(X
+00019560: 2c20 7929 2e66 6c61 7474 656e 2829 0d0a  , y).flatten()..
+00019570: 2020 2020 2320 6173 7375 6d69 6e67 2073      # assuming s
+00019580: 6361 6c65 642c 2074 6865 7365 2073 686f  caled, these sho
+00019590: 756c 6420 6265 2072 6561 736f 6e61 626c  uld be reasonabl
+000195a0: 6520 626f 756e 6473 0d0a 2020 2020 626f  e bounds..    bo
+000195b0: 756e 6473 203d 205b 282d 3130 2c20 3130  unds = [(-10, 10
+000195c0: 2920 666f 7220 7820 696e 2078 305d 0d0a  ) for x in x0]..
+000195d0: 2020 2020 6966 2063 6f73 745f 6675 6e63      if cost_func
+000195e0: 7469 6f6e 203d 3d20 2264 7761 6522 3a0d  tion == "dwae":.
+000195f0: 0a20 2020 2020 2020 2062 6f75 6e64 7320  .        bounds 
+00019600: 3d20 5b28 2d30 2e35 2c20 3130 2920 666f  = [(-0.5, 10) fo
+00019610: 7220 7820 696e 2078 305d 0d0a 2020 2020  r x in x0]..    
+00019620: 2020 2020 636f 7374 5f66 756e 6320 3d20      cost_func = 
+00019630: 636f 7374 5f66 756e 6374 696f 6e5f 6477  cost_function_dw
+00019640: 6165 0d0a 2020 2020 656c 6966 2063 6f73  ae..    elif cos
+00019650: 745f 6675 6e63 7469 6f6e 203d 3d20 2271  t_function == "q
+00019660: 7561 6e74 696c 6522 3a0d 0a20 2020 2020  uantile":..     
+00019670: 2020 2063 6f73 745f 6675 6e63 203d 2063     cost_func = c
+00019680: 6f73 745f 6675 6e63 7469 6f6e 5f71 7561  ost_function_qua
+00019690: 6e74 696c 650d 0a20 2020 2065 6c69 6620  ntile..    elif 
+000196a0: 636f 7374 5f66 756e 6374 696f 6e20 3d3d  cost_function ==
+000196b0: 2022 6c31 5f70 6f73 6974 6976 6522 3a0d   "l1_positive":.
+000196c0: 0a20 2020 2020 2020 2062 6f75 6e64 7320  .        bounds 
+000196d0: 3d20 5b28 302c 2031 3029 2066 6f72 2078  = [(0, 10) for x
+000196e0: 2069 6e20 7830 5d0d 0a20 2020 2020 2020   in x0]..       
+000196f0: 2063 6f73 745f 6675 6e63 203d 2063 6f73   cost_func = cos
+00019700: 745f 6675 6e63 7469 6f6e 5f6c 310d 0a20  t_function_l1.. 
+00019710: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00019720: 2020 636f 7374 5f66 756e 6320 3d20 636f    cost_func = co
+00019730: 7374 5f66 756e 6374 696f 6e5f 6c31 0d0a  st_function_l1..
+00019740: 2020 2020 7265 7475 726e 206d 696e 696d      return minim
+00019750: 697a 6528 0d0a 2020 2020 2020 2020 636f  ize(..        co
+00019760: 7374 5f66 756e 632c 2078 302c 2061 7267  st_func, x0, arg
+00019770: 733d 2858 2c20 7929 2c20 626f 756e 6473  s=(X, y), bounds
+00019780: 3d62 6f75 6e64 732c 206f 7074 696f 6e73  =bounds, options
+00019790: 3d7b 276d 6178 6974 6572 273a 206d 6178  ={'maxiter': max
+000197a0: 6974 6572 7d0d 0a20 2020 2029 2e78 2e72  iter}..    ).x.r
+000197b0: 6573 6861 7065 2858 2e73 6861 7065 5b31  eshape(X.shape[1
+000197c0: 5d2c 2079 2e73 6861 7065 5b31 5d29 0d0a  ], y.shape[1])..
+000197d0: 0d0a 0d0a 6465 6620 6c69 6e65 6172 5f6d  ....def linear_m
+000197e0: 6f64 656c 2878 2c20 792c 2070 6172 616d  odel(x, y, param
+000197f0: 7329 3a0d 0a20 2020 206d 6f64 656c 5f74  s):..    model_t
+00019800: 7970 6520 3d20 7061 7261 6d73 2e67 6574  ype = params.get
+00019810: 2822 6d6f 6465 6c22 2c20 226c 7374 7371  ("model", "lstsq
+00019820: 2229 0d0a 2020 2020 6c61 6d62 6420 3d20  ")..    lambd = 
+00019830: 7061 7261 6d73 2e67 6574 2822 6c61 6d62  params.get("lamb
+00019840: 6461 222c 204e 6f6e 6529 0d0a 2020 2020  da", None)..    
+00019850: 7265 6320 3d20 7061 7261 6d73 2e67 6574  rec = params.get
+00019860: 2822 7265 6365 6e63 795f 7765 6967 6874  ("recency_weight
+00019870: 696e 6722 2c20 4e6f 6e65 290d 0a20 2020  ing", None)..   
+00019880: 2069 6620 6c61 6d62 6420 6973 206e 6f74   if lambd is not
+00019890: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+000198a0: 6964 5f6d 6174 203d 206e 702e 7a65 726f  id_mat = np.zero
+000198b0: 7328 2878 2e73 6861 7065 5b31 5d2c 2078  s((x.shape[1], x
+000198c0: 2e73 6861 7065 5b31 5d29 290d 0a20 2020  .shape[1]))..   
+000198d0: 2020 2020 206e 702e 6669 6c6c 5f64 6961       np.fill_dia
+000198e0: 676f 6e61 6c28 6964 5f6d 6174 2c20 3129  gonal(id_mat, 1)
+000198f0: 0d0a 2020 2020 2020 2020 6964 5f6d 6174  ..        id_mat
+00019900: 5b30 2c20 305d 203d 2030 0d0a 2020 2020  [0, 0] = 0..    
+00019910: 6966 2072 6563 2069 7320 6e6f 7420 4e6f  if rec is not No
+00019920: 6e65 3a0d 0a20 2020 2020 2020 2077 6569  ne:..        wei
+00019930: 6768 7473 203d 2028 6e70 2e61 7261 6e67  ghts = (np.arang
+00019940: 6528 6c65 6e28 7829 2920 2b20 3129 202a  e(len(x)) + 1) *
+00019950: 2a20 7265 6320 2023 2030 2e30 3520 2d20  * rec  # 0.05 - 
+00019960: 302e 3235 0d0a 2020 2020 2020 2020 7820  0.25..        x 
+00019970: 3d20 7820 2a20 7765 6967 6874 735b 2e2e  = x * weights[..
+00019980: 2e2c 204e 6f6e 655d 0d0a 2020 2020 2020  ., None]..      
+00019990: 2020 7920 3d20 6e70 2e61 7361 7272 6179    y = np.asarray
+000199a0: 2879 2920 2a20 7765 6967 6874 735b 2e2e  (y) * weights[..
+000199b0: 2e2c 204e 6f6e 655d 0d0a 2020 2020 6966  ., None]..    if
+000199c0: 206d 6f64 656c 5f74 7970 6520 3d3d 2022   model_type == "
+000199d0: 6c73 7473 7122 3a0d 0a20 2020 2020 2020  lstsq":..       
+000199e0: 2069 6620 6c61 6d62 6420 6973 206e 6f74   if lambd is not
+000199f0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00019a00: 2020 2020 7265 7475 726e 206e 702e 6c69      return np.li
+00019a10: 6e61 6c67 2e6c 7374 7371 2878 2e54 2e64  nalg.lstsq(x.T.d
+00019a20: 6f74 2878 2920 2b20 6c61 6d62 6420 2a20  ot(x) + lambd * 
+00019a30: 6964 5f6d 6174 2c20 782e 542e 646f 7428  id_mat, x.T.dot(
+00019a40: 7929 2c20 7263 6f6e 643d 4e6f 6e65 295b  y), rcond=None)[
+00019a50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00019a60: 2020 300d 0a20 2020 2020 2020 2020 2020    0..           
+00019a70: 205d 0d0a 2020 2020 2020 2020 656c 7365   ]..        else
+00019a80: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00019a90: 6574 7572 6e20 6e70 2e6c 696e 616c 672e  eturn np.linalg.
+00019aa0: 6c73 7473 7128 782c 2079 2c20 7263 6f6e  lstsq(x, y, rcon
+00019ab0: 643d 4e6f 6e65 295b 305d 0d0a 2020 2020  d=None)[0]..    
+00019ac0: 656c 6966 206d 6f64 656c 5f74 7970 6520  elif model_type 
+00019ad0: 3d3d 2022 6c69 6e61 6c67 5f73 6f6c 7665  == "linalg_solve
+00019ae0: 223a 0d0a 2020 2020 2020 2020 7265 7475  ":..        retu
+00019af0: 726e 206c 7374 7371 5f73 6f6c 7665 2878  rn lstsq_solve(x
+00019b00: 2c20 792c 206c 616d 623d 6c61 6d62 642c  , y, lamb=lambd,
+00019b10: 2069 6465 6e74 6974 795f 6d61 7472 6978   identity_matrix
+00019b20: 3d69 645f 6d61 7429 0d0a 2020 2020 656c  =id_mat)..    el
+00019b30: 6966 206d 6f64 656c 5f74 7970 6520 3d3d  if model_type ==
+00019b40: 2022 6c31 5f6e 6f72 6d22 3a0d 0a20 2020   "l1_norm":..   
+00019b50: 2020 2020 2072 6574 7572 6e20 6c73 7473       return lsts
+00019b60: 715f 6d69 6e69 6d69 7a65 280d 0a20 2020  q_minimize(..   
+00019b70: 2020 2020 2020 2020 206e 702e 6173 6172           np.asar
+00019b80: 7261 7928 7829 2c0d 0a20 2020 2020 2020  ray(x),..       
+00019b90: 2020 2020 206e 702e 6173 6172 7261 7928       np.asarray(
+00019ba0: 7929 2c0d 0a20 2020 2020 2020 2020 2020  y),..           
+00019bb0: 206d 6178 6974 6572 3d70 6172 616d 732e   maxiter=params.
+00019bc0: 6765 7428 226d 6178 6974 6572 222c 2031  get("maxiter", 1
+00019bd0: 3530 3030 292c 0d0a 2020 2020 2020 2020  5000),..        
+00019be0: 2020 2020 636f 7374 5f66 756e 6374 696f      cost_functio
+00019bf0: 6e3d 226c 3122 2c0d 0a20 2020 2020 2020  n="l1",..       
+00019c00: 2029 0d0a 2020 2020 656c 6966 206d 6f64   )..    elif mod
+00019c10: 656c 5f74 7970 6520 3d3d 2022 7175 616e  el_type == "quan
+00019c20: 7469 6c65 5f6e 6f72 6d22 3a0d 0a20 2020  tile_norm":..   
+00019c30: 2020 2020 2072 6574 7572 6e20 6c73 7473       return lsts
+00019c40: 715f 6d69 6e69 6d69 7a65 280d 0a20 2020  q_minimize(..   
+00019c50: 2020 2020 2020 2020 206e 702e 6173 6172           np.asar
+00019c60: 7261 7928 7829 2c0d 0a20 2020 2020 2020  ray(x),..       
+00019c70: 2020 2020 206e 702e 6173 6172 7261 7928       np.asarray(
+00019c80: 7929 2c0d 0a20 2020 2020 2020 2020 2020  y),..           
+00019c90: 206d 6178 6974 6572 3d70 6172 616d 732e   maxiter=params.
+00019ca0: 6765 7428 226d 6178 6974 6572 222c 2031  get("maxiter", 1
+00019cb0: 3530 3030 292c 0d0a 2020 2020 2020 2020  5000),..        
+00019cc0: 2020 2020 636f 7374 5f66 756e 6374 696f      cost_functio
+00019cd0: 6e3d 2271 7561 6e74 696c 6522 2c0d 0a20  n="quantile",.. 
+00019ce0: 2020 2020 2020 2029 0d0a 2020 2020 656c         )..    el
+00019cf0: 6966 206d 6f64 656c 5f74 7970 6520 3d3d  if model_type ==
+00019d00: 2022 6477 6165 5f6e 6f72 6d22 3a0d 0a20   "dwae_norm":.. 
+00019d10: 2020 2020 2020 2072 6574 7572 6e20 6c73         return ls
+00019d20: 7473 715f 6d69 6e69 6d69 7a65 280d 0a20  tsq_minimize(.. 
+00019d30: 2020 2020 2020 2020 2020 206e 702e 6173             np.as
+00019d40: 6172 7261 7928 7829 2c0d 0a20 2020 2020  array(x),..     
+00019d50: 2020 2020 2020 206e 702e 6173 6172 7261         np.asarra
+00019d60: 7928 7929 2c0d 0a20 2020 2020 2020 2020  y(y),..         
+00019d70: 2020 206d 6178 6974 6572 3d70 6172 616d     maxiter=param
+00019d80: 732e 6765 7428 226d 6178 6974 6572 222c  s.get("maxiter",
+00019d90: 2031 3530 3030 292c 0d0a 2020 2020 2020   15000),..      
+00019da0: 2020 2020 2020 636f 7374 5f66 756e 6374        cost_funct
+00019db0: 696f 6e3d 2264 7761 6522 2c0d 0a20 2020  ion="dwae",..   
+00019dc0: 2020 2020 2029 0d0a 2020 2020 656c 6966       )..    elif
+00019dd0: 206d 6f64 656c 5f74 7970 6520 3d3d 2022   model_type == "
+00019de0: 6c31 5f70 6f73 6974 6976 6522 3a0d 0a20  l1_positive":.. 
+00019df0: 2020 2020 2020 2072 6574 7572 6e20 6c73         return ls
+00019e00: 7473 715f 6d69 6e69 6d69 7a65 280d 0a20  tsq_minimize(.. 
+00019e10: 2020 2020 2020 2020 2020 206e 702e 6173             np.as
+00019e20: 6172 7261 7928 7829 2c0d 0a20 2020 2020  array(x),..     
+00019e30: 2020 2020 2020 206e 702e 6173 6172 7261         np.asarra
+00019e40: 7928 7929 2c0d 0a20 2020 2020 2020 2020  y(y),..         
+00019e50: 2020 206d 6178 6974 6572 3d70 6172 616d     maxiter=param
+00019e60: 732e 6765 7428 226d 6178 6974 6572 222c  s.get("maxiter",
+00019e70: 2031 3530 3030 292c 0d0a 2020 2020 2020   15000),..      
+00019e80: 2020 2020 2020 636f 7374 5f66 756e 6374        cost_funct
+00019e90: 696f 6e3d 226c 315f 706f 7369 7469 7665  ion="l1_positive
+00019ea0: 222c 0d0a 2020 2020 2020 2020 290d 0a20  ",..        ).. 
+00019eb0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00019ec0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00019ed0: 6f72 2822 6c69 6e65 6172 206d 6f64 656c  or("linear model
+00019ee0: 206e 6f74 2072 6563 6f67 6e69 7a65 6422   not recognized"
+00019ef0: 290d 0a0d 0a0d 0a23 2053 6561 736f 6e61  )......# Seasona
+00019f00: 6c69 7469 6573 0d0a 2320 696e 7465 7261  lities..# intera
+00019f10: 6374 696f 6e20 6566 6665 6374 206f 6e6c  ction effect onl
+00019f20: 7920 6f6e 2066 6972 7374 2074 776f 2073  y on first two s
+00019f30: 6561 736f 6e61 6c69 7469 6573 2069 6620  easonalities if 
+00019f40: 6f72 6465 7220 6d61 7463 6865 730d 0a0d  order matches...
+00019f50: 0a23 2043 6174 6567 6f72 6963 616c 2046  .# Categorical F
+00019f60: 6561 7475 7265 730d 0a23 2028 6d75 6c74  eatures..# (mult
+00019f70: 6976 6172 6961 7465 2073 756d 6d61 7269  ivariate summari
+00019f80: 6573 2062 7920 6772 6f75 7029 0d0a 0d0a  es by group)....
+00019f90: 2320 7061 7374 2069 6d70 6163 7473 2028  # past impacts (
+00019fa0: 6f70 7469 6f6e 2074 6f20 6e6f 7420 656e  option to not en
+00019fb0: 666f 7263 652c 206f 6e6c 7920 7368 6f77  force, only show
+00019fc0: 290d 0a0d 0a23 2077 6861 7420 6973 2073  )....# what is s
+00019fd0: 7469 6c6c 206e 6565 6465 643a 0d0a 2320  till needed:..# 
+00019fe0: 6261 7965 7369 616e 206c 696e 6561 7220  bayesian linear 
+00019ff0: 6d6f 6465 6c20 6f70 7469 6f6e 730d 0a23  model options..#
+0001a000: 206d 6f72 6520 6d75 6c74 6976 6172 6961   more multivaria
+0001a010: 7465 2073 756d 6d61 7269 6573 0d0a 2320  te summaries..# 
+0001a020: 6164 6420 616e 6f6d 616c 7920 636c 6173  add anomaly clas
+0001a030: 7369 6669 6572 2074 6f20 666f 7265 6361  sifier to foreca
+0001a040: 7374 0d0a 2320 7265 6669 6e65 2074 7261  st..# refine tra
+0001a050: 6e73 666f 726d 6174 696f 6e73 2061 6e64  nsformations and
+0001a060: 206d 6f64 656c 7320 6765 6e65 7261 7465   models generate
+0001a070: 6420 6279 2067 6574 5f6e 6577 5f70 6172  d by get_new_par
+0001a080: 616d 730d 0a23 2072 6577 6569 6768 7420  ams..# reweight 
+0001a090: 736f 206c 6f6f 7020 6973 206e 6f74 2072  so loop is not r
+0001a0a0: 6571 7569 7265 6420 736f 206f 6674 656e  equired so often
+0001a0b0: 0d0a 2320 7465 7374 2061 6e64 2062 7567  ..# test and bug
+0001a0c0: 2066 6978 2065 7665 7279 7468 696e 670d   fix everything.
+0001a0d0: 0a23 206c 315f 6e6f 726d 2069 736e 2774  .# l1_norm isn't
+0001a0e0: 2077 6f72 6b69 6e67 0d0a 2320 756e 6974   working..# unit
+0001a0f0: 7465 7374 730d 0a0d 0a23 2054 4553 540d  tests....# TEST.
+0001a100: 0a23 206e 6577 5f64 660d 0a0d 0a23 2063  .# new_df....# c
+0001a110: 6f75 6c64 2064 6f20 7061 7274 6961 6c20  ould do partial 
+0001a120: 706f 6f6c 696e 6720 6279 206d 696e 696d  pooling by minim
+0001a130: 697a 696e 6720 6120 6675 6e63 7469 6f6e  izing a function
+0001a140: 2074 6861 7420 6d69 7865 7320 7368 6172   that mixes shar
+0001a150: 6564 2061 6e64 2075 6e73 6861 7265 6420  ed and unshared 
+0001a160: 636f 6566 6669 6369 656e 7473 2028 6d75  coefficients (mu
+0001a170: 6c74 6970 6c69 6361 7469 7665 290d 0a0d  ltiplicative)...
+0001a180: 0a23 2073 6561 7263 6820 7370 6163 653a  .# search space:
+0001a190: 0d0a 2320 6661 7374 206f 6e20 6c73 7473  ..# fast on lsts
+0001a1a0: 7173 206d 6f64 656c 0d0a 2320 6675 6c6c  qs model..# full
+0001a1b0: 2073 6561 7263 6820 6f66 2070 7265 6465   search of prede
+0001a1c0: 6669 6e65 6420 6f70 7469 6f6e 730d 0a23  fined options..#
+0001a1d0: 2073 6369 7079 206d 696e 696d 697a 6520   scipy minimize 
+0001a1e0: 666f 7220 636f 6e74 696e 756f 7573 2070  for continuous p
+0001a1f0: 6172 616d 732c 206f 7220 6d61 7962 6520  arams, or maybe 
+0001a200: 696e 7428 7061 7261 6d29 2066 6f72 2064  int(param) for d
+0001a210: 6973 6372 6574 6520 746f 6f0d 0a23 206d  iscrete too..# m
+0001a220: 696e 696d 697a 6520 776f 726b 696e 6720  inimize working 
+0001a230: 666f 7220 726f 6c6c 696e 6720 7769 6e64  for rolling wind
+0001a240: 6f77 2073 697a 6520 6275 7420 6e6f 7420  ow size but not 
+0001a250: 666f 7220 7365 6173 6f6e 616c 6974 7920  for seasonality 
+0001a260: 2861 6374 7561 6c6c 7920 7072 6f62 6162  (actually probab
+0001a270: 6c79 2077 696e 646f 7720 6973 206f 7665  ly window is ove
+0001a280: 7266 6974 290d 0a23 2064 6f20 6974 2073  rfit)..# do it s
+0001a290: 7465 7077 6973 653a 0d0a 2320 6669 7273  tepwise:..# firs
+0001a2a0: 7420 6669 7420 7365 6173 6f6e 616c 6974  t fit seasonalit
+0001a2b0: 7920 2877 6974 6820 666c 6167 2072 6567  y (with flag reg
+0001a2c0: 7265 7373 6f72 7320 6275 7420 6e6f 7420  ressors but not 
+0001a2d0: 6f74 6865 7273 290d 0a23 2073 6563 6f6e  others)..# secon
+0001a2e0: 646c 7920 7363 616c 6572 7320 616e 6420  dly scalers and 
+0001a2f0: 7072 6570 726f 6365 7373 696e 6720 414e  preprocessing AN
+0001a300: 4420 616e 6f6d 616c 7920 6465 7465 6374  D anomaly detect
+0001a310: 696f 6e20 414e 4420 686f 6c69 6461 7920  ion AND holiday 
+0001a320: 6465 7465 6374 696f 6e0d 0a23 2070 6f73  detection..# pos
+0001a330: 7369 626c 7920 6164 6420 3372 6420 7365  sibly add 3rd se
+0001a340: 6173 6f6e 616c 6974 7920 6166 7465 7220  asonality after 
+0001a350: 7072 6570 726f 6365 7373 696e 670d 0a23  preprocessing..#
+0001a360: 2074 6869 7264 6c79 2072 6f6c 6c69 6e67   thirdly rolling
+0001a370: 2077 696e 646f 7720 7369 7a65 2028 696e   window size (in
+0001a380: 636c 7564 6520 726f 6c6c 696e 6720 7769  clude rolling wi
+0001a390: 6e64 6f77 2069 6e20 696e 6974 6961 6c20  ndow in initial 
+0001a3a0: 5820 6166 7465 7220 7468 6973 290d 0a23  X after this)..#
+0001a3b0: 2074 6865 6e20 7465 7374 2075 7365 7220   then test user 
+0001a3c0: 7265 6772 6573 736f 7220 616e 6420 7072  regressor and pr
+0001a3d0: 6570 726f 6365 7373 696e 670d 0a23 2074  eprocessing..# t
+0001a3e0: 6865 6e20 7465 7374 2041 5220 6c61 6773  hen test AR lags
+0001a3f0: 2028 646f 6e27 7420 7573 6520 6966 2025   (don't use if %
+0001a400: 2067 6169 6e20 6973 203c 2078 2025 290d   gain is < x %).
+0001a410: 0a23 206f 7220 6d61 7962 6520 7573 6520  .# or maybe use 
+0001a420: 6120 7275 6e74 696d 6520 7765 6967 6874  a runtime weight
+0001a430: 696e 670d 0a23 2074 6865 6e20 6d75 6c74  ing..# then mult
+0001a440: 6976 6172 6961 7465 2073 756d 6d61 7269  ivariate summari
+0001a450: 6573 0d0a 2320 4649 4e41 4c4c 5920 636f  es..# FINALLY co
+0001a460: 7661 7269 6174 6520 6c61 6773 2028 6665  variate lags (fe
+0001a470: 6174 7572 6520 7365 6c65 6374 696f 6e20  ature selection 
+0001a480: 6465 6669 6e69 7465 6c79 206e 6565 6465  definitely neede
+0001a490: 6429 0d0a 0d0a 0d0a 6966 2046 616c 7365  d)......if False
+0001a4a0: 3a0d 0a20 2020 2023 2074 6573 7420 686f  :..    # test ho
+0001a4b0: 6c69 6461 7920 636f 756e 7472 6965 732c  liday countries,
+0001a4c0: 2072 6567 7265 7373 6f72 732c 2069 6d70   regressors, imp
+0001a4d0: 6163 7473 0d0a 2020 2020 6672 6f6d 2061  acts..    from a
+0001a4e0: 7574 6f74 7320 696d 706f 7274 206c 6f61  utots import loa
+0001a4f0: 645f 6461 696c 790d 0a20 2020 2069 6d70  d_daily..    imp
+0001a500: 6f72 7420 6d61 7470 6c6f 746c 6962 2e70  ort matplotlib.p
+0001a510: 7970 6c6f 7420 6173 2070 6c74 0d0a 0d0a  yplot as plt....
+0001a520: 2020 2020 6361 7465 676f 7269 6361 6c5f      categorical_
+0001a530: 6772 6f75 7073 203d 207b 0d0a 2020 2020  groups = {..    
+0001a540: 2020 2020 2277 696b 695f 556e 6974 6564      "wiki_United
+0001a550: 5f53 7461 7465 7322 3a20 2763 6f75 6e74  _States": 'count
+0001a560: 7279 272c 0d0a 2020 2020 2020 2020 2277  ry',..        "w
+0001a570: 696b 695f 4765 726d 616e 7922 3a20 2763  iki_Germany": 'c
+0001a580: 6f75 6e74 7279 272c 0d0a 2020 2020 2020  ountry',..      
+0001a590: 2020 2277 696b 695f 4a65 7375 7322 3a20    "wiki_Jesus": 
+0001a5a0: 2768 6f6c 6964 6179 272c 0d0a 2020 2020  'holiday',..    
+0001a5b0: 2020 2020 2277 696b 695f 4d69 6368 6165      "wiki_Michae
+0001a5c0: 6c5f 4a61 636b 736f 6e22 3a20 2770 6572  l_Jackson": 'per
+0001a5d0: 736f 6e27 2c0d 0a20 2020 2020 2020 2022  son',..        "
+0001a5e0: 7769 6b69 5f45 6173 7465 7222 3a20 2768  wiki_Easter": 'h
+0001a5f0: 6f6c 6964 6179 272c 0d0a 2020 2020 2020  oliday',..      
+0001a600: 2020 2277 696b 695f 4368 7269 7374 6d61    "wiki_Christma
+0001a610: 7322 3a20 2768 6f6c 6964 6179 272c 0d0a  s": 'holiday',..
+0001a620: 2020 2020 2020 2020 2277 696b 695f 4368          "wiki_Ch
+0001a630: 696e 6573 655f 4e65 775f 5965 6172 223a  inese_New_Year":
+0001a640: 2027 686f 6c69 6461 7927 2c0d 0a20 2020   'holiday',..   
+0001a650: 2020 2020 2022 7769 6b69 5f54 6861 6e6b       "wiki_Thank
+0001a660: 7367 6976 696e 6722 3a20 2768 6f6c 6964  sgiving": 'holid
+0001a670: 6179 272c 0d0a 2020 2020 2020 2020 2277  ay',..        "w
+0001a680: 696b 695f 456c 697a 6162 6574 685f 4949  iki_Elizabeth_II
+0001a690: 223a 2027 7065 7273 6f6e 272c 0d0a 2020  ": 'person',..  
+0001a6a0: 2020 2020 2020 2277 696b 695f 5769 6c6c        "wiki_Will
+0001a6b0: 6961 6d5f 5368 616b 6573 7065 6172 6522  iam_Shakespeare"
+0001a6c0: 3a20 2770 6572 736f 6e27 2c0d 0a20 2020  : 'person',..   
+0001a6d0: 2020 2020 2022 7769 6b69 5f47 656f 7267       "wiki_Georg
+0001a6e0: 655f 5761 7368 696e 6774 6f6e 223a 2027  e_Washington": '
+0001a6f0: 7065 7273 6f6e 272c 0d0a 2020 2020 2020  person',..      
+0001a700: 2020 2277 696b 695f 436c 656f 7061 7472    "wiki_Cleopatr
+0001a710: 6122 3a20 2770 6572 736f 6e27 2c0d 0a20  a": 'person',.. 
+0001a720: 2020 207d 0d0a 2020 2020 686f 6c69 6461     }..    holida
+0001a730: 795f 636f 756e 7472 6965 7320 3d20 7b0d  y_countries = {.
+0001a740: 0a20 2020 2020 2020 2027 7769 6b69 5f45  .        'wiki_E
+0001a750: 6c69 7a61 6265 7468 5f49 4927 3a20 2775  lizabeth_II': 'u
+0001a760: 6b27 2c0d 0a20 2020 2020 2020 2027 7769  k',..        'wi
+0001a770: 6b69 5f55 6e69 7465 645f 5374 6174 6573  ki_United_States
+0001a780: 273a 2027 7573 272c 0d0a 2020 2020 2020  ': 'us',..      
+0001a790: 2020 2777 696b 695f 4765 726d 616e 7927    'wiki_Germany'
+0001a7a0: 3a20 2764 6527 2c0d 0a20 2020 207d 0d0a  : 'de',..    }..
+0001a7b0: 2020 2020 6466 5f64 6169 6c79 203d 206c      df_daily = l
+0001a7c0: 6f61 645f 6461 696c 7928 6c6f 6e67 3d46  oad_daily(long=F
+0001a7d0: 616c 7365 290d 0a20 2020 2023 2061 6464  alse)..    # add
+0001a7e0: 206e 616e 0d0a 2020 2020 6466 5f64 6169   nan..    df_dai
+0001a7f0: 6c79 2e69 6c6f 635b 3130 302c 203a 5d20  ly.iloc[100, :] 
+0001a800: 3d20 6e70 2e6e 616e 0d0a 2020 2020 666f  = np.nan..    fo
+0001a810: 7265 6361 7374 5f6c 656e 6774 6820 3d20  recast_length = 
+0001a820: 3138 300d 0a20 2020 2069 6e63 6c75 6465  180..    include
+0001a830: 5f68 6973 746f 7279 203d 2054 7275 650d  _history = True.
+0001a840: 0a20 2020 2064 665f 7472 6169 6e20 3d20  .    df_train = 
+0001a850: 6466 5f64 6169 6c79 5b3a 2d66 6f72 6563  df_daily[:-forec
+0001a860: 6173 745f 6c65 6e67 7468 5d2e 696c 6f63  ast_length].iloc
+0001a870: 5b3a 2c20 313a 5d0d 0a20 2020 2064 665f  [:, 1:]..    df_
+0001a880: 7465 7374 203d 2064 665f 6461 696c 795b  test = df_daily[
+0001a890: 2d66 6f72 6563 6173 745f 6c65 6e67 7468  -forecast_length
+0001a8a0: 3a5d 2e69 6c6f 635b 3a2c 2031 3a5d 0d0a  :].iloc[:, 1:]..
+0001a8b0: 2020 2020 6661 6b65 5f72 6567 7220 3d20      fake_regr = 
+0001a8c0: 6466 5f64 6169 6c79 5b3a 2d66 6f72 6563  df_daily[:-forec
+0001a8d0: 6173 745f 6c65 6e67 7468 5d2e 696c 6f63  ast_length].iloc
+0001a8e0: 5b3a 2c20 303a 315d 0d0a 2020 2020 6661  [:, 0:1]..    fa
+0001a8f0: 6b65 5f72 6567 725f 6663 7374 203d 2028  ke_regr_fcst = (
+0001a900: 0d0a 2020 2020 2020 2020 6466 5f64 6169  ..        df_dai
+0001a910: 6c79 2e69 6c6f 635b 3a2c 2030 3a31 5d0d  ly.iloc[:, 0:1].
+0001a920: 0a20 2020 2020 2020 2069 6620 696e 636c  .        if incl
+0001a930: 7564 655f 6869 7374 6f72 790d 0a20 2020  ude_history..   
+0001a940: 2020 2020 2065 6c73 6520 6466 5f64 6169       else df_dai
+0001a950: 6c79 5b2d 666f 7265 6361 7374 5f6c 656e  ly[-forecast_len
+0001a960: 6774 683a 5d2e 696c 6f63 5b3a 2c20 303a  gth:].iloc[:, 0:
+0001a970: 315d 0d0a 2020 2020 290d 0a20 2020 2066  1]..    )..    f
+0001a980: 6c61 675f 7265 6772 6573 736f 7220 3d20  lag_regressor = 
+0001a990: 7064 2e44 6174 6146 7261 6d65 2831 2c20  pd.DataFrame(1, 
+0001a9a0: 696e 6465 783d 6661 6b65 5f72 6567 722e  index=fake_regr.
+0001a9b0: 696e 6465 782c 2063 6f6c 756d 6e73 3d5b  index, columns=[
+0001a9c0: 2266 6c61 675f 7465 7374 225d 290d 0a20  "flag_test"]).. 
+0001a9d0: 2020 2066 6c61 675f 7265 6772 6573 736f     flag_regresso
+0001a9e0: 725f 6663 7374 203d 2070 642e 4461 7461  r_fcst = pd.Data
+0001a9f0: 4672 616d 6528 0d0a 2020 2020 2020 2020  Frame(..        
+0001aa00: 312c 2069 6e64 6578 3d66 616b 655f 7265  1, index=fake_re
+0001aa10: 6772 5f66 6373 742e 696e 6465 782c 2063  gr_fcst.index, c
+0001aa20: 6f6c 756d 6e73 3d5b 2266 6c61 675f 7465  olumns=["flag_te
+0001aa30: 7374 225d 0d0a 2020 2020 290d 0a20 2020  st"]..    )..   
+0001aa40: 2072 6567 725f 7065 725f 7365 7269 6573   regr_per_series
+0001aa50: 203d 207b 0d0a 2020 2020 2020 2020 7374   = {..        st
+0001aa60: 7228 6466 5f74 7261 696e 2e63 6f6c 756d  r(df_train.colum
+0001aa70: 6e73 5b30 5d29 3a20 7064 2e44 6174 6146  ns[0]): pd.DataF
+0001aa80: 7261 6d65 280d 0a20 2020 2020 2020 2020  rame(..         
+0001aa90: 2020 206e 702e 7261 6e64 6f6d 2e6e 6f72     np.random.nor
+0001aaa0: 6d61 6c28 7369 7a65 3d28 6c65 6e28 6466  mal(size=(len(df
+0001aab0: 5f74 7261 696e 292c 2031 2929 2c20 696e  _train), 1)), in
+0001aac0: 6465 783d 6466 5f74 7261 696e 2e69 6e64  dex=df_train.ind
+0001aad0: 6578 0d0a 2020 2020 2020 2020 290d 0a20  ex..        ).. 
+0001aae0: 2020 207d 0d0a 2020 2020 7265 6772 5f70     }..    regr_p
+0001aaf0: 6572 5f73 6572 6965 735f 6663 7374 203d  er_series_fcst =
+0001ab00: 207b 0d0a 2020 2020 2020 2020 7374 7228   {..        str(
+0001ab10: 6466 5f74 7261 696e 2e63 6f6c 756d 6e73  df_train.columns
+0001ab20: 5b30 5d29 3a20 7064 2e44 6174 6146 7261  [0]): pd.DataFra
+0001ab30: 6d65 280d 0a20 2020 2020 2020 2020 2020  me(..           
+0001ab40: 206e 702e 7261 6e64 6f6d 2e6e 6f72 6d61   np.random.norma
+0001ab50: 6c28 7369 7a65 3d28 666f 7265 6361 7374  l(size=(forecast
+0001ab60: 5f6c 656e 6774 682c 2031 2929 2c20 696e  _length, 1)), in
+0001ab70: 6465 783d 6466 5f74 6573 742e 696e 6465  dex=df_test.inde
+0001ab80: 780d 0a20 2020 2020 2020 2029 0d0a 2020  x..        )..  
+0001ab90: 2020 7d0d 0a20 2020 2063 6f6e 7374 7261    }..    constra
+0001aba0: 696e 7420 3d20 7b0d 0a20 2020 2020 2020  int = {..       
+0001abb0: 2027 636f 6e73 7472 6169 6e74 5f6d 6574   'constraint_met
+0001abc0: 686f 6427 3a20 2771 7561 6e74 696c 6527  hod': 'quantile'
+0001abd0: 2c0d 0a20 2020 2020 2020 2027 6c6f 7765  ,..        'lowe
+0001abe0: 725f 636f 6e73 7472 6169 6e74 273a 2030  r_constraint': 0
+0001abf0: 2c0d 0a20 2020 2020 2020 2027 7570 7065  ,..        'uppe
+0001ac00: 725f 636f 6e73 7472 6169 6e74 273a 204e  r_constraint': N
+0001ac10: 6f6e 652c 0d0a 2020 2020 2020 2020 2262  one,..        "b
+0001ac20: 6f75 6e64 7322 3a20 5472 7565 2c0d 0a20  ounds": True,.. 
+0001ac30: 2020 207d 0d0a 2020 2020 7061 7374 5f69     }..    past_i
+0001ac40: 6d70 6163 7473 203d 2070 642e 4461 7461  mpacts = pd.Data
+0001ac50: 4672 616d 6528 302c 2069 6e64 6578 3d64  Frame(0, index=d
+0001ac60: 665f 7472 6169 6e2e 696e 6465 782c 2063  f_train.index, c
+0001ac70: 6f6c 756d 6e73 3d64 665f 7472 6169 6e2e  olumns=df_train.
+0001ac80: 636f 6c75 6d6e 7329 0d0a 2020 2020 7061  columns)..    pa
+0001ac90: 7374 5f69 6d70 6163 7473 2e69 6c6f 635b  st_impacts.iloc[
+0001aca0: 2d31 303a 2c20 305d 203d 206e 702e 6765  -10:, 0] = np.ge
+0001acb0: 6f6d 7370 6163 6528 312c 2031 3029 5b30  omspace(1, 10)[0
+0001acc0: 3a31 305d 202f 2031 3030 0d0a 2020 2020  :10] / 100..    
+0001acd0: 7061 7374 5f69 6d70 6163 7473 2e69 6c6f  past_impacts.ilo
+0001ace0: 635b 2d33 303a 2c20 2d31 5d20 3d20 6e70  c[-30:, -1] = np
+0001acf0: 2e6c 696e 7370 6163 6528 312c 2031 3029  .linspace(1, 10)
+0001ad00: 5b30 3a33 305d 202f 202d 3130 300d 0a20  [0:30] / -100.. 
+0001ad10: 2020 2066 7574 7572 655f 696d 7061 6374     future_impact
+0001ad20: 7320 3d20 7064 2e44 6174 6146 7261 6d65  s = pd.DataFrame
+0001ad30: 2830 2c20 696e 6465 783d 6466 5f74 6573  (0, index=df_tes
+0001ad40: 742e 696e 6465 782c 2063 6f6c 756d 6e73  t.index, columns
+0001ad50: 3d64 665f 7465 7374 2e63 6f6c 756d 6e73  =df_test.columns
+0001ad60: 290d 0a20 2020 2066 7574 7572 655f 696d  )..    future_im
+0001ad70: 7061 6374 732e 696c 6f63 5b30 3a31 302c  pacts.iloc[0:10,
+0001ad80: 2030 5d20 3d20 286e 702e 6c69 6e73 7061   0] = (np.linspa
+0001ad90: 6365 2831 2c20 3130 295b 303a 3130 5d20  ce(1, 10)[0:10] 
+0001ada0: 2b20 3130 2920 2f20 3130 300d 0a0d 0a20  + 10) / 100.... 
+0001adb0: 2020 2063 5f70 6172 616d 7320 3d20 4361     c_params = Ca
+0001adc0: 7373 616e 6472 6128 292e 6765 745f 6e65  ssandra().get_ne
+0001add0: 775f 7061 7261 6d73 2829 0d0a 0d0a 2020  w_params()....  
+0001ade0: 2020 6d6f 6420 3d20 4361 7373 616e 6472    mod = Cassandr
+0001adf0: 6128 0d0a 2020 2020 2020 2020 6e5f 6a6f  a(..        n_jo
+0001ae00: 6273 3d31 2c0d 0a20 2020 2020 2020 202a  bs=1,..        *
+0001ae10: 2a63 5f70 6172 616d 732c 0d0a 2020 2020  *c_params,..    
+0001ae20: 2020 2020 636f 6e73 7472 6169 6e74 3d63      constraint=c
+0001ae30: 6f6e 7374 7261 696e 742c 0d0a 2020 2020  onstraint,..    
+0001ae40: 2020 2020 686f 6c69 6461 795f 636f 756e      holiday_coun
+0001ae50: 7472 6965 733d 686f 6c69 6461 795f 636f  tries=holiday_co
+0001ae60: 756e 7472 6965 732c 0d0a 2020 2020 2020  untries,..      
+0001ae70: 2020 6d61 785f 6d75 6c74 6963 6f6c 696e    max_multicolin
+0001ae80: 6561 7269 7479 3d30 2e30 3030 312c 0d0a  earity=0.0001,..
+0001ae90: 2020 2020 290d 0a20 2020 206d 6f64 2e66      )..    mod.f
+0001aea0: 6974 280d 0a20 2020 2020 2020 2064 665f  it(..        df_
+0001aeb0: 7472 6169 6e2c 0d0a 2020 2020 2020 2020  train,..        
+0001aec0: 6361 7465 676f 7269 6361 6c5f 6772 6f75  categorical_grou
+0001aed0: 7073 3d63 6174 6567 6f72 6963 616c 5f67  ps=categorical_g
+0001aee0: 726f 7570 732c 0d0a 2020 2020 2020 2020  roups,..        
+0001aef0: 6675 7475 7265 5f72 6567 7265 7373 6f72  future_regressor
+0001af00: 3d66 616b 655f 7265 6772 2c0d 0a20 2020  =fake_regr,..   
+0001af10: 2020 2020 2072 6567 7265 7373 6f72 5f70       regressor_p
+0001af20: 6572 5f73 6572 6965 733d 7265 6772 5f70  er_series=regr_p
+0001af30: 6572 5f73 6572 6965 732c 0d0a 2020 2020  er_series,..    
+0001af40: 2020 2020 7061 7374 5f69 6d70 6163 7473      past_impacts
+0001af50: 3d70 6173 745f 696d 7061 6374 732c 0d0a  =past_impacts,..
+0001af60: 2020 2020 2020 2020 666c 6167 5f72 6567          flag_reg
+0001af70: 7265 7373 6f72 733d 666c 6167 5f72 6567  ressors=flag_reg
+0001af80: 7265 7373 6f72 2c0d 0a20 2020 2029 0d0a  ressor,..    )..
+0001af90: 2020 2020 7072 6564 203d 206d 6f64 2e70      pred = mod.p
+0001afa0: 7265 6469 6374 280d 0a20 2020 2020 2020  redict(..       
+0001afb0: 2066 6f72 6563 6173 745f 6c65 6e67 7468   forecast_length
+0001afc0: 3d66 6f72 6563 6173 745f 6c65 6e67 7468  =forecast_length
+0001afd0: 2c0d 0a20 2020 2020 2020 2069 6e63 6c75  ,..        inclu
+0001afe0: 6465 5f68 6973 746f 7279 3d69 6e63 6c75  de_history=inclu
+0001aff0: 6465 5f68 6973 746f 7279 2c0d 0a20 2020  de_history,..   
+0001b000: 2020 2020 2066 7574 7572 655f 7265 6772       future_regr
+0001b010: 6573 736f 723d 6661 6b65 5f72 6567 725f  essor=fake_regr_
+0001b020: 6663 7374 2c0d 0a20 2020 2020 2020 2072  fcst,..        r
+0001b030: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
+0001b040: 6965 733d 7265 6772 5f70 6572 5f73 6572  ies=regr_per_ser
+0001b050: 6965 735f 6663 7374 2c0d 0a20 2020 2020  ies_fcst,..     
+0001b060: 2020 2066 7574 7572 655f 696d 7061 6374     future_impact
+0001b070: 733d 6675 7475 7265 5f69 6d70 6163 7473  s=future_impacts
+0001b080: 2c0d 0a20 2020 2020 2020 2066 6c61 675f  ,..        flag_
+0001b090: 7265 6772 6573 736f 7273 3d66 6c61 675f  regressors=flag_
+0001b0a0: 7265 6772 6573 736f 725f 6663 7374 2c0d  regressor_fcst,.
+0001b0b0: 0a20 2020 2020 2020 2069 6e63 6c75 6465  .        include
+0001b0c0: 5f6f 7267 616e 6963 3d54 7275 652c 0d0a  _organic=True,..
+0001b0d0: 2020 2020 290d 0a20 2020 2072 6573 756c      )..    resul
+0001b0e0: 7420 3d20 7072 6564 2e66 6f72 6563 6173  t = pred.forecas
+0001b0f0: 740d 0a20 2020 2073 6572 6965 7320 3d20  t..    series = 
+0001b100: 7261 6e64 6f6d 2e63 686f 6963 6528 6d6f  random.choice(mo
+0001b110: 642e 636f 6c75 6d6e 5f6e 616d 6573 290d  d.column_names).
+0001b120: 0a20 2020 2023 2073 6572 6965 7320 3d20  .    # series = 
+0001b130: 2277 696b 695f 5065 7269 6f64 6963 5f74  "wiki_Periodic_t
+0001b140: 6162 6c65 220d 0a20 2020 2073 6572 6965  able"..    serie
+0001b150: 7320 3d20 2777 696b 695f 616c 6c27 0d0a  s = 'wiki_all'..
+0001b160: 2020 2020 6d6f 642e 7265 6772 6573 736f      mod.regresso
+0001b170: 7273 5f75 7365 640d 0a20 2020 206d 6f64  rs_used..    mod
+0001b180: 2e68 6f6c 6964 6179 5f63 6f75 6e74 7269  .holiday_countri
+0001b190: 6573 5f75 7365 640d 0a20 2020 2077 6974  es_used..    wit
+0001b1a0: 6820 706c 742e 7374 796c 652e 636f 6e74  h plt.style.cont
+0001b1b0: 6578 7428 2273 6561 626f 726e 2d77 6869  ext("seaborn-whi
+0001b1c0: 7465 2229 3a0d 0a20 2020 2020 2020 2073  te"):..        s
+0001b1d0: 7461 7274 5f64 6174 6520 3d20 2232 3031  tart_date = "201
+0001b1e0: 392d 3037 2d30 3122 0d0a 2020 2020 2020  9-07-01"..      
+0001b1f0: 2020 6d6f 642e 706c 6f74 5f66 6f72 6563    mod.plot_forec
+0001b200: 6173 7428 0d0a 2020 2020 2020 2020 2020  ast(..          
+0001b210: 2020 7072 6564 2c0d 0a20 2020 2020 2020    pred,..       
+0001b220: 2020 2020 2061 6374 7561 6c73 3d64 665f       actuals=df_
+0001b230: 6461 696c 7920 6966 2069 6e63 6c75 6465  daily if include
+0001b240: 5f68 6973 746f 7279 2065 6c73 6520 6466  _history else df
+0001b250: 5f74 6573 742c 0d0a 2020 2020 2020 2020  _test,..        
+0001b260: 2020 2020 7365 7269 6573 3d73 6572 6965      series=serie
+0001b270: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0001b280: 7374 6172 745f 6461 7465 3d73 7461 7274  start_date=start
+0001b290: 5f64 6174 652c 0d0a 2020 2020 2020 2020  _date,..        
+0001b2a0: 290d 0a0d 0a20 2020 2020 2020 2023 2070  )....        # p
+0001b2b0: 6c74 2e73 686f 7728 290d 0a20 2020 2020  lt.show()..     
+0001b2c0: 2020 2023 2070 6c74 2e73 6176 6566 6967     # plt.savefig
+0001b2d0: 2822 4361 7373 616e 6472 615f 666f 7265  ("Cassandra_fore
+0001b2e0: 6361 7374 2e70 6e67 222c 2064 7069 3d33  cast.png", dpi=3
+0001b2f0: 3030 290d 0a20 2020 2020 2020 2023 206d  00)..        # m
+0001b300: 6f64 2e70 6c6f 745f 636f 6d70 6f6e 656e  od.plot_componen
+0001b310: 7473 2870 7265 642c 2073 6572 6965 733d  ts(pred, series=
+0001b320: 7365 7269 6573 2c20 746f 5f6f 7269 6769  series, to_origi
+0001b330: 6e5f 7370 6163 653d 4661 6c73 6529 0d0a  n_space=False)..
+0001b340: 2020 2020 2020 2020 2320 706c 742e 7368          # plt.sh
+0001b350: 6f77 2829 0d0a 2020 2020 2020 2020 6d6f  ow()..        mo
+0001b360: 642e 706c 6f74 5f63 6f6d 706f 6e65 6e74  d.plot_component
+0001b370: 7328 0d0a 2020 2020 2020 2020 2020 2020  s(..            
+0001b380: 7072 6564 2c20 7365 7269 6573 3d73 6572  pred, series=ser
+0001b390: 6965 732c 2074 6f5f 6f72 6967 696e 5f73  ies, to_origin_s
+0001b3a0: 7061 6365 3d54 7275 652c 2073 7461 7274  pace=True, start
+0001b3b0: 5f64 6174 653d 7374 6172 745f 6461 7465  _date=start_date
+0001b3c0: 0d0a 2020 2020 2020 2020 290d 0a20 2020  ..        )..   
+0001b3d0: 2020 2020 2023 2070 6c74 2e73 6176 6566       # plt.savef
+0001b3e0: 6967 2822 4361 7373 616e 6472 615f 636f  ig("Cassandra_co
+0001b3f0: 6d70 6f6e 656e 7473 332e 706e 6722 2c20  mponents3.png", 
+0001b400: 6470 693d 3330 302c 2062 626f 785f 696e  dpi=300, bbox_in
+0001b410: 6368 6573 3d22 7469 6768 7422 290d 0a20  ches="tight").. 
+0001b420: 2020 2020 2020 2070 6c74 2e73 686f 7728         plt.show(
+0001b430: 290d 0a20 2020 2020 2020 206d 6f64 2e70  )..        mod.p
+0001b440: 6c6f 745f 7472 656e 6428 0d0a 2020 2020  lot_trend(..    
+0001b450: 2020 2020 2020 2020 7365 7269 6573 3d73          series=s
+0001b460: 6572 6965 732c 2076 6c69 6e65 3d72 6573  eries, vline=res
+0001b470: 756c 742e 696e 6465 785b 2d66 6f72 6563  ult.index[-forec
+0001b480: 6173 745f 6c65 6e67 7468 5d2c 2073 7461  ast_length], sta
+0001b490: 7274 5f64 6174 653d 7374 6172 745f 6461  rt_date=start_da
+0001b4a0: 7465 0d0a 2020 2020 2020 2020 290d 0a20  te..        ).. 
+0001b4b0: 2020 2020 2020 2023 2070 6c74 2e73 6176         # plt.sav
+0001b4c0: 6566 6967 2822 4361 7373 616e 6472 615f  efig("Cassandra_
+0001b4d0: 7472 656e 642e 706e 6722 2c20 6470 693d  trend.png", dpi=
+0001b4e0: 3330 302c 2062 626f 785f 696e 6368 6573  300, bbox_inches
+0001b4f0: 3d22 7469 6768 7422 290d 0a20 2020 2070  ="tight")..    p
+0001b500: 7265 642e 6576 616c 7561 7465 280d 0a20  red.evaluate(.. 
+0001b510: 2020 2020 2020 2064 665f 6461 696c 792e         df_daily.
+0001b520: 7265 696e 6465 7828 7265 7375 6c74 2e69  reindex(result.i
+0001b530: 6e64 6578 295b 6466 5f74 7261 696e 2e63  ndex)[df_train.c
+0001b540: 6f6c 756d 6e73 5d0d 0a20 2020 2020 2020  olumns]..       
+0001b550: 2069 6620 696e 636c 7564 655f 6869 7374   if include_hist
+0001b560: 6f72 790d 0a20 2020 2020 2020 2065 6c73  ory..        els
+0001b570: 6520 6466 5f74 6573 745b 6466 5f74 7261  e df_test[df_tra
+0001b580: 696e 2e63 6f6c 756d 6e73 5d0d 0a20 2020  in.columns]..   
+0001b590: 2029 0d0a 2020 2020 7072 696e 7428 7072   )..    print(pr
+0001b5a0: 6564 2e61 7667 5f6d 6574 7269 6373 2e72  ed.avg_metrics.r
+0001b5b0: 6f75 6e64 2831 2929 0d0a 0d0a 2020 2020  ound(1))....    
+0001b5c0: 2320 6966 206e 6f74 206d 6f64 2e72 6567  # if not mod.reg
+0001b5d0: 7265 7373 6f72 735f 7573 6564 3a0d 0a20  ressors_used:.. 
+0001b5e0: 2020 2064 6174 6573 203d 2064 665f 6461     dates = df_da
+0001b5f0: 696c 792e 696e 6465 782e 756e 696f 6e28  ily.index.union(
+0001b600: 0d0a 2020 2020 2020 2020 6d6f 642e 6372  ..        mod.cr
+0001b610: 6561 7465 5f66 6f72 6563 6173 745f 696e  eate_forecast_in
+0001b620: 6465 7828 666f 7265 6361 7374 5f6c 656e  dex(forecast_len
+0001b630: 6774 682c 206c 6173 745f 6461 7465 3d64  gth, last_date=d
+0001b640: 665f 6461 696c 792e 696e 6465 785b 2d31  f_daily.index[-1
+0001b650: 5d29 0d0a 2020 2020 290d 0a20 2020 2072  ])..    )..    r
+0001b660: 6567 725f 7073 203d 207b 0d0a 2020 2020  egr_ps = {..    
+0001b670: 2020 2020 2777 696b 695f 4765 726d 616e      'wiki_German
+0001b680: 7927 3a20 7265 6772 5f70 6572 5f73 6572  y': regr_per_ser
+0001b690: 6965 735f 6663 7374 5b27 7769 6b69 5f47  ies_fcst['wiki_G
+0001b6a0: 6572 6d61 6e79 275d 2e72 6569 6e64 6578  ermany'].reindex
+0001b6b0: 280d 0a20 2020 2020 2020 2020 2020 2064  (..            d
+0001b6c0: 6174 6573 2c20 6669 6c6c 5f76 616c 7565  ates, fill_value
+0001b6d0: 3d30 0d0a 2020 2020 2020 2020 290d 0a20  =0..        ).. 
+0001b6e0: 2020 207d 0d0a 2020 2020 7072 6564 3220     }..    pred2 
+0001b6f0: 3d20 6d6f 642e 7072 6564 6963 7428 0d0a  = mod.predict(..
+0001b700: 2020 2020 2020 2020 666f 7265 6361 7374          forecast
+0001b710: 5f6c 656e 6774 683d 666f 7265 6361 7374  _length=forecast
+0001b720: 5f6c 656e 6774 682c 0d0a 2020 2020 2020  _length,..      
+0001b730: 2020 696e 636c 7564 655f 6869 7374 6f72    include_histor
+0001b740: 793d 5472 7565 2c0d 0a20 2020 2020 2020  y=True,..       
+0001b750: 206e 6577 5f64 663d 6466 5f64 6169 6c79   new_df=df_daily
+0001b760: 5b64 665f 7472 6169 6e2e 636f 6c75 6d6e  [df_train.column
+0001b770: 735d 2c0d 0a20 2020 2020 2020 2066 6c61  s],..        fla
+0001b780: 675f 7265 6772 6573 736f 7273 3d66 6c61  g_regressors=fla
+0001b790: 675f 7265 6772 6573 736f 725f 6663 7374  g_regressor_fcst
+0001b7a0: 2e72 6569 6e64 6578 2864 6174 6573 2c20  .reindex(dates, 
+0001b7b0: 6669 6c6c 5f76 616c 7565 3d30 292c 0d0a  fill_value=0),..
+0001b7c0: 2020 2020 2020 2020 6675 7475 7265 5f72          future_r
+0001b7d0: 6567 7265 7373 6f72 3d66 616b 655f 7265  egressor=fake_re
+0001b7e0: 6772 5f66 6373 742e 7265 696e 6465 7828  gr_fcst.reindex(
+0001b7f0: 6461 7465 732c 2066 696c 6c5f 7661 6c75  dates, fill_valu
+0001b800: 653d 3029 2c0d 0a20 2020 2020 2020 2072  e=0),..        r
+0001b810: 6567 7265 7373 6f72 5f70 6572 5f73 6572  egressor_per_ser
+0001b820: 6965 733d 7265 6772 5f70 732c 0d0a 2020  ies=regr_ps,..  
+0001b830: 2020 290d 0a20 2020 206d 6f64 2e70 6c6f    )..    mod.plo
+0001b840: 745f 666f 7265 6361 7374 2870 7265 6432  t_forecast(pred2
+0001b850: 2c20 6163 7475 616c 733d 6466 5f64 6169  , actuals=df_dai
+0001b860: 6c79 2c20 7365 7269 6573 3d73 6572 6965  ly, series=serie
+0001b870: 732c 2073 7461 7274 5f64 6174 653d 7374  s, start_date=st
+0001b880: 6172 745f 6461 7465 290d 0a20 2020 206d  art_date)..    m
+0001b890: 6f64 2e72 6574 7572 6e5f 636f 6d70 6f6e  od.return_compon
+0001b8a0: 656e 7473 2829 0d0a 2020 2020 7072 696e  ents()..    prin
+0001b8b0: 7428 635f 7061 7261 6d73 5b27 7472 656e  t(c_params['tren
+0001b8c0: 645f 6d6f 6465 6c27 5d29 0d0a 0d0a 2320  d_model'])....# 
+0001b8d0: 4d55 4c54 4950 4c49 4341 5449 5645 2053  MULTIPLICATIVE S
+0001b8e0: 4541 534f 4e41 4c49 5459 2041 4e44 2048  EASONALITY AND H
+0001b8f0: 4f4c 4944 4159 530d 0a0d 0a23 206c 6f77  OLIDAYS....# low
+0001b900: 206d 656d 6f72 7920 6f70 7469 6f6e 2074   memory option t
+0001b910: 6f20 6465 6c65 7465 2073 746f 7265 6420  o delete stored 
+0001b920: 6466 7320 616e 6420 6172 7261 7973 2061  dfs and arrays a
+0001b930: 7320 736f 6f6e 2061 7320 706f 7373 6962  s soon as possib
+0001b940: 6c65 0d0a 0d0a 2320 4d61 6b65 2073 7572  le....# Make sur
+0001b950: 6520 7820 6665 6174 7572 6573 2061 7265  e x features are
+0001b960: 2061 6c6c 2073 6361 6c65 640d 0a23 2052   all scaled..# R
+0001b970: 656d 6f76 6520 7365 6173 6f6e 616c 6974  emove seasonalit
+0001b980: 7920 6672 6f6d 2072 6567 7265 7373 6f72  y from regressor
+0001b990: 730d 0a0d 0a23 2074 7261 6e73 6665 7220  s....# transfer 
+0001b9a0: 6c65 6172 6e69 6e67 0d0a 2320 6772 6170  learning..# grap
+0001b9b0: 6869 6373 2028 414d 464d 2077 6174 6572  hics (AMFM water
+0001b9c0: 6d61 726b 290d 0a23 2063 6f6d 7061 7265  mark)..# compare
+0001b9d0: 2061 6372 6f73 7320 7061 7374 2066 6f72   across past for
+0001b9e0: 6563 6173 7473 0d0a 2320 7374 6162 696c  ecasts..# stabil
+0001b9f0: 6974 790d 0a23 206d 616b 6520 6974 206d  ity..# make it m
+0001ba00: 6f72 6520 6d6f 6475 6c61 7220 2873 6570  ore modular (sep
+0001ba10: 6172 6174 6520 7573 6162 6c65 2066 756e  arate usable fun
+0001ba20: 6374 696f 6e73 290d 0a0d 0a23 2041 7574  ctions)....# Aut
+0001ba30: 6f6d 6174 696f 6e0d 0a23 2061 6c6c 6f77  omation..# allow
+0001ba40: 2073 6f6d 6520 636f 6e66 6967 2069 6e70   some config inp
+0001ba50: 7574 732c 206f 7220 6175 746f 6d61 7465  uts, or automate
+0001ba60: 6420 6669 740d 0a23 206f 7574 7075 7420  d fit..# output 
+0001ba70: 746f 2074 6162 6c65 0d0a 2320 636f 6d70  to table..# comp
+0001ba80: 6172 6520 636f 6566 6669 6369 656e 7473  are coefficients
+0001ba90: 2063 6861 6e67 6520 6f76 6572 2074 696d   change over tim
+0001baa0: 652c 2061 6363 7572 6163 7920 6f76 6572  e, accuracy over
+0001bab0: 2074 696d 650d 0a23 2063 6f6d 7061 7269   time..# compari
+0001bac0: 6e67 2064 6966 6665 7265 6e74 2073 6f75  ng different sou
+0001bad0: 7263 6573 3f20 616e 642f 6f72 2061 6c6c  rces? and/or all
+0001bae0: 6f77 696e 6720 6f6e 6520 666f 7265 6361  owing one foreca
+0001baf0: 7374 2074 6f20 6265 2075 7365 6420 6173  st to be used as
+0001bb00: 2061 2072 6567 7265 7373 6f72 2066 6f72   a regressor for
+0001bb10: 2061 6e6f 7468 6572 0d0a 2320 776f 756c   another..# woul
+0001bb20: 6420 616c 6c6f 7720 666f 7220 6561 726c  d allow for earl
+0001bb30: 6965 7220 6465 7465 6374 696f 6e20 6f66  ier detection of
+0001bb40: 2062 726f 6b65 6e20 636f 6e6e 6563 7469   broken connecti
+0001bb50: 6f6e 730d 0a0d 0a22 2222 0d0a 6178 203d  ons...."""..ax =
+0001bb60: 2070 7265 642e 706c 6f74 2864 665f 6461   pred.plot(df_da
+0001bb70: 696c 7920 6966 2069 6e63 6c75 6465 5f68  ily if include_h
+0001bb80: 6973 746f 7279 2065 6c73 6520 6466 5f74  istory else df_t
+0001bb90: 6573 742c 2073 6572 6965 733d 7365 7269  est, series=seri
+0001bba0: 6573 2c20 766c 696e 653d 6466 5f74 6573  es, vline=df_tes
+0001bbb0: 742e 696e 6465 785b 305d 2c20 7374 6172  t.index[0], star
+0001bbc0: 745f 6461 7465 3d73 7461 7274 5f64 6174  t_date=start_dat
+0001bbd0: 6529 0d0a 6861 6e64 6c65 732c 206c 6162  e)..handles, lab
+0001bbe0: 656c 7320 3d20 6178 2e67 6574 5f6c 6567  els = ax.get_leg
+0001bbf0: 656e 645f 6861 6e64 6c65 735f 6c61 6265  end_handles_labe
+0001bc00: 6c73 2829 0d0a 6966 206d 6f64 2e61 6e6f  ls()..if mod.ano
+0001bc10: 6d61 6c79 5f64 6574 6563 746f 723a 0d0a  maly_detector:..
+0001bc20: 2020 2020 6966 206d 6f64 2e61 6e6f 6d61      if mod.anoma
+0001bc30: 6c79 5f64 6574 6563 746f 722e 6f75 7470  ly_detector.outp
+0001bc40: 7574 203d 3d20 2275 6e69 7661 7269 6174  ut == "univariat
+0001bc50: 6522 3a0d 0a20 2020 2020 2020 2069 5f61  e":..        i_a
+0001bc60: 6e6f 6d20 3d20 6d6f 642e 616e 6f6d 616c  nom = mod.anomal
+0001bc70: 795f 6465 7465 6374 6f72 2e61 6e6f 6d61  y_detector.anoma
+0001bc80: 6c69 6573 2e69 6e64 6578 5b6d 6f64 2e61  lies.index[mod.a
+0001bc90: 6e6f 6d61 6c79 5f64 6574 6563 746f 722e  nomaly_detector.
+0001bca0: 616e 6f6d 616c 6965 732e 696c 6f63 5b3a  anomalies.iloc[:
+0001bcb0: 2c20 305d 203d 3d20 2d31 5d0d 0a20 2020  , 0] == -1]..   
+0001bcc0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0001bcd0: 7365 7269 6573 5f61 6e6f 6d20 3d20 6d6f  series_anom = mo
+0001bce0: 642e 616e 6f6d 616c 795f 6465 7465 6374  d.anomaly_detect
+0001bcf0: 6f72 2e61 6e6f 6d61 6c69 6573 5b73 6572  or.anomalies[ser
+0001bd00: 6965 735d 0d0a 2020 2020 2020 2020 695f  ies]..        i_
+0001bd10: 616e 6f6d 203d 2073 6572 6965 735f 616e  anom = series_an
+0001bd20: 6f6d 5b73 6572 6965 735f 616e 6f6d 203d  om[series_anom =
+0001bd30: 3d20 2d31 5d2e 696e 6465 780d 0a20 2020  = -1].index..   
+0001bd40: 2020 2020 2069 5f61 6e6f 6d20 3d20 695f       i_anom = i_
+0001bd50: 616e 6f6d 5b69 5f61 6e6f 6d20 3e3d 2073  anom[i_anom >= s
+0001bd60: 7461 7274 5f64 6174 655d 0d0a 2020 2020  tart_date]..    
+0001bd70: 6966 206c 656e 2869 5f61 6e6f 6d29 203e  if len(i_anom) >
+0001bd80: 2030 2061 6e64 206c 656e 2869 5f61 6e6f   0 and len(i_ano
+0001bd90: 6d29 203c 206c 656e 2864 665f 6461 696c  m) < len(df_dail
+0001bda0: 7929 202a 2030 2e35 3a0d 0a20 2020 2020  y) * 0.5:..     
+0001bdb0: 2020 2073 6361 7431 203d 2061 782e 7363     scat1 = ax.sc
+0001bdc0: 6174 7465 7228 695f 616e 6f6d 2e74 6f6c  atter(i_anom.tol
+0001bdd0: 6973 7428 292c 2064 665f 6461 696c 792e  ist(), df_daily.
+0001bde0: 6c6f 635b 695f 616e 6f6d 2c20 3a5d 5b73  loc[i_anom, :][s
+0001bdf0: 6572 6965 735d 2c20 633d 2264 6172 6b73  eries], c="darks
+0001be00: 6c61 7465 626c 7565 222c 2073 3d31 322e  lateblue", s=12.
+0001be10: 3029 0d0a 2020 2020 2020 2020 6861 6e64  0)..        hand
+0001be20: 6c65 7320 2b3d 205b 7363 6174 315d 0d0a  les += [scat1]..
+0001be30: 2020 2020 2020 2020 6c61 6265 6c73 202b          labels +
+0001be40: 3d20 5b22 616e 6f6d 616c 6965 7322 5d0d  = ["anomalies"].
+0001be50: 0a69 6620 6d6f 642e 686f 6c69 6461 795f  .if mod.holiday_
+0001be60: 6465 7465 6374 6f72 3a0d 0a20 2020 2069  detector:..    i
+0001be70: 5f61 6e6f 6d20 3d20 6d6f 642e 686f 6c69  _anom = mod.holi
+0001be80: 6461 795f 6465 7465 6374 6f72 2e64 6174  day_detector.dat
+0001be90: 6573 5f74 6f5f 686f 6c69 6461 7973 286d  es_to_holidays(m
+0001bea0: 6f64 2e64 662e 696e 6465 782c 2073 7479  od.df.index, sty
+0001beb0: 6c65 3d22 7365 7269 6573 5f66 6c61 6722  le="series_flag"
+0001bec0: 295b 7365 7269 6573 5d0d 0a20 2020 2069  )[series]..    i
+0001bed0: 5f61 6e6f 6d20 3d20 695f 616e 6f6d 2e69  _anom = i_anom.i
+0001bee0: 6e64 6578 5b69 5f61 6e6f 6d20 3d3d 2031  ndex[i_anom == 1
+0001bef0: 5d0d 0a20 2020 2069 6620 6c65 6e28 695f  ]..    if len(i_
+0001bf00: 616e 6f6d 2920 3e20 3020 616e 6420 6c65  anom) > 0 and le
+0001bf10: 6e28 695f 616e 6f6d 2920 3c20 6c65 6e28  n(i_anom) < len(
+0001bf20: 6466 5f64 6169 6c79 2920 2a20 302e 353a  df_daily) * 0.5:
+0001bf30: 0d0a 2020 2020 2020 2020 7363 6174 3220  ..        scat2 
+0001bf40: 3d20 6178 2e73 6361 7474 6572 2869 5f61  = ax.scatter(i_a
+0001bf50: 6e6f 6d2e 746f 6c69 7374 2829 2c20 6466  nom.tolist(), df
+0001bf60: 5f64 6169 6c79 2e6c 6f63 5b69 5f61 6e6f  _daily.loc[i_ano
+0001bf70: 6d2c 203a 5d5b 7365 7269 6573 5d2c 2063  m, :][series], c
+0001bf80: 3d22 6461 726b 6772 6565 6e22 2c20 733d  ="darkgreen", s=
+0001bf90: 3132 2e30 290d 0a20 2020 2020 2020 2068  12.0)..        h
+0001bfa0: 616e 646c 6573 202b 3d20 5b73 6361 7432  andles += [scat2
+0001bfb0: 5d0d 0a20 2020 2020 2020 206c 6162 656c  ]..        label
+0001bfc0: 7320 2b3d 205b 2264 6574 6563 7465 6420  s += ["detected 
+0001bfd0: 686f 6c69 6461 7973 225d 0d0a 6966 206d  holidays"]..if m
+0001bfe0: 6f64 2e74 7265 6e64 5f61 6e6f 6d61 6c79  od.trend_anomaly
+0001bff0: 5f64 6574 6563 746f 7220 6973 206e 6f74  _detector is not
+0001c000: 204e 6f6e 653a 0d0a 2020 2020 6966 206d   None:..    if m
+0001c010: 6f64 2e74 7265 6e64 5f61 6e6f 6d61 6c79  od.trend_anomaly
+0001c020: 5f64 6574 6563 746f 722e 6f75 7470 7574  _detector.output
+0001c030: 203d 3d20 2275 6e69 7661 7269 6174 6522   == "univariate"
+0001c040: 3a0d 0a20 2020 2020 2020 2069 5f61 6e6f  :..        i_ano
+0001c050: 6d20 3d20 6d6f 642e 7472 656e 645f 616e  m = mod.trend_an
+0001c060: 6f6d 616c 795f 6465 7465 6374 6f72 2e61  omaly_detector.a
+0001c070: 6e6f 6d61 6c69 6573 2e69 6e64 6578 5b6d  nomalies.index[m
+0001c080: 6f64 2e61 6e6f 6d61 6c79 5f64 6574 6563  od.anomaly_detec
+0001c090: 746f 722e 616e 6f6d 616c 6965 732e 696c  tor.anomalies.il
+0001c0a0: 6f63 5b3a 2c20 305d 203d 3d20 2d31 5d0d  oc[:, 0] == -1].
+0001c0b0: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+0001c0c0: 2020 2020 7365 7269 6573 5f61 6e6f 6d20      series_anom 
+0001c0d0: 3d20 6d6f 642e 7472 656e 645f 616e 6f6d  = mod.trend_anom
+0001c0e0: 616c 795f 6465 7465 6374 6f72 2e61 6e6f  aly_detector.ano
+0001c0f0: 6d61 6c69 6573 5b73 6572 6965 735d 0d0a  malies[series]..
+0001c100: 2020 2020 2020 2020 695f 616e 6f6d 203d          i_anom =
+0001c110: 2073 6572 6965 735f 616e 6f6d 5b73 6572   series_anom[ser
+0001c120: 6965 735f 616e 6f6d 203d 3d20 2d31 5d2e  ies_anom == -1].
+0001c130: 696e 6465 780d 0a20 2020 2069 6620 7374  index..    if st
+0001c140: 6172 745f 6461 7465 2069 7320 6e6f 7420  art_date is not 
+0001c150: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2069  None:..        i
+0001c160: 5f61 6e6f 6d20 3d20 695f 616e 6f6d 5b69  _anom = i_anom[i
+0001c170: 5f61 6e6f 6d20 3e3d 2073 7461 7274 5f64  _anom >= start_d
+0001c180: 6174 655d 0d0a 2020 2020 6966 206c 656e  ate]..    if len
+0001c190: 2869 5f61 6e6f 6d29 203e 2030 2061 6e64  (i_anom) > 0 and
+0001c1a0: 206c 656e 2869 5f61 6e6f 6d29 203c 206c   len(i_anom) < l
+0001c1b0: 656e 2864 665f 6461 696c 7929 202a 2030  en(df_daily) * 0
+0001c1c0: 2e35 3a0d 0a20 2020 2020 2020 2073 6361  .5:..        sca
+0001c1d0: 7433 203d 2061 782e 7363 6174 7465 7228  t3 = ax.scatter(
+0001c1e0: 695f 616e 6f6d 2e74 6f6c 6973 7428 292c  i_anom.tolist(),
+0001c1f0: 2064 665f 6461 696c 792e 6c6f 635b 695f   df_daily.loc[i_
+0001c200: 616e 6f6d 5d5b 7365 7269 6573 5d2c 2063  anom][series], c
+0001c210: 3d22 736c 6174 6567 7261 7922 2c20 733d  ="slategray", s=
+0001c220: 3132 2e30 290d 0a20 2020 2020 2020 2068  12.0)..        h
+0001c230: 616e 646c 6573 202b 3d20 5b73 6361 7433  andles += [scat3
+0001c240: 5d0d 0a20 2020 2020 2020 206c 6162 656c  ]..        label
+0001c250: 7320 2b3d 205b 2274 7265 6e64 2061 6e6f  s += ["trend ano
+0001c260: 6d61 6c69 6573 225d 0d0a 6178 2e6c 6567  malies"]..ax.leg
+0001c270: 656e 6428 6861 6e64 6c65 732c 206c 6162  end(handles, lab
+0001c280: 656c 7329 0d0a 2222 220d 0a              els).."""..
```

### Comparing `autots-0.5.6/autots/models/dnn.py` & `autots-0.5.7/autots/models/dnn.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/ensemble.py` & `autots-0.5.7/autots/models/ensemble.py`

 * *Files 2% similar despite different names*

```diff
@@ -1132,14 +1132,18 @@
             .drop_duplicates(
                 subset=['Model', 'ModelParameters', 'TransformationParameters']
             )
             .set_index("ID")[['Model', 'ModelParameters', 'TransformationParameters']]
         )
         nomen = 'Horizontal'
         metric = 'Score-max'
+        if len(mods_per_series) < per_series.shape[1]:
+            raise ValueError(
+                "ERROR in Horizontal Generation insufficient series created, horizontal-max"
+            )
         best5_params = {
             'Model': 'Ensemble',
             'ModelParameters': json.dumps(
                 {
                     'model_name': nomen,
                     'model_count': mods.shape[0],
                     'model_metric': metric,
@@ -1225,14 +1229,18 @@
             .drop_duplicates(
                 subset=['Model', 'ModelParameters', 'TransformationParameters']
             )
             .set_index("ID")[['Model', 'ModelParameters', 'TransformationParameters']]
         )
         nomen = 'Horizontal'
         metric = 'Score'
+        if len(mods_per_series) < per_series.shape[1]:
+            raise ValueError(
+                "ERROR in Horizontal Generation insufficient series created, horizontal"
+            )
         best5_params = {
             'Model': 'Ensemble',
             'ModelParameters': json.dumps(
                 {
                     'model_name': nomen,
                     'model_count': mods.shape[0],
                     'model_metric': metric,
@@ -1280,14 +1288,18 @@
             .drop_duplicates(
                 subset=['Model', 'ModelParameters', 'TransformationParameters']
             )
             .set_index("ID")[['Model', 'ModelParameters', 'TransformationParameters']]
         )
         nomen = 'Horizontal'
         metric = 'Score-min'
+        if len(mods_per_series) < per_series.shape[1]:
+            raise ValueError(
+                "ERROR in Horizontal Generation insufficient series created, horizontal-min"
+            )
         best5_params = {
             'Model': 'Ensemble',
             'ModelParameters': json.dumps(
                 {
                     'model_name': nomen,
                     'model_count': mods_per_series.unique().shape[0],
                     'model_metric': metric,
```

### Comparing `autots-0.5.6/autots/models/gluonts.py` & `autots-0.5.7/autots/models/gluonts.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/greykite.py` & `autots-0.5.7/autots/models/greykite.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/matrix_var.py` & `autots-0.5.7/autots/models/matrix_var.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/mlensemble.py` & `autots-0.5.7/autots/models/mlensemble.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/model_list.py` & `autots-0.5.7/autots/models/model_list.py`

 * *Files 2% similar despite different names*

```diff
@@ -8,15 +8,15 @@
     'ETS',
     'ARIMA',
     'FBProphet',
     'RollingRegression',
     'GluonTS',
     'SeasonalNaive',
     'UnobservedComponents',
-    'VARMAX',
+    # 'VARMAX',
     'VECM',
     'DynamicFactor',
     'MotifSimulation',
     'WindowRegression',
     'VAR',
     'DatepartRegression',
     "UnivariateRegression",
@@ -143,14 +143,15 @@
     'MultivariateMotif': 1,
     'Theta': 1,
     'ARDL': 1,
     'ARCH': 1,
 }
 # models that should be fast given many CPU cores
 fast_parallel = {**parallel, **fast}
+fast_parallel_no_arima = {i: fast_parallel[i] for i in fast_parallel if i != 'ARIMA'}
 # models that are explicitly not production ready
 experimental = [
     'MotifSimulation',
     'TensorflowSTS',
     'ComponentAnalysis',
     'TFPRegression',
 ]
@@ -328,14 +329,15 @@
 model_lists = {
     "all": all_models,
     "default": default,
     "fast": fast,
     "superfast": superfast,
     "parallel": parallel,
     "fast_parallel": fast_parallel,
+    "fast_parallel_no_arima": fast_parallel_no_arima,
     "probabilistic": probabilistic,
     "multivariate": multivariate,
     "univariate": univariate,
     "no_params": no_params,
     "recombination_approved": recombination_approved,
     "no_shared": no_shared,
     "no_shared_fast": no_shared_fast,
```

### Comparing `autots-0.5.6/autots/models/prophet.py` & `autots-0.5.7/autots/models/prophet.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/pytorch.py` & `autots-0.5.7/autots/models/pytorch.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/sklearn.py` & `autots-0.5.7/autots/models/sklearn.py`

 * *Files 0% similar despite different names*

```diff
@@ -199,15 +199,15 @@
 
 
 def retrieve_regressor(
     regression_model: dict = {
         "model": 'Adaboost',
         "model_params": {
             'n_estimators': 50,
-            'base_estimator': 'DecisionTree',
+            'estimator': 'DecisionTree',
             'loss': 'linear',
             'learning_rate': 1.0,
         },
     },
     verbose: int = 0,
     verbose_bool: bool = False,
     random_seed: int = 2020,
@@ -316,31 +316,31 @@
         if multioutput:
             return RegressorChain(regr)
         else:
             return regr
     elif model_class == 'Adaboost':
         from sklearn.ensemble import AdaBoostRegressor
 
-        if regression_model["model_params"]['base_estimator'] == 'SVR':
+        if regression_model["model_params"]['estimator'] == 'SVR':
             from sklearn.svm import LinearSVR
 
             svc = LinearSVR(verbose=verbose, random_state=random_seed, max_iter=1500)
             regr = AdaBoostRegressor(
-                base_estimator=svc,
+                estimator=svc,
                 n_estimators=regression_model["model_params"]['n_estimators'],
                 loss=regression_model["model_params"]['loss'],
                 learning_rate=regression_model["model_params"]['learning_rate'],
                 random_state=random_seed,
             )
-        elif regression_model["model_params"]['base_estimator'] == 'LinReg':
+        elif regression_model["model_params"]['estimator'] == 'LinReg':
             from sklearn.linear_model import LinearRegression
 
             linreg = LinearRegression()
             regr = AdaBoostRegressor(
-                base_estimator=linreg,
+                estimator=linreg,
                 n_estimators=regression_model["model_params"]['n_estimators'],
                 loss=regression_model["model_params"]['loss'],
                 learning_rate=regression_model["model_params"]['learning_rate'],
                 random_state=random_seed,
             )
         else:
             regr = AdaBoostRegressor(random_state=random_seed, **model_param_dict)
@@ -689,15 +689,15 @@
             param_dict = {
                 "model": 'Adaboost',
                 "model_params": {
                     "n_estimators": random.choices([50, 100, 500], [0.7, 0.2, 0.1])[0],
                     "loss": random.choices(
                         ['linear', 'square', 'exponential'], [0.8, 0.01, 0.1]
                     )[0],
-                    "base_estimator": random.choices(
+                    "estimator": random.choices(
                         [None, 'LinReg', 'SVR'], [0.8, 0.1, 0.1]
                     )[0],
                     "learning_rate": random.choices([1, 0.5], [0.9, 0.1])[0],
                 },
             }
         elif model == 'xgboost':
             branch = random.choices(['p1', 'p2', 'random'], [0.1, 0.4, 0.5])[0]
```

### Comparing `autots-0.5.6/autots/models/statsmodels.py` & `autots-0.5.7/autots/models/statsmodels.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/models/tfp.py` & `autots-0.5.7/autots/models/tfp.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/templates/general.py` & `autots-0.5.7/autots/templates/general.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/anomaly_utils.py` & `autots-0.5.7/autots/tools/anomaly_utils.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/calendar.py` & `autots-0.5.7/autots/tools/calendar.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/cointegration.py` & `autots-0.5.7/autots/tools/cointegration.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/cpu_count.py` & `autots-0.5.7/autots/tools/cpu_count.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/fast_kalman.py` & `autots-0.5.7/autots/tools/fast_kalman.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/hierarchial.py` & `autots-0.5.7/autots/tools/hierarchial.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/impute.py` & `autots-0.5.7/autots/tools/impute.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/lunar.py` & `autots-0.5.7/autots/tools/lunar.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/percentile.py` & `autots-0.5.7/autots/tools/percentile.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/probabilistic.py` & `autots-0.5.7/autots/tools/probabilistic.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/profile.py` & `autots-0.5.7/autots/tools/profile.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/regressor.py` & `autots-0.5.7/autots/tools/regressor.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/seasonal.py` & `autots-0.5.7/autots/tools/seasonal.py`

 * *Files 17% similar despite different names*

```diff
@@ -5,14 +5,15 @@
 @author: Colin
 """
 import random
 import numpy as np
 import pandas as pd
 from autots.tools.lunar import moon_phase
 from autots.tools.window_functions import sliding_window_view
+from autots.tools.holiday import holiday_flag
 
 
 def seasonal_int(include_one: bool = False, small=False, very_small=False):
     """Generate a random integer of typical seasonalities.
 
     Args:
         include_one (bool): whether to include 1 in output options
@@ -65,20 +66,24 @@
     "simple_binarized",
     "simple_binarized_poly",
     "expanded_binarized",
     'common_fourier',
     'common_fourier_rw',
 ]
 
+origin_ts = "2030-01-01"
+
 
 def date_part(
     DTindex,
     method: str = 'simple',
     set_index: bool = True,
     polynomial_degree: int = None,
+    holiday_country: str = None,
+    holiday_countries_used: bool = True,
 ):
     """Create date part columns from pd.DatetimeIndex.
 
     Args:
         DTindex (pd.DatetimeIndex): datetime index to provide dates
         method (str): expanded, recurring, or simple
             simple - just day, year, month, weekday
@@ -91,18 +96,32 @@
             common_fourier
         set_index (bool): if True, return DTindex as index of df
         polynomial_degree (int): add this degree of sklearn polynomial features if not None
 
     Returns:
         pd.Dataframe with DTindex
     """
-    if "_poly" in method:
+    # recursive
+    if isinstance(method, list):
+        all_seas = []
+        for seas in method:
+            all_seas.append(date_part(DTindex, method=seas, set_index=True))
+        date_part_df = pd.concat(all_seas, axis=1)
+    elif "_poly" in str(method):
         method = method.replace("_poly", "")
         polynomial_degree = 2
-    if method == 'recurring':
+
+    if isinstance(method, (int, float)):
+        date_part_df = fourier_df(DTindex, seasonality=method, order=6)
+    elif isinstance(method, list):
+        # remove duplicate columns if present
+        date_part_df = date_part_df.loc[:, ~date_part_df.columns.duplicated()]
+    elif method in datepart_components:
+        date_part_df = create_datepart_components(DTindex, method)
+    elif method == 'recurring':
         date_part_df = pd.DataFrame(
             {
                 'month': DTindex.month,
                 'day': DTindex.day,
                 'weekday': DTindex.weekday,
                 'weekend': (DTindex.weekday > 4).astype(int),
                 'hour': DTindex.hour,
@@ -203,15 +222,15 @@
             seasonal_ratio = 1  # assume daily, but weekly or monthly seems more likely for 1 step forecasts
         else:
             seasonal_ratio = ((DTmax - DTmin).days + 1) / len(DTindex)
         # seasonal_ratio = (DTmax.year - DTmin.year + 1) / len(DTindex)  # old ratio
         # hourly
         # if seasonal_ratio < 0.001:  # 0.00011 to 0.00023
         if seasonal_ratio < 0.75:  # 0.00011 to 0.00023
-            t = DTindex - pd.Timestamp("2030-01-01")
+            t = DTindex - pd.Timestamp(origin_ts)
             t = (t.days * 24) + (t.components['minutes'] / 60)
             # add hourly, weekly, yearly
             seasonal_list.append(fourier_series(t, p=8766, n=10))
             seasonal_list.append(fourier_series(t, p=24, n=3))
             seasonal_list.append(fourier_series(t, p=168, n=5))
             # interactions
             seasonal_list.append(
@@ -219,37 +238,37 @@
             )
             seasonal_list.append(
                 fourier_series(t, p=168, n=3) * fourier_series(t, p=8766, n=3)
             )
         # daily (+ business day)
         # elif seasonal_ratio < 0.012:  # 0.0027 to 0.0055
         elif seasonal_ratio < 3.5:  # 0.0027 to 0.0055
-            t = (DTindex - pd.Timestamp("2030-01-01")).days
+            t = (DTindex - pd.Timestamp(origin_ts)).days
             # add yearly and weekly seasonality
             seasonal_list.append(fourier_series(t, p=365.25, n=10))
             seasonal_list.append(fourier_series(t, p=7, n=3))
             # interaction
             seasonal_list.append(
                 fourier_series(t, p=7, n=5) * fourier_series(t, p=365.25, n=5)
             )
         # weekly
         # elif seasonal_ratio < 0.05:  # 0.019 to 0.038
         elif seasonal_ratio < 12:  # 0.019 to 0.038
-            t = (DTindex - pd.Timestamp("2030-01-01")).days
+            t = (DTindex - pd.Timestamp(origin_ts)).days
             seasonal_list.append(fourier_series(t, p=365.25, n=10))
             seasonal_list.append(fourier_series(t, p=28, n=4))
         # monthly
         # elif seasonal_ratio < 0.5:  # 0.083 to 0.154
         elif seasonal_ratio < 182:  # 0.083 to 0.154
-            t = (DTindex - pd.Timestamp("2030-01-01")).days
+            t = (DTindex - pd.Timestamp(origin_ts)).days
             seasonal_list.append(fourier_series(t, p=365.25, n=3))
             seasonal_list.append(fourier_series(t, p=1461, n=10))
         # yearly
         else:
-            t = (DTindex - pd.Timestamp("2030-01-01")).days
+            t = (DTindex - pd.Timestamp(origin_ts)).days
             seasonal_list.append(fourier_series(t, p=1461, n=10))
         date_part_df = (
             pd.DataFrame(np.concatenate(seasonal_list, axis=1))
             .rename(columns=lambda x: "seasonalitycommonfourier_" + str(x))
             .round(6)
         )
         if method == "common_fourier_rw":
@@ -287,52 +306,82 @@
                     "quarter_end": (DTindex.is_quarter_end).astype(int),
                     'year_end': (DTindex.is_year_end).astype(int),
                     'daysinmonth': DTindex.daysinmonth,
                     'epoch': pd.to_numeric(
                         DTindex, errors='coerce', downcast='integer'
                     ).values
                     - 946684800000000000,
-                    'us_election_year': (DTindex.year % 4 == 0).astype(int),
+                    'us_election_year': (DTindex.year % 4 == 0).astype(
+                        int
+                    ),  # also Olympics
                 }
             )
             date_part_df = pd.concat([date_part_df, date_part_df2], axis=1)
+
     if polynomial_degree is not None:
         from sklearn.preprocessing import PolynomialFeatures
 
         date_part_df = pd.DataFrame(
             PolynomialFeatures(polynomial_degree, include_bias=False).fit_transform(
                 date_part_df
             )
         )
         date_part_df.columns = ['dp' + str(x) for x in date_part_df.columns]
     if set_index:
         date_part_df.index = DTindex
+    if holiday_country is not None and holiday_countries_used:
+        date_part_df = pd.concat(
+            [
+                date_part_df,
+                holiday_flag(
+                    DTindex, country=holiday_country, encode_holiday_type=True
+                ),
+            ],
+            axis=1,
+            ignore_index=not set_index,
+        )
     return date_part_df
 
 
 def fourier_series(t, p=365.25, n=10):
     # 2 pi n / p
     x = 2 * np.pi * np.arange(1, n + 1) / p
     # 2 pi n / p * t
     x = x * np.asarray(t)[:, None]
     x = np.concatenate((np.cos(x), np.sin(x)), axis=1)
     return x
 
 
-def create_seasonality_feature(DTindex, t, seasonality, history_days=None):
-    # for consistency, all must have a range index, not date index
-    # fourier orders
-    if isinstance(seasonality, (int, float)):
-        if history_days is None:
-            history_days = (DTindex.max() - DTindex.min()).days
-        return pd.DataFrame(
-            fourier_series(np.asarray(t), seasonality / history_days, n=10)
-        ).rename(columns=lambda x: f"seasonality{seasonality}_" + str(x))
-    # dateparts
-    elif seasonality == "dayofweek":
+def fourier_df(DTindex, seasonality, order=10, t=None, history_days=None):
+    if history_days is None:
+        history_days = (DTindex.max() - DTindex.min()).days
+    if t is None:
+        t = (DTindex - pd.Timestamp(origin_ts)).days
+    return pd.DataFrame(
+        fourier_series(np.asarray(t), seasonality / history_days, n=order)
+    ).rename(columns=lambda x: f"seasonality{seasonality}_" + str(x))
+
+
+datepart_components = [
+    "dayofweek",
+    "month",
+    "weekend",
+    "weekdayofmonth",
+    "hour",
+    "daysinmonth",
+    "quarter",
+    "dayofyear",
+    "weekdaymonthofyear",
+    "dayofmonthofyear",
+]
+
+
+def create_datepart_components(DTindex, seasonality):
+    """single date part one-hot flags."""
+    if seasonality == "dayofweek":
         return pd.get_dummies(
             pd.Categorical(DTindex.weekday, categories=list(range(7)), ordered=True),
             dtype=np.uint8,
         ).rename(columns=lambda x: f"{seasonality}_" + str(x))
     elif seasonality == "month":
         return pd.get_dummies(
             pd.Categorical(DTindex.month, categories=list(range(1, 13)), ordered=True),
@@ -345,26 +394,84 @@
             pd.Categorical(
                 (DTindex.day - 1) // 7 + 1,
                 categories=list(range(1, 6)),
                 ordered=True,
             ),
             dtype=float,
         ).rename(columns=lambda x: f"{seasonality}_" + str(x))
+    # recommend used in combination with some combination like dayofweek and quarter
+    elif seasonality == "weekdaymonthofyear":
+        monweek = (
+            ((DTindex.day - 1) // 7 + 1).astype(str) + (DTindex.weekday).astype(str)
+        ).astype(int)
+        # because not much data for last week (week 5) of months unless many years of data
+        monweek = monweek.where(monweek <= 50, 50)
+        strs = DTindex.month.astype(str) + monweek.astype(str)
+        cat_index = pd.date_range(
+            "2020-01-01", "2021-01-01", freq='D'
+        )  # must be a leap year
+        catweek = (
+            ((cat_index.day - 1) // 7 + 1).astype(str) + (cat_index.weekday).astype(str)
+        ).astype(int)
+        catweek = catweek.where(catweek <= 50, 50)
+        cats = (cat_index.month.astype(str) + catweek.astype(str)).unique()
+        return pd.get_dummies(
+            pd.Categorical(
+                strs,
+                categories=cats,
+                ordered=False,
+            ),
+            dtype=float,
+        ).rename(columns=lambda x: f"{seasonality}_" + str(x))
+    elif seasonality == "dayofmonthofyear":
+        strs = DTindex.month.astype(str) + DTindex.day.astype(str)
+        cat_index = pd.date_range(
+            "2020-01-01", "2021-01-01", freq='D'
+        )  # must be a leap yaer
+        cats = (cat_index.month.astype(str) + cat_index.day.astype(str)).unique()
+        return pd.get_dummies(
+            pd.Categorical(
+                strs,
+                categories=cats,
+                ordered=False,
+            ),
+            dtype=float,
+        ).rename(columns=lambda x: f"{seasonality}_" + str(x))
     elif seasonality == "hour":
         return pd.get_dummies(
             pd.Categorical(DTindex.hour, categories=list(range(1, 25)), ordered=True),
             dtype=np.uint8,
         ).rename(columns=lambda x: f"{seasonality}_" + str(x))
     elif seasonality == "daysinmonth":
         return pd.DataFrame({'daysinmonth': DTindex.daysinmonth})
     elif seasonality == "quarter":
         return pd.get_dummies(
             pd.Categorical(DTindex.quarter, categories=list(range(1, 5)), ordered=True),
             dtype=np.uint8,
         ).rename(columns=lambda x: f"{seasonality}_" + str(x))
+    elif seasonality == "dayofyear":
+        return pd.get_dummies(
+            pd.Categorical(
+                DTindex.dayofyear, categories=list(range(1, 367)), ordered=True
+            ),
+            dtype=np.uint16,
+        ).rename(columns=lambda x: f"{seasonality}_" + str(x))
+
+
+def create_seasonality_feature(DTindex, t, seasonality, history_days=None):
+    """Cassandra-designed feature generator."""
+    # for consistency, all must have a range index, not date index
+    # fourier orders
+    if isinstance(seasonality, (int, float)):
+        return fourier_df(
+            DTindex, seasonality=seasonality, t=t, history_days=history_days
+        )
+    # dateparts
+    elif seasonality in datepart_components:
+        return create_datepart_components(DTindex, seasonality)
     elif seasonality in date_part_methods:
         return date_part(DTindex, method=seasonality, set_index=False)
     else:
         return ValueError(
             f"Seasonality `{seasonality}` not recognized. Must be int, float, or a select type string such as 'dayofweek'"
         )
```

### Comparing `autots-0.5.6/autots/tools/shaping.py` & `autots-0.5.7/autots/tools/shaping.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/thresholding.py` & `autots-0.5.7/autots/tools/thresholding.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/autots/tools/transform.py` & `autots-0.5.7/autots/tools/transform.py`

 * *Files 2% similar despite different names*

```diff
@@ -13,14 +13,15 @@
     anomaly_df_to_holidays,
     holiday_new_params,
     dates_to_holidays,
 )
 from autots.tools.window_functions import window_lin_reg, window_lin_reg_mean
 from autots.tools.fast_kalman import KalmanFilter, random_state_space
 from autots.tools.shaping import infer_frequency
+from autots.tools.holiday import holiday_flag
 
 try:
     from joblib import Parallel, delayed
 except Exception:
     pass
 
 
@@ -1062,36 +1063,44 @@
         self,
         regression_model: dict = {
             "model": "DecisionTree",
             "model_params": {"max_depth": 5, "min_samples_split": 2},
         },
         datepart_method: str = "expanded",
         polynomial_degree: int = None,
-        transform_dict=None,
+        transform_dict: dict = None,
+        holiday_country: list = None,
+        holiday_countries_used: bool = False,
+        n_jobs: int = 1,
         **kwargs,
     ):
         super().__init__(name="DatepartRegressionTransformer")
         self.regression_model = regression_model
         self.datepart_method = datepart_method
         self.polynomial_degree = polynomial_degree
         self.transform_dict = transform_dict
+        self.holiday_country = holiday_country
+        self.holiday_countries_used = holiday_countries_used
+        self.n_jobs = n_jobs
 
     @staticmethod
-    def get_new_params(method: str = "random"):
+    def get_new_params(method: str = "random", holiday_countries_used=None):
         datepart_choice = random.choices(
             [
                 "simple",
                 "expanded",
                 "recurring",
                 "simple_2",
                 "simple_binarized",
                 "lunar_phase",
                 "common_fourier",
+                ["dayofweek", 365.25],
+                ["weekdaymonthofyear", "quarter", "dayofweek"],
             ],
-            [0.1, 0.25, 0.2, 0.1, 0.3, 0.01, 0.1],
+            [0.1, 0.25, 0.2, 0.1, 0.3, 0.001, 0.1, 0.1, 0.03],
         )[0]
         if datepart_choice in ["simple", "simple_2", "recurring"]:
             polynomial_choice = random.choices([None, 2], [0.5, 0.2])[0]
         else:
             polynomial_choice = None
 
         if method == "all":
@@ -1113,20 +1122,23 @@
                     "MLP": 0.2,
                     "RandomForest": 0.2,
                     "ExtraTrees": 0.25,
                     "SVM": 0.1,
                     "RadiusRegressor": 0.1,
                 }
             )
+        if holiday_countries_used is None:
+            holiday_countries_used = random.choices([True, False], [0.3, 0.7])[0]
 
         return {
             "regression_model": choice,
             "datepart_method": datepart_choice,
             "polynomial_degree": polynomial_choice,
             "transform_dict": random_cleaners(),
+            "holiday_countries_used": holiday_countries_used,
         }
 
     def fit(self, df, regressor=None):
         """Fits trend for later detrending.
 
         Args:
             df (pandas.DataFrame): input dataframe
@@ -1144,28 +1156,39 @@
         if y.shape[1] == 1:
             y = np.asarray(y).ravel()
         X = date_part(
             df.index,
             method=self.datepart_method,
             polynomial_degree=self.polynomial_degree,
         )
+        if self.holiday_country is not None and self.holiday_countries_used:
+            X = pd.concat(
+                [
+                    X,
+                    holiday_flag(
+                        df.index, country=self.holiday_country, encode_holiday_type=True
+                    ),
+                ],
+                axis=1,
+            )
         if regressor is not None:
             X = pd.concat([X, regressor], axis=1)
-            self.X = X  # diagnostic
+        self.X = X  # diagnostic
         multioutput = True
         if y.ndim < 2:
             multioutput = False
         elif y.shape[1] < 2:
             multioutput = False
         self.model = retrieve_regressor(
             regression_model=self.regression_model,
             verbose=0,
             verbose_bool=False,
             random_seed=2020,
             multioutput=multioutput,
+            n_jobs=self.n_jobs,
         )
         self.model = self.model.fit(X, y)
         self.shape = df.shape
         return self
 
     def fit_transform(self, df, regressor=None):
         """Fit and Return Detrended DataFrame.
@@ -1188,14 +1211,24 @@
             raise ValueError("Data Cannot Be Converted to Numeric Float")
 
         X = date_part(
             df.index,
             method=self.datepart_method,
             polynomial_degree=self.polynomial_degree,
         )
+        if self.holiday_country is not None and self.holiday_countries_used:
+            X = pd.concat(
+                [
+                    X,
+                    holiday_flag(
+                        df.index, country=self.holiday_country, encode_holiday_type=True
+                    ),
+                ],
+                axis=1,
+            )
         if regressor is not None:
             X = pd.concat([X, regressor], axis=1)
         # X.columns = [str(xc) for xc in X.columns]
         y = pd.DataFrame(self.model.predict(X), columns=df.columns, index=df.index)
         df = df - y
         return df
 
@@ -1211,14 +1244,24 @@
             raise ValueError("Data Cannot Be Converted to Numeric Float")
 
         X = date_part(
             df.index,
             method=self.datepart_method,
             polynomial_degree=self.polynomial_degree,
         )
+        if self.holiday_country is not None and self.holiday_countries_used:
+            X = pd.concat(
+                [
+                    X,
+                    holiday_flag(
+                        df.index, country=self.holiday_country, encode_holiday_type=True
+                    ),
+                ],
+                axis=1,
+            )
         if regressor is not None:
             X = pd.concat([X, regressor], axis=1)
         y = pd.DataFrame(self.model.predict(X), columns=df.columns, index=df.index)
         df = df + y
         return df
 
 
@@ -2487,14 +2530,15 @@
     ):
         super().__init__(name="AlignLastValue")
         self.rows = rows
         self.lag = lag
         self.method = method
         self.strength = strength
         self.first_value_only = first_value_only
+        self.adjustment = None
 
     @staticmethod
     def get_new_params(method: str = "random"):
         return {
             "rows": random.choices([1, 2, 4, 7], [0.83, 0.02, 0.05, 0.1])[0],
             "lag": random.choices([1, 2, 7, 28], [0.8, 0.05, 0.1, 0.05])[0],
             "method": random.choices(["additive", "multiplicative"], [0.9, 0.1])[0],
@@ -2536,46 +2580,59 @@
         """Return changed data.
 
         Args:
             df (pandas.DataFrame): input dataframe
         """
         return df
 
-    def inverse_transform(self, df, trans_method: str = "forecast", bounds=False):
+    def inverse_transform(self, df, trans_method: str = "forecast", adjustment=None):
         """Return data to original *or* forecast form.
 
         Args:
             df (pandas.DataFrame): input dataframe
         """
-        if trans_method == "original" or bounds:
+        if self.adjustment is not None:
+            self.adjustment = adjustment
+        if trans_method == "original":
             return df
         else:
             if self.first_value_only:
                 if self.method == "multiplicative":
+                    if self.adjustment is None:
+                        self.adjustment = (
+                            1 + ((self.center / df.iloc[0]) - 1) * self.strength
+                        )
                     return pd.concat(
                         [
-                            df.iloc[0:1]
-                            * (1 + ((self.center / df.iloc[0]) - 1) * self.strength),
+                            df.iloc[0:1] * self.adjustment,
                             df.iloc[1:],
                         ],
                         axis=0,
                     )
                 else:
+                    if self.adjustment is None:
+                        self.adjustment = self.strength * (self.center - df.iloc[0])
                     return pd.concat(
                         [
-                            df.iloc[0:1] + self.strength * (self.center - df.iloc[0]),
+                            df.iloc[0:1] + adjustment,
                             df.iloc[1:],
                         ],
                         axis=0,
                     )
             else:
                 if self.method == "multiplicative":
-                    return df * (1 + ((self.center / df.iloc[0]) - 1) * self.strength)
+                    if self.adjustment is None:
+                        self.adjustment = (
+                            1 + ((self.center / df.iloc[0]) - 1) * self.strength
+                        )
+                    return df * self.adjustment
                 else:
-                    return df + self.strength * (self.center - df.iloc[0])
+                    if self.adjustment is None:
+                        self.adjustment = self.strength * (self.center - df.iloc[0])
+                    return df + self.adjustment
 
     def fit_transform(self, df):
         """Fits and Returns *Magical* DataFrame.
 
         Args:
             df (pandas.DataFrame): input dataframe
         """
@@ -2917,15 +2974,16 @@
                 'datepart_regression',
                 'regression',
             ],
             [0.1, 0.3, 0.3, 0.2, 0.2],
         )[0]
         if holiday_params['impact'] == 'datepart_regression':
             holiday_params['regression_params'] = DatepartRegression.get_new_params(
-                method=method
+                method=method,
+                holiday_countries_used=False,
             )
         else:
             holiday_params['regression_params'] = {}
         return holiday_params
 
 
 class LocalLinearTrend(EmptyTransformer):
@@ -3348,14 +3406,157 @@
         Args:
             df (pandas.DataFrame): input dataframe
         """
         self.fit(df)
         return self.transform(df)
 
 
+class RegressionFilter(EmptyTransformer):
+    """Models seasonal and local linear trend, and clips std dvs from this fit."""
+
+    def __init__(
+        self,
+        name: str = "RegressionFilter",
+        sigma: float = 2.0,
+        rolling_window: int = 90,
+        run_order: str = "season_first",
+        regression_params: dict = None,
+        holiday_params: dict = None,
+        holiday_country: str = "US",
+        **kwargs,
+    ):
+        super().__init__(name="DatepartRegressionTransformer")
+        self.sigma = sigma
+        self.rolling_window = rolling_window
+        self.run_order = run_order
+        self.regression_params = regression_params
+        self.holiday_params = holiday_params
+        self.holiday_country = holiday_country
+
+    def _fit(self, df):
+        """Learn behavior of data to change.
+
+        Args:
+            df (pandas.DataFrame): input dataframe
+        """
+        if self.holiday_params is not None:
+            self.holiday_params["regression_params"] = self.regression_params
+            self.holiday_params["impact"] = 'datepart_regression'
+            self.seasonal = HolidayTransformer(**self.holiday_params)
+        else:
+            if self.regression_params is None:
+                self.regression_params = {
+                    "regression_model": {
+                        "model": "DecisionTree",
+                        "model_params": {"max_depth": 4, "min_samples_split": 2},
+                    },
+                    "datepart_method": "common_fourier",
+                    "holiday_countries_used": True,
+                }
+            self.seasonal = DatepartRegressionTransformer(
+                **self.regression_params, holiday_country=self.holiday_country
+            )
+        self.trend = LocalLinearTrend(rolling_window=self.rolling_window)
+
+        if self.run_order == 'season_first':
+            deseason = self.seasonal.fit_transform(df)
+            result = self.trend.fit_transform(deseason)
+        else:
+            detrend = self.trend.fit_transform(df)
+            result = self.seasonal.fit_transform(detrend)
+
+        std_dev = result.std() * self.sigma
+        clipped = result.clip(upper=std_dev, lower=-1 * std_dev, axis=1)
+
+        if self.run_order == 'season_first':
+            retrend = self.trend.inverse_transform(clipped)
+            original = self.seasonal.inverse_transform(retrend)
+        else:
+            reseason = self.seasonal.inverse_transform(clipped)
+            original = self.trend.inverse_transform(reseason)
+        return original
+
+    def fit(self, df):
+        """Learn behavior of data to change.
+
+        Args:
+            df (pandas.DataFrame): input dataframe
+        """
+        self._fit(df)
+        return self
+
+    def transform(self, df):
+        """Return changed data.
+
+        Args:
+            df (pandas.DataFrame): input dataframe
+        """
+        if self.run_order == 'season_first':
+            deseason = self.seasonal.transform(df)
+            result = self.trend.transform(deseason)
+        else:
+            detrend = self.trend.transform(df)
+            result = self.seasonal.transform(detrend)
+
+        std_dev = result.std() * self.sigma
+        clipped = result.clip(upper=std_dev, lower=-1 * std_dev, axis=1)
+
+        if self.run_order == 'season_first':
+            retrend = self.trend.inverse_transform(clipped)
+            original = self.seasonal.inverse_transform(retrend)
+        else:
+            reseason = self.seasonal.inverse_transform(clipped)
+            original = self.trend.inverse_transform(reseason)
+        return original
+
+    def inverse_transform(self, df, trans_method: str = "forecast"):
+        """No changes made.
+
+        Args:
+            df (pandas.DataFrame): input dataframe
+        """
+        return df
+
+    def fit_transform(self, df):
+        """Fits and Returns *Magical* DataFrame.
+
+        Args:
+            df (pandas.DataFrame): input dataframe
+        """
+        return self._fit(df)
+
+    def __repr__(self):
+        """Print."""
+        return "Transformer " + str(self.name) + ", uses standard .fit/.transform"
+
+    @staticmethod
+    def get_new_params(method: str = "random"):
+        """Generate new random parameters"""
+        regression_params = DatepartRegressionTransformer.get_new_params(method=method)
+
+        if method == "fast":
+            holiday_trans_use = False
+        else:
+            holiday_trans_use = random.choices([True, False], [0.3, 0.7])[0]
+        if holiday_trans_use:
+            holiday_params = HolidayTransformer.get_new_params(method="fast")
+            holiday_params["regression_params"] = regression_params
+            holiday_params["impact"] = 'datepart_regression'
+        else:
+            holiday_params = None
+
+        return {
+            "sigma": random.choices([0.5, 1, 1.5, 2, 3], [0.1, 0.4, 0.1, 0.3, 0.1])[0],
+            "rolling_window": 90,
+            "run_order": random.choices(["season_first", "trend_first"], [0.7, 0.3])[0],
+            "regression_params": regression_params,
+            "holiday_params": holiday_params,
+        }
+
+
 # lookup dict for all non-parameterized transformers
 trans_dict = {
     "None": EmptyTransformer(),
     None: EmptyTransformer(),
     "RollingMean10": RollingMeanTransformer(window=10),
     "DifferencedTransformer": DifferencedTransformer(),
     "PctChangeTransformer": PctChangeTransformer(),
@@ -3390,23 +3591,22 @@
 n_jobs_trans = {
     # datepart not included for fears it will slow it down sometimes
     "SinTrend": SinTrend(),
     "SineTrend": SinTrend(),
     "AnomalyRemoval": AnomalyRemoval,
     'HolidayTransformer': HolidayTransformer,
 }
-# transformers with parameter pass through (internal only)
+# transformers with parameter pass through (internal only) MUST be here
 have_params = {
     "RollingMeanTransformer": RollingMeanTransformer,
     "SeasonalDifference": SeasonalDifference,
     "Discretize": Discretize,
     "CenterLastValue": CenterLastValue,
     "IntermittentOccurrence": IntermittentOccurrence,
     "ClipOutliers": ClipOutliers,
-    "DatepartRegression": DatepartRegression,
     "Round": Round,
     "Slice": Slice,
     "Detrend": Detrend,
     "ScipyFilter": ScipyFilter,
     "HPFilter": HPFilter,
     "STLFilter": STLFilter,
     "EWMAFilter": EWMAFilter,
@@ -3415,24 +3615,28 @@
     "BTCD": BTCD,
     "Cointegration": Cointegration,
     "AlignLastValue": AlignLastValue,
     "AnomalyRemoval": AnomalyRemoval,  # not shared as long as output is 'multivariate'
     "HolidayTransformer": HolidayTransformer,
     "LocalLinearTrend": LocalLinearTrend,
     "KalmanSmoothing": KalmanSmoothing,
+    "RegressionFilter": RegressionFilter,
+    "DatepartRegression": DatepartRegressionTransformer,
+    "DatepartRegressionTransformer": DatepartRegressionTransformer,
 }
 # where results will vary if not all series are included together
 shared_trans = [
     "PCA",
     "FastICA",
     "DatepartRegression",
     "MeanDifference",
     "BTCD",
     "Cointegration",
     "HolidayTransformer",
+    "RegressionFilter",
 ]
 # transformers not defined in AutoTS
 external_transformers = [
     "MinMaxScaler",
     "PowerTransformer",
     "QuantileTransformer",
     "MaxAbsScaler",
@@ -3492,29 +3696,30 @@
             'IntermittentOccurrence' - -1, 1 for non median values
             'SeasonalDifference' - remove the last lag values from all values
             'SeasonalDifferenceMean' - remove the average lag values from all
             'SeasonalDifference7','12','28' - non-parameterized version of Seasonal
             'CenterLastValue' - center data around tail of dataset
             'Round' - round values on inverse or transform
             'Slice' - use only recent records
-            'ClipOutliers' - remove outliers
+            'ClipOutliers' - simple remove outliers
             'Discretize' - bin or round data into groups
             'DatepartRegression' - move a trend trained on datetime index
             "ScipyFilter" - filter data (lose information but smoother!) from scipy
             "HPFilter" - statsmodels hp_filter
             "STLFilter" - seasonal decompose and keep just one part of decomposition
             "EWMAFilter" - use an exponential weighted moving average to smooth data
             "MeanDifference" - joint version of differencing
             "Cointegration" - VECM but just the vectors
             "BTCD" - Box Tiao decomposition
             'AlignLastValue': align forecast start to end of training data
             'AnomalyRemoval': more tailored anomaly removal options
             'HolidayTransformer': detects holidays and wishes good cheer to all
             'LocalLinearTrend': rolling local trend, using tails for future and past trend
             'KalmanSmoothing': smooth using a state space model
+            'RegressionFilter': fit seasonal removal and local linear trend, clip std devs away from this fit
 
         transformation_params (dict): params of transformers {0: {}, 1: {'model': 'Poisson'}, ...}
             pass through dictionary of empty dictionaries to utilize defaults
 
         random_seed (int): random state passed through where applicable
     """
 
@@ -3524,14 +3729,15 @@
         transformations: dict = {},
         transformation_params: dict = {},
         grouping: str = None,
         reconciliation: str = None,
         grouping_ids=None,
         random_seed: int = 2020,
         n_jobs: int = 1,
+        holiday_country: list = None,
     ):
         self.fillna = fillna
         self.transformations = transformations
         # handle users passing in no params
         if transformation_params is None or not transformation_params:
             keys = transformations.keys()
             transformation_params = {x: {} for x in keys}
@@ -3539,15 +3745,17 @@
 
         self.grouping = grouping
         self.reconciliation = reconciliation
         self.grouping_ids = grouping_ids
 
         self.random_seed = random_seed
         self.n_jobs = n_jobs
+        self.holiday_country = holiday_country
         self.transformers = {}
+        self.adjustments = {}
         # upper/lower forecast inverses are different
         self.bounded_oddities = ["AlignLastValue"]
         # trans methods are different
         self.oddities_list = [
             "DifferencedTransformer",
             "RollingMean100thN",
             "RollingMean10thN",
@@ -3592,14 +3800,15 @@
     def retrieve_transformer(
         self,
         transformation: str = None,
         param: dict = {},
         df=None,
         random_seed: int = 2020,
         n_jobs: int = 1,
+        holiday_country: list = None,
     ):
         """Retrieves a specific transformer object from a string.
 
         Args:
             df (pandas.DataFrame): Datetime Indexed - required to set params for some transformers
             transformation (str): name of desired method
             param (dict): dict of kwargs to pass (legacy: an actual param)
@@ -3610,34 +3819,39 @@
 
         if transformation in (trans_dict.keys()):
             return trans_dict[transformation]
 
         elif transformation in n_jobs_trans.keys():
             return n_jobs_trans[transformation](n_jobs=n_jobs, **param)
 
-        elif transformation in list(have_params.keys()):
-            return have_params[transformation](**param)
+        # these need holiday_country
+        elif transformation in ["DatepartRegression", "DatepartRegressionTransformer"]:
+            return DatepartRegression(
+                holiday_country=holiday_country, **param
+            )  # n_jobs=n_jobs,
+
+        elif transformation in ["RegressionFilter"]:
+            return RegressionFilter(
+                holiday_country=holiday_country, n_jobs=n_jobs, **param
+            )
 
         elif transformation == "MinMaxScaler":
             from sklearn.preprocessing import MinMaxScaler
 
             return MinMaxScaler()
 
         elif transformation == "PowerTransformer":
             from sklearn.preprocessing import PowerTransformer
 
-            transformer = PowerTransformer(
-                method="yeo-johnson", standardize=True, copy=True
-            )
-            return transformer
+            return PowerTransformer(method="yeo-johnson", standardize=True, copy=True)
 
         elif transformation == "QuantileTransformer":
             from sklearn.preprocessing import QuantileTransformer
 
-            quants = param["n_quantiles"]
+            quants = param.get("n_quantiles", 1000)
             if quants == "quarter":
                 quants = int(df.shape[0] / 4)
             elif quants == "fifth":
                 quants = int(df.shape[0] / 5)
             elif quants == "tenth":
                 quants = int(df.shape[0] / 10)
             else:
@@ -3662,30 +3876,28 @@
 
         elif transformation == "PCA":
             from sklearn.decomposition import PCA
 
             # could probably may it work, but this is simpler
             if df.shape[1] > df.shape[0]:
                 raise ValueError("PCA fails when n series > n observations")
-            transformer = PCA(
+            return PCA(
                 n_components=min(df.shape), whiten=False, random_state=random_seed
             )
-            return transformer
 
         elif transformation == "FastICA":
             from sklearn.decomposition import FastICA
 
-            if df.shape[1] > 500:
-                raise ValueError("FastICA fails with > 500 series")
-            transformer = FastICA(
+            if df.shape[1] > 5000:
+                raise ValueError("FastICA fails with > 5000 series for speed reasons")
+            return FastICA(
                 n_components=df.shape[1],
                 random_state=random_seed,
                 **param,
             )
-            return transformer
 
         elif transformation in ["RollingMean", "FixedRollingMean"]:
             param = 10 if param is None else param
             if not str(param).isdigit():
                 window = int("".join([s for s in str(param) if s.isdigit()]))
                 window = int(df.shape[0] / window)
             else:
@@ -3694,32 +3906,33 @@
             self.window = window
             if transformation == "FixedRollingMean":
                 transformer = RollingMeanTransformer(window=self.window, fixed=True)
             else:
                 transformer = RollingMeanTransformer(window=self.window, fixed=False)
             return transformer
 
-        elif transformation in ["SeasonalDifference", "SeasonalDifferenceMean"]:
-            if transformation == "SeasonalDifference":
-                return SeasonalDifference(lag_1=param, method="LastValue")
-            else:
-                return SeasonalDifference(lag_1=param, method="Mean")
+        elif transformation in ["SeasonalDifferenceMean"]:
+            return SeasonalDifference(lag_1=param, method="Mean")
 
         elif transformation == "RollingMean100thN":
             window = int(df.shape[0] / 100)
             window = 2 if window < 2 else window
             self.window = window
             return RollingMeanTransformer(window=self.window)
 
         elif transformation == "RollingMean10thN":
             window = int(df.shape[0] / 10)
             window = 2 if window < 2 else window
             self.window = window
             return RollingMeanTransformer(window=self.window)
 
+        # must be at bottom as it has duplicates of above inside
+        elif transformation in list(have_params.keys()):
+            return have_params[transformation](**param)
+
         else:
             print(
                 f"Transformation {transformation} not known or improperly entered, returning untransformed df"
             )
             return EmptyTransformer()
 
     def _fit(self, df):
@@ -3733,14 +3946,15 @@
                 transformation = self.transformations[i]
                 self.transformers[i] = self.retrieve_transformer(
                     transformation=transformation,
                     df=df,
                     param=self.transformation_params[i],
                     random_seed=self.random_seed,
                     n_jobs=self.n_jobs,
+                    holiday_country=self.holiday_country,
                 )
                 df = self.transformers[i].fit_transform(df)
                 # convert to DataFrame only if it isn't already
                 if not isinstance(df, pd.DataFrame):
                     df = pd.DataFrame(df, index=self.df_index, columns=self.df_colnames)
                 # update index reference if sliced
                 if transformation in ["Slice", "FastICA", "PCA"]:
@@ -3813,17 +4027,25 @@
         self.df_colnames = df.columns
         # df = df.replace([np.inf, -np.inf], 0)  # .fillna(0)
         try:
             for i in sorted(self.transformations.keys(), reverse=True):
                 c_trans_n = self.transformations[i]
                 if c_trans_n in self.oddities_list:
                     if c_trans_n in self.bounded_oddities:
+                        if not bounds:
+                            adjustment = None
+                        else:
+                            adjustment = self.adjustments.get(i, None)
                         df = self.transformers[i].inverse_transform(
-                            df, trans_method=trans_method, bounds=bounds
+                            df,
+                            trans_method=trans_method,
+                            adjustment=adjustment,
                         )
+                        if not bounds:
+                            self.adjustments[i] = self.transformers[i].adjustment
                     else:
                         df = self.transformers[i].inverse_transform(
                             df, trans_method=trans_method
                         )
                 else:
                     df = self.transformers[i].inverse_transform(df)
                 if not isinstance(df, pd.DataFrame):
@@ -3897,15 +4119,16 @@
     "MeanDifference": 0.002,
     "BTCD": 0.01,
     "Cointegration": 0.01,
     "AlignLastValue": 0.2,
     "AnomalyRemoval": 0.03,
     'HolidayTransformer': 0.01,
     'LocalLinearTrend': 0.01,
-    'KalmanSmoothing': 0.01,
+    'KalmanSmoothing': 0.04,
+    'RegressionFilter': 0.03,
 }
 # remove any slow transformers
 fast_transformer_dict = transformer_dict.copy()
 # del fast_transformer_dict["SinTrend"]
 del fast_transformer_dict["FastICA"]
 del fast_transformer_dict["Cointegration"]
 del fast_transformer_dict["BTCD"]
@@ -3938,14 +4161,15 @@
     # "RollingMeanTransformer": 0.1,  # makes for a mess with components if fixed=False
     "EWMAFilter": 0.1,
     "bkfilter": 0.1,
     "Slice": 0.01,  # sorta horizontal filter
     "AlignLastValue": 0.15,
     "KalmanSmoothing": 0.1,
     "ClipOutliers": 0.1,
+    "RegressionFilter": 0.05,
 }
 scalers = {
     "MinMaxScaler": 0.05,
     "MaxAbsScaler": 0.05,
     "StandardScaler": 0.05,
     "RobustScaler": 0.05,
     "Log": 0.03,
```

### Comparing `autots-0.5.6/autots/tools/window_functions.py` & `autots-0.5.7/autots/tools/window_functions.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/docs/conf.py` & `autots-0.5.7/docs/conf.py`

 * *Files 4% similar despite different names*

```diff
@@ -21,15 +21,15 @@
 copyright = u'%s, Colin Catlin' % date.today().year
 author = 'Colin Catlin'
 
 # The full version, including alpha/beta/rc tags
 # import AutoTS
 # from  AutoTS import __version__
 # release = __version__
-release = "0.5.6"
+release = "0.5.7"
 
 # -- General configuration ---------------------------------------------------
 
 # Add any Sphinx extension module names here, as strings. They can be
 # extensions coming with Sphinx (named 'sphinx.ext.*') or your custom
 # ones.
 # Add napoleon to the extensions list
@@ -60,15 +60,15 @@
 html_static_path = ['_static']
 
 # The name of the Pygments (syntax highlighting) style to use.
 pygments_style = 'sphinx'
 
 html_theme_options = {
     "show_powered_by": False,
-	'analytics_id': 'UA-166997414-1',
+	'analytics_id': 'G-P2KLF8302E',
 	'logo': 'autots_logo.png',
 	'description': 'Automated Forecasting',
     "github_user": "winedarksea",
     "github_repo": "autots",
     "github_banner": False,
     "show_related": False,
     "note_bg": "#FFF59C",
```

### Comparing `autots-0.5.6/pyproject.toml` & `autots-0.5.7/pyproject.toml`

 * *Files 8% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 [build-system]
 requires = ["setuptools>=61.0"]
 build-backend = "setuptools.build_meta"
 
 [project]
 name = "autots"
-version = "0.5.6"
+version = "0.5.7"
 authors = [
   { name="Colin Catlin", email="colin.catlin@gmail.com" },
 ]
 description = "Automated Time Series Forecasting"
 readme = "README.md"
 requires-python = ">=3.6"
 license = {text = "MIT License"}
```

### Comparing `autots-0.5.6/setup.py` & `autots-0.5.7/setup.py`

 * *Files 10% similar despite different names*

```diff
@@ -28,15 +28,15 @@
 }
 
 with open("README.md", "r") as fh:
     long_description = fh.read()
 
 setuptools.setup(
     name="AutoTS",
-    version="0.5.6",
+    version="0.5.7",
     author="Colin Catlin",
     author_email="colin.catlin@syllepsis.live",
     description="Automated Time Series Forecasting",
     long_description=long_description,
     long_description_content_type="text/markdown",
     url="https://github.com/winedarksea/AutoTS",
     packages=setuptools.find_packages(),
```

### Comparing `autots-0.5.6/tests/test_anomalies.py` & `autots-0.5.7/tests/test_anomalies.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/tests/test_autots.py` & `autots-0.5.7/tests/test_autots.py`

 * *Files 0% similar despite different names*

```diff
@@ -527,14 +527,15 @@
             'RollingMeanTransformer', 'bkfilter', 'cffilter', 'Log',
             'DifferencedTransformer', 'PctChangeTransformer', 'PositiveShift',
             'SineTrend', 'convolution_filter', 'CumSumTransformer',
             'AlignLastValue',  # new 0.4.3
             'AnomalyRemoval', "HolidayTransformer",  # new 0.5.0
             'LocalLinearTrend',  # new 0.5.1
             "KalmanSmoothing",  # new 0.5.1
+            # "RegressionFilter"   # new 0.5.7
         ]
 
         timings = {}
         forecasts = {}
         upper_forecasts = {}
         lower_forecasts = {}
         # load the comparison source
```

### Comparing `autots-0.5.6/tests/test_calendar_holiday.py` & `autots-0.5.7/tests/test_calendar_holiday.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,16 +1,18 @@
 # -*- coding: utf-8 -*-
 """Test calendars
 """
 import unittest
+import numpy as np
 import pandas as pd
 from autots import load_daily
 from autots.tools.calendar import gregorian_to_chinese, gregorian_to_islamic, gregorian_to_hebrew
 from autots.tools.lunar import moon_phase
 from autots.tools.holiday import holiday_flag
+from autots.tools.seasonal import date_part
 
 
 class TestCalendar(unittest.TestCase):
 
     def test_chinese(self):
         print("Starting test_chinese")
         input_dates = [
@@ -71,19 +73,91 @@
 
 class TestHolidayFlag(unittest.TestCase):
 
     def test_holiday_flag(self):
         print("Starting test_holiday_flag")
         input_dates = pd.date_range("2022-01-01", "2023-01-01", freq='D')
         flag_1 = holiday_flag(input_dates, country="US", encode_holiday_type=False, holidays_subdiv="PR")
-        self.assertAlmostEqual(flag_1.loc["2022-07-04"], 1.0)
-        self.assertAlmostEqual(flag_1.loc["2022-12-25"], 1.0)
-        self.assertAlmostEqual(flag_1.loc["2022-12-13"], 0.0)
+        self.assertAlmostEqual(flag_1.loc["2022-07-04"].iloc[0], 1.0)
+        self.assertAlmostEqual(flag_1.loc["2022-12-25"].iloc[0], 1.0)
+        self.assertAlmostEqual(flag_1.loc["2022-12-13"].iloc[0], 0.0)
 
         flag_2 = holiday_flag(input_dates, country="US", encode_holiday_type=True, holidays_subdiv=None)
         self.assertAlmostEqual(flag_2.loc["2022-12-25", 'Christmas Day'], 1.0)
         self.assertAlmostEqual(flag_2.loc["2022-12-13", "Christmas Day"], 0.0)
 
         df = load_daily(long=False)
         hflag = holiday_flag(df.index, country="US")
         test_result = hflag[(hflag.index.month == 7) & (hflag.index.day == 4)].mean()
-        self.assertEqual(test_result, 1)
+        self.assertEqual(test_result.iloc[0], 1)
+
+
+class TestSeasonal(unittest.TestCase):
+
+    def test_date_part(self):
+        print("Starting test_holiday_flag")
+        input_dates = pd.date_range("2021-01-01", "2023-01-01", freq='D')
+        date_part_df = date_part(
+            input_dates, method=['simple_binarized', 365.25, 'quarter'],
+            set_index=True, holiday_country=["US"], holiday_countries_used=True
+        )
+        # assert all numeric and not NaN
+        self.assertEqual(np.sum(date_part_df.isnull().to_numpy()), 0, msg="date part generating NaN")
+        self.assertEqual(date_part_df.select_dtypes("number").shape, date_part_df.shape)
+        # assert column names match expected
+        expected_cols = [
+            'day',
+             'weekend',
+             'epoch',
+             'month_1',
+             'month_2',
+             'month_3',
+             'month_4',
+             'month_5',
+             'month_6',
+             'month_7',
+             'month_8',
+             'month_9',
+             'month_10',
+             'month_11',
+             'month_12',
+             'weekday_0',
+             'weekday_1',
+             'weekday_2',
+             'weekday_3',
+             'weekday_4',
+             'weekday_5',
+             'weekday_6',
+             'seasonality365.25_0',
+             'seasonality365.25_1',
+             'seasonality365.25_2',
+             'seasonality365.25_3',
+             'seasonality365.25_4',
+             'seasonality365.25_5',
+             'seasonality365.25_6',
+             'seasonality365.25_7',
+             'seasonality365.25_8',
+             'seasonality365.25_9',
+             'seasonality365.25_10',
+             'seasonality365.25_11',
+             'quarter_1',
+             'quarter_2',
+             'quarter_3',
+             'quarter_4',
+             'Christmas Day',
+             'Christmas Day (Observed)',
+             'Columbus Day',
+             'Independence Day',
+             'Independence Day (Observed)',
+             'Juneteenth National Independence Day',
+             'Juneteenth National Independence Day (Observed)',
+             'Labor Day',
+             'Martin Luther King Jr. Day',
+             'Memorial Day',
+             "New Year's Day",
+             "New Year's Day (Observed)",
+             'Thanksgiving',
+             'Veterans Day',
+             'Veterans Day (Observed)',
+             "Washington's Birthday",
+         ]
+        self.assertCountEqual(date_part_df.columns.tolist(), expected_cols)
```

### Comparing `autots-0.5.6/tests/test_cassandra.py` & `autots-0.5.7/tests/test_cassandra.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/tests/test_event_forecasting.py` & `autots-0.5.7/tests/test_event_forecasting.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/tests/test_impute.py` & `autots-0.5.7/tests/test_impute.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/tests/test_metrics.py` & `autots-0.5.7/tests/test_metrics.py`

 * *Files 2% similar despite different names*

```diff
@@ -36,31 +36,31 @@
             actual,
             series_weights={'a': 10, 'b': 1, 'c': 1},
             df_train=actual,  # just used for SPL scaling
             per_timestamp_errors=False,
         )
 
         known_avg_metrics = pd.Series(
-            [40., 2., 3.162, 0.533, 4.000, 0.0, 1.240, 20.0, 1.240, 0.572, 0.467, 0.467, 3.333, 0.533, 1.509, 1.250, 4.934, 1.778, 2.614],
+            [40., 2., 3.162, 0.533, 4.000, -10.0, 1.240, 10.0, 1.240, 0.572, 0.467, 0.467, 3.333, 0.533, 1.509, 1.250, 4.934, 1.778, 2.614],
             index=[
                 'smape', 'mae', 'rmse', 'made', 'mage', 'underestimate', 'mle',
                 'overestimate', 'imle', 'spl', 'containment', 'contour', 'maxe',
                 'oda', 'dwae', 'mqae', 'ewmae', 'uwmse', 'smoothness',
             ]
         )
         known_avg_metrics_weighted = pd.Series(
-            [6.667, 0.333, 0.527, 0.089, 4.000, 0.0, 0.207, 20.0, 0.207, 0.623, 0.567, 0.717, 0.833, 0.883, 1.127, 0.208, 1.234, 0.444, 2.830],
+            [6.667, 0.333, 0.527, 0.089, 4.000, -10.0, 0.207, 10.0, 0.207, 0.623, 0.567, 0.717, 0.833, 0.883, 1.127, 0.208, 1.234, 0.444, 2.830],
             index=[
                 'smape', 'mae', 'rmse', 'made', 'mage', 'underestimate', 'mle',
                 'overestimate', 'imle', 'spl', 'containment', 'contour', 'maxe',
                 'oda', 'dwae', 'mqae', 'ewmae', 'uwmse', 'smoothness',
             ]
         )
         b_avg_metrics = pd.Series(
-            [80., 4., 6.325, 1.067, 4.000, 0.0, 2.480, 20.0, 2.480, 0.44, 0.8, 0.6, 10.0, 0.60, 2.527, 2.50, 14.803, 5.333, 2.037],
+            [80., 4., 6.325, 1.067, 4.000, -10.0, 2.480, 10.0, 2.480, 0.44, 0.8, 0.6, 10.0, 0.60, 2.527, 2.50, 14.803, 5.333, 2.037],
             index=[
                 'smape', 'mae', 'rmse', 'made', 'mage', 'underestimate',
                 'mle', 'overestimate', 'imle', 'spl', 'containment', 'contour',
                 'maxe', 'oda', 'dwae', 'mqae', 'ewmae', 'uwmse', 'smoothness',
             ]
         )
```

### Comparing `autots-0.5.6/tests/test_percentile.py` & `autots-0.5.7/tests/test_percentile.py`

 * *Files identical despite different names*

### Comparing `autots-0.5.6/tests/test_regressor.py` & `autots-0.5.7/tests/test_regressor.py`

 * *Files identical despite different names*

